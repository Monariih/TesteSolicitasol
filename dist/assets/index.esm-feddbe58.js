import{a as KC,c as hv,E as xt,d as Ph,L as On,r as ue,_ as Gg,C as X,b as jC,D as xh,e as GC,s as HC,o as zC,S as Mn,m as QC,f as At,i as YC,g as Me,h as na,F as je,j as ia,k as v,l as gl,n as ml,p as Rt,v as _l,q as yc,t as XC,u as Pe,w as dv,x as JC,y as ZC,z as ek,A as tk,B as zd,G as yl,H as we,I as _s,J as Ls,K as Jr,M as kt,N as fv,O as nk,P as vc,Q as Qd,R as E,T as Ee,U as Yd,V as ik,W as sk,X as Yi,Y as wc,Z as Xd,$ as sa,a0 as $t,a1 as pv,a2 as rk,a3 as ok,a4 as vl,a5 as ak,a6 as ck,a7 as P,a8 as Ae,a9 as Hg,aa as lk,ab as uk,ac as hk,ad as Vs}from"./index.esm2017-20e3b9f8.js";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dk{constructor(e,t){this._delegate=e,this.firebase=t,Gg(e,new X("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),jC(this._delegate)))}_getService(e,t=xh){var i;this._delegate.checkDestroyed();const s=this._delegate.container.getProvider(e);return!s.isInitialized()&&((i=s.getComponent())===null||i===void 0?void 0:i.instantiationMode)==="EXPLICIT"&&s.initialize(),s.getImmediate({identifier:t})}_removeServiceInstance(e,t=xh){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Gg(this._delegate,e)}_addOrOverwriteComponent(e){GC(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fk={["no-app"]:"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",["invalid-app-argument"]:"firebase.{$appName}() takes either no argument or a Firebase App instance."},zg=new xt("app-compat","Firebase",fk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pk(n){const e={},t={__esModule:!0,initializeApp:r,app:s,registerVersion:ue,setLogLevel:HC,onLog:zC,apps:null,SDK_VERSION:Mn,INTERNAL:{registerComponent:a,removeApp:i,useAsService:c,modularAPIs:QC}};t.default=t,Object.defineProperty(t,"apps",{get:o});function i(l){delete e[l]}function s(l){if(l=l||xh,!At(e,l))throw zg.create("no-app",{appName:l});return e[l]}s.App=n;function r(l,u={}){const h=YC(l,u);if(At(e,h.name))return e[h.name];const d=new n(h,t);return e[h.name]=d,d}function o(){return Object.keys(e).map(l=>e[l])}function a(l){const u=l.name,h=u.replace("-compat","");if(Me(l)&&l.type==="PUBLIC"){const d=(f=s())=>{if(typeof f[h]!="function")throw zg.create("invalid-app-argument",{appName:u});return f[h]()};l.serviceProps!==void 0&&Ph(d,l.serviceProps),t[h]=d,n.prototype[h]=function(...f){return this._getService.bind(this,u).apply(this,l.multipleInstances?f:[])}}return l.type==="PUBLIC"?t[h]:null}function c(l,u){return u==="serverAuth"?null:u}return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gv(){const n=pk(dk);n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:gv,extendNamespace:e,createSubscribe:hv,ErrorFactory:xt,deepExtend:Ph});function e(t){Ph(n,t)}return n}const gk=gv();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qg=new On("@firebase/app-compat"),mk="@firebase/app-compat",_k="0.2.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yk(n){ue(mk,_k,n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */if(KC()&&self.firebase!==void 0){Qg.warn(`
    Warning: Firebase is already defined in the global scope. Please make sure
    Firebase library is only loaded once.
  `);const n=self.firebase.SDK_VERSION;n&&n.indexOf("LITE")>=0&&Qg.warn(`
    Warning: You are trying to load Firebase while using Firebase Performance standalone script.
    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
    `)}const Ve=gk;yk();const mv="@firebase/installations",Jd="0.6.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _v=1e4,yv=`w:${Jd}`,vv="FIS_v2",vk="https://firebaseinstallations.googleapis.com/v1",wk=60*60*1e3,Ik="installations",Tk="Installations";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ek={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["not-registered"]:"Firebase Installation is not registered.",["installation-not-found"]:"Firebase Installation not found.",["request-failed"]:'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',["app-offline"]:"Could not process request. Application offline.",["delete-pending-registration"]:"Can't delete installation while there is a pending registration request."},Xi=new xt(Ik,Tk,Ek);function wv(n){return n instanceof je&&n.code.includes("request-failed")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iv({projectId:n}){return`${vk}/projects/${n}/installations`}function Tv(n){return{token:n.token,requestStatus:2,expiresIn:Sk(n.expiresIn),creationTime:Date.now()}}async function Ev(n,e){const i=(await e.json()).error;return Xi.create("request-failed",{requestName:n,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})}function bv({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function bk(n,{refreshToken:e}){const t=bv(n);return t.append("Authorization",Ck(e)),t}async function Sv(n){const e=await n();return e.status>=500&&e.status<600?n():e}function Sk(n){return Number(n.replace("s","000"))}function Ck(n){return`${vv} ${n}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kk({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const i=Iv(n),s=bv(n),r=e.getImmediate({optional:!0});if(r){const l=await r.getHeartbeatsHeader();l&&s.append("x-firebase-client",l)}const o={fid:t,authVersion:vv,appId:n.appId,sdkVersion:yv},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await Sv(()=>fetch(i,a));if(c.ok){const l=await c.json();return{fid:l.fid||t,registrationStatus:2,refreshToken:l.refreshToken,authToken:Tv(l.authToken)}}else throw await Ev("Create Installation",c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cv(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ak(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rk=/^[cdef][\w-]{21}$/,Oh="";function Nk(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=Dk(n);return Rk.test(t)?t:Oh}catch{return Oh}}function Dk(n){return Ak(n).substr(0,22)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wl(n){return`${n.appName}!${n.appId}`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kv=new Map;function Av(n,e){const t=wl(n);Rv(t,e),Pk(t,e)}function Rv(n,e){const t=kv.get(n);if(t)for(const i of t)i(e)}function Pk(n,e){const t=xk();t&&t.postMessage({key:n,fid:e}),Ok()}let Li=null;function xk(){return!Li&&"BroadcastChannel"in self&&(Li=new BroadcastChannel("[Firebase] FID Change"),Li.onmessage=n=>{Rv(n.data.key,n.data.fid)}),Li}function Ok(){kv.size===0&&Li&&(Li.close(),Li=null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mk="firebase-installations-database",Lk=1,Ji="firebase-installations-store";let qu=null;function Zd(){return qu||(qu=ia(Mk,Lk,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(Ji)}}})),qu}async function Ic(n,e){const t=wl(n),s=(await Zd()).transaction(Ji,"readwrite"),r=s.objectStore(Ji),o=await r.get(t);return await r.put(e,t),await s.done,(!o||o.fid!==e.fid)&&Av(n,e.fid),e}async function Nv(n){const e=wl(n),i=(await Zd()).transaction(Ji,"readwrite");await i.objectStore(Ji).delete(e),await i.done}async function Il(n,e){const t=wl(n),s=(await Zd()).transaction(Ji,"readwrite"),r=s.objectStore(Ji),o=await r.get(t),a=e(o);return a===void 0?await r.delete(t):await r.put(a,t),await s.done,a&&(!o||o.fid!==a.fid)&&Av(n,a.fid),a}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ef(n){let e;const t=await Il(n.appConfig,i=>{const s=Fk(i),r=Uk(n,s);return e=r.registrationPromise,r.installationEntry});return t.fid===Oh?{installationEntry:await e}:{installationEntry:t,registrationPromise:e}}function Fk(n){const e=n||{fid:Nk(),registrationStatus:0};return Dv(e)}function Uk(n,e){if(e.registrationStatus===0){if(!navigator.onLine){const s=Promise.reject(Xi.create("app-offline"));return{installationEntry:e,registrationPromise:s}}const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=Vk(n,t);return{installationEntry:t,registrationPromise:i}}else return e.registrationStatus===1?{installationEntry:e,registrationPromise:$k(n)}:{installationEntry:e}}async function Vk(n,e){try{const t=await kk(n,e);return Ic(n.appConfig,t)}catch(t){throw wv(t)&&t.customData.serverCode===409?await Nv(n.appConfig):await Ic(n.appConfig,{fid:e.fid,registrationStatus:0}),t}}async function $k(n){let e=await Yg(n.appConfig);for(;e.registrationStatus===1;)await Cv(100),e=await Yg(n.appConfig);if(e.registrationStatus===0){const{installationEntry:t,registrationPromise:i}=await ef(n);return i||t}return e}function Yg(n){return Il(n,e=>{if(!e)throw Xi.create("installation-not-found");return Dv(e)})}function Dv(n){return Bk(n)?{fid:n.fid,registrationStatus:0}:n}function Bk(n){return n.registrationStatus===1&&n.registrationTime+_v<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function qk({appConfig:n,heartbeatServiceProvider:e},t){const i=Wk(n,t),s=bk(n,t),r=e.getImmediate({optional:!0});if(r){const l=await r.getHeartbeatsHeader();l&&s.append("x-firebase-client",l)}const o={installation:{sdkVersion:yv,appId:n.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await Sv(()=>fetch(i,a));if(c.ok){const l=await c.json();return Tv(l)}else throw await Ev("Generate Auth Token",c)}function Wk(n,{fid:e}){return`${Iv(n)}/${e}/authTokens:generate`}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tf(n,e=!1){let t;const i=await Il(n.appConfig,r=>{if(!Pv(r))throw Xi.create("not-registered");const o=r.authToken;if(!e&&Gk(o))return r;if(o.requestStatus===1)return t=Kk(n,e),r;{if(!navigator.onLine)throw Xi.create("app-offline");const a=zk(r);return t=jk(n,a),a}});return t?await t:i.authToken}async function Kk(n,e){let t=await Xg(n.appConfig);for(;t.authToken.requestStatus===1;)await Cv(100),t=await Xg(n.appConfig);const i=t.authToken;return i.requestStatus===0?tf(n,e):i}function Xg(n){return Il(n,e=>{if(!Pv(e))throw Xi.create("not-registered");const t=e.authToken;return Qk(t)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}async function jk(n,e){try{const t=await qk(n,e),i=Object.assign(Object.assign({},e),{authToken:t});return await Ic(n.appConfig,i),t}catch(t){if(wv(t)&&(t.customData.serverCode===401||t.customData.serverCode===404))await Nv(n.appConfig);else{const i=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});await Ic(n.appConfig,i)}throw t}}function Pv(n){return n!==void 0&&n.registrationStatus===2}function Gk(n){return n.requestStatus===2&&!Hk(n)}function Hk(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+wk}function zk(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function Qk(n){return n.requestStatus===1&&n.requestTime+_v<Date.now()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yk(n){const e=n,{installationEntry:t,registrationPromise:i}=await ef(e);return i?i.catch(console.error):tf(e).catch(console.error),t.fid}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Xk(n,e=!1){const t=n;return await Jk(t),(await tf(t,e)).token}async function Jk(n){const{registrationPromise:e}=await ef(n);e&&await e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zk(n){if(!n||!n.options)throw Wu("App Configuration");if(!n.name)throw Wu("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Wu(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}function Wu(n){return Xi.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xv="installations",e0="installations-internal",t0=n=>{const e=n.getProvider("app").getImmediate(),t=Zk(e),i=na(e,"heartbeat");return{app:e,appConfig:t,heartbeatServiceProvider:i,_delete:()=>Promise.resolve()}},n0=n=>{const e=n.getProvider("app").getImmediate(),t=na(e,xv).getImmediate();return{getId:()=>Yk(t),getToken:s=>Xk(t,s)}};function i0(){Me(new X(xv,t0,"PUBLIC")),Me(new X(e0,n0,"PRIVATE"))}i0();ue(mv,Jd);ue(mv,Jd,"esm2017");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jg="analytics",s0="firebase_id",r0="origin",o0=60*1e3,a0="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Ov="https://www.googletagmanager.com/gtag/js";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ge=new On("@firebase/analytics");/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mv(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function c0(n,e){const t=document.createElement("script");t.src=`${Ov}?l=${n}&id=${e}`,t.async=!0,document.head.appendChild(t)}function l0(n){let e=[];return Array.isArray(window[n])?e=window[n]:window[n]=e,e}async function u0(n,e,t,i,s,r){const o=i[s];try{if(o)await e[o];else{const c=(await Mv(t)).find(l=>l.measurementId===s);c&&await e[c.appId]}}catch(a){Ge.error(a)}n("config",s,r)}async function h0(n,e,t,i,s){try{let r=[];if(s&&s.send_to){let o=s.send_to;Array.isArray(o)||(o=[o]);const a=await Mv(t);for(const c of o){const l=a.find(h=>h.measurementId===c),u=l&&e[l.appId];if(u)r.push(u);else{r=[];break}}}r.length===0&&(r=Object.values(e)),await Promise.all(r),n("event",i,s||{})}catch(r){Ge.error(r)}}function d0(n,e,t,i){async function s(r,o,a){try{r==="event"?await h0(n,e,t,o,a):r==="config"?await u0(n,e,t,i,o,a):r==="consent"?n("consent","update",a):n("set",o)}catch(c){Ge.error(c)}}return s}function f0(n,e,t,i,s){let r=function(...o){window[i].push(arguments)};return window[s]&&typeof window[s]=="function"&&(r=window[s]),window[s]=d0(r,n,e,t),{gtagCore:r,wrappedGtag:window[s]}}function p0(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Ov)&&t.src.includes(n))return t;return null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g0={["already-exists"]:"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.",["already-initialized"]:"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.",["already-initialized-settings"]:"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.",["interop-component-reg-failed"]:"Firebase Analytics Interop Component failed to instantiate: {$reason}",["invalid-analytics-context"]:"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["indexeddb-unavailable"]:"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}",["fetch-throttle"]:"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.",["config-fetch-failed"]:"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}",["no-api-key"]:'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',["no-app-id"]:'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'},Bt=new xt("analytics","Analytics",g0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m0=30,_0=1e3;class y0{constructor(e={},t=_0){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}}const Lv=new y0;function v0(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}async function w0(n){var e;const{appId:t,apiKey:i}=n,s={method:"GET",headers:v0(i)},r=a0.replace("{app-id}",t),o=await fetch(r,s);if(o.status!==200&&o.status!==304){let a="";try{const c=await o.json();!((e=c.error)===null||e===void 0)&&e.message&&(a=c.error.message)}catch{}throw Bt.create("config-fetch-failed",{httpStatus:o.status,responseMessage:a})}return o.json()}async function I0(n,e=Lv,t){const{appId:i,apiKey:s,measurementId:r}=n.options;if(!i)throw Bt.create("no-app-id");if(!s){if(r)return{measurementId:r,appId:i};throw Bt.create("no-api-key")}const o=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new b0;return setTimeout(async()=>{a.abort()},t!==void 0?t:o0),Fv({appId:i,apiKey:s,measurementId:r},o,a,e)}async function Fv(n,{throttleEndTimeMillis:e,backoffCount:t},i,s=Lv){var r;const{appId:o,measurementId:a}=n;try{await T0(i,e)}catch(c){if(a)return Ge.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${c==null?void 0:c.message}]`),{appId:o,measurementId:a};throw c}try{const c=await w0(n);return s.deleteThrottleMetadata(o),c}catch(c){const l=c;if(!E0(l)){if(s.deleteThrottleMetadata(o),a)return Ge.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${a} provided in the "measurementId" field in the local Firebase config. [${l==null?void 0:l.message}]`),{appId:o,measurementId:a};throw c}const u=Number((r=l==null?void 0:l.customData)===null||r===void 0?void 0:r.httpStatus)===503?yc(t,s.intervalMillis,m0):yc(t,s.intervalMillis),h={throttleEndTimeMillis:Date.now()+u,backoffCount:t+1};return s.setThrottleMetadata(o,h),Ge.debug(`Calling attemptFetch again in ${u} millis`),Fv(n,h,i,s)}}function T0(n,e){return new Promise((t,i)=>{const s=Math.max(e-Date.now(),0),r=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(r),i(Bt.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function E0(n){if(!(n instanceof je)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class b0{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}async function S0(n,e,t,i,s){if(s&&s.global){n("event",t,i);return}else{const r=await e,o=Object.assign(Object.assign({},i),{send_to:r});n("event",t,o)}}async function C0(n,e,t,i){if(i&&i.global)return n("set",{screen_name:t}),Promise.resolve();{const s=await e;n("config",s,{update:!0,screen_name:t})}}async function k0(n,e,t,i){if(i&&i.global)return n("set",{user_id:t}),Promise.resolve();{const s=await e;n("config",s,{update:!0,user_id:t})}}async function A0(n,e,t,i){if(i&&i.global){const s={};for(const r of Object.keys(t))s[`user_properties.${r}`]=t[r];return n("set",s),Promise.resolve()}else{const s=await e;n("config",s,{update:!0,user_properties:t})}}async function R0(n,e){const t=await n;window[`ga-disable-${t}`]=!e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N0(){if(Rt())try{await _l()}catch(n){return Ge.warn(Bt.create("indexeddb-unavailable",{errorInfo:n==null?void 0:n.toString()}).message),!1}else return Ge.warn(Bt.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;return!0}async function D0(n,e,t,i,s,r,o){var a;const c=I0(n);c.then(f=>{t[f.measurementId]=f.appId,n.options.measurementId&&f.measurementId!==n.options.measurementId&&Ge.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${f.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(f=>Ge.error(f)),e.push(c);const l=N0().then(f=>{if(f)return i.getId()}),[u,h]=await Promise.all([c,l]);p0(r)||c0(r,u.measurementId),s("js",new Date);const d=(a=o==null?void 0:o.config)!==null&&a!==void 0?a:{};return d[r0]="firebase",d.update=!0,h!=null&&(d[s0]=h),s("config",u.measurementId,d),u.measurementId}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let P0=class{constructor(e){this.app=e}_delete(){return delete Cn[this.app.options.appId],Promise.resolve()}},Cn={},Zg=[];const em={};let ac="dataLayer",Uv="gtag",tm,ra,Mh=!1;function x0(n){if(Mh)throw Bt.create("already-initialized");n.dataLayerName&&(ac=n.dataLayerName),n.gtagName&&(Uv=n.gtagName)}function O0(){const n=[];if(gl()&&n.push("This is a browser extension environment."),ml()||n.push("Cookies are not available."),n.length>0){const e=n.map((i,s)=>`(${s+1}) ${i}`).join(" "),t=Bt.create("invalid-analytics-context",{errorInfo:e});Ge.warn(t.message)}}function M0(n,e,t){O0();const i=n.options.appId;if(!i)throw Bt.create("no-app-id");if(!n.options.apiKey)if(n.options.measurementId)Ge.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`);else throw Bt.create("no-api-key");if(Cn[i]!=null)throw Bt.create("already-exists",{id:i});if(!Mh){l0(ac);const{wrappedGtag:r,gtagCore:o}=f0(Cn,Zg,em,ac,Uv);ra=r,tm=o,Mh=!0}return Cn[i]=D0(n,Zg,em,e,tm,ac,t),new P0(n)}async function L0(){if(gl()||!ml()||!Rt())return!1;try{return await _l()}catch{return!1}}function F0(n,e,t){n=v(n),C0(ra,Cn[n.app.options.appId],e,t).catch(i=>Ge.error(i))}function U0(n,e,t){n=v(n),k0(ra,Cn[n.app.options.appId],e,t).catch(i=>Ge.error(i))}function V0(n,e,t){n=v(n),A0(ra,Cn[n.app.options.appId],e,t).catch(i=>Ge.error(i))}function $0(n,e){n=v(n),R0(Cn[n.app.options.appId],e).catch(t=>Ge.error(t))}function Vv(n,e,t,i){n=v(n),S0(ra,Cn[n.app.options.appId],e,t,i).catch(s=>Ge.error(s))}const nm="@firebase/analytics",im="0.9.3";function B0(){Me(new X(Jg,(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();return M0(i,s,t)},"PUBLIC")),Me(new X("analytics-internal",n,"PRIVATE")),ue(nm,im),ue(nm,im,"esm2017");function n(e){try{const t=e.getProvider(Jg).getImmediate();return{logEvent:(i,s,r)=>Vv(t,i,s,r)}}catch(t){throw Bt.create("interop-component-reg-failed",{reason:t})}}}B0();const q0="@firebase/analytics-compat",W0="0.2.3";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $v{constructor(e,t){this.app=e,this._delegate=t}logEvent(e,t,i){Vv(this._delegate,e,t,i)}setCurrentScreen(e,t){F0(this._delegate,e,t)}setUserId(e,t){U0(this._delegate,e,t)}setUserProperties(e,t){V0(this._delegate,e,t)}setAnalyticsCollectionEnabled(e){$0(this._delegate,e)}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Lh;(function(n){n.ADD_SHIPPING_INFO="add_shipping_info",n.ADD_PAYMENT_INFO="add_payment_info",n.ADD_TO_CART="add_to_cart",n.ADD_TO_WISHLIST="add_to_wishlist",n.BEGIN_CHECKOUT="begin_checkout",n.CHECKOUT_PROGRESS="checkout_progress",n.EXCEPTION="exception",n.GENERATE_LEAD="generate_lead",n.LOGIN="login",n.PAGE_VIEW="page_view",n.PURCHASE="purchase",n.REFUND="refund",n.REMOVE_FROM_CART="remove_from_cart",n.SCREEN_VIEW="screen_view",n.SEARCH="search",n.SELECT_CONTENT="select_content",n.SELECT_ITEM="select_item",n.SELECT_PROMOTION="select_promotion",n.SET_CHECKOUT_OPTION="set_checkout_option",n.SHARE="share",n.SIGN_UP="sign_up",n.TIMING_COMPLETE="timing_complete",n.VIEW_CART="view_cart",n.VIEW_ITEM="view_item",n.VIEW_ITEM_LIST="view_item_list",n.VIEW_PROMOTION="view_promotion",n.VIEW_SEARCH_RESULTS="view_search_results"})(Lh||(Lh={}));/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const K0=n=>{const e=n.getProvider("app-compat").getImmediate(),t=n.getProvider("analytics").getImmediate();return new $v(e,t)};function j0(){const n={Analytics:$v,settings:x0,isSupported:L0,EventName:Lh};Ve.INTERNAL.registerComponent(new X("analytics-compat",K0,"PUBLIC").setServiceProps(n).setMultipleInstances(!0))}j0();Ve.registerVersion(q0,W0);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fh=new Map,Bv={activated:!1,tokenObservers:[]},G0={initialized:!1,enabled:!1};function Qe(n){return Fh.get(n)||Object.assign({},Bv)}function H0(n,e){return Fh.set(n,e),Fh.get(n)}function Tl(){return G0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nf="https://content-firebaseappcheck.googleapis.com/v1",z0="exchangeRecaptchaV3Token",Q0="exchangeRecaptchaEnterpriseToken",Y0="exchangeDebugToken",sm={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},X0=24*60*60*1e3;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J0{constructor(e,t,i,s,r){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=s,this.upperBound=r,this.pending=null,this.nextErrorWaitInterval=s,s>r)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}async process(e){this.stop();try{this.pending=new Pe,await Z0(this.getNextRun(e)),this.pending.resolve(),await this.pending.promise,this.pending=new Pe,await this.operation(),this.pending.resolve(),await this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}function Z0(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eA={["already-initialized"]:"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.",["use-before-activation"]:"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.",["fetch-network-error"]:"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",["fetch-parse-error"]:"Fetch client could not parse response. Original error: {$originalErrorMessage}.",["fetch-status-error"]:"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",["storage-open"]:"Error thrown when opening storage. Original error: {$originalErrorMessage}.",["storage-get"]:"Error thrown when reading from storage. Original error: {$originalErrorMessage}.",["storage-set"]:"Error thrown when writing to storage. Original error: {$originalErrorMessage}.",["recaptcha-error"]:"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},lt=new xt("appCheck","AppCheck",eA);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tc(n=!1){var e;return n?(e=self.grecaptcha)===null||e===void 0?void 0:e.enterprise:self.grecaptcha}function qv(n){if(!Qe(n).activated)throw lt.create("use-before-activation",{appName:n.name})}function sf(n){const e=Math.round(n/1e3),t=Math.floor(e/(3600*24)),i=Math.floor((e-t*3600*24)/3600),s=Math.floor((e-t*3600*24-i*3600)/60),r=e-t*3600*24-i*3600-s*60;let o="";return t&&(o+=Wa(t)+"d:"),i&&(o+=Wa(i)+"h:"),o+=Wa(s)+"m:"+Wa(r)+"s",o}function Wa(n){return n===0?"00":n>=10?n.toString():"0"+n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rf({url:n,body:e},t){const i={"Content-Type":"application/json"},s=t.getImmediate({optional:!0});if(s){const h=await s.getHeartbeatsHeader();h&&(i["X-Firebase-Client"]=h)}const r={method:"POST",body:JSON.stringify(e),headers:i};let o;try{o=await fetch(n,r)}catch(h){throw lt.create("fetch-network-error",{originalErrorMessage:h==null?void 0:h.message})}if(o.status!==200)throw lt.create("fetch-status-error",{httpStatus:o.status});let a;try{a=await o.json()}catch(h){throw lt.create("fetch-parse-error",{originalErrorMessage:h==null?void 0:h.message})}const c=a.ttl.match(/^([\d.]+)(s)$/);if(!c||!c[2]||isNaN(Number(c[1])))throw lt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${a.ttl}`});const l=Number(c[1])*1e3,u=Date.now();return{token:a.token,expireTimeMillis:u+l,issuedAtTimeMillis:u}}function tA(n,e){const{projectId:t,appId:i,apiKey:s}=n.options;return{url:`${nf}/projects/${t}/apps/${i}:${z0}?key=${s}`,body:{recaptcha_v3_token:e}}}function nA(n,e){const{projectId:t,appId:i,apiKey:s}=n.options;return{url:`${nf}/projects/${t}/apps/${i}:${Q0}?key=${s}`,body:{recaptcha_enterprise_token:e}}}function iA(n,e){const{projectId:t,appId:i,apiKey:s}=n.options;return{url:`${nf}/projects/${t}/apps/${i}:${Y0}?key=${s}`,body:{debug_token:e}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sA="firebase-app-check-database",rA=1,wo="firebase-app-check-store",Wv="debug-token";let Ka=null;function Kv(){return Ka||(Ka=new Promise((n,e)=>{try{const t=indexedDB.open(sA,rA);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var s;e(lt.create("storage-open",{originalErrorMessage:(s=i.target.error)===null||s===void 0?void 0:s.message}))},t.onupgradeneeded=i=>{const s=i.target.result;switch(i.oldVersion){case 0:s.createObjectStore(wo,{keyPath:"compositeKey"})}}}catch(t){e(lt.create("storage-open",{originalErrorMessage:t==null?void 0:t.message}))}}),Ka)}function oA(n){return Gv(Hv(n))}function aA(n,e){return jv(Hv(n),e)}function cA(n){return jv(Wv,n)}function lA(){return Gv(Wv)}async function jv(n,e){const i=(await Kv()).transaction(wo,"readwrite"),r=i.objectStore(wo).put({compositeKey:n,value:e});return new Promise((o,a)=>{r.onsuccess=c=>{o()},i.onerror=c=>{var l;a(lt.create("storage-set",{originalErrorMessage:(l=c.target.error)===null||l===void 0?void 0:l.message}))}})}async function Gv(n){const t=(await Kv()).transaction(wo,"readonly"),s=t.objectStore(wo).get(n);return new Promise((r,o)=>{s.onsuccess=a=>{const c=a.target.result;r(c?c.value:void 0)},t.onerror=a=>{var c;o(lt.create("storage-get",{originalErrorMessage:(c=a.target.error)===null||c===void 0?void 0:c.message}))}})}function Hv(n){return`${n.options.appId}-${n.name}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Io=new On("@firebase/app-check");/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uA(n){if(Rt()){let e;try{e=await oA(n)}catch(t){Io.warn(`Failed to read token from IndexedDB. Error: ${t}`)}return e}}function Ku(n,e){return Rt()?aA(n,e).catch(t=>{Io.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}async function hA(){let n;try{n=await lA()}catch{}if(n)return n;{const e=ek();return cA(e).catch(t=>Io.warn(`Failed to persist debug token to IndexedDB. Error: ${t}`)),e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zv(){return Tl().enabled}async function Qv(){const n=Tl();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)}function dA(){const n=ZC(),e=Tl();if(e.initialized=!0,typeof n.FIREBASE_APPCHECK_DEBUG_TOKEN!="string"&&n.FIREBASE_APPCHECK_DEBUG_TOKEN!==!0)return;e.enabled=!0;const t=new Pe;e.token=t,typeof n.FIREBASE_APPCHECK_DEBUG_TOKEN=="string"?t.resolve(n.FIREBASE_APPCHECK_DEBUG_TOKEN):t.resolve(hA())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fA={error:"UNKNOWN_ERROR"};function pA(n){return dv.encodeString(JSON.stringify(n),!1)}async function Ec(n,e=!1){const t=n.app;qv(t);const i=Qe(t);let s=i.token,r;if(s&&!Fs(s)&&(i.token=void 0,s=void 0),!s){const c=await i.cachedTokenPromise;c&&(Fs(c)?s=c:await Ku(t,void 0))}if(!e&&s&&Fs(s))return{token:s.token};let o=!1;if(zv()){i.exchangeTokenPromise||(i.exchangeTokenPromise=rf(iA(t,await Qv()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),o=!0);const c=await i.exchangeTokenPromise;return await Ku(t,c),i.token=c,{token:c.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),o=!0),s=await Qe(t).exchangeTokenPromise}catch(c){c.code==="appCheck/throttled"?Io.warn(c.message):Io.error(c),r=c}let a;return s?r?Fs(s)?a={token:s.token,internalError:r}:a=om(r):(a={token:s.token},i.token=s,await Ku(t,s)):a=om(r),o&&Yv(t,a),a}function of(n,e,t,i){const{app:s}=n,r=Qe(s),o={next:t,error:i,type:e};if(r.tokenObservers=[...r.tokenObservers,o],r.token&&Fs(r.token)){const a=r.token;Promise.resolve().then(()=>{t({token:a.token}),rm(n)}).catch(()=>{})}r.cachedTokenPromise.then(()=>rm(n))}function af(n,e){const t=Qe(n),i=t.tokenObservers.filter(s=>s.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function rm(n){const{app:e}=n,t=Qe(e);let i=t.tokenRefresher;i||(i=gA(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function gA(n){const{app:e}=n;return new J0(async()=>{const t=Qe(e);let i;if(t.token?i=await Ec(n,!0):i=await Ec(n),i.error)throw i.error;if(i.internalError)throw i.internalError},()=>!0,()=>{const t=Qe(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5;const s=t.token.expireTimeMillis-5*60*1e3;return i=Math.min(i,s),Math.max(0,i-Date.now())}else return 0},sm.RETRIAL_MIN_WAIT,sm.RETRIAL_MAX_WAIT)}function Yv(n,e){const t=Qe(n).tokenObservers;for(const i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function Fs(n){return n.expireTimeMillis-Date.now()>0}function om(n){return{token:pA(fA),error:n}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mA=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=Qe(this.app);for(const t of e)af(this.app,t.next);return Promise.resolve()}};function _A(n,e){return new mA(n,e)}function yA(n){return{getToken:e=>Ec(n,e),addTokenListener:e=>of(n,"INTERNAL",e),removeTokenListener:e=>af(n.app,e)}}const vA="@firebase/app-check",wA="0.6.3";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IA="https://www.google.com/recaptcha/api.js",TA="https://www.google.com/recaptcha/enterprise.js";function EA(n,e){const t=new Pe,i=Qe(n);i.reCAPTCHAState={initialized:t};const s=Xv(n),r=Tc(!1);return r?bc(n,e,r,s,t):CA(()=>{const o=Tc(!1);if(!o)throw new Error("no recaptcha");bc(n,e,o,s,t)}),t.promise}function bA(n,e){const t=new Pe,i=Qe(n);i.reCAPTCHAState={initialized:t};const s=Xv(n),r=Tc(!0);return r?bc(n,e,r,s,t):kA(()=>{const o=Tc(!0);if(!o)throw new Error("no recaptcha");bc(n,e,o,s,t)}),t.promise}function bc(n,e,t,i,s){t.ready(()=>{SA(n,e,t,i),s.resolve(t)})}function Xv(n){const e=`fire_app_check_${n.name}`,t=document.createElement("div");return t.id=e,t.style.display="none",document.body.appendChild(t),e}async function Jv(n){qv(n);const t=await Qe(n).reCAPTCHAState.initialized.promise;return new Promise((i,s)=>{const r=Qe(n).reCAPTCHAState;t.ready(()=>{i(t.execute(r.widgetId,{action:"fire_app_check"}))})})}function SA(n,e,t,i){const s=t.render(i,{sitekey:e,size:"invisible"}),r=Qe(n);r.reCAPTCHAState=Object.assign(Object.assign({},r.reCAPTCHAState),{widgetId:s})}function CA(n){const e=document.createElement("script");e.src=IA,e.onload=n,document.head.appendChild(e)}function kA(n){const e=document.createElement("script");e.src=TA,e.onload=n,document.head.appendChild(e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class To{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e,t;ew(this._throttleData);const i=await Jv(this._app).catch(r=>{throw lt.create("recaptcha-error")});let s;try{s=await rf(tA(this._app,i),this._heartbeatServiceProvider)}catch(r){throw!((e=r.code)===null||e===void 0)&&e.includes("fetch-status-error")?(this._throttleData=Zv(Number((t=r.customData)===null||t===void 0?void 0:t.httpStatus),this._throttleData),lt.create("throttled",{time:sf(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):r}return this._throttleData=null,s}initialize(e){this._app=e,this._heartbeatServiceProvider=na(e,"heartbeat"),EA(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof To?this._siteKey===e._siteKey:!1}}class El{constructor(e){this._siteKey=e,this._throttleData=null}async getToken(){var e,t;ew(this._throttleData);const i=await Jv(this._app).catch(r=>{throw lt.create("recaptcha-error")});let s;try{s=await rf(nA(this._app,i),this._heartbeatServiceProvider)}catch(r){throw!((e=r.code)===null||e===void 0)&&e.includes("fetch-status-error")?(this._throttleData=Zv(Number((t=r.customData)===null||t===void 0?void 0:t.httpStatus),this._throttleData),lt.create("throttled",{time:sf(this._throttleData.allowRequestsAfter-Date.now()),httpStatus:this._throttleData.httpStatus})):r}return this._throttleData=null,s}initialize(e){this._app=e,this._heartbeatServiceProvider=na(e,"heartbeat"),bA(e,this._siteKey).catch(()=>{})}isEqual(e){return e instanceof El?this._siteKey===e._siteKey:!1}}class Eo{constructor(e){this._customProviderOptions=e}async getToken(){const e=await this._customProviderOptions.getToken(),t=XC(e.token),i=t!==null&&t<Date.now()&&t>0?t*1e3:Date.now();return Object.assign(Object.assign({},e),{issuedAtTimeMillis:i})}initialize(e){this._app=e}isEqual(e){return e instanceof Eo?this._customProviderOptions.getToken.toString()===e._customProviderOptions.getToken.toString():!1}}function Zv(n,e){if(n===404||n===403)return{backoffCount:1,allowRequestsAfter:Date.now()+X0,httpStatus:n};{const t=e?e.backoffCount:0,i=yc(t,1e3,2);return{backoffCount:t+1,allowRequestsAfter:Date.now()+i,httpStatus:n}}}function ew(n){if(n&&Date.now()-n.allowRequestsAfter<=0)throw lt.create("throttled",{time:sf(n.allowRequestsAfter-Date.now()),httpStatus:n.httpStatus})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function AA(n=JC(),e){n=v(n);const t=na(n,"app-check");if(Tl().initialized||dA(),zv()&&Qv().then(s=>console.log(`App Check debug token: ${s}. You will need to add it to your app's App Check settings in the Firebase console for it to work.`)),t.isInitialized()){const s=t.getImmediate(),r=t.getOptions();if(r.isTokenAutoRefreshEnabled===e.isTokenAutoRefreshEnabled&&r.provider.isEqual(e.provider))return s;throw lt.create("already-initialized",{appName:n.name})}const i=t.initialize({options:e});return RA(n,e.provider,e.isTokenAutoRefreshEnabled),Qe(n).isTokenAutoRefreshEnabled&&of(i,"INTERNAL",()=>{}),i}function RA(n,e,t){const i=H0(n,Object.assign({},Bv));i.activated=!0,i.provider=e,i.cachedTokenPromise=uA(n).then(s=>(s&&Fs(s)&&(i.token=s,Yv(n,{token:s.token})),s)),i.isTokenAutoRefreshEnabled=t===void 0?n.automaticDataCollectionEnabled:t,i.provider.initialize(n)}function NA(n,e){const t=n.app,i=Qe(t);i.tokenRefresher&&(e===!0?i.tokenRefresher.start():i.tokenRefresher.stop()),i.isTokenAutoRefreshEnabled=e}async function DA(n,e){const t=await Ec(n,e);if(t.error)throw t.error;return{token:t.token}}function PA(n,e,t,i){let s=()=>{},r=()=>{};return e.next!=null?s=e.next.bind(e):s=e,e.error!=null?r=e.error.bind(e):t&&(r=t),of(n,"EXTERNAL",s,r),()=>af(n.app,s)}const xA="app-check",am="app-check-internal";function OA(){Me(new X(xA,n=>{const e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return _A(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(am).initialize()})),Me(new X(am,n=>{const e=n.getProvider("app-check").getImmediate();return yA(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),ue(vA,wA)}OA();const MA="@firebase/app-check-compat",LA="0.3.3";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FA={["use-before-activation"]:"App Check is being used before activate() is called for FirebaseApp {$appName}. Call activate() before instantiating other Firebase services."},ju=new xt("appCheck","AppCheck",FA);/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UA{constructor(e){this.app=e}activate(e,t){let i;typeof e=="string"?i=new To(e):e instanceof El||e instanceof To||e instanceof Eo?i=e:i=new Eo({getToken:e.getToken}),this._delegate=AA(this.app,{provider:i,isTokenAutoRefreshEnabled:t})}setTokenAutoRefreshEnabled(e){if(!this._delegate)throw ju.create("use-before-activation",{appName:this.app.name});NA(this._delegate,e)}getToken(e){if(!this._delegate)throw ju.create("use-before-activation",{appName:this.app.name});return DA(this._delegate,e)}onTokenChanged(e,t,i){if(!this._delegate)throw ju.create("use-before-activation",{appName:this.app.name});return PA(this._delegate,e,t)}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VA=n=>{const e=n.getProvider("app-compat").getImmediate();return new UA(e)};function $A(){Ve.INTERNAL.registerComponent(new X("appCheck-compat",VA,"PUBLIC").setServiceProps({ReCaptchaEnterpriseProvider:El,ReCaptchaV3Provider:To,CustomProvider:Eo}))}$A();Ve.registerVersion(MA,LA);function cf(n,e){var t={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(n);s<i.length;s++)e.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(n,i[s])&&(t[i[s]]=n[i[s]]);return t}const Fr={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",PHONE:"phone",TWITTER:"twitter.com"},As={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BA(){return{["admin-restricted-operation"]:"This operation is restricted to administrators only.",["argument-error"]:"",["app-not-authorized"]:"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.",["app-not-installed"]:"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.",["captcha-check-failed"]:"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.",["code-expired"]:"The SMS code has expired. Please re-send the verification code to try again.",["cordova-not-ready"]:"Cordova framework is not ready.",["cors-unsupported"]:"This browser is not supported.",["credential-already-in-use"]:"This credential is already associated with a different user account.",["custom-token-mismatch"]:"The custom token corresponds to a different audience.",["requires-recent-login"]:"This operation is sensitive and requires recent authentication. Log in again before retrying this request.",["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.",["dynamic-link-not-activated"]:"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.",["email-change-needs-verification"]:"Multi-factor users must always have a verified email.",["email-already-in-use"]:"The email address is already in use by another account.",["emulator-config-failed"]:'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',["expired-action-code"]:"The action code has expired.",["cancelled-popup-request"]:"This operation has been cancelled due to another conflicting popup being opened.",["internal-error"]:"An internal AuthError has occurred.",["invalid-app-credential"]:"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.",["invalid-app-id"]:"The mobile app identifier is not registed for the current project.",["invalid-user-token"]:"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.",["invalid-auth-event"]:"An internal AuthError has occurred.",["invalid-verification-code"]:"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.",["invalid-continue-uri"]:"The continue URL provided in the request is invalid.",["invalid-cordova-configuration"]:"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.",["invalid-custom-token"]:"The custom token format is incorrect. Please check the documentation.",["invalid-dynamic-link-domain"]:"The provided dynamic link domain is not configured or authorized for the current project.",["invalid-email"]:"The email address is badly formatted.",["invalid-emulator-scheme"]:"Emulator URL must start with a valid scheme (http:// or https://).",["invalid-api-key"]:"Your API key is invalid, please check you have copied it correctly.",["invalid-cert-hash"]:"The SHA-1 certificate hash provided is invalid.",["invalid-credential"]:"The supplied auth credential is malformed or has expired.",["invalid-message-payload"]:"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-multi-factor-session"]:"The request does not contain a valid proof of first factor successful sign-in.",["invalid-oauth-provider"]:"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.",["invalid-oauth-client-id"]:"The OAuth client ID provided is either invalid or does not match the specified API key.",["unauthorized-domain"]:"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.",["invalid-action-code"]:"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.",["wrong-password"]:"The password is invalid or the user does not have a password.",["invalid-persistence-type"]:"The specified persistence type is invalid. It can only be local, session or none.",["invalid-phone-number"]:"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].",["invalid-provider-id"]:"The specified provider ID is invalid.",["invalid-recipient-email"]:"The email corresponding to this action failed to send as the provided recipient email address is invalid.",["invalid-sender"]:"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.",["invalid-verification-id"]:"The verification ID used to create the phone auth credential is invalid.",["invalid-tenant-id"]:"The Auth instance's tenant ID is invalid.",["login-blocked"]:"Login blocked by user-provided method: {$originalMessage}",["missing-android-pkg-name"]:"An Android Package Name must be provided if the Android App is required to be installed.",["auth-domain-config-required"]:"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.",["missing-app-credential"]:"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.",["missing-verification-code"]:"The phone auth credential was created with an empty SMS verification code.",["missing-continue-uri"]:"A continue URL must be provided in the request.",["missing-iframe-start"]:"An internal AuthError has occurred.",["missing-ios-bundle-id"]:"An iOS Bundle ID must be provided if an App Store ID is provided.",["missing-or-invalid-nonce"]:"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.",["missing-multi-factor-info"]:"No second factor identifier is provided.",["missing-multi-factor-session"]:"The request is missing proof of first factor successful sign-in.",["missing-phone-number"]:"To send verification codes, provide a phone number for the recipient.",["missing-verification-id"]:"The phone auth credential was created with an empty verification ID.",["app-deleted"]:"This instance of FirebaseApp has been deleted.",["multi-factor-info-not-found"]:"The user does not have a second factor matching the identifier provided.",["multi-factor-auth-required"]:"Proof of ownership of a second factor is required to complete sign-in.",["account-exists-with-different-credential"]:"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.",["network-request-failed"]:"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.",["no-auth-event"]:"An internal AuthError has occurred.",["no-such-provider"]:"User was not linked to an account with the given provider.",["null-user"]:"A null user object was provided as the argument for an operation which requires a non-null user object.",["operation-not-allowed"]:"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.",["operation-not-supported-in-this-environment"]:'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',["popup-blocked"]:"Unable to establish a connection with the popup. It may have been blocked by the browser.",["popup-closed-by-user"]:"The popup has been closed by the user before finalizing the operation.",["provider-already-linked"]:"User can only be linked to one identity for the given provider.",["quota-exceeded"]:"The project's quota for this operation has been exceeded.",["redirect-cancelled-by-user"]:"The redirect operation has been cancelled by the user before finalizing.",["redirect-operation-pending"]:"A redirect sign-in operation is already pending.",["rejected-credential"]:"The request contains malformed or mismatching credentials.",["second-factor-already-in-use"]:"The second factor is already enrolled on this account.",["maximum-second-factor-count-exceeded"]:"The maximum allowed number of second factors on a user has been exceeded.",["tenant-id-mismatch"]:"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.",["user-token-expired"]:"The user's credential is no longer valid. The user must sign in again.",["too-many-requests"]:"We have blocked all requests from this device due to unusual activity. Try again later.",["unauthorized-continue-uri"]:"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.",["unsupported-first-factor"]:"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.",["unsupported-persistence-type"]:"The current environment does not support the specified persistence type.",["unsupported-tenant-operation"]:"This operation is not supported in a multi-tenant context.",["unverified-email"]:"The operation requires a verified email.",["user-cancelled"]:"The user did not grant your application the permissions it requested.",["user-not-found"]:"There is no user record corresponding to this identifier. The user may have been deleted.",["user-disabled"]:"The user account has been disabled by an administrator.",["user-mismatch"]:"The supplied credentials do not correspond to the previously signed in user.",["user-signed-out"]:"",["weak-password"]:"The password must be 6 characters long or more.",["web-storage-unsupported"]:"This browser is not supported or 3rd party cookies and data may be disabled.",["already-initialized"]:"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}}function tw(){return{["dependent-sdk-initialized-before-auth"]:"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const qA=BA,WA=tw,nw=new xt("auth","Firebase",tw());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cm=new On("@firebase/auth");function cc(n,...e){cm.logLevel<=kt.ERROR&&cm.error(`Auth (${Mn}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ye(n,...e){throw lf(n,...e)}function He(n,...e){return lf(n,...e)}function iw(n,e,t){const i=Object.assign(Object.assign({},WA()),{[e]:t});return new xt("auth","Firebase",i).create(e,{appName:n.name})}function yr(n,e,t){const i=t;if(!(e instanceof i))throw i.name!==e.constructor.name&&Ye(n,"argument-error"),iw(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function lf(n,...e){if(typeof n!="string"){const t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return nw.create(n,...e)}function T(n,e,...t){if(!n)throw lf(e,...t)}function sn(n){const e="INTERNAL ASSERTION FAILED: "+n;throw cc(e),new Error(e)}function Qt(n,e){n||sn(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lm=new Map;function St(n){Qt(n instanceof Function,"Expected a class definition");let e=lm.get(n);return e?(Qt(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,lm.set(n,e),e)}function KA(n,e){const t=(e==null?void 0:e.persistence)||[],i=(Array.isArray(t)?t:[t]).map(St);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e==null?void 0:e.popupRedirectResolver)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bo(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function uf(){return um()==="http:"||um()==="https:"}function um(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jA(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(uf()||gl()||"connection"in navigator)?navigator.onLine:!0}function GA(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oa{constructor(e,t){this.shortDelay=e,this.longDelay=t,Qt(t>e,"Short delay should be less than long delay!"),this.isMobile=zd()||yl()}get(){return jA()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hf(n,e){Qt(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sw{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;sn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;sn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;sn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const HA={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zA=new oa(3e4,6e4);function Se(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function $e(n,e,t,i,s={}){return rw(n,s,async()=>{let r={},o={};i&&(e==="GET"?o=i:r={body:JSON.stringify(i)});const a=_s(Object.assign({key:n.config.apiKey},o)).slice(1),c=await n._getAdditionalHeaders();return c["Content-Type"]="application/json",n.languageCode&&(c["X-Firebase-Locale"]=n.languageCode),sw.fetch()(ow(n,n.config.apiHost,t,a),Object.assign({method:e,headers:c,referrerPolicy:"no-referrer"},r))})}async function rw(n,e,t){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},HA),e);try{const s=new QA(n),r=await Promise.race([t(),s.promise]);s.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw Zr(n,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const a=r.ok?o.errorMessage:o.error.message,[c,l]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw Zr(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw Zr(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw Zr(n,"user-disabled",o);const u=i[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw iw(n,u,l);Ye(n,u)}}catch(s){if(s instanceof je)throw s;Ye(n,"network-request-failed")}}async function Ln(n,e,t,i,s={}){const r=await $e(n,e,t,i,s);return"mfaPendingCredential"in r&&Ye(n,"multi-factor-auth-required",{_serverResponse:r}),r}function ow(n,e,t,i){const s=`${e}${t}?${i}`;return n.config.emulator?hf(n.config,s):`${n.config.apiScheme}://${s}`}class QA{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(He(this.auth,"network-request-failed")),zA.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Zr(n,e,t){const i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);const s=He(n,e,i);return s.customData._tokenResponse=t,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YA(n,e){return $e(n,"POST","/v1/accounts:delete",e)}async function XA(n,e){return $e(n,"POST","/v1/accounts:update",e)}async function JA(n,e){return $e(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function so(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function ZA(n,e=!1){const t=v(n),i=await t.getIdToken(e),s=bl(i);T(s&&s.exp&&s.auth_time&&s.iat,t.auth,"internal-error");const r=typeof s.firebase=="object"?s.firebase:void 0,o=r==null?void 0:r.sign_in_provider;return{claims:s,token:i,authTime:so(Gu(s.auth_time)),issuedAtTime:so(Gu(s.iat)),expirationTime:so(Gu(s.exp)),signInProvider:o||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function Gu(n){return Number(n)*1e3}function bl(n){const[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return cc("JWT malformed, contained fewer than 3 sections"),null;try{const s=nk(t);return s?JSON.parse(s):(cc("Failed to decode base64 JWT payload"),null)}catch(s){return cc("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function eR(n){const e=bl(n);return T(e,"internal-error"),T(typeof e.exp<"u","internal-error"),T(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Nn(n,e,t=!1){if(t)return e;try{return await e}catch(i){throw i instanceof je&&tR(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function tR({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nR{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const s=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aw{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=so(this.lastLoginAt),this.creationTime=so(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function So(n){var e;const t=n.auth,i=await n.getIdToken(),s=await Nn(n,JA(t,{idToken:i}));T(s==null?void 0:s.users.length,t,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const o=!((e=r.providerUserInfo)===null||e===void 0)&&e.length?rR(r.providerUserInfo):[],a=sR(n.providerData,o),c=n.isAnonymous,l=!(n.email&&r.passwordHash)&&!(a!=null&&a.length),u=c?l:!1,h={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new aw(r.createdAt,r.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function iR(n){const e=v(n);await So(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function sR(n,e){return[...n.filter(i=>!e.some(s=>s.providerId===i.providerId)),...e]}function rR(n){return n.map(e=>{var{providerId:t}=e,i=cf(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oR(n,e){const t=await rw(n,{},async()=>{const i=_s({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:s,apiKey:r}=n.config,o=ow(n,s,"/v1/token",`key=${r}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",sw.fetch()(o,{method:"POST",headers:a,body:i})});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Co{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){T(e.idToken,"internal-error"),T(typeof e.idToken<"u","internal-error"),T(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):eR(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return T(!this.accessToken||this.refreshToken,e,"user-token-expired"),!t&&this.accessToken&&!this.isExpired?this.accessToken:this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:i,refreshToken:s,expiresIn:r}=await oR(e,t);this.updateTokensAndExpiration(i,s,Number(r))}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){const{refreshToken:i,accessToken:s,expirationTime:r}=t,o=new Co;return i&&(T(typeof i=="string","internal-error",{appName:e}),o.refreshToken=i),s&&(T(typeof s=="string","internal-error",{appName:e}),o.accessToken=s),r&&(T(typeof r=="number","internal-error",{appName:e}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Co,this.toJSON())}_performRefresh(){return sn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qn(n,e){T(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Wi{constructor(e){var{uid:t,auth:i,stsTokenManager:s}=e,r=cf(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new nR(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new aw(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){const t=await Nn(this,this.stsTokenManager.getToken(this.auth,e));return T(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return ZA(this,e)}reload(){return iR(this)}_assign(e){this!==e&&(T(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new Wi(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){T(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&await So(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await Nn(this,YA(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,s,r,o,a,c,l,u;const h=(i=t.displayName)!==null&&i!==void 0?i:void 0,d=(s=t.email)!==null&&s!==void 0?s:void 0,f=(r=t.phoneNumber)!==null&&r!==void 0?r:void 0,p=(o=t.photoURL)!==null&&o!==void 0?o:void 0,_=(a=t.tenantId)!==null&&a!==void 0?a:void 0,w=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,N=(l=t.createdAt)!==null&&l!==void 0?l:void 0,M=(u=t.lastLoginAt)!==null&&u!==void 0?u:void 0,{uid:x,emailVerified:U,isAnonymous:Q,providerData:G,stsTokenManager:me}=t;T(x&&me,e,"internal-error");const Et=Co.fromJSON(this.name,me);T(typeof x=="string",e,"internal-error"),qn(h,e.name),qn(d,e.name),T(typeof U=="boolean",e,"internal-error"),T(typeof Q=="boolean",e,"internal-error"),qn(f,e.name),qn(p,e.name),qn(_,e.name),qn(w,e.name),qn(N,e.name),qn(M,e.name);const Ci=new Wi({uid:x,auth:e,email:d,emailVerified:U,displayName:h,isAnonymous:Q,photoURL:p,phoneNumber:f,tenantId:_,stsTokenManager:Et,createdAt:N,lastLoginAt:M});return G&&Array.isArray(G)&&(Ci.providerData=G.map(WC=>Object.assign({},WC))),w&&(Ci._redirectEventId=w),Ci}static async _fromIdTokenResponse(e,t,i=!1){const s=new Co;s.updateFromServerResponse(t);const r=new Wi({uid:t.localId,auth:e,stsTokenManager:s,isAnonymous:i});return await So(r),r}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cw{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}cw.type="NONE";const Ys=cw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ki(n,e,t){return`firebase:${n}:${e}:${t}`}class $s{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;const{config:s,name:r}=this.auth;this.fullUserKey=Ki(this.userKey,s.apiKey,r),this.fullPersistenceKey=Ki("persistence",s.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?Wi._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,i="authUser"){if(!t.length)return new $s(St(Ys),e,i);const s=(await Promise.all(t.map(async l=>{if(await l._isAvailable())return l}))).filter(l=>l);let r=s[0]||St(Ys);const o=Ki(i,e.config.apiKey,e.name);let a=null;for(const l of t)try{const u=await l._get(o);if(u){const h=Wi._fromJSON(e,u);l!==r&&(a=h),r=l;break}}catch{}const c=s.filter(l=>l._shouldAllowMigration);return!r._shouldAllowMigration||!c.length?new $s(r,e,i):(r=c[0],a&&await r._set(o,a.toJSON()),await Promise.all(t.map(async l=>{if(l!==r)try{await l._remove(o)}catch{}})),new $s(r,e,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hm(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(hw(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(lw(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(dw(e))return"Blackberry";if(fw(e))return"Webos";if(df(e))return"Safari";if((e.includes("chrome/")||uw(e))&&!e.includes("edge/"))return"Chrome";if(aa(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function lw(n=we()){return/firefox\//i.test(n)}function df(n=we()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function uw(n=we()){return/crios\//i.test(n)}function hw(n=we()){return/iemobile/i.test(n)}function aa(n=we()){return/android/i.test(n)}function dw(n=we()){return/blackberry/i.test(n)}function fw(n=we()){return/webos/i.test(n)}function vr(n=we()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function aR(n=we()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(n)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(n)}function cR(n=we()){var e;return vr(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function lR(){return fv()&&document.documentMode===10}function pw(n=we()){return vr(n)||aa(n)||fw(n)||dw(n)||/windows phone/i.test(n)||hw(n)}function uR(){try{return!!(window&&window!==window.top)}catch{return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gw(n,e=[]){let t;switch(n){case"Browser":t=hm(we());break;case"Worker":t=`${hm(we())}-${n}`;break;default:t=n}const i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Mn}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hR{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const i=r=>new Promise((o,a)=>{try{const c=e(r);o(c)}catch(c){a(c)}});i.onAbort=t,this.queue.push(i);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const i of this.queue)await i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(const s of t)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dR{constructor(e,t,i){this.app=e,this.heartbeatServiceProvider=t,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new dm(this),this.idTokenSubscription=new dm(this),this.beforeStateQueue=new hR(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=nw,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=St(t)),this._initializationPromise=this.queue(async()=>{var i,s;if(!this._deleted&&(this.persistenceManager=await $s.create(this,e),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUser(e){var t;const i=await this.assertedPersistence.getCurrentUser();let s=i,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=s==null?void 0:s._redirectEventId,c=await this.tryRedirectSignIn(e);(!o||o===a)&&(c!=null&&c.user)&&(s=c.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return T(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await So(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=GA()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?v(e):null;return t&&T(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&T(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue(async()=>{await this.assertedPersistence.setPersistence(St(e))})}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new xt("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const i=await this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&St(e)||this._popupRedirectResolver;T(t,this,"argument-error"),this.redirectPersistenceManager=await $s.create(this,[St(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,i;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,s){if(this._deleted)return()=>{};const r=typeof t=="function"?t:t.next.bind(t),o=this._isInitialized?Promise.resolve():this._initializationPromise;return T(o,this,"internal-error"),o.then(()=>r(this.currentUser)),typeof t=="function"?e.addObserver(t,i,s):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return T(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=gw(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={["X-Client-Version"]:this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const i=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());return i&&(t["X-Firebase-Client"]=i),t}}function Le(n){return v(n)}class dm{constructor(e){this.auth=e,this.observer=null,this.addObserver=hv(t=>this.observer=t)}get next(){return T(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function fR(n,e,t){const i=Le(n);T(i._canInitEmulator,i,"emulator-config-failed"),T(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const s=!!(t!=null&&t.disableWarnings),r=mw(e),{host:o,port:a}=pR(e),c=a===null?"":`:${a}`;i.config.emulator={url:`${r}//${o}${c}/`},i.settings.appVerificationDisabledForTesting=!0,i.emulatorConfig=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:s})}),s||gR()}function mw(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function pR(n){const e=mw(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const i=t[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const r=s[1];return{host:r,port:fm(i.substr(r.length+1))}}else{const[r,o]=i.split(":");return{host:r,port:fm(o)}}}function fm(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function gR(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wr{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return sn("not implemented")}_getIdTokenResponse(e){return sn("not implemented")}_linkToIdToken(e,t){return sn("not implemented")}_getReauthenticationResolver(e){return sn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _w(n,e){return $e(n,"POST","/v1/accounts:resetPassword",Se(n,e))}async function yw(n,e){return $e(n,"POST","/v1/accounts:update",e)}async function mR(n,e){return $e(n,"POST","/v1/accounts:update",Se(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _R(n,e){return Ln(n,"POST","/v1/accounts:signInWithPassword",Se(n,e))}async function Sl(n,e){return $e(n,"POST","/v1/accounts:sendOobCode",Se(n,e))}async function yR(n,e){return Sl(n,e)}async function vR(n,e){return Sl(n,e)}async function wR(n,e){return Sl(n,e)}async function IR(n,e){return Sl(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TR(n,e){return Ln(n,"POST","/v1/accounts:signInWithEmailLink",Se(n,e))}async function ER(n,e){return Ln(n,"POST","/v1/accounts:signInWithEmailLink",Se(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko extends wr{constructor(e,t,i,s=null){super("password",i),this._email=e,this._password=t,this._tenantId=s}static _fromEmailAndPassword(e,t){return new ko(e,t,"password")}static _fromEmailAndCode(e,t,i=null){return new ko(e,t,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return _R(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return TR(e,{email:this._email,oobCode:this._password});default:Ye(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return yw(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return ER(e,{idToken:t,email:this._email,oobCode:this._password});default:Ye(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kn(n,e){return Ln(n,"POST","/v1/accounts:signInWithIdp",Se(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bR="http://localhost";class fn extends wr{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new fn(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Ye("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:s}=t,r=cf(t,["providerId","signInMethod"]);if(!i||!s)return null;const o=new fn(i,s);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(e){const t=this.buildRequest();return kn(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,kn(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,kn(e,t)}buildRequest(){const e={requestUri:bR,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=_s(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SR(n,e){return $e(n,"POST","/v1/accounts:sendVerificationCode",Se(n,e))}async function CR(n,e){return Ln(n,"POST","/v1/accounts:signInWithPhoneNumber",Se(n,e))}async function kR(n,e){const t=await Ln(n,"POST","/v1/accounts:signInWithPhoneNumber",Se(n,e));if(t.temporaryProof)throw Zr(n,"account-exists-with-different-credential",t);return t}const AR={USER_NOT_FOUND:"user-not-found"};async function RR(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Ln(n,"POST","/v1/accounts:signInWithPhoneNumber",Se(n,t),AR)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ji extends wr{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ji({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ji({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return CR(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return kR(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return RR(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:i,verificationCode:s}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:i,code:s}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:i,phoneNumber:s,temporaryProof:r}=e;return!i&&!t&&!s&&!r?null:new ji({verificationId:t,verificationCode:i,phoneNumber:s,temporaryProof:r})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NR(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function DR(n){const e=Ls(Jr(n)).link,t=e?Ls(Jr(e)).deep_link_id:null,i=Ls(Jr(n)).deep_link_id;return(i?Ls(Jr(i)).link:null)||i||t||e||n}class Cl{constructor(e){var t,i,s,r,o,a;const c=Ls(Jr(e)),l=(t=c.apiKey)!==null&&t!==void 0?t:null,u=(i=c.oobCode)!==null&&i!==void 0?i:null,h=NR((s=c.mode)!==null&&s!==void 0?s:null);T(l&&u&&h,"argument-error"),this.apiKey=l,this.operation=h,this.code=u,this.continueUrl=(r=c.continueUrl)!==null&&r!==void 0?r:null,this.languageCode=(o=c.languageCode)!==null&&o!==void 0?o:null,this.tenantId=(a=c.tenantId)!==null&&a!==void 0?a:null}static parseLink(e){const t=DR(e);try{return new Cl(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _i{constructor(){this.providerId=_i.PROVIDER_ID}static credential(e,t){return ko._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const i=Cl.parseLink(t);return T(i,"argument-error"),ko._fromEmailAndCode(e,i.code,i.tenantId)}}_i.PROVIDER_ID="password";_i.EMAIL_PASSWORD_SIGN_IN_METHOD="password";_i.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fn{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ir extends Fn{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Bs extends Ir{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return T("providerId"in t&&"signInMethod"in t,"argument-error"),fn._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return T(e.idToken||e.accessToken,"argument-error"),fn._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Bs.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Bs.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i,oauthTokenSecret:s,pendingToken:r,nonce:o,providerId:a}=e;if(!i&&!s&&!t&&!r||!a)return null;try{return new Bs(a)._credential({idToken:t,accessToken:i,nonce:o,pendingToken:r})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xt extends Ir{constructor(){super("facebook.com")}static credential(e){return fn._fromParams({providerId:Xt.PROVIDER_ID,signInMethod:Xt.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xt.credentialFromTaggedObject(e)}static credentialFromError(e){return Xt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Xt.credential(e.oauthAccessToken)}catch{return null}}}Xt.FACEBOOK_SIGN_IN_METHOD="facebook.com";Xt.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jt extends Ir{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return fn._fromParams({providerId:Jt.PROVIDER_ID,signInMethod:Jt.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Jt.credentialFromTaggedObject(e)}static credentialFromError(e){return Jt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:i}=e;if(!t&&!i)return null;try{return Jt.credential(t,i)}catch{return null}}}Jt.GOOGLE_SIGN_IN_METHOD="google.com";Jt.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zt extends Ir{constructor(){super("github.com")}static credential(e){return fn._fromParams({providerId:Zt.PROVIDER_ID,signInMethod:Zt.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Zt.credentialFromTaggedObject(e)}static credentialFromError(e){return Zt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Zt.credential(e.oauthAccessToken)}catch{return null}}}Zt.GITHUB_SIGN_IN_METHOD="github.com";Zt.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const PR="http://localhost";class Xs extends wr{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return kn(e,t)}_linkToIdToken(e,t){const i=this.buildRequest();return i.idToken=t,kn(e,i)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,kn(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:s,pendingToken:r}=t;return!i||!s||!r||i!==s?null:new Xs(i,r)}static _create(e,t){return new Xs(e,t)}buildRequest(){return{requestUri:PR,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xR="saml.";class Sc extends Fn{constructor(e){T(e.startsWith(xR),"argument-error"),super(e)}static credentialFromResult(e){return Sc.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return Sc.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Xs.fromJSON(e);return T(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:i}=e;if(!t||!i)return null;try{return Xs._create(i,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class en extends Ir{constructor(){super("twitter.com")}static credential(e,t){return fn._fromParams({providerId:en.PROVIDER_ID,signInMethod:en.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return en.credentialFromTaggedObject(e)}static credentialFromError(e){return en.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:i}=e;if(!t||!i)return null;try{return en.credential(t,i)}catch{return null}}}en.TWITTER_SIGN_IN_METHOD="twitter.com";en.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vw(n,e){return Ln(n,"POST","/v1/accounts:signUp",Se(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class qt{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,i,s=!1){const r=await Wi._fromIdTokenResponse(e,i,s),o=pm(i);return new qt({user:r,providerId:o,_tokenResponse:i,operationType:t})}static async _forOperation(e,t,i){await e._updateTokensIfNecessary(i,!0);const s=pm(i);return new qt({user:e,providerId:s,_tokenResponse:i,operationType:t})}}function pm(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OR(n){var e;const t=Le(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new qt({user:t.currentUser,providerId:null,operationType:"signIn"});const i=await vw(t,{returnSecureToken:!0}),s=await qt._fromIdTokenResponse(t,"signIn",i,!0);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cc extends je{constructor(e,t,i,s){var r;super(t.code,t.message),this.operationType=i,this.user=s,Object.setPrototypeOf(this,Cc.prototype),this.customData={appName:e.name,tenantId:(r=e.tenantId)!==null&&r!==void 0?r:void 0,_serverResponse:t.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,t,i,s){return new Cc(e,t,i,s)}}function ww(n,e,t,i){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?Cc._fromErrorAndOperation(n,r,e,i):r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Iw(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function MR(n,e){const t=v(n);await kl(!0,t,e);const{providerUserInfo:i}=await XA(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),s=Iw(i||[]);return t.providerData=t.providerData.filter(r=>s.has(r.providerId)),s.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function ff(n,e,t=!1){const i=await Nn(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return qt._forOperation(n,"link",i)}async function kl(n,e,t){await So(e);const i=Iw(e.providerData),s=n===!1?"provider-already-linked":"no-such-provider";T(i.has(t)===n,e.auth,s)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tw(n,e,t=!1){const{auth:i}=n,s="reauthenticate";try{const r=await Nn(n,ww(i,s,e,n),t);T(r.idToken,i,"internal-error");const o=bl(r.idToken);T(o,i,"internal-error");const{sub:a}=o;return T(n.uid===a,i,"user-mismatch"),qt._forOperation(n,s,r)}catch(r){throw(r==null?void 0:r.code)==="auth/user-not-found"&&Ye(i,"user-mismatch"),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ew(n,e,t=!1){const i="signIn",s=await ww(n,i,e),r=await qt._fromIdTokenResponse(n,i,s);return t||await n._updateCurrentUser(r.user),r}async function Al(n,e){return Ew(Le(n),e)}async function bw(n,e){const t=v(n);return await kl(!1,t,e.providerId),ff(t,e)}async function Sw(n,e){return Tw(v(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LR(n,e){return Ln(n,"POST","/v1/accounts:signInWithCustomToken",Se(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function FR(n,e){const t=Le(n),i=await LR(t,{token:e,returnSecureToken:!0}),s=await qt._fromIdTokenResponse(t,"signIn",i);return await t._updateCurrentUser(s.user),s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rl{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?pf._fromServerResponse(e,t):Ye(e,"internal-error")}}class pf extends Rl{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new pf(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nl(n,e,t){var i;T(((i=t.url)===null||i===void 0?void 0:i.length)>0,n,"invalid-continue-uri"),T(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(T(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(T(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function UR(n,e,t){const i=v(n),s={requestType:"PASSWORD_RESET",email:e};t&&Nl(i,s,t),await vR(i,s)}async function VR(n,e,t){await _w(v(n),{oobCode:e,newPassword:t})}async function $R(n,e){await mR(v(n),{oobCode:e})}async function Cw(n,e){const t=v(n),i=await _w(t,{oobCode:e}),s=i.requestType;switch(T(s,t,"internal-error"),s){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":T(i.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":T(i.mfaInfo,t,"internal-error");default:T(i.email,t,"internal-error")}let r=null;return i.mfaInfo&&(r=Rl._fromServerResponse(Le(t),i.mfaInfo)),{data:{email:(i.requestType==="VERIFY_AND_CHANGE_EMAIL"?i.newEmail:i.email)||null,previousEmail:(i.requestType==="VERIFY_AND_CHANGE_EMAIL"?i.email:i.newEmail)||null,multiFactorInfo:r},operation:s}}async function BR(n,e){const{data:t}=await Cw(v(n),e);return t.email}async function qR(n,e,t){const i=Le(n),s=await vw(i,{returnSecureToken:!0,email:e,password:t}),r=await qt._fromIdTokenResponse(i,"signIn",s);return await i._updateCurrentUser(r.user),r}function WR(n,e,t){return Al(v(n),_i.credential(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function KR(n,e,t){const i=v(n),s={requestType:"EMAIL_SIGNIN",email:e};T(t.handleCodeInApp,i,"argument-error"),t&&Nl(i,s,t),await wR(i,s)}function jR(n,e){const t=Cl.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function GR(n,e,t){const i=v(n),s=_i.credentialWithLink(e,t||bo());return T(s._tenantId===(i.tenantId||null),i,"tenant-id-mismatch"),Al(i,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HR(n,e){return $e(n,"POST","/v1/accounts:createAuthUri",Se(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zR(n,e){const t=uf()?bo():"http://localhost",i={identifier:e,continueUri:t},{signinMethods:s}=await HR(v(n),i);return s||[]}async function QR(n,e){const t=v(n),s={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Nl(t.auth,s,e);const{email:r}=await yR(t.auth,s);r!==n.email&&await n.reload()}async function YR(n,e,t){const i=v(n),r={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Nl(i.auth,r,t);const{email:o}=await IR(i.auth,r);o!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function XR(n,e){return $e(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JR(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const i=v(n),r={idToken:await i.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},o=await Nn(i,XR(i.auth,r));i.displayName=o.displayName||null,i.photoURL=o.photoUrl||null;const a=i.providerData.find(({providerId:c})=>c==="password");a&&(a.displayName=i.displayName,a.photoURL=i.photoURL),await i._updateTokensIfNecessary(o)}function ZR(n,e){return kw(v(n),e,null)}function eN(n,e){return kw(v(n),null,e)}async function kw(n,e,t){const{auth:i}=n,r={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(r.email=e),t&&(r.password=t);const o=await Nn(n,yw(i,r));await n._updateTokensIfNecessary(o,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tN(n){var e,t;if(!n)return null;const{providerId:i}=n,s=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},r=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!i&&(n!=null&&n.idToken)){const o=(t=(e=bl(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(o){const a=o!=="anonymous"&&o!=="custom"?o:null;return new qs(r,a)}}if(!i)return null;switch(i){case"facebook.com":return new nN(r,s);case"github.com":return new iN(r,s);case"google.com":return new sN(r,s);case"twitter.com":return new rN(r,s,n.screenName||null);case"custom":case"anonymous":return new qs(r,null);default:return new qs(r,i,s)}}class qs{constructor(e,t,i={}){this.isNewUser=e,this.providerId=t,this.profile=i}}class Aw extends qs{constructor(e,t,i,s){super(e,t,i),this.username=s}}class nN extends qs{constructor(e,t){super(e,"facebook.com",t)}}class iN extends Aw{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class sN extends qs{constructor(e,t){super(e,"google.com",t)}}class rN extends Aw{constructor(e,t,i){super(e,"twitter.com",t,i)}}function oN(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:tN(t)}class Fi{constructor(e,t,i){this.type=e,this.credential=t,this.auth=i}static _fromIdtoken(e,t){return new Fi("enroll",e,t)}static _fromMfaPendingCredential(e){return new Fi("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,i;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return Fi._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((i=e.multiFactorSession)===null||i===void 0)&&i.idToken)return Fi._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gf{constructor(e,t,i){this.session=e,this.hints=t,this.signInResolver=i}static _fromError(e,t){const i=Le(e),s=t.customData._serverResponse,r=(s.mfaInfo||[]).map(a=>Rl._fromServerResponse(i,a));T(s.mfaPendingCredential,i,"internal-error");const o=Fi._fromMfaPendingCredential(s.mfaPendingCredential);return new gf(o,r,async a=>{const c=await a._process(i,o);delete s.mfaInfo,delete s.mfaPendingCredential;const l=Object.assign(Object.assign({},s),{idToken:c.idToken,refreshToken:c.refreshToken});switch(t.operationType){case"signIn":const u=await qt._fromIdTokenResponse(i,t.operationType,l);return await i._updateCurrentUser(u.user),u;case"reauthenticate":return T(t.user,i,"internal-error"),qt._forOperation(t.user,t.operationType,l);default:Ye(i,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function aN(n,e){var t;const i=v(n),s=e;return T(e.customData.operationType,i,"argument-error"),T((t=s.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,i,"argument-error"),gf._fromError(i,s)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cN(n,e){return $e(n,"POST","/v2/accounts/mfaEnrollment:start",Se(n,e))}function lN(n,e){return $e(n,"POST","/v2/accounts/mfaEnrollment:finalize",Se(n,e))}function uN(n,e){return $e(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Se(n,e))}class mf{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(i=>Rl._fromServerResponse(e.auth,i)))})}static _fromUser(e){return new mf(e)}async getSession(){return Fi._fromIdtoken(await this.user.getIdToken(),this.user.auth)}async enroll(e,t){const i=e,s=await this.getSession(),r=await Nn(this.user,i._process(this.user.auth,s,t));return await this.user._updateTokensIfNecessary(r),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,i=await this.user.getIdToken();try{const s=await Nn(this.user,uN(this.user.auth,{idToken:i,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:r})=>r!==t),await this.user._updateTokensIfNecessary(s),await this.user.reload()}catch(s){throw s}}}const Hu=new WeakMap;function hN(n){const e=v(n);return Hu.has(e)||Hu.set(e,mf._fromUser(e)),Hu.get(e)}const kc="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rw{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(kc,"1"),this.storage.removeItem(kc),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dN(){const n=we();return df(n)||vr(n)}const fN=1e3,pN=10;class Nw extends Rw{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=dN()&&uR(),this.fallbackToPolling=pw(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const i=this.storage.getItem(t),s=this.localCache[t];i!==s&&e(t,s,i)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((o,a,c)=>{this.notifyListeners(o,c)});return}const i=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const o=this.storage.getItem(i);if(e.newValue!==o)e.newValue!==null?this.storage.setItem(i,e.newValue):this.storage.removeItem(i);else if(this.localCache[i]===e.newValue&&!t)return}const s=()=>{const o=this.storage.getItem(i);!t&&this.localCache[i]===o||this.notifyListeners(i,o)},r=this.storage.getItem(i);lR()&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(s,pN):s()}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:i}),!0)})},fN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Nw.type="LOCAL";const _f=Nw;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dw extends Rw{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Dw.type="SESSION";const Zi=Dw;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gN(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dl{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(s=>s.isListeningto(e));if(t)return t;const i=new Dl(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:i,eventType:s,data:r}=t.data,o=this.handlersMap[s];if(!(o!=null&&o.size))return;t.ports[0].postMessage({status:"ack",eventId:i,eventType:s});const a=Array.from(o).map(async l=>l(t.origin,r)),c=await gN(a);t.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:c})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Dl.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ca(n="",e=10){let t="";for(let i=0;i<e;i++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mN{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,i=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let r,o;return new Promise((a,c)=>{const l=ca("",20);s.port1.start();const u=setTimeout(()=>{c(new Error("unsupported_event"))},i);o={messageChannel:s,onMessage(h){const d=h;if(d.data.eventId===l)switch(d.data.status){case"ack":clearTimeout(u),r=setTimeout(()=>{c(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(d.data.response);break;default:clearTimeout(u),clearTimeout(r),c(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Te(){return window}function _N(n){Te().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yf(){return typeof Te().WorkerGlobalScope<"u"&&typeof Te().importScripts=="function"}async function yN(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function vN(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function wN(){return yf()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pw="firebaseLocalStorageDb",IN=1,Ac="firebaseLocalStorage",xw="fbase_key";class la{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Pl(n,e){return n.transaction([Ac],e?"readwrite":"readonly").objectStore(Ac)}function TN(){const n=indexedDB.deleteDatabase(Pw);return new la(n).toPromise()}function Uh(){const n=indexedDB.open(Pw,IN);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(Ac,{keyPath:xw})}catch(s){t(s)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(Ac)?e(i):(i.close(),await TN(),e(await Uh()))})})}async function gm(n,e,t){const i=Pl(n,!0).put({[xw]:e,value:t});return new la(i).toPromise()}async function EN(n,e){const t=Pl(n,!1).get(e),i=await new la(t).toPromise();return i===void 0?null:i.value}function mm(n,e){const t=Pl(n,!0).delete(e);return new la(t).toPromise()}const bN=800,SN=3;class Ow{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Uh(),this.db)}async _withRetries(e){let t=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(t++>SN)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return yf()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Dl._getInstance(wN()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await yN(),!this.activeServiceWorker)return;this.sender=new mN(this.activeServiceWorker);const i=await this.sender._send("ping",{},800);i&&!((e=i[0])===null||e===void 0)&&e.fulfilled&&!((t=i[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||vN()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Uh();return await gm(e,kc,"1"),await mm(e,kc),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(i=>gm(i,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(i=>EN(i,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>mm(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(s=>{const r=Pl(s,!1).getAll();return new la(r).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],i=new Set;for(const{fbase_key:s,value:r}of e)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(r)&&(this.notifyListeners(s,r),t.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),t.push(s));return t}notifyListeners(e,t){this.localCache[e]=t;const i=this.listeners[e];if(i)for(const s of Array.from(i))s(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),bN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Ow.type="LOCAL";const Ao=Ow;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function CN(n,e){return $e(n,"POST","/v2/accounts/mfaSignIn:start",Se(n,e))}function kN(n,e){return $e(n,"POST","/v2/accounts/mfaSignIn:finalize",Se(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function AN(n){return(await $e(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RN(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}function Mw(n){return new Promise((e,t)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=s=>{const r=He("internal-error");r.customData=s,t(r)},i.type="text/javascript",i.charset="UTF-8",RN().appendChild(i)})}function Lw(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NN=500,DN=6e4,ja=1e12;class PN{constructor(e){this.auth=e,this.counter=ja,this._widgets=new Map}render(e,t){const i=this.counter;return this._widgets.set(i,new xN(e,this.auth.name,t||{})),this.counter++,i}reset(e){var t;const i=e||ja;(t=this._widgets.get(i))===null||t===void 0||t.delete(),this._widgets.delete(i)}getResponse(e){var t;const i=e||ja;return((t=this._widgets.get(i))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const i=e||ja;return(t=this._widgets.get(i))===null||t===void 0||t.execute(),""}}class xN{constructor(e,t,i){this.params=i,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const s=typeof e=="string"?document.getElementById(e):e;T(s,"argument-error",{appName:t}),this.container=s,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=ON(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},DN)},NN))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function ON(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let i=0;i<n;i++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zu=Lw("rcb"),MN=new oa(3e4,6e4),LN="https://www.google.com/recaptcha/api.js?";class FN{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=Te().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return T(UN(t),e,"argument-error"),this.shouldResolveImmediately(t)?Promise.resolve(Te().grecaptcha):new Promise((i,s)=>{const r=Te().setTimeout(()=>{s(He(e,"network-request-failed"))},MN.get());Te()[zu]=()=>{Te().clearTimeout(r),delete Te()[zu];const a=Te().grecaptcha;if(!a){s(He(e,"internal-error"));return}const c=a.render;a.render=(l,u)=>{const h=c(l,u);return this.counter++,h},this.hostLanguage=t,i(a)};const o=`${LN}?${_s({onload:zu,render:"explicit",hl:t})}`;Mw(o).catch(()=>{clearTimeout(r),s(He(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=Te().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function UN(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class VN{async load(e){return new PN(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fw="recaptcha",$N={theme:"light",type:"image"};let BN=class{constructor(e,t=Object.assign({},$N),i){this.parameters=t,this.type=Fw,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Le(i),this.isInvisible=this.parameters.size==="invisible",T(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const s=typeof e=="string"?document.getElementById(e):e;T(s,this.auth,"argument-error"),this.container=s,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new VN:new FN,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),i=t.getResponse(e);return i||new Promise(s=>{const r=o=>{o&&(this.tokenChangeListeners.delete(r),s(o))};this.tokenChangeListeners.add(r),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){T(!this.parameters.sitekey,this.auth,"argument-error"),T(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),T(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(i=>i(t)),typeof e=="function")e(t);else if(typeof e=="string"){const i=Te()[e];typeof i=="function"&&i(t)}}}assertNotDestroyed(){T(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){T(uf()&&!yf(),this.auth,"internal-error"),await qN(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await AN(this.auth);T(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return T(this.recaptcha,this.auth,"internal-error"),this.recaptcha}};function qN(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vf{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=ji._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function WN(n,e,t){const i=Le(n),s=await xl(i,e,v(t));return new vf(s,r=>Al(i,r))}async function KN(n,e,t){const i=v(n);await kl(!1,i,"phone");const s=await xl(i.auth,e,v(t));return new vf(s,r=>bw(i,r))}async function jN(n,e,t){const i=v(n),s=await xl(i.auth,e,v(t));return new vf(s,r=>Sw(i,r))}async function xl(n,e,t){var i;const s=await t.verify();try{T(typeof s=="string",n,"argument-error"),T(t.type===Fw,n,"argument-error");let r;if(typeof e=="string"?r={phoneNumber:e}:r=e,"session"in r){const o=r.session;if("phoneNumber"in r)return T(o.type==="enroll",n,"internal-error"),(await cN(n,{idToken:o.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,recaptchaToken:s}})).phoneSessionInfo.sessionInfo;{T(o.type==="signin",n,"internal-error");const a=((i=r.multiFactorHint)===null||i===void 0?void 0:i.uid)||r.multiFactorUid;return T(a,n,"missing-multi-factor-info"),(await CN(n,{mfaPendingCredential:o.credential,mfaEnrollmentId:a,phoneSignInInfo:{recaptchaToken:s}})).phoneResponseInfo.sessionInfo}}else{const{sessionInfo:o}=await SR(n,{phoneNumber:r.phoneNumber,recaptchaToken:s});return o}}finally{t._reset()}}async function GN(n,e){await ff(v(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let an=class{constructor(e){this.providerId=an.PROVIDER_ID,this.auth=Le(e)}verifyPhoneNumber(e,t){return xl(this.auth,e,v(t))}static credential(e,t){return ji._fromVerification(e,t)}static credentialFromResult(e){const t=e;return an.credentialFromTaggedObject(t)}static credentialFromError(e){return an.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:i}=e;return t&&i?ji._fromTokenResponse(t,i):null}};an.PROVIDER_ID="phone";an.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ys(n,e){return e?St(e):(T(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wf extends wr{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return kn(e,this._buildIdpRequest())}_linkToIdToken(e,t){return kn(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return kn(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function HN(n){return Ew(n.auth,new wf(n),n.bypassAuthState)}function zN(n){const{auth:e,user:t}=n;return T(t,e,"internal-error"),Tw(t,new wf(n),n.bypassAuthState)}async function QN(n){const{auth:e,user:t}=n;return T(t,e,"internal-error"),ff(t,new wf(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uw{constructor(e,t,i,s,r=!1){this.auth=e,this.resolver=i,this.user=s,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:i,postBody:s,tenantId:r,error:o,type:a}=e;if(o){this.reject(o);return}const c={auth:this.auth,requestUri:t,sessionId:i,tenantId:r||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(c))}catch(l){this.reject(l)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return HN;case"linkViaPopup":case"linkViaRedirect":return QN;case"reauthViaPopup":case"reauthViaRedirect":return zN;default:Ye(this.auth,"internal-error")}}resolve(e){Qt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Qt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YN=new oa(2e3,1e4);async function XN(n,e,t){const i=Le(n);yr(n,e,Fn);const s=ys(i,t);return new Tn(i,"signInViaPopup",e,s).executeNotNull()}async function JN(n,e,t){const i=v(n);yr(i.auth,e,Fn);const s=ys(i.auth,t);return new Tn(i.auth,"reauthViaPopup",e,s,i).executeNotNull()}async function ZN(n,e,t){const i=v(n);yr(i.auth,e,Fn);const s=ys(i.auth,t);return new Tn(i.auth,"linkViaPopup",e,s,i).executeNotNull()}class Tn extends Uw{constructor(e,t,i,s,r){super(e,t,s,r),this.provider=i,this.authWindow=null,this.pollId=null,Tn.currentPopupAction&&Tn.currentPopupAction.cancel(),Tn.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return T(e,this.auth,"internal-error"),e}async onExecution(){Qt(this.filter.length===1,"Popup operations only handle one event");const e=ca();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(He(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(He(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Tn.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,i;if(!((i=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||i===void 0)&&i.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(He(this.auth,"popup-closed-by-user"))},2e3);return}this.pollId=window.setTimeout(e,YN.get())};e()}}Tn.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eD="pendingRedirect",ro=new Map;class tD extends Uw{constructor(e,t,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,i),this.eventId=null}async execute(){let e=ro.get(this.auth._key());if(!e){try{const i=await nD(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(t){e=()=>Promise.reject(t)}ro.set(this.auth._key(),e)}return this.bypassAuthState||ro.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function nD(n,e){const t=$w(e),i=Vw(n);if(!await i._isAvailable())return!1;const s=await i._get(t)==="true";return await i._remove(t),s}async function If(n,e){return Vw(n)._set($w(e),"true")}function iD(){ro.clear()}function Tf(n,e){ro.set(n._key(),e)}function Vw(n){return St(n._redirectPersistence)}function $w(n){return Ki(eD,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sD(n,e,t){return rD(n,e,t)}async function rD(n,e,t){const i=Le(n);yr(n,e,Fn),await i._initializationPromise;const s=ys(i,t);return await If(s,i),s._openRedirect(i,e,"signInViaRedirect")}function oD(n,e,t){return aD(n,e,t)}async function aD(n,e,t){const i=v(n);yr(i.auth,e,Fn),await i.auth._initializationPromise;const s=ys(i.auth,t);await If(s,i.auth);const r=await Bw(i);return s._openRedirect(i.auth,e,"reauthViaRedirect",r)}function cD(n,e,t){return lD(n,e,t)}async function lD(n,e,t){const i=v(n);yr(i.auth,e,Fn),await i.auth._initializationPromise;const s=ys(i.auth,t);await kl(!1,i,e.providerId),await If(s,i.auth);const r=await Bw(i);return s._openRedirect(i.auth,e,"linkViaRedirect",r)}async function uD(n,e){return await Le(n)._initializationPromise,Ol(n,e,!1)}async function Ol(n,e,t=!1){const i=Le(n),s=ys(i,e),o=await new tD(i,s,t).execute();return o&&!t&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,e)),o}async function Bw(n){const e=ca(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hD=10*60*1e3;class qw{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(t=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!dD(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var i;if(e.error&&!Ww(e)){const s=((i=e.error.code)===null||i===void 0?void 0:i.split("auth/")[1])||"internal-error";t.onError(He(this.auth,s))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const i=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=hD&&this.cachedEventUids.clear(),this.cachedEventUids.has(_m(e))}saveEventToCache(e){this.cachedEventUids.add(_m(e)),this.lastProcessedEventTime=Date.now()}}function _m(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Ww({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function dD(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ww(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kw(n,e={}){return $e(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fD=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,pD=/^https?/;async function gD(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Kw(n);for(const t of e)try{if(mD(t))return}catch{}Ye(n,"unauthorized-domain")}function mD(n){const e=bo(),{protocol:t,hostname:i}=new URL(e);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&i===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&o.hostname===i}if(!pD.test(t))return!1;if(fD.test(n))return i===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _D=new oa(3e4,6e4);function ym(){const n=Te().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function yD(n){return new Promise((e,t)=>{var i,s,r;function o(){ym(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{ym(),t(He(n,"network-request-failed"))},timeout:_D.get()})}if(!((s=(i=Te().gapi)===null||i===void 0?void 0:i.iframes)===null||s===void 0)&&s.Iframe)e(gapi.iframes.getContext());else if(!((r=Te().gapi)===null||r===void 0)&&r.load)o();else{const a=Lw("iframefcb");return Te()[a]=()=>{gapi.load?o():t(He(n,"network-request-failed"))},Mw(`https://apis.google.com/js/api.js?onload=${a}`).catch(c=>t(c))}}).catch(e=>{throw lc=null,e})}let lc=null;function vD(n){return lc=lc||yD(n),lc}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wD=new oa(5e3,15e3),ID="__/auth/iframe",TD="emulator/auth/iframe",ED={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},bD=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function SD(n){const e=n.config;T(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?hf(e,TD):`https://${n.config.authDomain}/${ID}`,i={apiKey:e.apiKey,appName:n.name,v:Mn},s=bD.get(n.config.apiHost);s&&(i.eid=s);const r=n._getFrameworks();return r.length&&(i.fw=r.join(",")),`${t}?${_s(i).slice(1)}`}async function CD(n){const e=await vD(n),t=Te().gapi;return T(t,n,"internal-error"),e.open({where:document.body,url:SD(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ED,dontclear:!0},i=>new Promise(async(s,r)=>{await i.restyle({setHideOnLeave:!1});const o=He(n,"network-request-failed"),a=Te().setTimeout(()=>{r(o)},wD.get());function c(){Te().clearTimeout(a),s(i)}i.ping(c).then(c,()=>{r(o)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kD={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},AD=500,RD=600,ND="_blank",DD="http://localhost";class vm{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function PD(n,e,t,i=AD,s=RD){const r=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c=Object.assign(Object.assign({},kD),{width:i.toString(),height:s.toString(),top:r,left:o}),l=we().toLowerCase();t&&(a=uw(l)?ND:t),lw(l)&&(e=e||DD,c.scrollbars="yes");const u=Object.entries(c).reduce((d,[f,p])=>`${d}${f}=${p},`,"");if(cR(l)&&a!=="_self")return xD(e||"",a),new vm(null);const h=window.open(e||"",a,u);T(h,n,"popup-blocked");try{h.focus()}catch{}return new vm(h)}function xD(n,e){const t=document.createElement("a");t.href=n,t.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(i)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const OD="__/auth/handler",MD="emulator/auth/handler";function Vh(n,e,t,i,s,r){T(n.config.authDomain,n,"auth-domain-config-required"),T(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:i,v:Mn,eventId:s};if(e instanceof Fn){e.setDefaultLanguage(n.languageCode),o.providerId=e.providerId||"",vc(e.getCustomParameters())||(o.customParameters=JSON.stringify(e.getCustomParameters()));for(const[c,l]of Object.entries(r||{}))o[c]=l}if(e instanceof Ir){const c=e.getScopes().filter(l=>l!=="");c.length>0&&(o.scopes=c.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const c of Object.keys(a))a[c]===void 0&&delete a[c];return`${LD(n)}?${_s(a).slice(1)}`}function LD({config:n}){return n.emulator?hf(n,MD):`https://${n.authDomain}/${OD}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qu="webStorageSupport";class FD{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Zi,this._completeRedirectFn=Ol,this._overrideRedirectResult=Tf}async _openPopup(e,t,i,s){var r;Qt((r=this.eventManagers[e._key()])===null||r===void 0?void 0:r.manager,"_initialize() not called before _openPopup()");const o=Vh(e,t,i,bo(),s);return PD(e,o,ca())}async _openRedirect(e,t,i,s){return await this._originValidation(e),_N(Vh(e,t,i,bo(),s)),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:s,promise:r}=this.eventManagers[t];return s?Promise.resolve(s):(Qt(r,"If manager is not set, promise should be"),r)}const i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){const t=await CD(e),i=new qw(e);return t.register("authEvent",s=>(T(s==null?void 0:s.authEvent,e,"invalid-auth-event"),{status:i.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=t,i}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Qu,{type:Qu},s=>{var r;const o=(r=s==null?void 0:s[0])===null||r===void 0?void 0:r[Qu];o!==void 0&&t(!!o),Ye(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=gD(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return pw()||df()||vr()}}const UD=FD;class VD{constructor(e){this.factorId=e}_process(e,t,i){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,i);case"signin":return this._finalizeSignIn(e,t.credential);default:return sn("unexpected MultiFactorSessionType")}}}class Ef extends VD{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new Ef(e)}_finalizeEnroll(e,t,i){return lN(e,{idToken:t,displayName:i,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return kN(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class jw{constructor(){}static assertion(e){return Ef._fromCredential(e)}}jw.FACTOR_ID="phone";var wm="@firebase/auth",Im="0.21.3";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $D{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(i=>{e((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){T(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BD(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}function qD(n){Me(new X("auth",(e,{options:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),{apiKey:r,authDomain:o}=i.options;return((a,c)=>{T(r&&!r.includes(":"),"invalid-api-key",{appName:a.name}),T(!(o!=null&&o.includes(":")),"argument-error",{appName:a.name});const l={apiKey:r,authDomain:o,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:gw(n)},u=new dR(a,c,l);return KA(u,t),u})(i,s)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),Me(new X("auth-internal",e=>{const t=Le(e.getProvider("auth").getImmediate());return(i=>new $D(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),ue(wm,Im,BD(n)),ue(wm,Im,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WD=5*60;tk("authIdTokenMaxAge");qD("Browser");/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function es(){return window}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const KD=2e3;async function jD(n,e,t){var i;const{BuildInfo:s}=es();Qt(e.sessionId,"AuthEvent did not contain a session ID");const r=await YD(e.sessionId),o={};return vr()?o.ibi=s.packageName:aa()?o.apn=s.packageName:Ye(n,"operation-not-supported-in-this-environment"),s.displayName&&(o.appDisplayName=s.displayName),o.sessionId=r,Vh(n,t,e.type,void 0,(i=e.eventId)!==null&&i!==void 0?i:void 0,o)}async function GD(n){const{BuildInfo:e}=es(),t={};vr()?t.iosBundleId=e.packageName:aa()?t.androidPackageName=e.packageName:Ye(n,"operation-not-supported-in-this-environment"),await Kw(n,t)}function HD(n){const{cordova:e}=es();return new Promise(t=>{e.plugins.browsertab.isAvailable(i=>{let s=null;i?e.plugins.browsertab.openUrl(n):s=e.InAppBrowser.open(n,aR()?"_blank":"_system","location=yes"),t(s)})})}async function zD(n,e,t){const{cordova:i}=es();let s=()=>{};try{await new Promise((r,o)=>{let a=null;function c(){var h;r();const d=(h=i.plugins.browsertab)===null||h===void 0?void 0:h.close;typeof d=="function"&&d(),typeof(t==null?void 0:t.close)=="function"&&t.close()}function l(){a||(a=window.setTimeout(()=>{o(He(n,"redirect-cancelled-by-user"))},KD))}function u(){(document==null?void 0:document.visibilityState)==="visible"&&l()}e.addPassiveListener(c),document.addEventListener("resume",l,!1),aa()&&document.addEventListener("visibilitychange",u,!1),s=()=>{e.removePassiveListener(c),document.removeEventListener("resume",l,!1),document.removeEventListener("visibilitychange",u,!1),a&&window.clearTimeout(a)}})}finally{s()}}function QD(n){var e,t,i,s,r,o,a,c,l,u;const h=es();T(typeof((e=h==null?void 0:h.universalLinks)===null||e===void 0?void 0:e.subscribe)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),T(typeof((t=h==null?void 0:h.BuildInfo)===null||t===void 0?void 0:t.packageName)<"u",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),T(typeof((r=(s=(i=h==null?void 0:h.cordova)===null||i===void 0?void 0:i.plugins)===null||s===void 0?void 0:s.browsertab)===null||r===void 0?void 0:r.openUrl)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),T(typeof((c=(a=(o=h==null?void 0:h.cordova)===null||o===void 0?void 0:o.plugins)===null||a===void 0?void 0:a.browsertab)===null||c===void 0?void 0:c.isAvailable)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),T(typeof((u=(l=h==null?void 0:h.cordova)===null||l===void 0?void 0:l.InAppBrowser)===null||u===void 0?void 0:u.open)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}async function YD(n){const e=XD(n),t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(s=>s.toString(16).padStart(2,"0")).join("")}function XD(n){if(Qt(/[0-9a-zA-Z]+/.test(n),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return new TextEncoder().encode(n);const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let i=0;i<n.length;i++)t[i]=n.charCodeAt(i);return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JD=20;class ZD extends qw{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}function eP(n,e,t=null){return{type:e,eventId:t,urlResponse:null,sessionId:iP(),postBody:null,tenantId:n.tenantId,error:He(n,"no-auth-event")}}function tP(n,e){return $h()._set(Bh(n),e)}async function Tm(n){const e=await $h()._get(Bh(n));return e&&await $h()._remove(Bh(n)),e}function nP(n,e){var t,i;const s=rP(e);if(s.includes("/__/auth/callback")){const r=uc(s),o=r.firebaseError?sP(decodeURIComponent(r.firebaseError)):null,a=(i=(t=o==null?void 0:o.code)===null||t===void 0?void 0:t.split("auth/"))===null||i===void 0?void 0:i[1],c=a?He(a):null;return c?{type:n.type,eventId:n.eventId,tenantId:n.tenantId,error:c,urlResponse:null,sessionId:null,postBody:null}:{type:n.type,eventId:n.eventId,tenantId:n.tenantId,sessionId:n.sessionId,urlResponse:s,postBody:null}}return null}function iP(){const n=[],e="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let t=0;t<JD;t++){const i=Math.floor(Math.random()*e.length);n.push(e.charAt(i))}return n.join("")}function $h(){return St(_f)}function Bh(n){return Ki("authEvent",n.config.apiKey,n.name)}function sP(n){try{return JSON.parse(n)}catch{return null}}function rP(n){const e=uc(n),t=e.link?decodeURIComponent(e.link):void 0,i=uc(t).link,s=e.deep_link_id?decodeURIComponent(e.deep_link_id):void 0;return uc(s).link||s||i||t||n}function uc(n){if(!(n!=null&&n.includes("?")))return{};const[e,...t]=n.split("?");return Ls(t.join("?"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oP=500;class aP{constructor(){this._redirectPersistence=Zi,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Ol,this._overrideRedirectResult=Tf}async _initialize(e){const t=e._key();let i=this.eventManagers.get(t);return i||(i=new ZD(e),this.eventManagers.set(t,i),this.attachCallbackListeners(e,i)),i}_openPopup(e){Ye(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,i,s){QD(e);const r=await this._initialize(e);await r.initialized(),r.resetRedirect(),iD(),await this._originValidation(e);const o=eP(e,i,s);await tP(e,o);const a=await jD(e,o,t),c=await HD(a);return zD(e,r,c)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=GD(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:i,handleOpenURL:s,BuildInfo:r}=es(),o=setTimeout(async()=>{await Tm(e),t.onEvent(Em())},oP),a=async u=>{clearTimeout(o);const h=await Tm(e);let d=null;h&&(u!=null&&u.url)&&(d=nP(h,u.url)),t.onEvent(d||Em())};typeof i<"u"&&typeof i.subscribe=="function"&&i.subscribe(null,a);const c=s,l=`${r.packageName.toLowerCase()}://`;es().handleOpenURL=async u=>{if(u.toLowerCase().startsWith(l)&&a({url:u}),typeof c=="function")try{c(u)}catch(h){console.error(h)}}}}const cP=aP;function Em(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:He("no-auth-event")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lP(n,e){Le(n)._logFramework(e)}var uP="@firebase/auth-compat",hP="0.3.3";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dP=1e3;function oo(){var n;return((n=self==null?void 0:self.location)===null||n===void 0?void 0:n.protocol)||null}function fP(){return oo()==="http:"||oo()==="https:"}function Gw(n=we()){return!!((oo()==="file:"||oo()==="ionic:"||oo()==="capacitor:")&&n.toLowerCase().match(/iphone|ipad|ipod|android/))}function pP(){return yl()||Qd()}function gP(){return fv()&&(document==null?void 0:document.documentMode)===11}function mP(n=we()){return/Edge\/\d+/.test(n)}function _P(n=we()){return gP()||mP(n)}function Hw(){try{const n=self.localStorage,e=ca();if(n)return n.setItem(e,"1"),n.removeItem(e),_P()?Rt():!0}catch{return bf()&&Rt()}return!1}function bf(){return typeof global<"u"&&"WorkerGlobalScope"in global&&"importScripts"in global}function Yu(){return(fP()||gl()||Gw())&&!pP()&&Hw()&&!bf()}function zw(){return Gw()&&typeof document<"u"}async function yP(){return zw()?new Promise(n=>{const e=setTimeout(()=>{n(!1)},dP);document.addEventListener("deviceready",()=>{clearTimeout(e),n(!0)})}):!1}function vP(){return typeof window<"u"?window:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bt={LOCAL:"local",NONE:"none",SESSION:"session"},Ur=T,Qw="persistence";function wP(n,e){if(Ur(Object.values(bt).includes(e),n,"invalid-persistence-type"),yl()){Ur(e!==bt.SESSION,n,"unsupported-persistence-type");return}if(Qd()){Ur(e===bt.NONE,n,"unsupported-persistence-type");return}if(bf()){Ur(e===bt.NONE||e===bt.LOCAL&&Rt(),n,"unsupported-persistence-type");return}Ur(e===bt.NONE||Hw(),n,"unsupported-persistence-type")}async function qh(n){await n._initializationPromise;const e=Yw(),t=Ki(Qw,n.config.apiKey,n.name);e&&e.setItem(t,n._getPersistence())}function IP(n,e){const t=Yw();if(!t)return[];const i=Ki(Qw,n,e);switch(t.getItem(i)){case bt.NONE:return[Ys];case bt.LOCAL:return[Ao,Zi];case bt.SESSION:return[Zi];default:return[]}}function Yw(){var n;try{return((n=vP())===null||n===void 0?void 0:n.sessionStorage)||null}catch{return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const TP=T;class zn{constructor(){this.browserResolver=St(UD),this.cordovaResolver=St(cP),this.underlyingResolver=null,this._redirectPersistence=Zi,this._completeRedirectFn=Ol,this._overrideRedirectResult=Tf}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,i,s){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,i,s)}async _openRedirect(e,t,i,s){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,i,s)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return zw()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return TP(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await yP();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xw(n){return n.unwrap()}function EP(n){return n.wrapped()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bP(n){return Jw(n)}function SP(n,e){var t;const i=(t=e.customData)===null||t===void 0?void 0:t._tokenResponse;if((e==null?void 0:e.code)==="auth/multi-factor-auth-required"){const s=e;s.resolver=new CP(n,aN(n,e))}else if(i){const s=Jw(e),r=e;s&&(r.credential=s,r.tenantId=i.tenantId||void 0,r.email=i.email||void 0,r.phoneNumber=i.phoneNumber||void 0)}}function Jw(n){const{_tokenResponse:e}=n instanceof je?n.customData:n;if(!e)return null;if(!(n instanceof je)&&"temporaryProof"in e&&"phoneNumber"in e)return an.credentialFromResult(n);const t=e.providerId;if(!t||t===Fr.PASSWORD)return null;let i;switch(t){case Fr.GOOGLE:i=Jt;break;case Fr.FACEBOOK:i=Xt;break;case Fr.GITHUB:i=Zt;break;case Fr.TWITTER:i=en;break;default:const{oauthIdToken:s,oauthAccessToken:r,oauthTokenSecret:o,pendingToken:a,nonce:c}=e;return!r&&!o&&!s&&!a?null:a?t.startsWith("saml.")?Xs._create(t,a):fn._fromParams({providerId:t,signInMethod:t,pendingToken:a,idToken:s,accessToken:r}):new Bs(t).credential({idToken:s,accessToken:r,rawNonce:c})}return n instanceof je?i.credentialFromError(n):i.credentialFromResult(n)}function pt(n,e){return e.catch(t=>{throw t instanceof je&&SP(n,t),t}).then(t=>{const i=t.operationType,s=t.user;return{operationType:i,credential:bP(t),additionalUserInfo:oN(t),user:En.getOrCreate(s)}})}async function Wh(n,e){const t=await e;return{verificationId:t.verificationId,confirm:i=>pt(n,t.confirm(i))}}class CP{constructor(e,t){this.resolver=t,this.auth=EP(e)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return pt(Xw(this.auth),this.resolver.resolveSignIn(e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class En{constructor(e){this._delegate=e,this.multiFactor=hN(e)}static getOrCreate(e){return En.USER_MAP.has(e)||En.USER_MAP.set(e,new En(e)),En.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return pt(this.auth,bw(this._delegate,e))}async linkWithPhoneNumber(e,t){return Wh(this.auth,KN(this._delegate,e,t))}async linkWithPopup(e){return pt(this.auth,ZN(this._delegate,e,zn))}async linkWithRedirect(e){return await qh(Le(this.auth)),cD(this._delegate,e,zn)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return pt(this.auth,Sw(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return Wh(this.auth,jN(this._delegate,e,t))}reauthenticateWithPopup(e){return pt(this.auth,JN(this._delegate,e,zn))}async reauthenticateWithRedirect(e){return await qh(Le(this.auth)),oD(this._delegate,e,zn)}sendEmailVerification(e){return QR(this._delegate,e)}async unlink(e){return await MR(this._delegate,e),this}updateEmail(e){return ZR(this._delegate,e)}updatePassword(e){return eN(this._delegate,e)}updatePhoneNumber(e){return GN(this._delegate,e)}updateProfile(e){return JR(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return YR(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}En.USER_MAP=new WeakMap;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vr=T;class Kh{constructor(e,t){if(this.app=e,t.isInitialized()){this._delegate=t.getImmediate(),this.linkUnderlyingAuth();return}const{apiKey:i}=e.options;Vr(i,"invalid-api-key",{appName:e.name}),Vr(i,"invalid-api-key",{appName:e.name});const s=typeof window<"u"?zn:void 0;this._delegate=t.initialize({options:{persistence:kP(i,e.name),popupRedirectResolver:s}}),this._delegate._updateErrorMap(qA),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?En.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){fR(this._delegate,e,t)}applyActionCode(e){return $R(this._delegate,e)}checkActionCode(e){return Cw(this._delegate,e)}confirmPasswordReset(e,t){return VR(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return pt(this._delegate,qR(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return zR(this._delegate,e)}isSignInWithEmailLink(e){return jR(this._delegate,e)}async getRedirectResult(){Vr(Yu(),this._delegate,"operation-not-supported-in-this-environment");const e=await uD(this._delegate,zn);return e?pt(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){lP(this._delegate,e)}onAuthStateChanged(e,t,i){const{next:s,error:r,complete:o}=bm(e,t,i);return this._delegate.onAuthStateChanged(s,r,o)}onIdTokenChanged(e,t,i){const{next:s,error:r,complete:o}=bm(e,t,i);return this._delegate.onIdTokenChanged(s,r,o)}sendSignInLinkToEmail(e,t){return KR(this._delegate,e,t)}sendPasswordResetEmail(e,t){return UR(this._delegate,e,t||void 0)}async setPersistence(e){wP(this._delegate,e);let t;switch(e){case bt.SESSION:t=Zi;break;case bt.LOCAL:t=await St(Ao)._isAvailable()?Ao:_f;break;case bt.NONE:t=Ys;break;default:return Ye("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return pt(this._delegate,OR(this._delegate))}signInWithCredential(e){return pt(this._delegate,Al(this._delegate,e))}signInWithCustomToken(e){return pt(this._delegate,FR(this._delegate,e))}signInWithEmailAndPassword(e,t){return pt(this._delegate,WR(this._delegate,e,t))}signInWithEmailLink(e,t){return pt(this._delegate,GR(this._delegate,e,t))}signInWithPhoneNumber(e,t){return Wh(this._delegate,WN(this._delegate,e,t))}async signInWithPopup(e){return Vr(Yu(),this._delegate,"operation-not-supported-in-this-environment"),pt(this._delegate,XN(this._delegate,e,zn))}async signInWithRedirect(e){return Vr(Yu(),this._delegate,"operation-not-supported-in-this-environment"),await qh(this._delegate),sD(this._delegate,e,zn)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return BR(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}Kh.Persistence=bt;function bm(n,e,t){let i=n;typeof n!="function"&&({next:i,error:e,complete:t}=n);const s=i;return{next:o=>s(o&&En.getOrCreate(o)),error:e,complete:t}}function kP(n,e){const t=IP(n,e);if(typeof self<"u"&&!t.includes(Ao)&&t.push(Ao),typeof window<"u")for(const i of[_f,Zi])t.includes(i)||t.push(i);return t.includes(Ys)||t.push(Ys),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sf{constructor(){this.providerId="phone",this._delegate=new an(Xw(Ve.auth()))}static credential(e,t){return an.credential(e,t)}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}Sf.PHONE_SIGN_IN_METHOD=an.PHONE_SIGN_IN_METHOD;Sf.PROVIDER_ID=an.PROVIDER_ID;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const AP=T;class RP{constructor(e,t,i=Ve.app()){var s;AP((s=i.options)===null||s===void 0?void 0:s.apiKey,"invalid-api-key",{appName:i.name}),this._delegate=new BN(e,t,i.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NP="auth-compat";function DP(n){n.INTERNAL.registerComponent(new X(NP,e=>{const t=e.getProvider("app-compat").getImmediate(),i=e.getProvider("auth");return new Kh(t,i)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:As.EMAIL_SIGNIN,PASSWORD_RESET:As.PASSWORD_RESET,RECOVER_EMAIL:As.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:As.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:As.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:As.VERIFY_EMAIL}},EmailAuthProvider:_i,FacebookAuthProvider:Xt,GithubAuthProvider:Zt,GoogleAuthProvider:Jt,OAuthProvider:Bs,SAMLAuthProvider:Sc,PhoneAuthProvider:Sf,PhoneMultiFactorGenerator:jw,RecaptchaVerifier:RP,TwitterAuthProvider:en,Auth:Kh,AuthCredential:wr,Error:je}).setInstantiationMode("LAZY").setMultipleInstances(!1)),n.registerVersion(uP,hP)}DP(Ve);const Sm="@firebase/database",Cm="0.14.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Zw="";function eI(n){Zw=n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PP{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Ee(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:Yd(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xP{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return At(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tI=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new PP(e)}}catch{}return new xP},Ui=tI("localStorage"),jh=tI("sessionStorage");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ws=new On("@firebase/database"),nI=function(){let n=1;return function(){return n++}}(),iI=function(n){const e=ik(n),t=new sk;t.update(e);const i=t.digest();return dv.encodeByteArray(i)},ua=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=ua.apply(null,i):typeof i=="object"?e+=Ee(i):e+=i,e+=" "}return e};let Gi=null,km=!0;const sI=function(n,e){E(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Ws.logLevel=kt.VERBOSE,Gi=Ws.log.bind(Ws),e&&jh.set("logging_enabled",!0)):typeof n=="function"?Gi=n:(Gi=null,jh.remove("logging_enabled"))},De=function(...n){if(km===!0&&(km=!1,Gi===null&&jh.get("logging_enabled")===!0&&sI(!0)),Gi){const e=ua.apply(null,n);Gi(e)}},ha=function(n){return function(...e){De(n,...e)}},Gh=function(...n){const e="FIREBASE INTERNAL ERROR: "+ua(...n);Ws.error(e)},pn=function(...n){const e=`FIREBASE FATAL ERROR: ${ua(...n)}`;throw Ws.error(e),new Error(e)},nt=function(...n){const e="FIREBASE WARNING: "+ua(...n);Ws.warn(e)},OP=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&nt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Ml=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},MP=function(n){if(document.readyState==="complete")n();else{let e=!1;const t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},si="[MIN_NAME]",Dn="[MAX_NAME]",vs=function(n,e){if(n===e)return 0;if(n===si||e===Dn)return-1;if(e===si||n===Dn)return 1;{const t=Am(n),i=Am(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},LP=function(n,e){return n===e?0:n<e?-1:1},$r=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+Ee(e))},Cf=function(n){if(typeof n!="object"||n===null)return Ee(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=Ee(e[i]),t+=":",t+=Cf(n[e[i]]);return t+="}",t},rI=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let s=0;s<t;s+=e)s+e>t?i.push(n.substring(s,t)):i.push(n.substring(s,s+e));return i};function Fe(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const oI=function(n){E(!Ml(n),"Invalid JSON number");const e=11,t=52,i=(1<<e-1)-1;let s,r,o,a,c;n===0?(r=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(r=0,o=Math.round(n/Math.pow(2,1-i-t))));const l=[];for(c=t;c;c-=1)l.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)l.push(r%2?1:0),r=Math.floor(r/2);l.push(s?1:0),l.reverse();const u=l.join("");let h="";for(c=0;c<64;c+=8){let d=parseInt(u.substr(c,8),2).toString(16);d.length===1&&(d="0"+d),h=h+d}return h.toLowerCase()},FP=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},UP=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function VP(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");const i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}const $P=new RegExp("^-?(0*)\\d{1,10}$"),BP=-2147483648,qP=2147483647,Am=function(n){if($P.test(n)){const e=Number(n);if(e>=BP&&e<=qP)return e}return null},Tr=function(n){try{n()}catch(e){setTimeout(()=>{const t=e.stack||"";throw nt("Exception was thrown by user callback.",t),e},Math.floor(0))}},WP=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},ao=function(n,e){const t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KP{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t==null?void 0:t.getImmediate({optional:!0}),this.appCheck||t==null||t.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){nt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jP{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(De("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',nt(e)}}class Ks{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Ks.OWNER="owner";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kf="5",aI="v",cI="s",lI="r",uI="f",hI=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,dI="ls",fI="p",Hh="ac",pI="websocket",gI="long_polling";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mI{constructor(e,t,i,s,r=!1,o="",a=!1,c=!1){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ui.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ui.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function GP(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function _I(n,e,t){E(typeof e=="string","typeof type must == string"),E(typeof t=="object","typeof params must == object");let i;if(e===pI)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===gI)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);GP(n)&&(t.ns=n.namespace);const s=[];return Fe(t,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class HP{constructor(){this.counters_={}}incrementCounter(e,t=1){At(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return ak(this.counters_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xu={},Ju={};function Af(n){const e=n.toString();return Xu[e]||(Xu[e]=new HP),Xu[e]}function zP(n,e){const t=n.toString();return Ju[t]||(Ju[t]=e()),Ju[t]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class QP{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&Tr(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rm="start",YP="close",XP="pLPCommand",JP="pRTLPCB",yI="id",vI="pw",wI="ser",ZP="cb",ex="seg",tx="ts",nx="d",ix="dframe",II=1870,TI=30,sx=II-TI,rx=25e3,ox=3e4;class Qn{constructor(e,t,i,s,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ha(e),this.stats_=Af(t),this.urlFn=c=>(this.appCheckToken&&(c[Hh]=this.appCheckToken),_I(t,gI,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new QP(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(ox)),MP(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Rf((...r)=>{const[o,a,c,l,u]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Rm)this.id=a,this.password=c;else if(o===YP)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={};i[Rm]="t",i[wI]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[ZP]=this.scriptTagHolder.uniqueCallbackIdentifier),i[aI]=kf,this.transportSessionId&&(i[cI]=this.transportSessionId),this.lastSessionId&&(i[dI]=this.lastSessionId),this.applicationId&&(i[fI]=this.applicationId),this.appCheckToken&&(i[Hh]=this.appCheckToken),typeof location<"u"&&location.hostname&&hI.test(location.hostname)&&(i[lI]=uI);const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){Qn.forceAllow_=!0}static forceDisallow(){Qn.forceDisallow_=!0}static isAvailable(){return Qn.forceAllow_?!0:!Qn.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!FP()&&!UP()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Ee(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=ck(t),s=rI(i,sx);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const i={};i[ix]="t",i[yI]=e,i[vI]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Ee(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Rf{constructor(e,t,i,s){this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=nI(),window[XP+this.uniqueCallbackIdentifier]=e,window[JP+this.uniqueCallbackIdentifier]=t,this.myIFrame=Rf.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){De("frame writing exception"),a.stack&&De(a.stack),De(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||De("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e[yI]=this.myID,e[vI]=this.myPW,e[wI]=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+TI+i.length<=II;){const o=this.pendingSegs.shift();i=i+"&"+ex+s+"="+o.seg+"&"+tx+s+"="+o.ts+"&"+nx+s+"="+o.d,s++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(rx)),r=()=>{clearTimeout(s),i()};this.addTag(e,r)}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{De("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ax=16384,cx=45e3;let Rc=null;typeof MozWebSocket<"u"?Rc=MozWebSocket:typeof WebSocket<"u"&&(Rc=WebSocket);class Ot{constructor(e,t,i,s,r,o,a){this.connId=e,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ha(this.connId),this.stats_=Af(t),this.connURL=Ot.connectionURL_(t,o,a,s,i),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,i,s,r){const o={};return o[aI]=kf,typeof location<"u"&&location.hostname&&hI.test(location.hostname)&&(o[lI]=uI),t&&(o[cI]=t),i&&(o[dI]=i),s&&(o[Hh]=s),r&&(o[fI]=r),_I(e,pI,o)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ui.set("previous_websocket_failure",!0);try{let i;pv(),this.mySock=new Rc(this.connURL,[],i)}catch(i){this.log_("Error instantiating WebSocket.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=i=>{this.handleIncomingFrame(i)},this.mySock.onerror=i=>{this.log_("WebSocket error.  Closing connection.");const s=i.message||i.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){Ot.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,i=navigator.userAgent.match(t);i&&i.length>1&&parseFloat(i[1])<4.4&&(e=!0)}return!e&&Rc!==null&&!Ot.forceDisallow_}static previouslyFailed(){return Ui.isInMemoryStorage||Ui.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ui.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const t=this.frames.join("");this.frames=null;const i=Yd(t);this.onMessage(i)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(E(this.frames===null,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(t);else{const i=this.extractFrameCount_(t);i!==null&&this.appendFrame_(i)}}send(e){this.resetKeepAlive();const t=Ee(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=rI(t,ax);i.length>1&&this.sendString_(String(i.length));for(let s=0;s<i.length;s++)this.sendString_(i[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(cx))}sendString_(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Ot.responsesRequiredToBeHealthy=2;Ot.healthyTimeout=3e4;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Js{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[Qn,Ot]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=Ot&&Ot.isAvailable();let i=t&&!Ot.previouslyFailed();if(e.webSocketOnly&&(t||nt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),i=!0),i)this.transports_=[Ot];else{const s=this.transports_=[];for(const r of Js.ALL_TRANSPORTS)r&&r.isAvailable()&&s.push(r);Js.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}Js.globalTransportInitialized_=!1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lx=6e4,ux=5e3,hx=10*1024,dx=100*1024,Zu="t",Nm="d",fx="s",Dm="r",px="e",Pm="o",xm="a",Om="n",Mm="p",gx="h";class mx{constructor(e,t,i,s,r,o,a,c,l,u){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=l,this.lastSessionId=u,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ha("c:"+this.id+":"),this.transportManager_=new Js(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=ao(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>dx?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>hx?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(Zu in e){const t=e[Zu];t===xm?this.upgradeIfSecondaryHealthy_():t===Dm?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===Pm&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=$r("t",e),i=$r("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:Mm,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:xm,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Om,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=$r("t",e),i=$r("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=$r(Zu,e);if(Nm in e){const i=e[Nm];if(t===gx){const s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(t===Om){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===fx?this.onConnectionShutdown_(i):t===Dm?this.onReset_(i):t===px?Gh("Server Error: "+i):t===Pm?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Gh("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),kf!==i&&nt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),ao(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(lx))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):ao(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(ux))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:Mm,d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ui.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EI{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bI{constructor(e){this.allowedEvents_=e,this.listeners_={},E(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(e){E(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nc extends bI{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!zd()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Nc}getInitialEvent(e){return E(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lm=32,Fm=768;class z{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}}function H(){return new z("")}function V(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function ri(n){return n.pieces_.length-n.pieceNum_}function Z(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new z(n.pieces_,e)}function Nf(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function _x(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Ro(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function SI(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new z(e,0)}function oe(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof z)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new z(t,0)}function $(n){return n.pieceNum_>=n.pieces_.length}function ut(n,e){const t=V(n),i=V(e);if(t===null)return e;if(t===i)return ut(Z(n),Z(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function yx(n,e){const t=Ro(n,0),i=Ro(e,0);for(let s=0;s<t.length&&s<i.length;s++){const r=vs(t[s],i[s]);if(r!==0)return r}return t.length===i.length?0:t.length<i.length?-1:1}function Df(n,e){if(ri(n)!==ri(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function Lt(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(ri(n)>ri(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class vx{constructor(e,t){this.errorPrefix_=t,this.parts_=Ro(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=vl(this.parts_[i]);CI(this)}}function wx(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=vl(e),CI(n)}function Ix(n){const e=n.parts_.pop();n.byteLength_-=vl(e),n.parts_.length>0&&(n.byteLength_-=1)}function CI(n){if(n.byteLength_>Fm)throw new Error(n.errorPrefix_+"has a key path longer than "+Fm+" bytes ("+n.byteLength_+").");if(n.parts_.length>Lm)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Lm+") or object contains a cycle "+Ai(n))}function Ai(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf extends bI{constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new Pf}getInitialEvent(e){return E(e==="visible","Unknown event type: "+e),[this.visible_]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Br=1e3,Tx=60*5*1e3,Um=30*1e3,Ex=1.3,bx=3e4,Sx="server_kill",Vm=3;class An extends EI{constructor(e,t,i,s,r,o,a,c){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=i,this.onConnectStatus_=s,this.onServerInfoUpdate_=r,this.authTokenProvider_=o,this.appCheckTokenProvider_=a,this.authOverride_=c,this.id=An.nextPersistentConnectionId_++,this.log_=ha("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Br,this.maxReconnectDelay_=Tx,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!pv())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Pf.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&Nc.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,i){const s=++this.requestNumber_,r={r:s,a:e,b:t};this.log_(Ee(r)),E(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();const t=new Pe,s={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:o=>{const a=o.d;o.s==="ok"?t.resolve(a):t.reject(a)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,i,s){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),E(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),E(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:t,query:e,tag:i};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,i=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(i)})}sendListen_(e){const t=e.query,i=t._path.toString(),s=t._queryIdentifier;this.log_("Listen on "+i+" for "+s);const r={p:i},o="q";e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest(o,r,a=>{const c=a.d,l=a.s;An.warnOnListenWarnings_(c,t),(this.listens.get(i)&&this.listens.get(i).get(s))===e&&(this.log_("listen response",a),l!=="ok"&&this.removeListen_(i,s),e.onComplete&&e.onComplete(l,c))})}static warnOnListenWarnings_(e,t){if(e&&typeof e=="object"&&At(e,"w")){const i=Yi(e,"w");if(Array.isArray(i)&&~i.indexOf("no_index")){const s='".indexOn": "'+t._queryParams.getIndex().toString()+'"',r=t._path.toString();nt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${r} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||rk(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Um)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=ok(e)?"auth":"gauth",i={cred:e};this.authOverride_===null?i.noauth=!0:typeof this.authOverride_=="object"&&(i.authvar=this.authOverride_),this.sendRequest(t,i,s=>{const r=s.s,o=s.d||"error";this.authToken_===e&&(r==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(r,o))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{const t=e.s,i=e.d||"error";t==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,i)})}unlisten(e,t){const i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),E(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,t)}sendUnlisten_(e,t,i,s){this.log_("Unlisten on "+e+" for "+t);const r={p:e},o="n";s&&(r.q=i,r.t=s),this.sendRequest(o,r)}onDisconnectPut(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:i})}onDisconnectMerge(e,t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:i})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,i,s){const r={p:t,d:i};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,o=>{s&&setTimeout(()=>{s(o.s,o.d)},Math.floor(0))})}put(e,t,i,s){this.putInternal("p",e,t,i,s)}merge(e,t,i,s){this.putInternal("m",e,t,i,s)}putInternal(e,t,i,s,r){this.initConnection_();const o={p:t,d:i};r!==void 0&&(o.h=r),this.outstandingPuts_.push({action:e,request:o,onComplete:s}),this.outstandingPutCount_++;const a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,i=this.outstandingPuts_[e].request,s=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,i,r=>{this.log_(t+" response",r),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(r.s,r.d)})}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,i=>{if(i.s!=="ok"){const r=i.d;this.log_("reportStats","Error sending stats: "+r)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Ee(e));const t=e.r,i=this.requestCBHash_[t];i&&(delete this.requestCBHash_[t],i(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),e==="d"?this.onDataUpdate_(t.p,t.d,!1,t.t):e==="m"?this.onDataUpdate_(t.p,t.d,!0,t.t):e==="c"?this.onListenRevoked_(t.p,t.q):e==="ac"?this.onAuthRevoked_(t.s,t.d):e==="apc"?this.onAppCheckRevoked_(t.s,t.d):e==="sd"?this.onSecurityDebugPacket_(t):Gh("Unrecognized action received from server: "+Ee(e)+`
Are you using the latest client?`)}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){E(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Br,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Br,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>bx&&(this.reconnectDelay_=Br),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());const e=new Date().getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Ex)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+An.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,i())},l=function(h){E(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(h)};this.realtime_={close:c,sendRequest:l};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[h,d]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?De("getToken() completed but was canceled"):(De("getToken() completed. Creating connection."),this.authToken_=h&&h.accessToken,this.appCheckToken_=d&&d.token,a=new mx(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,i,f=>{nt(f+" ("+this.repoInfo_.toString()+")"),this.interrupt(Sx)},r))}catch(h){this.log_("Failed to get token: "+h),o||(this.repoInfo_.nodeAdmin&&nt(h),c())}}}interrupt(e){De("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){De("Resuming connection for reason: "+e),delete this.interruptReasons_[e],vc(this.interruptReasons_)&&(this.reconnectDelay_=Br,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let i;t?i=t.map(r=>Cf(r)).join("$"):i="default";const s=this.removeListen_(e,i);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(e,t){const i=new z(e).toString();let s;if(this.listens.has(i)){const r=this.listens.get(i);s=r.get(t),r.delete(t),r.size===0&&this.listens.delete(i)}else s=void 0;return s}onAuthRevoked_(e,t){De("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Vm&&(this.reconnectDelay_=Um,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){De("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Vm&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";e["sdk."+t+"."+Zw.replace(/\./g,"-")]=1,zd()?e["framework.cordova"]=1:yl()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Nc.getInstance().currentlyOnline();return vc(this.interruptReasons_)&&e}}An.nextPersistentConnectionId_=0;An.nextConnectionId_=0;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new B(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ll{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new B(si,e),s=new B(si,t);return this.compare(i,s)!==0}minPost(){return B.MIN}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ga;class kI extends Ll{static get __EMPTY_NODE(){return Ga}static set __EMPTY_NODE(e){Ga=e}compare(e,t){return vs(e.name,t.name)}isDefinedOn(e){throw sa("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return B.MIN}maxPost(){return new B(Dn,Ga)}makePost(e,t){return E(typeof e=="string","KeyIndex indexValue must always be a string."),new B(e,Ga)}toString(){return".key"}}const cn=new kI;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ha{constructor(e,t,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,s&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Re{constructor(e,t,i,s,r){this.key=e,this.value=t,this.color=i??Re.RED,this.left=s??_t.EMPTY_NODE,this.right=r??_t.EMPTY_NODE}copy(e,t,i,s,r){return new Re(e??this.key,t??this.value,i??this.color,s??this.left,r??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const r=i(e,s.key);return r<0?s=s.copy(null,null,null,s.left.insert(e,t,i),null):r===0?s=s.copy(null,t,null,null,null):s=s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return _t.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let i,s;if(i=this,t(e,i.key)<0)!i.left.isEmpty()&&!i.left.isRed_()&&!i.left.left.isRed_()&&(i=i.moveRedLeft_()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed_()&&(i=i.rotateRight_()),!i.right.isEmpty()&&!i.right.isRed_()&&!i.right.left.isRed_()&&(i=i.moveRedRight_()),t(e,i.key)===0){if(i.right.isEmpty())return _t.EMPTY_NODE;s=i.right.min_(),i=i.copy(s.key,s.value,null,null,i.right.removeMin_())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Re.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Re.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Re.RED=!0;Re.BLACK=!1;class Cx{copy(e,t,i,s,r){return this}insert(e,t,i){return new Re(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}}class _t{constructor(e,t=_t.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new _t(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Re.BLACK,null,null))}remove(e){return new _t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Re.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Ha(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Ha(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Ha(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Ha(this.root_,null,this.comparator_,!0,e)}}_t.EMPTY_NODE=new Cx;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kx(n,e){return vs(n.name,e.name)}function xf(n,e){return vs(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let zh;function Ax(n){zh=n}const AI=function(n){return typeof n=="number"?"number:"+oI(n):"string:"+n},RI=function(n){if(n.isLeafNode()){const e=n.val();E(typeof e=="string"||typeof e=="number"||typeof e=="object"&&At(e,".sv"),"Priority must be a string or number.")}else E(n===zh||n.isEmpty(),"priority of unexpected type.");E(n===zh||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $m;class Ce{constructor(e,t=Ce.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,E(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),RI(this.priorityNode_)}static set __childrenNodeConstructor(e){$m=e}static get __childrenNodeConstructor(){return $m}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Ce(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:Ce.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return $(e)?this:V(e)===".priority"?this.priorityNode_:Ce.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return e===".priority"?this.updatePriority(t):t.isEmpty()&&e!==".priority"?this:Ce.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const i=V(e);return i===null?t:t.isEmpty()&&i!==".priority"?this:(E(i!==".priority"||ri(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(i,Ce.__childrenNodeConstructor.EMPTY_NODE.updateChild(Z(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+AI(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",t==="number"?e+=oI(this.value_):e+=this.value_,this.lazyHash_=iI(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Ce.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Ce.__childrenNodeConstructor?-1:(E(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,i=typeof this.value_,s=Ce.VALUE_TYPE_ORDER.indexOf(t),r=Ce.VALUE_TYPE_ORDER.indexOf(i);return E(s>=0,"Unknown leaf type: "+t),E(r>=0,"Unknown leaf type: "+i),s===r?i==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}else return!1}}Ce.VALUE_TYPE_ORDER=["object","boolean","number","string"];/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let NI,DI;function Rx(n){NI=n}function Nx(n){DI=n}class Dx extends Ll{compare(e,t){const i=e.node.getPriority(),s=t.node.getPriority(),r=i.compareTo(s);return r===0?vs(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return B.MIN}maxPost(){return new B(Dn,new Ce("[PRIORITY-POST]",DI))}makePost(e,t){const i=NI(e);return new B(t,new Ce("[PRIORITY-POST]",i))}toString(){return".priority"}}const te=new Dx;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Px=Math.log(2);class xx{constructor(e){const t=r=>parseInt(Math.log(r)/Px,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;const s=i(this.count);this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Dc=function(n,e,t,i){n.sort(e);const s=function(c,l){const u=l-c;let h,d;if(u===0)return null;if(u===1)return h=n[c],d=t?t(h):h,new Re(d,h.node,Re.BLACK,null,null);{const f=parseInt(u/2,10)+c,p=s(c,f),_=s(f+1,l);return h=n[f],d=t?t(h):h,new Re(d,h.node,Re.BLACK,p,_)}},r=function(c){let l=null,u=null,h=n.length;const d=function(p,_){const w=h-p,N=h;h-=p;const M=s(w+1,N),x=n[w],U=t?t(x):x;f(new Re(U,x.node,_,null,M))},f=function(p){l?(l.left=p,l=p):(u=p,l=p)};for(let p=0;p<c.count;++p){const _=c.nextBitIsOne(),w=Math.pow(2,c.count-(p+1));_?d(w,Re.BLACK):(d(w,Re.BLACK),d(w,Re.RED))}return u},o=new xx(n.length),a=r(o);return new _t(i||e,a)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let eh;const Rs={};class bn{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return E(Rs&&te,"ChildrenNode.ts has not been loaded"),eh=eh||new bn({".priority":Rs},{".priority":te}),eh}get(e){const t=Yi(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof _t?t:null}hasIndex(e){return At(this.indexSet_,e.toString())}addIndex(e,t){E(e!==cn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=t.getIterator(B.Wrap);let o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=Dc(i,e.getCompare()):a=Rs;const c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;const u=Object.assign({},this.indexes_);return u[c]=a,new bn(u,l)}addToIndexes(e,t){const i=wc(this.indexes_,(s,r)=>{const o=Yi(this.indexSet_,r);if(E(o,"Missing index implementation for "+r),s===Rs)if(o.isDefinedOn(e.node)){const a=[],c=t.getIterator(B.Wrap);let l=c.getNext();for(;l;)l.name!==e.name&&a.push(l),l=c.getNext();return a.push(e),Dc(a,o.getCompare())}else return Rs;else{const a=t.get(e.name);let c=s;return a&&(c=c.remove(new B(e.name,a))),c.insert(e,e.node)}});return new bn(i,this.indexSet_)}removeFromIndexes(e,t){const i=wc(this.indexes_,s=>{if(s===Rs)return s;{const r=t.get(e.name);return r?s.remove(new B(e.name,r)):s}});return new bn(i,this.indexSet_)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let qr;class D{constructor(e,t,i){this.children_=e,this.priorityNode_=t,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&RI(this.priorityNode_),this.children_.isEmpty()&&E(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return qr||(qr=new D(new _t(xf),null,bn.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||qr}updatePriority(e){return this.children_.isEmpty()?this:new D(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{const t=this.children_.get(e);return t===null?qr:t}}getChild(e){const t=V(e);return t===null?this:this.getImmediateChild(t).getChild(Z(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,t){if(E(t,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(t);{const i=new B(e,t);let s,r;t.isEmpty()?(s=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(s=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_));const o=s.isEmpty()?qr:this.priorityNode_;return new D(s,o,r)}}updateChild(e,t){const i=V(e);if(i===null)return t;{E(V(e)!==".priority"||ri(e)===1,".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(Z(e),t);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let i=0,s=0,r=!0;if(this.forEachChild(te,(o,a)=>{t[o]=a.val(e),i++,r&&D.INTEGER_REGEXP_.test(o)?s=Math.max(s,Number(o)):r=!1}),!e&&r&&s<2*i){const o=[];for(const a in t)o[a]=t[a];return o}else return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+AI(this.getPriority().val())+":"),this.forEachChild(te,(t,i)=>{const s=i.hash();s!==""&&(e+=":"+t+":"+s)}),this.lazyHash_=e===""?"":iI(e)}return this.lazyHash_}getPredecessorChildName(e,t,i){const s=this.resolveIndex_(i);if(s){const r=s.getPredecessorKey(new B(e,t));return r?r.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.minKey();return i&&i.name}else return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new B(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const i=t.maxKey();return i&&i.name}else return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new B(t,this.children_.get(t)):null}forEachChild(e,t){const i=this.resolveIndex_(e);return i?i.inorderTraversal(s=>t(s.name,s.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getIteratorFrom(e,s=>s);{const s=this.children_.getIteratorFrom(e.name,B.Wrap);let r=s.peek();for(;r!=null&&t.compare(r,e)<0;)s.getNext(),r=s.peek();return s}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const i=this.resolveIndex_(t);if(i)return i.getReverseIteratorFrom(e,s=>s);{const s=this.children_.getReverseIteratorFrom(e.name,B.Wrap);let r=s.peek();for(;r!=null&&t.compare(r,e)>0;)s.getNext(),r=s.peek();return s}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===da?-1:0}withIndex(e){if(e===cn||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new D(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===cn||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority()))if(this.children_.count()===t.children_.count()){const i=this.getIterator(te),s=t.getIterator(te);let r=i.getNext(),o=s.getNext();for(;r&&o;){if(r.name!==o.name||!r.node.equals(o.node))return!1;r=i.getNext(),o=s.getNext()}return r===null&&o===null}else return!1;else return!1}}resolveIndex_(e){return e===cn?null:this.indexMap_.get(e.toString())}}D.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;class Ox extends D{constructor(){super(new _t(xf),D.EMPTY_NODE,bn.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return D.EMPTY_NODE}isEmpty(){return!1}}const da=new Ox;Object.defineProperties(B,{MIN:{value:new B(si,D.EMPTY_NODE)},MAX:{value:new B(Dn,da)}});kI.__EMPTY_NODE=D.EMPTY_NODE;Ce.__childrenNodeConstructor=D;Ax(da);Nx(da);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mx=!0;function le(n,e=null){if(n===null)return D.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),E(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){const t=n;return new Ce(t,le(e))}if(!(n instanceof Array)&&Mx){const t=[];let i=!1;if(Fe(n,(o,a)=>{if(o.substring(0,1)!=="."){const c=le(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),t.push(new B(o,c)))}}),t.length===0)return D.EMPTY_NODE;const r=Dc(t,kx,o=>o.name,xf);if(i){const o=Dc(t,te.getCompare());return new D(r,le(e),new bn({".priority":o},{".priority":te}))}else return new D(r,le(e),bn.Default)}else{let t=D.EMPTY_NODE;return Fe(n,(i,s)=>{if(At(n,i)&&i.substring(0,1)!=="."){const r=le(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(i,r))}}),t.updatePriority(le(e))}}Rx(le);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Of extends Ll{constructor(e){super(),this.indexPath_=e,E(!$(e)&&V(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),s=this.extractChild(t.node),r=i.compareTo(s);return r===0?vs(e.name,t.name):r}makePost(e,t){const i=le(e),s=D.EMPTY_NODE.updateChild(this.indexPath_,i);return new B(t,s)}maxPost(){const e=D.EMPTY_NODE.updateChild(this.indexPath_,da);return new B(Dn,e)}toString(){return Ro(this.indexPath_,0).join("/")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lx extends Ll{compare(e,t){const i=e.node.compareTo(t.node);return i===0?vs(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return B.MIN}maxPost(){return B.MAX}makePost(e,t){const i=le(e);return new B(t,i)}toString(){return".value"}}const Mf=new Lx;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function PI(n){return{type:"value",snapshotNode:n}}function Zs(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function No(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Do(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function Fx(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lf{constructor(e){this.index_=e}updateChild(e,t,i,s,r,o){E(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(No(t,a)):E(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Zs(t,i)):o.trackChildChange(Do(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(te,(s,r)=>{t.hasChild(s)||i.trackChildChange(No(s,r))}),t.isLeafNode()||t.forEachChild(te,(s,r)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(Do(s,r,o))}else i.trackChildChange(Zs(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?D.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Po{constructor(e){this.indexedFilter_=new Lf(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Po.getStartPost_(e),this.endPost_=Po.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,s,r,o){return this.matches(new B(t,i))||(i=D.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,r,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=D.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(D.EMPTY_NODE);const r=this;return t.forEachChild(te,(o,a)=>{r.matches(new B(o,a))||(s=s.updateImmediateChild(o,D.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ux{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{const i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new Po(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,s,r,o){return this.rangedFilter_.matches(new B(t,i))||(i=D.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,r,o):this.fullLimitUpdateChild_(e,t,i,r,o)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=D.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){s=D.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=t.withIndex(this.index_),s=s.updatePriority(D.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){const a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,D.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,r){let o;if(this.reverse_){const h=this.index_.getCompare();o=(d,f)=>h(f,d)}else o=this.index_.getCompare();const a=e;E(a.numChildren()===this.limit_,"");const c=new B(t,i),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(a.hasChild(t)){const h=a.getImmediateChild(t);let d=s.getChildAfterChild(this.index_,l,this.reverse_);for(;d!=null&&(d.name===t||a.hasChild(d.name));)d=s.getChildAfterChild(this.index_,d,this.reverse_);const f=d==null?1:o(d,c);if(u&&!i.isEmpty()&&f>=0)return r!=null&&r.trackChildChange(Do(t,i,h)),a.updateImmediateChild(t,i);{r!=null&&r.trackChildChange(No(t,h));const _=a.updateImmediateChild(t,D.EMPTY_NODE);return d!=null&&this.rangedFilter_.matches(d)?(r!=null&&r.trackChildChange(Zs(d.name,d.node)),_.updateImmediateChild(d.name,d.node)):_}}else return i.isEmpty()?e:u&&o(l,c)>=0?(r!=null&&(r.trackChildChange(No(l.name,l.node)),r.trackChildChange(Zs(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(l.name,D.EMPTY_NODE)):e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fl{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=te}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return E(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return E(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:si}hasEnd(){return this.endSet_}getIndexEndValue(){return E(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return E(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Dn}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return E(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===te}copy(){const e=new Fl;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Vx(n){return n.loadsAllData()?new Lf(n.getIndex()):n.hasLimit()?new Ux(n):new Po(n)}function $x(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="l",t}function Bx(n,e){const t=n.copy();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="r",t}function Qh(n,e,t){const i=n.copy();return i.startSet_=!0,e===void 0&&(e=null),i.indexStartValue_=e,t!=null?(i.startNameSet_=!0,i.indexStartName_=t):(i.startNameSet_=!1,i.indexStartName_=""),i}function qx(n,e,t){let i;return n.index_===cn||t?i=Qh(n,e,t):i=Qh(n,e,Dn),i.startAfterSet_=!0,i}function Yh(n,e,t){const i=n.copy();return i.endSet_=!0,e===void 0&&(e=null),i.indexEndValue_=e,t!==void 0?(i.endNameSet_=!0,i.indexEndName_=t):(i.endNameSet_=!1,i.indexEndName_=""),i}function Wx(n,e,t){let i;return n.index_===cn||t?i=Yh(n,e,t):i=Yh(n,e,si),i.endBeforeSet_=!0,i}function Ul(n,e){const t=n.copy();return t.index_=e,t}function Bm(n){const e={};if(n.isDefault())return e;let t;if(n.index_===te?t="$priority":n.index_===Mf?t="$value":n.index_===cn?t="$key":(E(n.index_ instanceof Of,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=Ee(t),n.startSet_){const i=n.startAfterSet_?"startAfter":"startAt";e[i]=Ee(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+Ee(n.indexStartName_))}if(n.endSet_){const i=n.endBeforeSet_?"endBefore":"endAt";e[i]=Ee(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+Ee(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function qm(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==te&&(e.i=n.index_.toString()),e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pc extends EI{constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=ha("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(E(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,s){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=Pc.getListenId_(e,i),a={};this.listens_[o]=a;const c=Bm(e._queryParams);this.restRequest_(r+".json",c,(l,u)=>{let h=u;if(l===404&&(h=null,l=null),l===null&&this.onDataUpdate_(r,h,!1,i),Yi(this.listens_,o)===a){let d;l?l===401?d="permission_denied":d="rest_error:"+l:d="ok",s(d,null)}})}unlisten(e,t){const i=Pc.getListenId_(e,t);delete this.listens_[i]}get(e){const t=Bm(e._queryParams),i=e._path.toString(),s=new Pe;return this.restRequest_(i+".json",t,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+_s(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=Yd(a.responseText)}catch{nt("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else a.status!==401&&a.status!==404&&nt("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kx{constructor(){this.rootNode_=D.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xc(){return{value:null,children:new Map}}function Er(n,e,t){if($(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{const i=V(e);n.children.has(i)||n.children.set(i,xc());const s=n.children.get(i);e=Z(e),Er(s,e,t)}}function Xh(n,e){if($(e))return n.value=null,n.children.clear(),!0;if(n.value!==null){if(n.value.isLeafNode())return!1;{const t=n.value;return n.value=null,t.forEachChild(te,(i,s)=>{Er(n,new z(i),s)}),Xh(n,e)}}else if(n.children.size>0){const t=V(e);return e=Z(e),n.children.has(t)&&Xh(n.children.get(t),e)&&n.children.delete(t),n.children.size===0}else return!0}function Jh(n,e,t){n.value!==null?t(e,n.value):jx(n,(i,s)=>{const r=new z(e.toString()+"/"+i);Jh(s,r,t)})}function jx(n,e){n.children.forEach((t,i)=>{e(i,t)})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gx{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Fe(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wm=10*1e3,Hx=30*1e3,zx=5*60*1e3;class Qx{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Gx(e);const i=Wm+(Hx-Wm)*Math.random();ao(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;Fe(e,(s,r)=>{r>0&&At(this.statsToReport_,s)&&(t[s]=r,i=!0)}),i&&this.server_.reportStats(t),ao(this.reportStats_.bind(this),Math.floor(Math.random()*2*zx))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Gt;(function(n){n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"})(Gt||(Gt={}));function Ff(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Uf(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Vf(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oc{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=Gt.ACK_USER_WRITE,this.source=Ff()}operationForChild(e){if($(this.path)){if(this.affectedTree.value!=null)return E(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new z(e));return new Oc(H(),t,this.revert)}}else return E(V(this.path)===e,"operationForChild called for unrelated child."),new Oc(Z(this.path),this.affectedTree,this.revert)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xo{constructor(e,t){this.source=e,this.path=t,this.type=Gt.LISTEN_COMPLETE}operationForChild(e){return $(this.path)?new xo(this.source,H()):new xo(this.source,Z(this.path))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ts{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=Gt.OVERWRITE}operationForChild(e){return $(this.path)?new ts(this.source,H(),this.snap.getImmediateChild(e)):new ts(this.source,Z(this.path),this.snap)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class er{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=Gt.MERGE}operationForChild(e){if($(this.path)){const t=this.children.subtree(new z(e));return t.isEmpty()?null:t.value?new ts(this.source,H(),t.value):new er(this.source,H(),t)}else return E(V(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new er(this.source,Z(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oi{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if($(e))return this.isFullyInitialized()&&!this.filtered_;const t=V(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yx{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Xx(n,e,t,i){const s=[],r=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(Fx(o.childName,o.snapshotNode))}),Wr(n,s,"child_removed",e,i,t),Wr(n,s,"child_added",e,i,t),Wr(n,s,"child_moved",r,i,t),Wr(n,s,"child_changed",e,i,t),Wr(n,s,"value",e,i,t),s}function Wr(n,e,t,i,s,r){const o=i.filter(a=>a.type===t);o.sort((a,c)=>Zx(n,a,c)),o.forEach(a=>{const c=Jx(n,a,r);s.forEach(l=>{l.respondsTo(a.type)&&e.push(l.createEvent(c,n.query_))})})}function Jx(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Zx(n,e,t){if(e.childName==null||t.childName==null)throw sa("Should only compare child_ events.");const i=new B(e.childName,e.snapshotNode),s=new B(t.childName,t.snapshotNode);return n.index_.compare(i,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vl(n,e){return{eventCache:n,serverCache:e}}function co(n,e,t,i){return Vl(new oi(e,t,i),n.serverCache)}function xI(n,e,t,i){return Vl(n.eventCache,new oi(e,t,i))}function Mc(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function ns(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let th;const eO=()=>(th||(th=new _t(LP)),th);class ee{constructor(e,t=eO()){this.value=e,this.children=t}static fromObject(e){let t=new ee(null);return Fe(e,(i,s)=>{t=t.set(new z(i),s)}),t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:H(),value:this.value};if($(e))return null;{const i=V(e),s=this.children.get(i);if(s!==null){const r=s.findRootMostMatchingPathAndValue(Z(e),t);return r!=null?{path:oe(new z(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if($(e))return this;{const t=V(e),i=this.children.get(t);return i!==null?i.subtree(Z(e)):new ee(null)}}set(e,t){if($(e))return new ee(t,this.children);{const i=V(e),r=(this.children.get(i)||new ee(null)).set(Z(e),t),o=this.children.insert(i,r);return new ee(this.value,o)}}remove(e){if($(e))return this.children.isEmpty()?new ee(null):new ee(null,this.children);{const t=V(e),i=this.children.get(t);if(i){const s=i.remove(Z(e));let r;return s.isEmpty()?r=this.children.remove(t):r=this.children.insert(t,s),this.value===null&&r.isEmpty()?new ee(null):new ee(this.value,r)}else return this}}get(e){if($(e))return this.value;{const t=V(e),i=this.children.get(t);return i?i.get(Z(e)):null}}setTree(e,t){if($(e))return t;{const i=V(e),r=(this.children.get(i)||new ee(null)).setTree(Z(e),t);let o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new ee(this.value,o)}}fold(e){return this.fold_(H(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(oe(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,H(),t)}findOnPath_(e,t,i){const s=this.value?i(t,this.value):!1;if(s)return s;if($(e))return null;{const r=V(e),o=this.children.get(r);return o?o.findOnPath_(Z(e),oe(t,r),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,H(),t)}foreachOnPath_(e,t,i){if($(e))return this;{this.value&&i(t,this.value);const s=V(e),r=this.children.get(s);return r?r.foreachOnPath_(Z(e),oe(t,s),i):new ee(null)}}foreach(e){this.foreach_(H(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(oe(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zt{constructor(e){this.writeTree_=e}static empty(){return new zt(new ee(null))}}function lo(n,e,t){if($(e))return new zt(new ee(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){const s=i.path;let r=i.value;const o=ut(s,e);return r=r.updateChild(o,t),new zt(n.writeTree_.set(s,r))}else{const s=new ee(t),r=n.writeTree_.setTree(e,s);return new zt(r)}}}function Zh(n,e,t){let i=n;return Fe(t,(s,r)=>{i=lo(i,oe(e,s),r)}),i}function Km(n,e){if($(e))return zt.empty();{const t=n.writeTree_.setTree(e,new ee(null));return new zt(t)}}function ed(n,e){return ws(n,e)!=null}function ws(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(ut(t.path,e)):null}function jm(n){const e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(te,(i,s)=>{e.push(new B(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&e.push(new B(i,s.value))}),e}function Jn(n,e){if($(e))return n;{const t=ws(n,e);return t!=null?new zt(new ee(t)):new zt(n.writeTree_.subtree(e))}}function td(n){return n.writeTree_.isEmpty()}function tr(n,e){return OI(H(),n.writeTree_,e)}function OI(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{s===".priority"?(E(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):t=OI(oe(n,s),r,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(oe(n,".priority"),i)),t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $l(n,e){return UI(e,n)}function tO(n,e,t,i,s){E(i>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=lo(n.visibleWrites,e,t)),n.lastWriteId=i}function nO(n,e,t,i){E(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:e,children:t,writeId:i,visible:!0}),n.visibleWrites=Zh(n.visibleWrites,e,t),n.lastWriteId=i}function iO(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}function sO(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);E(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&rO(a,i.path)?s=!1:Lt(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return oO(n),!0;if(i.snap)n.visibleWrites=Km(n.visibleWrites,i.path);else{const a=i.children;Fe(a,c=>{n.visibleWrites=Km(n.visibleWrites,oe(i.path,c))})}return!0}else return!1}function rO(n,e){if(n.snap)return Lt(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&Lt(oe(n.path,t),e))return!0;return!1}function oO(n){n.visibleWrites=MI(n.allWrites,aO,H()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function aO(n){return n.visible}function MI(n,e,t){let i=zt.empty();for(let s=0;s<n.length;++s){const r=n[s];if(e(r)){const o=r.path;let a;if(r.snap)Lt(t,o)?(a=ut(t,o),i=lo(i,a,r.snap)):Lt(o,t)&&(a=ut(o,t),i=lo(i,H(),r.snap.getChild(a)));else if(r.children){if(Lt(t,o))a=ut(t,o),i=Zh(i,a,r.children);else if(Lt(o,t))if(a=ut(o,t),$(a))i=Zh(i,H(),r.children);else{const c=Yi(r.children,V(a));if(c){const l=c.getChild(Z(a));i=lo(i,H(),l)}}}else throw sa("WriteRecord should have .snap or .children")}}return i}function LI(n,e,t,i,s){if(!i&&!s){const r=ws(n.visibleWrites,e);if(r!=null)return r;{const o=Jn(n.visibleWrites,e);if(td(o))return t;if(t==null&&!ed(o,H()))return null;{const a=t||D.EMPTY_NODE;return tr(o,a)}}}else{const r=Jn(n.visibleWrites,e);if(!s&&td(r))return t;if(!s&&t==null&&!ed(r,H()))return null;{const o=function(l){return(l.visible||s)&&(!i||!~i.indexOf(l.writeId))&&(Lt(l.path,e)||Lt(e,l.path))},a=MI(n.allWrites,o,e),c=t||D.EMPTY_NODE;return tr(a,c)}}}function cO(n,e,t){let i=D.EMPTY_NODE;const s=ws(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(te,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(t){const r=Jn(n.visibleWrites,e);return t.forEachChild(te,(o,a)=>{const c=tr(Jn(r,new z(o)),a);i=i.updateImmediateChild(o,c)}),jm(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{const r=Jn(n.visibleWrites,e);return jm(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function lO(n,e,t,i,s){E(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=oe(e,t);if(ed(n.visibleWrites,r))return null;{const o=Jn(n.visibleWrites,r);return td(o)?s.getChild(t):tr(o,s.getChild(t))}}function uO(n,e,t,i){const s=oe(e,t),r=ws(n.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(t)){const o=Jn(n.visibleWrites,s);return tr(o,i.getNode().getImmediateChild(t))}else return null}function hO(n,e){return ws(n.visibleWrites,e)}function dO(n,e,t,i,s,r,o){let a;const c=Jn(n.visibleWrites,e),l=ws(c,H());if(l!=null)a=l;else if(t!=null)a=tr(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){const u=[],h=o.getCompare(),d=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let f=d.getNext();for(;f&&u.length<s;)h(f,i)!==0&&u.push(f),f=d.getNext();return u}else return[]}function fO(){return{visibleWrites:zt.empty(),allWrites:[],lastWriteId:-1}}function Lc(n,e,t,i){return LI(n.writeTree,n.treePath,e,t,i)}function $f(n,e){return cO(n.writeTree,n.treePath,e)}function Gm(n,e,t,i){return lO(n.writeTree,n.treePath,e,t,i)}function Fc(n,e){return hO(n.writeTree,oe(n.treePath,e))}function pO(n,e,t,i,s,r){return dO(n.writeTree,n.treePath,e,t,i,s,r)}function Bf(n,e,t){return uO(n.writeTree,n.treePath,e,t)}function FI(n,e){return UI(oe(n.treePath,e),n.writeTree)}function UI(n,e){return{treePath:n,writeTree:e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gO{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;E(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),E(i!==".priority","Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const r=s.type;if(t==="child_added"&&r==="child_removed")this.changeMap.set(i,Do(i,e.snapshotNode,s.snapshotNode));else if(t==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&r==="child_changed")this.changeMap.set(i,No(i,s.oldSnap));else if(t==="child_changed"&&r==="child_added")this.changeMap.set(i,Zs(i,e.snapshotNode));else if(t==="child_changed"&&r==="child_changed")this.changeMap.set(i,Do(i,e.snapshotNode,s.oldSnap));else throw sa("Illegal combination of changes: "+e+" occurred after "+s)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mO{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}}const VI=new mO;class qf{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=this.optCompleteServerCache_!=null?new oi(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Bf(this.writes_,e,i)}}getChildAfterChild(e,t,i){const s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:ns(this.viewCache_),r=pO(this.writes_,s,t,1,i,e);return r.length===0?null:r[0]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _O(n){return{filter:n}}function yO(n,e){E(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),E(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function vO(n,e,t,i,s){const r=new gO;let o,a;if(t.type===Gt.OVERWRITE){const l=t;l.source.fromUser?o=nd(n,e,l.path,l.snap,i,s,r):(E(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!$(l.path),o=Uc(n,e,l.path,l.snap,i,s,a,r))}else if(t.type===Gt.MERGE){const l=t;l.source.fromUser?o=IO(n,e,l.path,l.children,i,s,r):(E(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),o=id(n,e,l.path,l.children,i,s,a,r))}else if(t.type===Gt.ACK_USER_WRITE){const l=t;l.revert?o=bO(n,e,l.path,i,s,r):o=TO(n,e,l.path,l.affectedTree,i,s,r)}else if(t.type===Gt.LISTEN_COMPLETE)o=EO(n,e,t.path,i,r);else throw sa("Unknown operation type: "+t.type);const c=r.getChanges();return wO(e,o,c),{viewCache:o,changes:c}}function wO(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Mc(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&t.push(PI(Mc(e)))}}function $I(n,e,t,i,s,r){const o=e.eventCache;if(Fc(i,t)!=null)return e;{let a,c;if($(t))if(E(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const l=ns(e),u=l instanceof D?l:D.EMPTY_NODE,h=$f(i,u);a=n.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const l=Lc(i,ns(e));a=n.filter.updateFullNode(e.eventCache.getNode(),l,r)}else{const l=V(t);if(l===".priority"){E(ri(t)===1,"Can't have a priority with additional path components");const u=o.getNode();c=e.serverCache.getNode();const h=Gm(i,t,u,c);h!=null?a=n.filter.updatePriority(u,h):a=o.getNode()}else{const u=Z(t);let h;if(o.isCompleteForChild(l)){c=e.serverCache.getNode();const d=Gm(i,t,o.getNode(),c);d!=null?h=o.getNode().getImmediateChild(l).updateChild(u,d):h=o.getNode().getImmediateChild(l)}else h=Bf(i,l,e.serverCache);h!=null?a=n.filter.updateChild(o.getNode(),l,h,u,s,r):a=o.getNode()}}return co(e,a,o.isFullyInitialized()||$(t),n.filter.filtersNodes())}}function Uc(n,e,t,i,s,r,o,a){const c=e.serverCache;let l;const u=o?n.filter:n.filter.getIndexedFilter();if($(t))l=u.updateFullNode(c.getNode(),i,null);else if(u.filtersNodes()&&!c.isFiltered()){const f=c.getNode().updateChild(t,i);l=u.updateFullNode(c.getNode(),f,null)}else{const f=V(t);if(!c.isCompleteForPath(t)&&ri(t)>1)return e;const p=Z(t),w=c.getNode().getImmediateChild(f).updateChild(p,i);f===".priority"?l=u.updatePriority(c.getNode(),w):l=u.updateChild(c.getNode(),f,w,p,VI,null)}const h=xI(e,l,c.isFullyInitialized()||$(t),u.filtersNodes()),d=new qf(s,h,r);return $I(n,h,t,s,d,a)}function nd(n,e,t,i,s,r,o){const a=e.eventCache;let c,l;const u=new qf(s,e,r);if($(t))l=n.filter.updateFullNode(e.eventCache.getNode(),i,o),c=co(e,l,!0,n.filter.filtersNodes());else{const h=V(t);if(h===".priority")l=n.filter.updatePriority(e.eventCache.getNode(),i),c=co(e,l,a.isFullyInitialized(),a.isFiltered());else{const d=Z(t),f=a.getNode().getImmediateChild(h);let p;if($(d))p=i;else{const _=u.getCompleteChild(h);_!=null?Nf(d)===".priority"&&_.getChild(SI(d)).isEmpty()?p=_:p=_.updateChild(d,i):p=D.EMPTY_NODE}if(f.equals(p))c=e;else{const _=n.filter.updateChild(a.getNode(),h,p,d,u,o);c=co(e,_,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function Hm(n,e){return n.eventCache.isCompleteForChild(e)}function IO(n,e,t,i,s,r,o){let a=e;return i.foreach((c,l)=>{const u=oe(t,c);Hm(e,V(u))&&(a=nd(n,a,u,l,s,r,o))}),i.foreach((c,l)=>{const u=oe(t,c);Hm(e,V(u))||(a=nd(n,a,u,l,s,r,o))}),a}function zm(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function id(n,e,t,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,l;$(t)?l=i:l=new ee(null).setTree(t,i);const u=e.serverCache.getNode();return l.children.inorderTraversal((h,d)=>{if(u.hasChild(h)){const f=e.serverCache.getNode().getImmediateChild(h),p=zm(n,f,d);c=Uc(n,c,new z(h),p,s,r,o,a)}}),l.children.inorderTraversal((h,d)=>{const f=!e.serverCache.isCompleteForChild(h)&&d.value===null;if(!u.hasChild(h)&&!f){const p=e.serverCache.getNode().getImmediateChild(h),_=zm(n,p,d);c=Uc(n,c,new z(h),_,s,r,o,a)}}),c}function TO(n,e,t,i,s,r,o){if(Fc(s,t)!=null)return e;const a=e.serverCache.isFiltered(),c=e.serverCache;if(i.value!=null){if($(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return Uc(n,e,t,c.getNode().getChild(t),s,r,a,o);if($(t)){let l=new ee(null);return c.getNode().forEachChild(cn,(u,h)=>{l=l.set(new z(u),h)}),id(n,e,t,l,s,r,a,o)}else return e}else{let l=new ee(null);return i.foreach((u,h)=>{const d=oe(t,u);c.isCompleteForPath(d)&&(l=l.set(u,c.getNode().getChild(d)))}),id(n,e,t,l,s,r,a,o)}}function EO(n,e,t,i,s){const r=e.serverCache,o=xI(e,r.getNode(),r.isFullyInitialized()||$(t),r.isFiltered());return $I(n,o,t,i,VI,s)}function bO(n,e,t,i,s,r){let o;if(Fc(i,t)!=null)return e;{const a=new qf(i,e,s),c=e.eventCache.getNode();let l;if($(t)||V(t)===".priority"){let u;if(e.serverCache.isFullyInitialized())u=Lc(i,ns(e));else{const h=e.serverCache.getNode();E(h instanceof D,"serverChildren would be complete if leaf node"),u=$f(i,h)}u=u,l=n.filter.updateFullNode(c,u,r)}else{const u=V(t);let h=Bf(i,u,e.serverCache);h==null&&e.serverCache.isCompleteForChild(u)&&(h=c.getImmediateChild(u)),h!=null?l=n.filter.updateChild(c,u,h,Z(t),a,r):e.eventCache.getNode().hasChild(u)?l=n.filter.updateChild(c,u,D.EMPTY_NODE,Z(t),a,r):l=c,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Lc(i,ns(e)),o.isLeafNode()&&(l=n.filter.updateFullNode(l,o,r)))}return o=e.serverCache.isFullyInitialized()||Fc(i,H())!=null,co(e,l,o,n.filter.filtersNodes())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SO{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new Lf(i.getIndex()),r=Vx(i);this.processor_=_O(r);const o=t.serverCache,a=t.eventCache,c=s.updateFullNode(D.EMPTY_NODE,o.getNode(),null),l=r.updateFullNode(D.EMPTY_NODE,a.getNode(),null),u=new oi(c,o.isFullyInitialized(),s.filtersNodes()),h=new oi(l,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=Vl(h,u),this.eventGenerator_=new Yx(this.query_)}get query(){return this.query_}}function CO(n){return n.viewCache_.serverCache.getNode()}function kO(n){return Mc(n.viewCache_)}function AO(n,e){const t=ns(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!$(e)&&!t.getImmediateChild(V(e)).isEmpty())?t.getChild(e):null}function Qm(n){return n.eventRegistrations_.length===0}function RO(n,e){n.eventRegistrations_.push(e)}function Ym(n,e,t){const i=[];if(t){E(e==null,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(!o.matches(e))s.push(o);else if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function Xm(n,e,t,i){e.type===Gt.MERGE&&e.source.queryId!==null&&(E(ns(n.viewCache_),"We should always have a full cache before handling merges"),E(Mc(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,r=vO(n.processor_,s,e,t,i);return yO(n.processor_,r.viewCache),E(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,BI(n,r.changes,r.viewCache.eventCache.getNode(),null)}function NO(n,e){const t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(te,(r,o)=>{i.push(Zs(r,o))}),t.isFullyInitialized()&&i.push(PI(t.getNode())),BI(n,i,t.getNode(),e)}function BI(n,e,t,i){const s=i?[i]:n.eventRegistrations_;return Xx(n.eventGenerator_,e,t,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Vc;class qI{constructor(){this.views=new Map}}function DO(n){E(!Vc,"__referenceConstructor has already been defined"),Vc=n}function PO(){return E(Vc,"Reference.ts has not been loaded"),Vc}function xO(n){return n.views.size===0}function Wf(n,e,t,i){const s=e.source.queryId;if(s!==null){const r=n.views.get(s);return E(r!=null,"SyncTree gave us an op for an invalid query."),Xm(r,e,t,i)}else{let r=[];for(const o of n.views.values())r=r.concat(Xm(o,e,t,i));return r}}function WI(n,e,t,i,s){const r=e._queryIdentifier,o=n.views.get(r);if(!o){let a=Lc(t,s?i:null),c=!1;a?c=!0:i instanceof D?(a=$f(t,i),c=!1):(a=D.EMPTY_NODE,c=!1);const l=Vl(new oi(a,c,!1),new oi(i,s,!1));return new SO(e,l)}return o}function OO(n,e,t,i,s,r){const o=WI(n,e,i,s,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),RO(o,t),NO(o,t)}function MO(n,e,t,i){const s=e._queryIdentifier,r=[];let o=[];const a=ai(n);if(s==="default")for(const[c,l]of n.views.entries())o=o.concat(Ym(l,t,i)),Qm(l)&&(n.views.delete(c),l.query._queryParams.loadsAllData()||r.push(l.query));else{const c=n.views.get(s);c&&(o=o.concat(Ym(c,t,i)),Qm(c)&&(n.views.delete(s),c.query._queryParams.loadsAllData()||r.push(c.query)))}return a&&!ai(n)&&r.push(new(PO())(e._repo,e._path)),{removed:r,events:o}}function KI(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function Zn(n,e){let t=null;for(const i of n.views.values())t=t||AO(i,e);return t}function jI(n,e){if(e._queryParams.loadsAllData())return Bl(n);{const i=e._queryIdentifier;return n.views.get(i)}}function GI(n,e){return jI(n,e)!=null}function ai(n){return Bl(n)!=null}function Bl(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let $c;function LO(n){E(!$c,"__referenceConstructor has already been defined"),$c=n}function FO(){return E($c,"Reference.ts has not been loaded"),$c}let UO=1;class Jm{constructor(e){this.listenProvider_=e,this.syncPointTree_=new ee(null),this.pendingWriteTree_=fO(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Kf(n,e,t,i,s){return tO(n.pendingWriteTree_,e,t,i,s),s?br(n,new ts(Ff(),e,t)):[]}function VO(n,e,t,i){nO(n.pendingWriteTree_,e,t,i);const s=ee.fromObject(t);return br(n,new er(Ff(),e,s))}function Yn(n,e,t=!1){const i=iO(n.pendingWriteTree_,e);if(sO(n.pendingWriteTree_,e)){let r=new ee(null);return i.snap!=null?r=r.set(H(),!0):Fe(i.children,o=>{r=r.set(new z(o),!0)}),br(n,new Oc(i.path,r,t))}else return[]}function fa(n,e,t){return br(n,new ts(Uf(),e,t))}function $O(n,e,t){const i=ee.fromObject(t);return br(n,new er(Uf(),e,i))}function BO(n,e){return br(n,new xo(Uf(),e))}function qO(n,e,t){const i=jf(n,t);if(i){const s=Gf(i),r=s.path,o=s.queryId,a=ut(r,e),c=new xo(Vf(o),a);return Hf(n,r,c)}else return[]}function Bc(n,e,t,i,s=!1){const r=e._path,o=n.syncPointTree_.get(r);let a=[];if(o&&(e._queryIdentifier==="default"||GI(o,e))){const c=MO(o,e,t,i);xO(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const l=c.removed;if(a=c.events,!s){const u=l.findIndex(d=>d._queryParams.loadsAllData())!==-1,h=n.syncPointTree_.findOnPath(r,(d,f)=>ai(f));if(u&&!h){const d=n.syncPointTree_.subtree(r);if(!d.isEmpty()){const f=jO(d);for(let p=0;p<f.length;++p){const _=f[p],w=_.query,N=YI(n,_);n.listenProvider_.startListening(uo(w),Oo(n,w),N.hashFn,N.onComplete)}}}!h&&l.length>0&&!i&&(u?n.listenProvider_.stopListening(uo(e),null):l.forEach(d=>{const f=n.queryToTagMap.get(Wl(d));n.listenProvider_.stopListening(uo(d),f)}))}GO(n,l)}return a}function HI(n,e,t,i){const s=jf(n,i);if(s!=null){const r=Gf(s),o=r.path,a=r.queryId,c=ut(o,e),l=new ts(Vf(a),c,t);return Hf(n,o,l)}else return[]}function WO(n,e,t,i){const s=jf(n,i);if(s){const r=Gf(s),o=r.path,a=r.queryId,c=ut(o,e),l=ee.fromObject(t),u=new er(Vf(a),c,l);return Hf(n,o,u)}else return[]}function sd(n,e,t,i=!1){const s=e._path;let r=null,o=!1;n.syncPointTree_.foreachOnPath(s,(d,f)=>{const p=ut(d,s);r=r||Zn(f,p),o=o||ai(f)});let a=n.syncPointTree_.get(s);a?(o=o||ai(a),r=r||Zn(a,H())):(a=new qI,n.syncPointTree_=n.syncPointTree_.set(s,a));let c;r!=null?c=!0:(c=!1,r=D.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((f,p)=>{const _=Zn(p,H());_&&(r=r.updateImmediateChild(f,_))}));const l=GI(a,e);if(!l&&!e._queryParams.loadsAllData()){const d=Wl(e);E(!n.queryToTagMap.has(d),"View does not exist, but we have a tag");const f=HO();n.queryToTagMap.set(d,f),n.tagToQueryMap.set(f,d)}const u=$l(n.pendingWriteTree_,s);let h=OO(a,e,t,u,r,c);if(!l&&!o&&!i){const d=jI(a,e);h=h.concat(zO(n,e,d))}return h}function ql(n,e,t){const s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{const c=ut(o,e),l=Zn(a,c);if(l)return l});return LI(s,e,r,t,!0)}function KO(n,e){const t=e._path;let i=null;n.syncPointTree_.foreachOnPath(t,(l,u)=>{const h=ut(l,t);i=i||Zn(u,h)});let s=n.syncPointTree_.get(t);s?i=i||Zn(s,H()):(s=new qI,n.syncPointTree_=n.syncPointTree_.set(t,s));const r=i!=null,o=r?new oi(i,!0,!1):null,a=$l(n.pendingWriteTree_,e._path),c=WI(s,e,a,r?o.getNode():D.EMPTY_NODE,r);return kO(c)}function br(n,e){return zI(e,n.syncPointTree_,null,$l(n.pendingWriteTree_,H()))}function zI(n,e,t,i){if($(n.path))return QI(n,e,t,i);{const s=e.get(H());t==null&&s!=null&&(t=Zn(s,H()));let r=[];const o=V(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){const l=t?t.getImmediateChild(o):null,u=FI(i,o);r=r.concat(zI(a,c,l,u))}return s&&(r=r.concat(Wf(s,n,i,t))),r}}function QI(n,e,t,i){const s=e.get(H());t==null&&s!=null&&(t=Zn(s,H()));let r=[];return e.children.inorderTraversal((o,a)=>{const c=t?t.getImmediateChild(o):null,l=FI(i,o),u=n.operationForChild(o);u&&(r=r.concat(QI(u,a,c,l)))}),s&&(r=r.concat(Wf(s,n,i,t))),r}function YI(n,e){const t=e.query,i=Oo(n,t);return{hashFn:()=>(CO(e)||D.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?qO(n,t._path,i):BO(n,t._path);{const r=VP(s,t);return Bc(n,t,null,r)}}}}function Oo(n,e){const t=Wl(e);return n.queryToTagMap.get(t)}function Wl(n){return n._path.toString()+"$"+n._queryIdentifier}function jf(n,e){return n.tagToQueryMap.get(e)}function Gf(n){const e=n.indexOf("$");return E(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new z(n.substr(0,e))}}function Hf(n,e,t){const i=n.syncPointTree_.get(e);E(i,"Missing sync point for query tag that we're tracking");const s=$l(n.pendingWriteTree_,e);return Wf(i,t,s,null)}function jO(n){return n.fold((e,t,i)=>{if(t&&ai(t))return[Bl(t)];{let s=[];return t&&(s=KI(t)),Fe(i,(r,o)=>{s=s.concat(o)}),s}})}function uo(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(FO())(n._repo,n._path):n}function GO(n,e){for(let t=0;t<e.length;++t){const i=e[t];if(!i._queryParams.loadsAllData()){const s=Wl(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}function HO(){return UO++}function zO(n,e,t){const i=e._path,s=Oo(n,e),r=YI(n,t),o=n.listenProvider_.startListening(uo(e),s,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(i);if(s)E(!ai(a.value),"If we're adding a query, it shouldn't be shadowed");else{const c=a.fold((l,u,h)=>{if(!$(l)&&u&&ai(u))return[Bl(u).query];{let d=[];return u&&(d=d.concat(KI(u).map(f=>f.query))),Fe(h,(f,p)=>{d=d.concat(p)}),d}});for(let l=0;l<c.length;++l){const u=c[l];n.listenProvider_.stopListening(uo(u),Oo(n,u))}}return o}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zf{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new zf(t)}node(){return this.node_}}class Qf{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=oe(this.path_,e);return new Qf(this.syncTree_,t)}node(){return ql(this.syncTree_,this.path_)}}const QO=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Zm=function(n,e,t){if(!n||typeof n!="object")return n;if(E(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return YO(n[".sv"],e,t);if(typeof n[".sv"]=="object")return XO(n[".sv"],e);E(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},YO=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:E(!1,"Unexpected server value: "+n)}},XO=function(n,e,t){n.hasOwnProperty("increment")||E(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;typeof i!="number"&&E(!1,"Unexpected increment value: "+i);const s=e.node();if(E(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return typeof o!="number"?i:o+i},XI=function(n,e,t,i){return Xf(e,new Qf(t,n),i)},Yf=function(n,e,t){return Xf(n,new zf(e),t)};function Xf(n,e,t){const i=n.getPriority().val(),s=Zm(i,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,a=Zm(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new Ce(a,le(s)):n}else{const o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new Ce(s))),o.forEachChild(te,(a,c)=>{const l=Xf(c,e.getImmediateChild(a),t);l!==c&&(r=r.updateImmediateChild(a,l))}),r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jf{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function Kl(n,e){let t=e instanceof z?e:new z(e),i=n,s=V(t);for(;s!==null;){const r=Yi(i.node.children,s)||{children:{},childCount:0};i=new Jf(s,i,r),t=Z(t),s=V(t)}return i}function Is(n){return n.node.value}function Zf(n,e){n.node.value=e,rd(n)}function JI(n){return n.node.childCount>0}function JO(n){return Is(n)===void 0&&!JI(n)}function jl(n,e){Fe(n.node.children,(t,i)=>{e(new Jf(t,n,i))})}function ZI(n,e,t,i){t&&!i&&e(n),jl(n,s=>{ZI(s,e,!0,i)}),t&&i&&e(n)}function ZO(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function pa(n){return new z(n.parent===null?n.name:pa(n.parent)+"/"+n.name)}function rd(n){n.parent!==null&&eM(n.parent,n.name,n)}function eM(n,e,t){const i=JO(t),s=At(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,rd(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,rd(n))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tM=/[\[\].#$\/\u0000-\u001F\u007F]/,nM=/[\[\].#$\u0000-\u001F\u007F]/,nh=10*1024*1024,Gl=function(n){return typeof n=="string"&&n.length!==0&&!tM.test(n)},eT=function(n){return typeof n=="string"&&n.length!==0&&!nM.test(n)},iM=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),eT(n)},Mo=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!Ml(n)||n&&typeof n=="object"&&At(n,".sv")},gn=function(n,e,t,i){i&&e===void 0||ga($t(n,"value"),e,t)},ga=function(n,e,t){const i=t instanceof z?new vx(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+Ai(i));if(typeof e=="function")throw new Error(n+"contains a function "+Ai(i)+" with contents = "+e.toString());if(Ml(e))throw new Error(n+"contains "+e.toString()+" "+Ai(i));if(typeof e=="string"&&e.length>nh/3&&vl(e)>nh)throw new Error(n+"contains a string greater than "+nh+" utf8 bytes "+Ai(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let s=!1,r=!1;if(Fe(e,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Gl(o)))throw new Error(n+" contains an invalid key ("+o+") "+Ai(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);wx(i,o),ga(n,a,i),Ix(i)}),s&&r)throw new Error(n+' contains ".value" child '+Ai(i)+" in addition to actual children.")}},sM=function(n,e){let t,i;for(t=0;t<e.length;t++){i=e[t];const r=Ro(i);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!Gl(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}e.sort(yx);let s=null;for(t=0;t<e.length;t++){if(i=e[t],s!==null&&Lt(s,i))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}},tT=function(n,e,t,i){if(i&&e===void 0)return;const s=$t(n,"values");if(!(e&&typeof e=="object")||Array.isArray(e))throw new Error(s+" must be an object containing the children to replace.");const r=[];Fe(e,(o,a)=>{const c=new z(o);if(ga(s,a,oe(t,c)),Nf(c)===".priority"&&!Mo(a))throw new Error(s+"contains an invalid value for '"+c.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(c)}),sM(s,r)},ep=function(n,e,t){if(!(t&&e===void 0)){if(Ml(e))throw new Error($t(n,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Mo(e))throw new Error($t(n,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},ma=function(n,e,t,i){if(!(i&&t===void 0)&&!Gl(t))throw new Error($t(n,e)+'was an invalid key = "'+t+`".  Firebase keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]").`)},Lo=function(n,e,t,i){if(!(i&&t===void 0)&&!eT(t))throw new Error($t(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},rM=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Lo(n,e,t,i)},Ft=function(n,e){if(V(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},nT=function(n,e){const t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Gl(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!iM(t))throw new Error($t(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oM{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Hl(n,e){let t=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();t!==null&&!Df(r,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:r}),t.events.push(s)}t&&n.eventLists_.push(t)}function iT(n,e,t){Hl(n,t),sT(n,i=>Df(i,e))}function Nt(n,e,t){Hl(n,t),sT(n,i=>Lt(i,e)||Lt(e,i))}function sT(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const s=n.eventLists_[i];if(s){const r=s.path;e(r)?(aM(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function aM(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(t!==null){n.events[e]=null;const i=t.getEventRunner();Gi&&De("event: "+t.toString()),Tr(i)}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rT="repo_interrupt",cM=25;class lM{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new oM,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=xc(),this.transactionQueueTree_=new Jf,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function uM(n,e,t){if(n.stats_=Af(n.repoInfo_),n.forceRestClient_||WP())n.server_=new Pc(n.repoInfo_,(i,s,r,o)=>{e_(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>t_(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Ee(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new An(n.repoInfo_,e,(i,s,r,o)=>{e_(n,i,s,r,o)},i=>{t_(n,i)},i=>{hM(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=zP(n.repoInfo_,()=>new Qx(n.stats_,n.server_)),n.infoData_=new Kx,n.infoSyncTree_=new Jm({startListening:(i,s,r,o)=>{let a=[];const c=n.infoData_.getNode(i._path);return c.isEmpty()||(a=fa(n.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),tp(n,"connected",!1),n.serverSyncTree_=new Jm({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(a,c)=>{const l=o(a,c);Nt(n.eventQueue_,i._path,l)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}function oT(n){const t=n.infoData_.getNode(new z(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function _a(n){return QO({timestamp:oT(n)})}function e_(n,e,t,i,s){n.dataUpdateCount++;const r=new z(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(i){const c=wc(t,l=>le(l));o=WO(n.serverSyncTree_,r,c,s)}else{const c=le(t);o=HI(n.serverSyncTree_,r,c,s)}else if(i){const c=wc(t,l=>le(l));o=$O(n.serverSyncTree_,r,c)}else{const c=le(t);o=fa(n.serverSyncTree_,r,c)}let a=r;o.length>0&&(a=nr(n,r)),Nt(n.eventQueue_,a,o)}function t_(n,e){tp(n,"connected",e),e===!1&&pM(n)}function hM(n,e){Fe(e,(t,i)=>{tp(n,t,i)})}function tp(n,e,t){const i=new z("/.info/"+e),s=le(t);n.infoData_.updateSnapshot(i,s);const r=fa(n.infoSyncTree_,i,s);Nt(n.eventQueue_,i,r)}function zl(n){return n.nextWriteId_++}function dM(n,e,t){const i=KO(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(s=>{const r=le(s).withIndex(e._queryParams.getIndex());sd(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=fa(n.serverSyncTree_,e._path,r);else{const a=Oo(n.serverSyncTree_,e);o=HI(n.serverSyncTree_,e._path,r,a)}return Nt(n.eventQueue_,e._path,o),Bc(n.serverSyncTree_,e,t,null,!0),r},s=>(Sr(n,"get for query "+Ee(e)+" failed: "+s),Promise.reject(new Error(s))))}function np(n,e,t,i,s){Sr(n,"set",{path:e.toString(),value:t,priority:i});const r=_a(n),o=le(t,i),a=ql(n.serverSyncTree_,e),c=Yf(o,a,r),l=zl(n),u=Kf(n.serverSyncTree_,e,c,l,!0);Hl(n.eventQueue_,u),n.server_.put(e.toString(),o.val(!0),(d,f)=>{const p=d==="ok";p||nt("set at "+e+" failed: "+d);const _=Yn(n.serverSyncTree_,l,!p);Nt(n.eventQueue_,e,_),ci(n,s,d,f)});const h=sp(n,e);nr(n,h),Nt(n.eventQueue_,h,[])}function fM(n,e,t,i){Sr(n,"update",{path:e.toString(),value:t});let s=!0;const r=_a(n),o={};if(Fe(t,(a,c)=>{s=!1,o[a]=XI(oe(e,a),le(c),n.serverSyncTree_,r)}),s)De("update() called with empty data.  Don't do anything."),ci(n,i,"ok",void 0);else{const a=zl(n),c=VO(n.serverSyncTree_,e,o,a);Hl(n.eventQueue_,c),n.server_.merge(e.toString(),t,(l,u)=>{const h=l==="ok";h||nt("update at "+e+" failed: "+l);const d=Yn(n.serverSyncTree_,a,!h),f=d.length>0?nr(n,e):e;Nt(n.eventQueue_,f,d),ci(n,i,l,u)}),Fe(t,l=>{const u=sp(n,oe(e,l));nr(n,u)}),Nt(n.eventQueue_,e,[])}}function pM(n){Sr(n,"onDisconnectEvents");const e=_a(n),t=xc();Jh(n.onDisconnect_,H(),(s,r)=>{const o=XI(s,r,n.serverSyncTree_,e);Er(t,s,o)});let i=[];Jh(t,H(),(s,r)=>{i=i.concat(fa(n.serverSyncTree_,s,r));const o=sp(n,s);nr(n,o)}),n.onDisconnect_=xc(),Nt(n.eventQueue_,H(),i)}function gM(n,e,t){n.server_.onDisconnectCancel(e.toString(),(i,s)=>{i==="ok"&&Xh(n.onDisconnect_,e),ci(n,t,i,s)})}function n_(n,e,t,i){const s=le(t);n.server_.onDisconnectPut(e.toString(),s.val(!0),(r,o)=>{r==="ok"&&Er(n.onDisconnect_,e,s),ci(n,i,r,o)})}function mM(n,e,t,i,s){const r=le(t,i);n.server_.onDisconnectPut(e.toString(),r.val(!0),(o,a)=>{o==="ok"&&Er(n.onDisconnect_,e,r),ci(n,s,o,a)})}function _M(n,e,t,i){if(vc(t)){De("onDisconnect().update() called with empty data.  Don't do anything."),ci(n,i,"ok",void 0);return}n.server_.onDisconnectMerge(e.toString(),t,(s,r)=>{s==="ok"&&Fe(t,(o,a)=>{const c=le(a);Er(n.onDisconnect_,oe(e,o),c)}),ci(n,i,s,r)})}function yM(n,e,t){let i;V(e._path)===".info"?i=sd(n.infoSyncTree_,e,t):i=sd(n.serverSyncTree_,e,t),iT(n.eventQueue_,e._path,i)}function od(n,e,t){let i;V(e._path)===".info"?i=Bc(n.infoSyncTree_,e,t):i=Bc(n.serverSyncTree_,e,t),iT(n.eventQueue_,e._path,i)}function aT(n){n.persistentConnection_&&n.persistentConnection_.interrupt(rT)}function vM(n){n.persistentConnection_&&n.persistentConnection_.resume(rT)}function Sr(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),De(t,...e)}function ci(n,e,t,i){e&&Tr(()=>{if(t==="ok")e(null);else{const s=(t||"error").toUpperCase();let r=s;i&&(r+=": "+i);const o=new Error(r);o.code=s,e(o)}})}function wM(n,e,t,i,s,r){Sr(n,"transaction on "+e);const o={path:e,update:t,onComplete:i,status:null,order:nI(),applyLocally:r,retryCount:0,unwatcher:s,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},a=ip(n,e,void 0);o.currentInputSnapshot=a;const c=o.update(a.val());if(c===void 0)o.unwatcher(),o.currentOutputSnapshotRaw=null,o.currentOutputSnapshotResolved=null,o.onComplete&&o.onComplete(null,!1,o.currentInputSnapshot);else{ga("transaction failed: Data returned ",c,o.path),o.status=0;const l=Kl(n.transactionQueueTree_,e),u=Is(l)||[];u.push(o),Zf(l,u);let h;typeof c=="object"&&c!==null&&At(c,".priority")?(h=Yi(c,".priority"),E(Mo(h),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):h=(ql(n.serverSyncTree_,e)||D.EMPTY_NODE).getPriority().val();const d=_a(n),f=le(c,h),p=Yf(f,a,d);o.currentOutputSnapshotRaw=f,o.currentOutputSnapshotResolved=p,o.currentWriteId=zl(n);const _=Kf(n.serverSyncTree_,e,p,o.currentWriteId,o.applyLocally);Nt(n.eventQueue_,e,_),Ql(n,n.transactionQueueTree_)}}function ip(n,e,t){return ql(n.serverSyncTree_,e,t)||D.EMPTY_NODE}function Ql(n,e=n.transactionQueueTree_){if(e||Yl(n,e),Is(e)){const t=lT(n,e);E(t.length>0,"Sending zero length transaction queue"),t.every(s=>s.status===0)&&IM(n,pa(e),t)}else JI(e)&&jl(e,t=>{Ql(n,t)})}function IM(n,e,t){const i=t.map(l=>l.currentWriteId),s=ip(n,e,i);let r=s;const o=s.hash();for(let l=0;l<t.length;l++){const u=t[l];E(u.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=1,u.retryCount++;const h=ut(e,u.path);r=r.updateChild(h,u.currentOutputSnapshotRaw)}const a=r.val(!0),c=e;n.server_.put(c.toString(),a,l=>{Sr(n,"transaction put response",{path:c.toString(),status:l});let u=[];if(l==="ok"){const h=[];for(let d=0;d<t.length;d++)t[d].status=2,u=u.concat(Yn(n.serverSyncTree_,t[d].currentWriteId)),t[d].onComplete&&h.push(()=>t[d].onComplete(null,!0,t[d].currentOutputSnapshotResolved)),t[d].unwatcher();Yl(n,Kl(n.transactionQueueTree_,e)),Ql(n,n.transactionQueueTree_),Nt(n.eventQueue_,e,u);for(let d=0;d<h.length;d++)Tr(h[d])}else{if(l==="datastale")for(let h=0;h<t.length;h++)t[h].status===3?t[h].status=4:t[h].status=0;else{nt("transaction at "+c.toString()+" failed: "+l);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=l}nr(n,e)}},o)}function nr(n,e){const t=cT(n,e),i=pa(t),s=lT(n,t);return TM(n,s,i),i}function TM(n,e,t){if(e.length===0)return;const i=[];let s=[];const o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const c=e[a],l=ut(t,c.path);let u=!1,h;if(E(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)u=!0,h=c.abortReason,s=s.concat(Yn(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=cM)u=!0,h="maxretry",s=s.concat(Yn(n.serverSyncTree_,c.currentWriteId,!0));else{const d=ip(n,c.path,o);c.currentInputSnapshot=d;const f=e[a].update(d.val());if(f!==void 0){ga("transaction failed: Data returned ",f,c.path);let p=le(f);typeof f=="object"&&f!=null&&At(f,".priority")||(p=p.updatePriority(d.getPriority()));const w=c.currentWriteId,N=_a(n),M=Yf(p,d,N);c.currentOutputSnapshotRaw=p,c.currentOutputSnapshotResolved=M,c.currentWriteId=zl(n),o.splice(o.indexOf(w),1),s=s.concat(Kf(n.serverSyncTree_,c.path,M,c.currentWriteId,c.applyLocally)),s=s.concat(Yn(n.serverSyncTree_,w,!0))}else u=!0,h="nodata",s=s.concat(Yn(n.serverSyncTree_,c.currentWriteId,!0))}Nt(n.eventQueue_,t,s),s=[],u&&(e[a].status=2,function(d){setTimeout(d,Math.floor(0))}(e[a].unwatcher),e[a].onComplete&&(h==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(h),!1,null))))}Yl(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Tr(i[a]);Ql(n,n.transactionQueueTree_)}function cT(n,e){let t,i=n.transactionQueueTree_;for(t=V(e);t!==null&&Is(i)===void 0;)i=Kl(i,t),e=Z(e),t=V(e);return i}function lT(n,e){const t=[];return uT(n,e,t),t.sort((i,s)=>i.order-s.order),t}function uT(n,e,t){const i=Is(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);jl(e,s=>{uT(n,s,t)})}function Yl(n,e){const t=Is(e);if(t){let i=0;for(let s=0;s<t.length;s++)t[s].status!==2&&(t[i]=t[s],i++);t.length=i,Zf(e,t.length>0?t:void 0)}jl(e,i=>{Yl(n,i)})}function sp(n,e){const t=pa(cT(n,e)),i=Kl(n.transactionQueueTree_,e);return ZO(i,s=>{ih(n,s)}),ih(n,i),ZI(i,s=>{ih(n,s)}),t}function ih(n,e){const t=Is(e);if(t){const i=[];let s=[],r=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(E(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(E(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(Yn(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Zf(e,void 0):t.length=r+1,Nt(n.eventQueue_,pa(e),s);for(let o=0;o<i.length;o++)Tr(i[o])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EM(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}function bM(n){const e={};n.charAt(0)==="?"&&(n=n.substring(1));for(const t of n.split("&")){if(t.length===0)continue;const i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):nt(`Invalid query segment '${t}' in query '${n}'`)}return e}const ad=function(n,e){const t=SM(n),i=t.namespace;t.domain==="firebase.com"&&pn(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&pn("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||OP();const s=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new mI(t.host,t.secure,i,s,e,"",i!==t.subdomain),path:new z(t.pathString)}},SM=function(n){let e="",t="",i="",s="",r="",o=!0,a="https",c=443;if(typeof n=="string"){let l=n.indexOf("//");l>=0&&(a=n.substring(0,l-1),n=n.substring(l+2));let u=n.indexOf("/");u===-1&&(u=n.length);let h=n.indexOf("?");h===-1&&(h=n.length),e=n.substring(0,Math.min(u,h)),u<h&&(s=EM(n.substring(u,h)));const d=bM(n.substring(Math.min(n.length,h)));l=e.indexOf(":"),l>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(l+1),10)):l=e.length;const f=e.slice(0,l);if(f.toLowerCase()==="localhost")t="localhost";else if(f.split(".").length<=2)t=f;else{const p=e.indexOf(".");i=e.substring(0,p).toLowerCase(),t=e.substring(p+1),r=i}"ns"in d&&(r=d.ns)}return{host:e,port:c,domain:t,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const i_="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",CM=function(){let n=0;const e=[];return function(t){const i=t===n;n=t;let s;const r=new Array(8);for(s=7;s>=0;s--)r[s]=i_.charAt(t%64),t=Math.floor(t/64);E(t===0,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&e[s]===63;s--)e[s]=0;e[s]++}else for(s=0;s<12;s++)e[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=i_.charAt(e[s]);return E(o.length===20,"nextPushId: Length should be 20."),o}}();/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hT{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){const e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Ee(this.snapshot.exportVal())}}class dT{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rp{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return E(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let kM=class{constructor(e,t){this._repo=e,this._path=t}cancel(){const e=new Pe;return gM(this._repo,this._path,e.wrapCallback(()=>{})),e.promise}remove(){Ft("OnDisconnect.remove",this._path);const e=new Pe;return n_(this._repo,this._path,null,e.wrapCallback(()=>{})),e.promise}set(e){Ft("OnDisconnect.set",this._path),gn("OnDisconnect.set",e,this._path,!1);const t=new Pe;return n_(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}setWithPriority(e,t){Ft("OnDisconnect.setWithPriority",this._path),gn("OnDisconnect.setWithPriority",e,this._path,!1),ep("OnDisconnect.setWithPriority",t,!1);const i=new Pe;return mM(this._repo,this._path,e,t,i.wrapCallback(()=>{})),i.promise}update(e){Ft("OnDisconnect.update",this._path),tT("OnDisconnect.update",e,this._path,!1);const t=new Pe;return _M(this._repo,this._path,e,t.wrapCallback(()=>{})),t.promise}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tt{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return $(this._path)?null:Nf(this._path)}get ref(){return new Wt(this._repo,this._path)}get _queryIdentifier(){const e=qm(this._queryParams),t=Cf(e);return t==="{}"?"default":t}get _queryObject(){return qm(this._queryParams)}isEqual(e){if(e=v(e),!(e instanceof Tt))return!1;const t=this._repo===e._repo,i=Df(this._path,e._path),s=this._queryIdentifier===e._queryIdentifier;return t&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+_x(this._path)}}function Xl(n,e){if(n._orderByCalled===!0)throw new Error(e+": You can't combine multiple orderBy calls.")}function yi(n){let e=null,t=null;if(n.hasStart()&&(e=n.getIndexStartValue()),n.hasEnd()&&(t=n.getIndexEndValue()),n.getIndex()===cn){const i="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",s="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(n.hasStart()){if(n.getIndexStartName()!==si)throw new Error(i);if(typeof e!="string")throw new Error(s)}if(n.hasEnd()){if(n.getIndexEndName()!==Dn)throw new Error(i);if(typeof t!="string")throw new Error(s)}}else if(n.getIndex()===te){if(e!=null&&!Mo(e)||t!=null&&!Mo(t))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(E(n.getIndex()instanceof Of||n.getIndex()===Mf,"unknown index type."),e!=null&&typeof e=="object"||t!=null&&typeof t=="object")throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Jl(n){if(n.hasStart()&&n.hasEnd()&&n.hasLimit()&&!n.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}class Wt extends Tt{constructor(e,t){super(e,t,new Fl,!1)}get parent(){const e=SI(this._path);return e===null?null:new Wt(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}}let ir=class{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new z(e),i=is(this.ref,e);return new ir(this._node.getChild(t),i,te)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>e(new ir(s,is(this.ref,i),te)))}hasChild(e){const t=new z(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function fT(n,e){return n=v(n),n._checkNotDeleted("ref"),e!==void 0?is(n._root,e):n._root}function s_(n,e){n=v(n),n._checkNotDeleted("refFromURL");const t=ad(e,n._repo.repoInfo_.nodeAdmin);nT("refFromURL",t);const i=t.repoInfo;return!n._repo.repoInfo_.isCustomHost()&&i.host!==n._repo.repoInfo_.host&&pn("refFromURL: Host name does not match the current database: (found "+i.host+" but expected "+n._repo.repoInfo_.host+")"),fT(n,t.path.toString())}function is(n,e){return n=v(n),V(n._path)===null?rM("child","path",e,!1):Lo("child","path",e,!1),new Wt(n._repo,oe(n._path,e))}function AM(n,e){n=v(n),Ft("push",n._path),gn("push",e,n._path,!0);const t=oT(n._repo),i=CM(t),s=is(n,i),r=is(n,i);let o;return e!=null?o=op(r,e).then(()=>r):o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function RM(n){return Ft("remove",n._path),op(n,null)}function op(n,e){n=v(n),Ft("set",n._path),gn("set",e,n._path,!1);const t=new Pe;return np(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function NM(n,e){n=v(n),Ft("setPriority",n._path),ep("setPriority",e,!1);const t=new Pe;return np(n._repo,oe(n._path,".priority"),e,null,t.wrapCallback(()=>{})),t.promise}function DM(n,e,t){if(Ft("setWithPriority",n._path),gn("setWithPriority",e,n._path,!1),ep("setWithPriority",t,!1),n.key===".length"||n.key===".keys")throw"setWithPriority failed: "+n.key+" is a read-only object.";const i=new Pe;return np(n._repo,n._path,e,t,i.wrapCallback(()=>{})),i.promise}function PM(n,e){tT("update",e,n._path,!1);const t=new Pe;return fM(n._repo,n._path,e,t.wrapCallback(()=>{})),t.promise}function xM(n){n=v(n);const e=new rp(()=>{}),t=new ya(e);return dM(n._repo,n,t).then(i=>new ir(i,new Wt(n._repo,n._path),n._queryParams.getIndex()))}class ya{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){const i=t._queryParams.getIndex();return new hT("value",this,new ir(e.snapshotNode,new Wt(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new dT(this,e,t):null}matches(e){return e instanceof ya?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}}class Zl{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new dT(this,e,t):null}createEvent(e,t){E(e.childName!=null,"Child events should have a childName.");const i=is(new Wt(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new hT(e.type,this,new ir(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Zl?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}}function va(n,e,t,i,s){let r;if(typeof i=="object"&&(r=void 0,s=i),typeof i=="function"&&(r=i),s&&s.onlyOnce){const c=t,l=(u,h)=>{od(n._repo,n,a),c(u,h)};l.userCallback=t.userCallback,l.context=t.context,t=l}const o=new rp(t,r||void 0),a=e==="value"?new ya(o):new Zl(e,o);return yM(n._repo,n,a),()=>od(n._repo,n,a)}function cd(n,e,t,i){return va(n,"value",e,t,i)}function r_(n,e,t,i){return va(n,"child_added",e,t,i)}function o_(n,e,t,i){return va(n,"child_changed",e,t,i)}function a_(n,e,t,i){return va(n,"child_moved",e,t,i)}function c_(n,e,t,i){return va(n,"child_removed",e,t,i)}function l_(n,e,t){let i=null;const s=t?new rp(t):null;e==="value"?i=new ya(s):e&&(i=new Zl(e,s)),od(n._repo,n,i)}class Yt{}class pT extends Yt{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){gn("endAt",this._value,e._path,!0);const t=Yh(e._queryParams,this._value,this._key);if(Jl(t),yi(t),e._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Tt(e._repo,e._path,t,e._orderByCalled)}}function OM(n,e){return ma("endAt","key",e,!0),new pT(n,e)}class MM extends Yt{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){gn("endBefore",this._value,e._path,!1);const t=Wx(e._queryParams,this._value,this._key);if(Jl(t),yi(t),e._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Tt(e._repo,e._path,t,e._orderByCalled)}}function LM(n,e){return ma("endBefore","key",e,!0),new MM(n,e)}class gT extends Yt{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){gn("startAt",this._value,e._path,!0);const t=Qh(e._queryParams,this._value,this._key);if(Jl(t),yi(t),e._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Tt(e._repo,e._path,t,e._orderByCalled)}}function FM(n=null,e){return ma("startAt","key",e,!0),new gT(n,e)}class UM extends Yt{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){gn("startAfter",this._value,e._path,!1);const t=qx(e._queryParams,this._value,this._key);if(Jl(t),yi(t),e._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Tt(e._repo,e._path,t,e._orderByCalled)}}function VM(n,e){return ma("startAfter","key",e,!0),new UM(n,e)}class $M extends Yt{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Tt(e._repo,e._path,$x(e._queryParams,this._limit),e._orderByCalled)}}function BM(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new $M(n)}class qM extends Yt{constructor(e){super(),this._limit=e}_apply(e){if(e._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Tt(e._repo,e._path,Bx(e._queryParams,this._limit),e._orderByCalled)}}function WM(n){if(typeof n!="number"||Math.floor(n)!==n||n<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new qM(n)}class KM extends Yt{constructor(e){super(),this._path=e}_apply(e){Xl(e,"orderByChild");const t=new z(this._path);if($(t))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");const i=new Of(t),s=Ul(e._queryParams,i);return yi(s),new Tt(e._repo,e._path,s,!0)}}function jM(n){if(n==="$key")throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if(n==="$priority")throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if(n==="$value")throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Lo("orderByChild","path",n,!1),new KM(n)}class GM extends Yt{_apply(e){Xl(e,"orderByKey");const t=Ul(e._queryParams,cn);return yi(t),new Tt(e._repo,e._path,t,!0)}}function HM(){return new GM}class zM extends Yt{_apply(e){Xl(e,"orderByPriority");const t=Ul(e._queryParams,te);return yi(t),new Tt(e._repo,e._path,t,!0)}}function QM(){return new zM}class YM extends Yt{_apply(e){Xl(e,"orderByValue");const t=Ul(e._queryParams,Mf);return yi(t),new Tt(e._repo,e._path,t,!0)}}function XM(){return new YM}class JM extends Yt{constructor(e,t){super(),this._value=e,this._key=t}_apply(e){if(gn("equalTo",this._value,e._path,!1),e._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(e._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new pT(this._value,this._key)._apply(new gT(this._value,this._key)._apply(e))}}function ZM(n,e){return ma("equalTo","key",e,!0),new JM(n,e)}function Kt(n,...e){let t=v(n);for(const i of e)t=i._apply(t);return t}DO(Wt);LO(Wt);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eL="FIREBASE_DATABASE_EMULATOR_HOST",ld={};let tL=!1;function nL(n,e,t,i){n.repoInfo_=new mI(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}function mT(n,e,t,i,s){let r=i||n.options.databaseURL;r===void 0&&(n.options.projectId||pn("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),De("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=ad(r,s),a=o.repoInfo,c,l;typeof process<"u"&&process.env&&(l=process.env[eL]),l?(c=!0,r=`http://${l}?ns=${a.namespace}`,o=ad(r,s),a=o.repoInfo):c=!o.repoInfo.secure;const u=s&&c?new Ks(Ks.OWNER):new jP(n.name,n.options,e);nT("Invalid Firebase Database URL",o),$(o.path)||pn("Database URL must point to the root of a Firebase Database (not including a child path).");const h=sL(a,n,u,new KP(n.name,t));return new rL(h,n)}function iL(n,e){const t=ld[e];(!t||t[n.key]!==n)&&pn(`Database ${e}(${n.repoInfo_}) has already been deleted.`),aT(n),delete t[n.key]}function sL(n,e,t,i){let s=ld[e.name];s||(s={},ld[e.name]=s);let r=s[n.toURLString()];return r&&pn("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new lM(n,tL,t,i),s[n.toURLString()]=r,r}let rL=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(uM(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Wt(this._repo,H())),this._rootInternal}_delete(){return this._rootInternal!==null&&(iL(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&pn("Cannot call "+e+" on a deleted database.")}};function _T(){Js.IS_TRANSPORT_INITIALIZED&&nt("Transport has already been initialized. Please call this function before calling ref or setting up a listener")}function oL(){_T(),Qn.forceDisallow()}function aL(){_T(),Ot.forceDisallow(),Qn.forceAllow()}function cL(n,e,t,i={}){n=v(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&pn("Cannot call useEmulator() after instance has already been initialized.");const s=n._repoInternal;let r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&pn('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new Ks(Ks.OWNER);else if(i.mockUserToken){const o=typeof i.mockUserToken=="string"?i.mockUserToken:Xd(i.mockUserToken,n.app.options.projectId);r=new Ks(o)}nL(s,e,t,r)}function lL(n){n=v(n),n._checkNotDeleted("goOffline"),aT(n._repo)}function uL(n){n=v(n),n._checkNotDeleted("goOnline"),vM(n._repo)}function hL(n,e){sI(n,e)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dL(n){eI(Mn),Me(new X("database",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app").getImmediate(),s=e.getProvider("auth-internal"),r=e.getProvider("app-check-internal");return mT(i,s,r,t)},"PUBLIC").setMultipleInstances(!0)),ue(Sm,Cm,n),ue(Sm,Cm,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fL={".sv":"timestamp"};function pL(){return fL}function gL(n){return{".sv":{increment:n}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let mL=class{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}}};function _L(n,e,t){var i;if(n=v(n),Ft("Reference.transaction",n._path),n.key===".length"||n.key===".keys")throw"Reference.transaction failed: "+n.key+" is a read-only object.";const s=(i=t==null?void 0:t.applyLocally)!==null&&i!==void 0?i:!0,r=new Pe,o=(c,l,u)=>{let h=null;c?r.reject(c):(h=new ir(u,new Wt(n._repo,n._path),te),r.resolve(new mL(l,h)))},a=cd(n,()=>{});return wM(n._repo,n._path,e,o,a,s),r.promise}An.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};An.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};dL();const yL="@firebase/database-compat",vL="0.3.3";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wL=new On("@firebase/database-compat"),yT=function(n){const e="FIREBASE WARNING: "+n;wL.warn(e)};/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IL=function(n,e,t,i){if(!(i&&t===void 0)&&typeof t!="boolean")throw new Error($t(n,e)+"must be a boolean.")},TL=function(n,e,t){if(!(t&&e===void 0))switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error($t(n,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EL{constructor(e){this._delegate=e}cancel(e){P("OnDisconnect.cancel",0,1,arguments.length),Ae("OnDisconnect.cancel","onComplete",e,!0);const t=this._delegate.cancel();return e&&t.then(()=>e(null),i=>e(i)),t}remove(e){P("OnDisconnect.remove",0,1,arguments.length),Ae("OnDisconnect.remove","onComplete",e,!0);const t=this._delegate.remove();return e&&t.then(()=>e(null),i=>e(i)),t}set(e,t){P("OnDisconnect.set",1,2,arguments.length),Ae("OnDisconnect.set","onComplete",t,!0);const i=this._delegate.set(e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){P("OnDisconnect.setWithPriority",2,3,arguments.length),Ae("OnDisconnect.setWithPriority","onComplete",i,!0);const s=this._delegate.setWithPriority(e,t);return i&&s.then(()=>i(null),r=>i(r)),s}update(e,t){if(P("OnDisconnect.update",1,2,arguments.length),Array.isArray(e)){const s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,yT("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ae("OnDisconnect.update","onComplete",t,!0);const i=this._delegate.update(e);return t&&i.then(()=>t(null),s=>t(s)),i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bL{constructor(e,t){this.committed=e,this.snapshot=t}toJSON(){return P("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ei{constructor(e,t){this._database=e,this._delegate=t}val(){return P("DataSnapshot.val",0,0,arguments.length),this._delegate.val()}exportVal(){return P("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()}toJSON(){return P("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()}exists(){return P("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()}child(e){return P("DataSnapshot.child",0,1,arguments.length),e=String(e),Lo("DataSnapshot.child","path",e,!1),new ei(this._database,this._delegate.child(e))}hasChild(e){return P("DataSnapshot.hasChild",1,1,arguments.length),Lo("DataSnapshot.hasChild","path",e,!1),this._delegate.hasChild(e)}getPriority(){return P("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority}forEach(e){return P("DataSnapshot.forEach",1,1,arguments.length),Ae("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(t=>e(new ei(this._database,t)))}hasChildren(){return P("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()}get key(){return this._delegate.key}numChildren(){return P("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size}getRef(){return P("DataSnapshot.ref",0,0,arguments.length),new Mt(this._database,this._delegate.ref)}get ref(){return this.getRef()}}let Ze=class{constructor(e,t){this.database=e,this._delegate=t}on(e,t,i,s){var r;P("Query.on",2,4,arguments.length),Ae("Query.on","callback",t,!1);const o=Ze.getCancelAndContextArgs_("Query.on",i,s),a=(l,u)=>{t.call(o.context,new ei(this.database,l),u)};a.userCallback=t,a.context=o.context;const c=(r=o.cancel)===null||r===void 0?void 0:r.bind(o.context);switch(e){case"value":return cd(this._delegate,a,c),t;case"child_added":return r_(this._delegate,a,c),t;case"child_removed":return c_(this._delegate,a,c),t;case"child_changed":return o_(this._delegate,a,c),t;case"child_moved":return a_(this._delegate,a,c),t;default:throw new Error($t("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}}off(e,t,i){if(P("Query.off",0,3,arguments.length),TL("Query.off",e,!0),Ae("Query.off","callback",t,!0),Hg("Query.off","context",i,!0),t){const s=()=>{};s.userCallback=t,s.context=i,l_(this._delegate,e,s)}else l_(this._delegate,e)}get(){return xM(this._delegate).then(e=>new ei(this.database,e))}once(e,t,i,s){P("Query.once",1,4,arguments.length),Ae("Query.once","callback",t,!0);const r=Ze.getCancelAndContextArgs_("Query.once",i,s),o=new Pe,a=(l,u)=>{const h=new ei(this.database,l);t&&t.call(r.context,h,u),o.resolve(h)};a.userCallback=t,a.context=r.context;const c=l=>{r.cancel&&r.cancel.call(r.context,l),o.reject(l)};switch(e){case"value":cd(this._delegate,a,c,{onlyOnce:!0});break;case"child_added":r_(this._delegate,a,c,{onlyOnce:!0});break;case"child_removed":c_(this._delegate,a,c,{onlyOnce:!0});break;case"child_changed":o_(this._delegate,a,c,{onlyOnce:!0});break;case"child_moved":a_(this._delegate,a,c,{onlyOnce:!0});break;default:throw new Error($t("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return o.promise}limitToFirst(e){return P("Query.limitToFirst",1,1,arguments.length),new Ze(this.database,Kt(this._delegate,BM(e)))}limitToLast(e){return P("Query.limitToLast",1,1,arguments.length),new Ze(this.database,Kt(this._delegate,WM(e)))}orderByChild(e){return P("Query.orderByChild",1,1,arguments.length),new Ze(this.database,Kt(this._delegate,jM(e)))}orderByKey(){return P("Query.orderByKey",0,0,arguments.length),new Ze(this.database,Kt(this._delegate,HM()))}orderByPriority(){return P("Query.orderByPriority",0,0,arguments.length),new Ze(this.database,Kt(this._delegate,QM()))}orderByValue(){return P("Query.orderByValue",0,0,arguments.length),new Ze(this.database,Kt(this._delegate,XM()))}startAt(e=null,t){return P("Query.startAt",0,2,arguments.length),new Ze(this.database,Kt(this._delegate,FM(e,t)))}startAfter(e=null,t){return P("Query.startAfter",0,2,arguments.length),new Ze(this.database,Kt(this._delegate,VM(e,t)))}endAt(e=null,t){return P("Query.endAt",0,2,arguments.length),new Ze(this.database,Kt(this._delegate,OM(e,t)))}endBefore(e=null,t){return P("Query.endBefore",0,2,arguments.length),new Ze(this.database,Kt(this._delegate,LM(e,t)))}equalTo(e,t){return P("Query.equalTo",1,2,arguments.length),new Ze(this.database,Kt(this._delegate,ZM(e,t)))}toString(){return P("Query.toString",0,0,arguments.length),this._delegate.toString()}toJSON(){return P("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()}isEqual(e){if(P("Query.isEqual",1,1,arguments.length),!(e instanceof Ze)){const t="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(t)}return this._delegate.isEqual(e._delegate)}static getCancelAndContextArgs_(e,t,i){const s={cancel:void 0,context:void 0};if(t&&i)s.cancel=t,Ae(e,"cancel",s.cancel,!0),s.context=i,Hg(e,"context",s.context,!0);else if(t)if(typeof t=="object"&&t!==null)s.context=t;else if(typeof t=="function")s.cancel=t;else throw new Error($t(e,"cancelOrContext")+" must either be a cancel callback or a context object.");return s}get ref(){return new Mt(this.database,new Wt(this._delegate._repo,this._delegate._path))}},Mt=class extends Ze{constructor(e,t){super(e,new Tt(t._repo,t._path,new Fl,!1)),this.database=e,this._delegate=t}getKey(){return P("Reference.key",0,0,arguments.length),this._delegate.key}child(e){return P("Reference.child",1,1,arguments.length),typeof e=="number"&&(e=String(e)),new Mt(this.database,is(this._delegate,e))}getParent(){P("Reference.parent",0,0,arguments.length);const e=this._delegate.parent;return e?new Mt(this.database,e):null}getRoot(){return P("Reference.root",0,0,arguments.length),new Mt(this.database,this._delegate.root)}set(e,t){P("Reference.set",1,2,arguments.length),Ae("Reference.set","onComplete",t,!0);const i=op(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}update(e,t){if(P("Reference.update",1,2,arguments.length),Array.isArray(e)){const s={};for(let r=0;r<e.length;++r)s[""+r]=e[r];e=s,yT("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ft("Reference.update",this._delegate._path),Ae("Reference.update","onComplete",t,!0);const i=PM(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}setWithPriority(e,t,i){P("Reference.setWithPriority",2,3,arguments.length),Ae("Reference.setWithPriority","onComplete",i,!0);const s=DM(this._delegate,e,t);return i&&s.then(()=>i(null),r=>i(r)),s}remove(e){P("Reference.remove",0,1,arguments.length),Ae("Reference.remove","onComplete",e,!0);const t=RM(this._delegate);return e&&t.then(()=>e(null),i=>e(i)),t}transaction(e,t,i){P("Reference.transaction",1,3,arguments.length),Ae("Reference.transaction","transactionUpdate",e,!1),Ae("Reference.transaction","onComplete",t,!0),IL("Reference.transaction","applyLocally",i,!0);const s=_L(this._delegate,e,{applyLocally:i}).then(r=>new bL(r.committed,new ei(this.database,r.snapshot)));return t&&s.then(r=>t(null,r.committed,r.snapshot),r=>t(r,!1,null)),s}setPriority(e,t){P("Reference.setPriority",1,2,arguments.length),Ae("Reference.setPriority","onComplete",t,!0);const i=NM(this._delegate,e);return t&&i.then(()=>t(null),s=>t(s)),i}push(e,t){P("Reference.push",0,2,arguments.length),Ae("Reference.push","onComplete",t,!0);const i=AM(this._delegate,e),s=i.then(o=>new Mt(this.database,o));t&&s.then(()=>t(null),o=>t(o));const r=new Mt(this.database,i);return r.then=s.then.bind(s),r.catch=s.catch.bind(s,void 0),r}onDisconnect(){return Ft("Reference.onDisconnect",this._delegate._path),new EL(new kM(this._delegate._repo,this._delegate._path))}get key(){return this.getKey()}get parent(){return this.getParent()}get root(){return this.getRoot()}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fo{constructor(e,t){this._delegate=e,this.app=t,this.INTERNAL={delete:()=>this._delegate._delete(),forceWebSockets:oL,forceLongPolling:aL}}useEmulator(e,t,i={}){cL(this._delegate,e,t,i)}ref(e){if(P("database.ref",0,1,arguments.length),e instanceof Mt){const t=s_(this._delegate,e.toString());return new Mt(this,t)}else{const t=fT(this._delegate,e);return new Mt(this,t)}}refFromURL(e){P("database.refFromURL",1,1,arguments.length);const i=s_(this._delegate,e);return new Mt(this,i)}goOffline(){return P("database.goOffline",0,0,arguments.length),lL(this._delegate)}goOnline(){return P("database.goOnline",0,0,arguments.length),uL(this._delegate)}}Fo.ServerValue={TIMESTAMP:pL(),increment:n=>gL(n)};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SL({app:n,url:e,version:t,customAuthImpl:i,namespace:s,nodeAdmin:r=!1}){eI(t);const o=new lk("auth-internal",new uk("database-standalone"));return o.setComponent(new X("auth-internal",()=>i,"PRIVATE")),{instance:new Fo(mT(n,o,void 0,e,r),n),namespace:s}}var CL=Object.freeze({__proto__:null,initStandalone:SL});/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kL=Fo.ServerValue;function AL(n){n.INTERNAL.registerComponent(new X("database-compat",(e,{instanceIdentifier:t})=>{const i=e.getProvider("app-compat").getImmediate(),s=e.getProvider("database").getImmediate({identifier:t});return new Fo(s,i)},"PUBLIC").setServiceProps({Reference:Mt,Query:Ze,Database:Fo,DataSnapshot:ei,enableLogging:hL,INTERNAL:CL,ServerValue:kL}).setMultipleInstances(!0)),n.registerVersion(yL,vL)}AL(Ve);var RL=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},k,ap=ap||{},O=RL||self;function qc(){}function eu(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function wa(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function NL(n){return Object.prototype.hasOwnProperty.call(n,sh)&&n[sh]||(n[sh]=++DL)}var sh="closure_uid_"+(1e9*Math.random()>>>0),DL=0;function PL(n,e,t){return n.call.apply(n.bind,arguments)}function xL(n,e,t){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var s=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(s,i),n.apply(e,s)}}return function(){return n.apply(e,arguments)}}function it(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?it=PL:it=xL,it.apply(null,arguments)}function za(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var i=t.slice();return i.push.apply(i,arguments),n.apply(this,i)}}function Je(n,e){function t(){}t.prototype=e.prototype,n.X=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Wb=function(i,s,r){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[s].apply(i,o)}}function vi(){this.s=this.s,this.o=this.o}var OL=0;vi.prototype.s=!1;vi.prototype.na=function(){!this.s&&(this.s=!0,this.M(),OL!=0)&&NL(this)};vi.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const vT=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function cp(n){const e=n.length;if(0<e){const t=Array(e);for(let i=0;i<e;i++)t[i]=n[i];return t}return[]}function u_(n,e){for(let t=1;t<arguments.length;t++){const i=arguments[t];if(eu(i)){const s=n.length||0,r=i.length||0;n.length=s+r;for(let o=0;o<r;o++)n[s+o]=i[o]}else n.push(i)}}function st(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}st.prototype.h=function(){this.defaultPrevented=!0};var ML=function(){if(!O.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{O.addEventListener("test",qc,e),O.removeEventListener("test",qc,e)}catch{}return n}();function Wc(n){return/^[\s\xa0]*$/.test(n)}var h_=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function rh(n,e){return n<e?-1:n>e?1:0}function tu(){var n=O.navigator;return n&&(n=n.userAgent)?n:""}function tn(n){return tu().indexOf(n)!=-1}function lp(n){return lp[" "](n),n}lp[" "]=qc;function LL(n){var e=VL;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}var FL=tn("Opera"),sr=tn("Trident")||tn("MSIE"),wT=tn("Edge"),ud=wT||sr,IT=tn("Gecko")&&!(tu().toLowerCase().indexOf("webkit")!=-1&&!tn("Edge"))&&!(tn("Trident")||tn("MSIE"))&&!tn("Edge"),UL=tu().toLowerCase().indexOf("webkit")!=-1&&!tn("Edge");function TT(){var n=O.document;return n?n.documentMode:void 0}var Kc;e:{var oh="",ah=function(){var n=tu();if(IT)return/rv:([^\);]+)(\)|;)/.exec(n);if(wT)return/Edge\/([\d\.]+)/.exec(n);if(sr)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(UL)return/WebKit\/(\S+)/.exec(n);if(FL)return/(?:Version)[ \/]?(\S+)/.exec(n)}();if(ah&&(oh=ah?ah[1]:""),sr){var ch=TT();if(ch!=null&&ch>parseFloat(oh)){Kc=String(ch);break e}}Kc=oh}var VL={};function $L(){return LL(function(){let n=0;const e=h_(String(Kc)).split("."),t=h_("9").split("."),i=Math.max(e.length,t.length);for(let o=0;n==0&&o<i;o++){var s=e[o]||"",r=t[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],s[0].length==0&&r[0].length==0)break;n=rh(s[1].length==0?0:parseInt(s[1],10),r[1].length==0?0:parseInt(r[1],10))||rh(s[2].length==0,r[2].length==0)||rh(s[2],r[2]),s=s[3],r=r[3]}while(n==0)}return 0<=n})}var hd;if(O.document&&sr){var d_=TT();hd=d_||parseInt(Kc,10)||void 0}else hd=void 0;var BL=hd;function Uo(n,e){if(st.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,i=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(IT){e:{try{lp(e.nodeName);var s=!0;break e}catch{}s=!1}s||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,i?(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:qL[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Uo.X.h.call(this)}}Je(Uo,st);var qL={2:"touch",3:"pen",4:"mouse"};Uo.prototype.h=function(){Uo.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Ia="closure_listenable_"+(1e6*Math.random()|0),WL=0;function KL(n,e,t,i,s){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!i,this.ha=s,this.key=++WL,this.ba=this.ea=!1}function nu(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function up(n,e,t){for(const i in n)e.call(t,n[i],i,n)}function ET(n){const e={};for(const t in n)e[t]=n[t];return e}const f_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function bT(n,e){let t,i;for(let s=1;s<arguments.length;s++){i=arguments[s];for(t in i)n[t]=i[t];for(let r=0;r<f_.length;r++)t=f_[r],Object.prototype.hasOwnProperty.call(i,t)&&(n[t]=i[t])}}function iu(n){this.src=n,this.g={},this.h=0}iu.prototype.add=function(n,e,t,i,s){var r=n.toString();n=this.g[r],n||(n=this.g[r]=[],this.h++);var o=fd(n,e,i,s);return-1<o?(e=n[o],t||(e.ea=!1)):(e=new KL(e,this.src,r,!!i,s),e.ea=t,n.push(e)),e};function dd(n,e){var t=e.type;if(t in n.g){var i=n.g[t],s=vT(i,e),r;(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(nu(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function fd(n,e,t,i){for(var s=0;s<n.length;++s){var r=n[s];if(!r.ba&&r.listener==e&&r.capture==!!t&&r.ha==i)return s}return-1}var hp="closure_lm_"+(1e6*Math.random()|0),lh={};function ST(n,e,t,i,s){if(i&&i.once)return kT(n,e,t,i,s);if(Array.isArray(e)){for(var r=0;r<e.length;r++)ST(n,e[r],t,i,s);return null}return t=pp(t),n&&n[Ia]?n.N(e,t,wa(i)?!!i.capture:!!i,s):CT(n,e,t,!1,i,s)}function CT(n,e,t,i,s,r){if(!e)throw Error("Invalid event type");var o=wa(s)?!!s.capture:!!s,a=fp(n);if(a||(n[hp]=a=new iu(n)),t=a.add(e,t,i,o,r),t.proxy)return t;if(i=jL(),t.proxy=i,i.src=n,i.listener=t,n.addEventListener)ML||(s=o),s===void 0&&(s=!1),n.addEventListener(e.toString(),i,s);else if(n.attachEvent)n.attachEvent(RT(e.toString()),i);else if(n.addListener&&n.removeListener)n.addListener(i);else throw Error("addEventListener and attachEvent are unavailable.");return t}function jL(){function n(t){return e.call(n.src,n.listener,t)}const e=GL;return n}function kT(n,e,t,i,s){if(Array.isArray(e)){for(var r=0;r<e.length;r++)kT(n,e[r],t,i,s);return null}return t=pp(t),n&&n[Ia]?n.O(e,t,wa(i)?!!i.capture:!!i,s):CT(n,e,t,!0,i,s)}function AT(n,e,t,i,s){if(Array.isArray(e))for(var r=0;r<e.length;r++)AT(n,e[r],t,i,s);else i=wa(i)?!!i.capture:!!i,t=pp(t),n&&n[Ia]?(n=n.i,e=String(e).toString(),e in n.g&&(r=n.g[e],t=fd(r,t,i,s),-1<t&&(nu(r[t]),Array.prototype.splice.call(r,t,1),r.length==0&&(delete n.g[e],n.h--)))):n&&(n=fp(n))&&(e=n.g[e.toString()],n=-1,e&&(n=fd(e,t,i,s)),(t=-1<n?e[n]:null)&&dp(t))}function dp(n){if(typeof n!="number"&&n&&!n.ba){var e=n.src;if(e&&e[Ia])dd(e.i,n);else{var t=n.type,i=n.proxy;e.removeEventListener?e.removeEventListener(t,i,n.capture):e.detachEvent?e.detachEvent(RT(t),i):e.addListener&&e.removeListener&&e.removeListener(i),(t=fp(e))?(dd(t,n),t.h==0&&(t.src=null,e[hp]=null)):nu(n)}}}function RT(n){return n in lh?lh[n]:lh[n]="on"+n}function GL(n,e){if(n.ba)n=!0;else{e=new Uo(e,this);var t=n.listener,i=n.ha||n.src;n.ea&&dp(n),n=t.call(i,e)}return n}function fp(n){return n=n[hp],n instanceof iu?n:null}var uh="__closure_events_fn_"+(1e9*Math.random()>>>0);function pp(n){return typeof n=="function"?n:(n[uh]||(n[uh]=function(e){return n.handleEvent(e)}),n[uh])}function Ue(){vi.call(this),this.i=new iu(this),this.P=this,this.I=null}Je(Ue,vi);Ue.prototype[Ia]=!0;Ue.prototype.removeEventListener=function(n,e,t,i){AT(this,n,e,t,i)};function ze(n,e){var t,i=n.I;if(i)for(t=[];i;i=i.I)t.push(i);if(n=n.P,i=e.type||e,typeof e=="string")e=new st(e,n);else if(e instanceof st)e.target=e.target||n;else{var s=e;e=new st(i,n),bT(e,s)}if(s=!0,t)for(var r=t.length-1;0<=r;r--){var o=e.g=t[r];s=Qa(o,i,!0,e)&&s}if(o=e.g=n,s=Qa(o,i,!0,e)&&s,s=Qa(o,i,!1,e)&&s,t)for(r=0;r<t.length;r++)o=e.g=t[r],s=Qa(o,i,!1,e)&&s}Ue.prototype.M=function(){if(Ue.X.M.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],i=0;i<t.length;i++)nu(t[i]);delete n.g[e],n.h--}}this.I=null};Ue.prototype.N=function(n,e,t,i){return this.i.add(String(n),e,!1,t,i)};Ue.prototype.O=function(n,e,t,i){return this.i.add(String(n),e,!0,t,i)};function Qa(n,e,t,i){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var s=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.ba&&o.capture==t){var a=o.listener,c=o.ha||o.src;o.ea&&dd(n.i,o),s=a.call(c,i)!==!1&&s}}return s&&!i.defaultPrevented}var gp=O.JSON.stringify;function HL(){var n=PT;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}class zL{constructor(){this.h=this.g=null}add(e,t){const i=NT.get();i.set(e,t),this.h?this.h.next=i:this.g=i,this.h=i}}var NT=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new QL,n=>n.reset());class QL{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function YL(n){O.setTimeout(()=>{throw n},0)}function DT(n,e){pd||XL(),gd||(pd(),gd=!0),PT.add(n,e)}var pd;function XL(){var n=O.Promise.resolve(void 0);pd=function(){n.then(JL)}}var gd=!1,PT=new zL;function JL(){for(var n;n=HL();){try{n.h.call(n.g)}catch(t){YL(t)}var e=NT;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}gd=!1}function su(n,e){Ue.call(this),this.h=n||1,this.g=e||O,this.j=it(this.lb,this),this.l=Date.now()}Je(su,Ue);k=su.prototype;k.ca=!1;k.R=null;k.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),ze(this,"tick"),this.ca&&(mp(this),this.start()))}};k.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function mp(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}k.M=function(){su.X.M.call(this),mp(this),delete this.g};function _p(n,e,t){if(typeof n=="function")t&&(n=it(n,t));else if(n&&typeof n.handleEvent=="function")n=it(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:O.setTimeout(n,e||0)}function xT(n){n.g=_p(()=>{n.g=null,n.i&&(n.i=!1,xT(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}class ZL extends vi{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:xT(this)}M(){super.M(),this.g&&(O.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Vo(n){vi.call(this),this.h=n,this.g={}}Je(Vo,vi);var p_=[];function OT(n,e,t,i){Array.isArray(t)||(t&&(p_[0]=t.toString()),t=p_);for(var s=0;s<t.length;s++){var r=ST(e,t[s],i||n.handleEvent,!1,n.h||n);if(!r)break;n.g[r.key]=r}}function MT(n){up(n.g,function(e,t){this.g.hasOwnProperty(t)&&dp(e)},n),n.g={}}Vo.prototype.M=function(){Vo.X.M.call(this),MT(this)};Vo.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function ru(){this.g=!0}ru.prototype.Aa=function(){this.g=!1};function e1(n,e,t,i,s,r){n.info(function(){if(n.g)if(r)for(var o="",a=r.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var h=u.split("_");o=2<=h.length&&h[1]=="type"?o+(u+"="+l+"&"):o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+e+`
`+t+`
`+o})}function t1(n,e,t,i,s,r,o){n.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+e+`
`+t+`
`+r+" "+o})}function Us(n,e,t,i){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+i1(n,t)+(i?" "+i:"")})}function n1(n,e){n.info(function(){return"TIMEOUT: "+e})}ru.prototype.info=function(){};function i1(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var i=t[n];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if(r!="noop"&&r!="stop"&&r!="close")for(var o=1;o<s.length;o++)s[o]=""}}}}return gp(t)}catch{return e}}var Ts={},g_=null;function ou(){return g_=g_||new Ue}Ts.Pa="serverreachability";function LT(n){st.call(this,Ts.Pa,n)}Je(LT,st);function $o(n){const e=ou();ze(e,new LT(e))}Ts.STAT_EVENT="statevent";function FT(n,e){st.call(this,Ts.STAT_EVENT,n),this.stat=e}Je(FT,st);function ht(n){const e=ou();ze(e,new FT(e,n))}Ts.Qa="timingevent";function UT(n,e){st.call(this,Ts.Qa,n),this.size=e}Je(UT,st);function Ta(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return O.setTimeout(function(){n()},e)}var au={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},VT={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function yp(){}yp.prototype.h=null;function m_(n){return n.h||(n.h=n.i())}function $T(){}var Ea={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function vp(){st.call(this,"d")}Je(vp,st);function wp(){st.call(this,"c")}Je(wp,st);var md;function cu(){}Je(cu,yp);cu.prototype.g=function(){return new XMLHttpRequest};cu.prototype.i=function(){return{}};md=new cu;function ba(n,e,t,i){this.l=n,this.j=e,this.m=t,this.U=i||1,this.S=new Vo(this),this.O=s1,n=ud?125:void 0,this.T=new su(n),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new BT}function BT(){this.i=null,this.g="",this.h=!1}var s1=45e3,_d={},jc={};k=ba.prototype;k.setTimeout=function(n){this.O=n};function yd(n,e,t){n.K=1,n.v=uu(Pn(e)),n.s=t,n.P=!0,qT(n,null)}function qT(n,e){n.F=Date.now(),Sa(n),n.A=Pn(n.v);var t=n.A,i=n.U;Array.isArray(i)||(i=[String(i)]),YT(t.i,"t",i),n.C=0,t=n.l.H,n.h=new BT,n.g=_E(n.l,t?e:null,!n.s),0<n.N&&(n.L=new ZL(it(n.La,n,n.g),n.N)),OT(n.S,n.g,"readystatechange",n.ib),e=n.H?ET(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,e)):(n.u="GET",n.g.da(n.A,n.u,null,e)),$o(),e1(n.j,n.u,n.A,n.m,n.U,n.s)}k.ib=function(n){n=n.target;const e=this.L;e&&Sn(n)==3?e.l():this.La(n)};k.La=function(n){try{if(n==this.g)e:{const u=Sn(this.g);var e=this.g.Ea();const h=this.g.aa();if(!(3>u)&&(u!=3||ud||this.g&&(this.h.h||this.g.fa()||w_(this.g)))){this.I||u!=4||e==7||(e==8||0>=h?$o(3):$o(2)),lu(this);var t=this.g.aa();this.Y=t;t:if(WT(this)){var i=w_(this.g);n="";var s=i.length,r=Sn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Vi(this),ho(this);var o="";break t}this.h.i=new O.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,n+=this.h.i.decode(i[e],{stream:r&&e==s-1});i.splice(0,s),this.h.g+=n,this.C=0,o=this.h.g}else o=this.g.fa();if(this.i=t==200,t1(this.j,this.u,this.A,this.m,this.U,u,t),this.i){if(this.Z&&!this.J){t:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Wc(a)){var l=a;break t}}l=null}if(t=l)Us(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,vd(this,t);else{this.i=!1,this.o=3,ht(12),Vi(this),ho(this);break e}}this.P?(KT(this,u,o),ud&&this.i&&u==3&&(OT(this.S,this.T,"tick",this.hb),this.T.start())):(Us(this.j,this.m,o,null),vd(this,o)),u==4&&Vi(this),this.i&&!this.I&&(u==4?fE(this.l,this):(this.i=!1,Sa(this)))}else t==400&&0<o.indexOf("Unknown SID")?(this.o=3,ht(12)):(this.o=0,ht(13)),Vi(this),ho(this)}}}catch{}finally{}};function WT(n){return n.g?n.u=="GET"&&n.K!=2&&n.l.Da:!1}function KT(n,e,t){let i=!0,s;for(;!n.I&&n.C<t.length;)if(s=r1(n,t),s==jc){e==4&&(n.o=4,ht(14),i=!1),Us(n.j,n.m,null,"[Incomplete Response]");break}else if(s==_d){n.o=4,ht(15),Us(n.j,n.m,t,"[Invalid Chunk]"),i=!1;break}else Us(n.j,n.m,s,null),vd(n,s);WT(n)&&s!=jc&&s!=_d&&(n.h.g="",n.C=0),e!=4||t.length!=0||n.h.h||(n.o=1,ht(16),i=!1),n.i=n.i&&i,i?0<t.length&&!n.$&&(n.$=!0,e=n.l,e.g==n&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),kp(e),e.K=!0,ht(11))):(Us(n.j,n.m,t,"[Invalid Chunked Response]"),Vi(n),ho(n))}k.hb=function(){if(this.g){var n=Sn(this.g),e=this.g.fa();this.C<e.length&&(lu(this),KT(this,n,e),this.i&&n!=4&&Sa(this))}};function r1(n,e){var t=n.C,i=e.indexOf(`
`,t);return i==-1?jc:(t=Number(e.substring(t,i)),isNaN(t)?_d:(i+=1,i+t>e.length?jc:(e=e.substr(i,t),n.C=i+t,e)))}k.cancel=function(){this.I=!0,Vi(this)};function Sa(n){n.V=Date.now()+n.O,jT(n,n.O)}function jT(n,e){if(n.B!=null)throw Error("WatchDog timer not null");n.B=Ta(it(n.gb,n),e)}function lu(n){n.B&&(O.clearTimeout(n.B),n.B=null)}k.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(n1(this.j,this.A),this.K!=2&&($o(),ht(17)),Vi(this),this.o=2,ho(this)):jT(this,this.V-n)};function ho(n){n.l.G==0||n.I||fE(n.l,n)}function Vi(n){lu(n);var e=n.L;e&&typeof e.na=="function"&&e.na(),n.L=null,mp(n.T),MT(n.S),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function vd(n,e){try{var t=n.l;if(t.G!=0&&(t.g==n||wd(t.h,n))){if(!n.J&&wd(t.h,n)&&t.G==3){try{var i=t.Fa.g.parse(e)}catch{i=null}if(Array.isArray(i)&&i.length==3){var s=i;if(s[0]==0){e:if(!t.u){if(t.g)if(t.g.F+3e3<n.F)zc(t),fu(t);else break e;Cp(t),ht(18)}}else t.Ba=s[1],0<t.Ba-t.T&&37500>s[2]&&t.L&&t.A==0&&!t.v&&(t.v=Ta(it(t.cb,t),6e3));if(1>=ZT(t.h)&&t.ja){try{t.ja()}catch{}t.ja=void 0}}else $i(t,11)}else if((n.J||t.g==n)&&zc(t),!Wc(e))for(s=t.Fa.g.parse(e),e=0;e<s.length;e++){let l=s[e];if(t.T=l[0],l=l[1],t.G==2)if(l[0]=="c"){t.I=l[1],t.ka=l[2];const u=l[3];u!=null&&(t.ma=u,t.j.info("VER="+t.ma));const h=l[4];h!=null&&(t.Ca=h,t.j.info("SVER="+t.Ca));const d=l[5];d!=null&&typeof d=="number"&&0<d&&(i=1.5*d,t.J=i,t.j.info("backChannelRequestTimeoutMs_="+i)),i=t;const f=n.g;if(f){const p=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(p){var r=i.h;r.g||p.indexOf("spdy")==-1&&p.indexOf("quic")==-1&&p.indexOf("h2")==-1||(r.j=r.l,r.g=new Set,r.h&&(Ip(r,r.h),r.h=null))}if(i.D){const _=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;_&&(i.za=_,re(i.F,i.D,_))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-n.F,t.j.info("Handshake RTT: "+t.P+"ms")),i=t;var o=n;if(i.sa=mE(i,i.H?i.ka:null,i.V),o.J){eE(i.h,o);var a=o,c=i.J;c&&a.setTimeout(c),a.B&&(lu(a),Sa(a)),i.g=o}else hE(i);0<t.i.length&&pu(t)}else l[0]!="stop"&&l[0]!="close"||$i(t,7);else t.G==3&&(l[0]=="stop"||l[0]=="close"?l[0]=="stop"?$i(t,7):Sp(t):l[0]!="noop"&&t.l&&t.l.wa(l),t.A=0)}}$o(4)}catch{}}function o1(n){if(n.W&&typeof n.W=="function")return n.W();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(eu(n)){for(var e=[],t=n.length,i=0;i<t;i++)e.push(n[i]);return e}e=[],t=0;for(i in n)e[t++]=n[i];return e}function a1(n){if(n.oa&&typeof n.oa=="function")return n.oa();if(!n.W||typeof n.W!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(eu(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const i in n)e[t++]=i;return e}}}function GT(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(eu(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=a1(n),i=o1(n),s=i.length,r=0;r<s;r++)e.call(void 0,i[r],t&&t[r],n)}var HT=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function c1(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var i=n[t].indexOf("="),s=null;if(0<=i){var r=n[t].substring(0,i);s=n[t].substring(i+1)}else r=n[t];e(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}function Hi(n,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Hi){this.h=e!==void 0?e:n.h,Gc(this,n.j),this.s=n.s,this.g=n.g,Hc(this,n.m),this.l=n.l,e=n.i;var t=new Bo;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),__(this,t),this.o=n.o}else n&&(t=String(n).match(HT))?(this.h=!!e,Gc(this,t[1]||"",!0),this.s=eo(t[2]||""),this.g=eo(t[3]||"",!0),Hc(this,t[4]),this.l=eo(t[5]||"",!0),__(this,t[6]||"",!0),this.o=eo(t[7]||"")):(this.h=!!e,this.i=new Bo(null,this.h))}Hi.prototype.toString=function(){var n=[],e=this.j;e&&n.push(to(e,y_,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(to(e,y_,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(to(t,t.charAt(0)=="/"?h1:u1,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",to(t,f1)),n.join("")};function Pn(n){return new Hi(n)}function Gc(n,e,t){n.j=t?eo(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Hc(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function __(n,e,t){e instanceof Bo?(n.i=e,p1(n.i,n.h)):(t||(e=to(e,d1)),n.i=new Bo(e,n.h))}function re(n,e,t){n.i.set(e,t)}function uu(n){return re(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function eo(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function to(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,l1),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function l1(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var y_=/[#\/\?@]/g,u1=/[#\?:]/g,h1=/[#\?]/g,d1=/[#\?@]/g,f1=/#/g;function Bo(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function wi(n){n.g||(n.g=new Map,n.h=0,n.i&&c1(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}k=Bo.prototype;k.add=function(n,e){wi(this),this.i=null,n=Cr(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function zT(n,e){wi(n),e=Cr(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function QT(n,e){return wi(n),e=Cr(n,e),n.g.has(e)}k.forEach=function(n,e){wi(this),this.g.forEach(function(t,i){t.forEach(function(s){n.call(e,s,i,this)},this)},this)};k.oa=function(){wi(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let i=0;i<e.length;i++){const s=n[i];for(let r=0;r<s.length;r++)t.push(e[i])}return t};k.W=function(n){wi(this);let e=[];if(typeof n=="string")QT(this,n)&&(e=e.concat(this.g.get(Cr(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};k.set=function(n,e){return wi(this),this.i=null,n=Cr(this,n),QT(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};k.get=function(n,e){return n?(n=this.W(n),0<n.length?String(n[0]):e):e};function YT(n,e,t){zT(n,e),0<t.length&&(n.i=null,n.g.set(Cr(n,e),cp(t)),n.h+=t.length)}k.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var i=e[t];const r=encodeURIComponent(String(i)),o=this.W(i);for(i=0;i<o.length;i++){var s=r;o[i]!==""&&(s+="="+encodeURIComponent(String(o[i]))),n.push(s)}}return this.i=n.join("&")};function Cr(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function p1(n,e){e&&!n.j&&(wi(n),n.i=null,n.g.forEach(function(t,i){var s=i.toLowerCase();i!=s&&(zT(this,i),YT(this,s,t))},n)),n.j=e}var g1=class{constructor(e,t){this.h=e,this.g=t}};function XT(n){this.l=n||m1,O.PerformanceNavigationTiming?(n=O.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(O.g&&O.g.Ga&&O.g.Ga()&&O.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var m1=10;function JT(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function ZT(n){return n.h?1:n.g?n.g.size:0}function wd(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function Ip(n,e){n.g?n.g.add(e):n.h=e}function eE(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}XT.prototype.cancel=function(){if(this.i=tE(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const n of this.g.values())n.cancel();this.g.clear()}};function tE(n){if(n.h!=null)return n.i.concat(n.h.D);if(n.g!=null&&n.g.size!==0){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return cp(n.i)}function Tp(){}Tp.prototype.stringify=function(n){return O.JSON.stringify(n,void 0)};Tp.prototype.parse=function(n){return O.JSON.parse(n,void 0)};function _1(){this.g=new Tp}function y1(n,e,t){const i=t||"";try{GT(n,function(s,r){let o=s;wa(s)&&(o=gp(s)),e.push(i+r+"="+encodeURIComponent(o))})}catch(s){throw e.push(i+"type="+encodeURIComponent("_badmap")),s}}function v1(n,e){const t=new ru;if(O.Image){const i=new Image;i.onload=za(Ya,t,i,"TestLoadImage: loaded",!0,e),i.onerror=za(Ya,t,i,"TestLoadImage: error",!1,e),i.onabort=za(Ya,t,i,"TestLoadImage: abort",!1,e),i.ontimeout=za(Ya,t,i,"TestLoadImage: timeout",!1,e),O.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else e(!1)}function Ya(n,e,t,i,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(i)}catch{}}function Ca(n){this.l=n.ac||null,this.j=n.jb||!1}Je(Ca,yp);Ca.prototype.g=function(){return new hu(this.l,this.j)};Ca.prototype.i=function(n){return function(){return n}}({});function hu(n,e){Ue.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Ep,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Je(hu,Ue);var Ep=0;k=hu.prototype;k.open=function(n,e){if(this.readyState!=Ep)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,qo(this)};k.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||O).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))};k.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ka(this)),this.readyState=Ep};k.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,qo(this)),this.g&&(this.readyState=3,qo(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(typeof O.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;nE(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))};function nE(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}k.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?ka(this):qo(this),this.readyState==3&&nE(this)}};k.Va=function(n){this.g&&(this.response=this.responseText=n,ka(this))};k.Ua=function(n){this.g&&(this.response=n,ka(this))};k.ga=function(){this.g&&ka(this)};function ka(n){n.readyState=4,n.l=null,n.j=null,n.A=null,qo(n)}k.setRequestHeader=function(n,e){this.v.append(n,e)};k.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};k.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function qo(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(hu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var w1=O.JSON.parse;function fe(n){Ue.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=iE,this.K=this.L=!1}Je(fe,Ue);var iE="",I1=/^https?$/i,T1=["POST","PUT"];k=fe.prototype;k.Ka=function(n){this.L=n};k.da=function(n,e,t,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():md.g(),this.C=this.u?m_(this.u):m_(md),this.g.onreadystatechange=it(this.Ha,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(r){v_(this,r);return}if(n=t||"",t=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)t.set(s,i[s]);else if(typeof i.keys=="function"&&typeof i.get=="function")for(const r of i.keys())t.set(r,i.get(r));else throw Error("Unknown input type for opt_headers: "+String(i));i=Array.from(t.keys()).find(r=>r.toLowerCase()=="content-type"),s=O.FormData&&n instanceof O.FormData,!(0<=vT(T1,e))||i||s||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[r,o]of t)this.g.setRequestHeader(r,o);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{oE(this),0<this.B&&((this.K=E1(this.g))?(this.g.timeout=this.B,this.g.ontimeout=it(this.qa,this)):this.A=_p(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(r){v_(this,r)}};function E1(n){return sr&&$L()&&typeof n.timeout=="number"&&n.ontimeout!==void 0}k.qa=function(){typeof ap<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ze(this,"timeout"),this.abort(8))};function v_(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,sE(n),du(n)}function sE(n){n.D||(n.D=!0,ze(n,"complete"),ze(n,"error"))}k.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ze(this,"complete"),ze(this,"abort"),du(this))};k.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),du(this,!0)),fe.X.M.call(this)};k.Ha=function(){this.s||(this.F||this.v||this.l?rE(this):this.fb())};k.fb=function(){rE(this)};function rE(n){if(n.h&&typeof ap<"u"&&(!n.C[1]||Sn(n)!=4||n.aa()!=2)){if(n.v&&Sn(n)==4)_p(n.Ha,0,n);else if(ze(n,"readystatechange"),Sn(n)==4){n.h=!1;try{const a=n.aa();e:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var i;if(i=a===0){var s=String(n.H).match(HT)[1]||null;if(!s&&O.self&&O.self.location){var r=O.self.location.protocol;s=r.substr(0,r.length-1)}i=!I1.test(s?s.toLowerCase():"")}t=i}if(t)ze(n,"complete"),ze(n,"success");else{n.m=6;try{var o=2<Sn(n)?n.g.statusText:""}catch{o=""}n.j=o+" ["+n.aa()+"]",sE(n)}}finally{du(n)}}}}function du(n,e){if(n.g){oE(n);const t=n.g,i=n.C[0]?qc:null;n.g=null,n.C=null,e||ze(n,"ready");try{t.onreadystatechange=i}catch{}}}function oE(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(O.clearTimeout(n.A),n.A=null)}function Sn(n){return n.g?n.g.readyState:0}k.aa=function(){try{return 2<Sn(this)?this.g.status:-1}catch{return-1}};k.fa=function(){try{return this.g?this.g.responseText:""}catch{return""}};k.Sa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),w1(e)}};function w_(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case iE:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}k.Ea=function(){return this.m};k.Oa=function(){return typeof this.j=="string"?this.j:String(this.j)};function aE(n){let e="";return up(n,function(t,i){e+=i,e+=":",e+=t,e+=`\r
`}),e}function bp(n,e,t){e:{for(i in t){var i=!1;break e}i=!0}i||(t=aE(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):re(n,e,t))}function Kr(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function cE(n){this.Ca=0,this.i=[],this.j=new ru,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Kr("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Kr("baseRetryDelayMs",5e3,n),this.bb=Kr("retryDelaySeedMs",1e4,n),this.$a=Kr("forwardChannelMaxRetries",2,n),this.ta=Kr("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new XT(n&&n.concurrentRequestLimit),this.Fa=new _1,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}k=cE.prototype;k.ma=8;k.G=1;function Sp(n){if(lE(n),n.G==3){var e=n.U++,t=Pn(n.F);re(t,"SID",n.I),re(t,"RID",e),re(t,"TYPE","terminate"),Aa(n,t),e=new ba(n,n.j,e,void 0),e.K=2,e.v=uu(Pn(t)),t=!1,O.navigator&&O.navigator.sendBeacon&&(t=O.navigator.sendBeacon(e.v.toString(),"")),!t&&O.Image&&(new Image().src=e.v,t=!0),t||(e.g=_E(e.l,null),e.g.da(e.v)),e.F=Date.now(),Sa(e)}gE(n)}function fu(n){n.g&&(kp(n),n.g.cancel(),n.g=null)}function lE(n){fu(n),n.u&&(O.clearTimeout(n.u),n.u=null),zc(n),n.h.cancel(),n.m&&(typeof n.m=="number"&&O.clearTimeout(n.m),n.m=null)}function pu(n){JT(n.h)||n.m||(n.m=!0,DT(n.Ja,n),n.C=0)}function b1(n,e){return ZT(n.h)>=n.h.j-(n.m?1:0)?!1:n.m?(n.i=e.D.concat(n.i),!0):n.G==1||n.G==2||n.C>=(n.Za?0:n.$a)?!1:(n.m=Ta(it(n.Ja,n,e),pE(n,n.C)),n.C++,!0)}k.Ja=function(n){if(this.m)if(this.m=null,this.G==1){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const s=new ba(this,this.j,n,void 0);let r=this.s;if(this.S&&(r?(r=ET(r),bT(r,this.S)):r=this.S),this.o!==null||this.N||(s.H=r,r=null),this.O)e:{for(var e=0,t=0;t<this.i.length;t++){t:{var i=this.i[t];if("__data__"in i.g&&(i=i.g.__data__,typeof i=="string")){i=i.length;break t}i=void 0}if(i===void 0)break;if(e+=i,4096<e){e=t;break e}if(e===4096||t===this.i.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=uE(this,s,e),t=Pn(this.F),re(t,"RID",n),re(t,"CVER",22),this.D&&re(t,"X-HTTP-Session-Id",this.D),Aa(this,t),r&&(this.N?e="headers="+encodeURIComponent(String(aE(r)))+"&"+e:this.o&&bp(t,this.o,r)),Ip(this.h,s),this.Ya&&re(t,"TYPE","init"),this.O?(re(t,"$req",e),re(t,"SID","null"),s.Z=!0,yd(s,t,null)):yd(s,t,e),this.G=2}}else this.G==3&&(n?I_(this,n):this.i.length==0||JT(this.h)||I_(this))};function I_(n,e){var t;e?t=e.m:t=n.U++;const i=Pn(n.F);re(i,"SID",n.I),re(i,"RID",t),re(i,"AID",n.T),Aa(n,i),n.o&&n.s&&bp(i,n.o,n.s),t=new ba(n,n.j,t,n.C+1),n.o===null&&(t.H=n.s),e&&(n.i=e.D.concat(n.i)),e=uE(n,t,1e3),t.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),Ip(n.h,t),yd(t,i,e)}function Aa(n,e){n.ia&&up(n.ia,function(t,i){re(e,i,t)}),n.l&&GT({},function(t,i){re(e,i,t)})}function uE(n,e,t){t=Math.min(n.i.length,t);var i=n.l?it(n.l.Ra,n.l,n):null;e:{var s=n.i;let r=-1;for(;;){const o=["count="+t];r==-1?0<t?(r=s[0].h,o.push("ofs="+r)):r=0:o.push("ofs="+r);let a=!0;for(let c=0;c<t;c++){let l=s[c].h;const u=s[c].g;if(l-=r,0>l)r=Math.max(0,s[c].h-100),a=!1;else try{y1(u,o,"req"+l+"_")}catch{i&&i(u)}}if(a){i=o.join("&");break e}}}return n=n.i.splice(0,t),e.D=n,i}function hE(n){n.g||n.u||(n.Z=1,DT(n.Ia,n),n.A=0)}function Cp(n){return n.g||n.u||3<=n.A?!1:(n.Z++,n.u=Ta(it(n.Ia,n),pE(n,n.A)),n.A++,!0)}k.Ia=function(){if(this.u=null,dE(this),this.$&&!(this.K||this.g==null||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=Ta(it(this.eb,this),n)}};k.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,ht(10),fu(this),dE(this))};function kp(n){n.B!=null&&(O.clearTimeout(n.B),n.B=null)}function dE(n){n.g=new ba(n,n.j,"rpc",n.Z),n.o===null&&(n.g.H=n.s),n.g.N=0;var e=Pn(n.sa);re(e,"RID","rpc"),re(e,"SID",n.I),re(e,"CI",n.L?"0":"1"),re(e,"AID",n.T),re(e,"TYPE","xmlhttp"),Aa(n,e),n.o&&n.s&&bp(e,n.o,n.s),n.J&&n.g.setTimeout(n.J);var t=n.g;n=n.ka,t.K=1,t.v=uu(Pn(e)),t.s=null,t.P=!0,qT(t,n)}k.cb=function(){this.v!=null&&(this.v=null,fu(this),Cp(this),ht(19))};function zc(n){n.v!=null&&(O.clearTimeout(n.v),n.v=null)}function fE(n,e){var t=null;if(n.g==e){zc(n),kp(n),n.g=null;var i=2}else if(wd(n.h,e))t=e.D,eE(n.h,e),i=1;else return;if(n.G!=0){if(n.pa=e.Y,e.i)if(i==1){t=e.s?e.s.length:0,e=Date.now()-e.F;var s=n.C;i=ou(),ze(i,new UT(i,t)),pu(n)}else hE(n);else if(s=e.o,s==3||s==0&&0<n.pa||!(i==1&&b1(n,e)||i==2&&Cp(n)))switch(t&&0<t.length&&(e=n.h,e.i=e.i.concat(t)),s){case 1:$i(n,5);break;case 4:$i(n,10);break;case 3:$i(n,6);break;default:$i(n,2)}}}function pE(n,e){let t=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(t*=2),t*e}function $i(n,e){if(n.j.info("Error code "+e),e==2){var t=null;n.l&&(t=null);var i=it(n.kb,n);t||(t=new Hi("//www.google.com/images/cleardot.gif"),O.location&&O.location.protocol=="http"||Gc(t,"https"),uu(t)),v1(t.toString(),i)}else ht(2);n.G=0,n.l&&n.l.va(e),gE(n),lE(n)}k.kb=function(n){n?(this.j.info("Successfully pinged google.com"),ht(2)):(this.j.info("Failed to ping google.com"),ht(1))};function gE(n){if(n.G=0,n.la=[],n.l){const e=tE(n.h);(e.length!=0||n.i.length!=0)&&(u_(n.la,e),u_(n.la,n.i),n.h.i.length=0,cp(n.i),n.i.length=0),n.l.ua()}}function mE(n,e,t){var i=t instanceof Hi?Pn(t):new Hi(t,void 0);if(i.g!="")e&&(i.g=e+"."+i.g),Hc(i,i.m);else{var s=O.location;i=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var r=new Hi(null,void 0);i&&Gc(r,i),e&&(r.g=e),s&&Hc(r,s),t&&(r.l=t),i=r}return t=n.D,e=n.za,t&&e&&re(i,t,e),re(i,"VER",n.ma),Aa(n,i),i}function _E(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return e=t&&n.Da&&!n.ra?new fe(new Ca({jb:!0})):new fe(n.ra),e.Ka(n.H),e}function yE(){}k=yE.prototype;k.xa=function(){};k.wa=function(){};k.va=function(){};k.ua=function(){};k.Ra=function(){};function Qc(){if(sr&&!(10<=Number(BL)))throw Error("Environmental error: no available transport.")}Qc.prototype.g=function(n,e){return new Dt(n,e)};function Dt(n,e){Ue.call(this),this.g=new cE(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.S=n,(n=e&&e.Yb)&&!Wc(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Wc(e)&&(this.g.D=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new kr(this)}Je(Dt,Ue);Dt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;ht(0),n.V=e,n.ia=t||{},n.L=n.Y,n.F=mE(n,null,n.V),pu(n)};Dt.prototype.close=function(){Sp(this.g)};Dt.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=gp(n),n=t);e.i.push(new g1(e.ab++,n)),e.G==3&&pu(e)};Dt.prototype.M=function(){this.g.l=null,delete this.j,Sp(this.g),delete this.g,Dt.X.M.call(this)};function vE(n){vp.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}Je(vE,vp);function wE(){wp.call(this),this.status=1}Je(wE,wp);function kr(n){this.g=n}Je(kr,yE);kr.prototype.xa=function(){ze(this.g,"a")};kr.prototype.wa=function(n){ze(this.g,new vE(n))};kr.prototype.va=function(n){ze(this.g,new wE)};kr.prototype.ua=function(){ze(this.g,"b")};Qc.prototype.createWebChannel=Qc.prototype.g;Dt.prototype.send=Dt.prototype.u;Dt.prototype.open=Dt.prototype.m;Dt.prototype.close=Dt.prototype.close;au.NO_ERROR=0;au.TIMEOUT=8;au.HTTP_ERROR=6;VT.COMPLETE="complete";$T.EventType=Ea;Ea.OPEN="a";Ea.CLOSE="b";Ea.ERROR="c";Ea.MESSAGE="d";Ue.prototype.listen=Ue.prototype.N;fe.prototype.listenOnce=fe.prototype.O;fe.prototype.getLastError=fe.prototype.Oa;fe.prototype.getLastErrorCode=fe.prototype.Ea;fe.prototype.getStatus=fe.prototype.aa;fe.prototype.getResponseJson=fe.prototype.Sa;fe.prototype.getResponseText=fe.prototype.fa;fe.prototype.send=fe.prototype.da;fe.prototype.setWithCredentials=fe.prototype.Ka;var S1=function(){return new Qc},C1=function(){return ou()},hh=au,k1=VT,A1=Ts,T_={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},R1=Ca,Xa=$T,N1=fe;const E_="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ne{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ne.UNAUTHENTICATED=new Ne(null),Ne.GOOGLE_CREDENTIALS=new Ne("google-credentials-uid"),Ne.FIRST_PARTY=new Ne("first-party-uid"),Ne.MOCK_USER=new Ne("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ar="9.17.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const li=new On("@firebase/firestore");function Id(){return li.logLevel}function D1(n){li.setLogLevel(n)}function I(n,...e){if(li.logLevel<=kt.DEBUG){const t=e.map(Ap);li.debug(`Firestore (${Ar}): ${n}`,...t)}}function _e(n,...e){if(li.logLevel<=kt.ERROR){const t=e.map(Ap);li.error(`Firestore (${Ar}): ${n}`,...t)}}function rr(n,...e){if(li.logLevel<=kt.WARN){const t=e.map(Ap);li.warn(`Firestore (${Ar}): ${n}`,...t)}}function Ap(n){if(typeof n=="string")return n;try{return e=n,JSON.stringify(e)}catch{return n}/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/var e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C(n="Unexpected state"){const e=`FIRESTORE (${Ar}) INTERNAL ASSERTION FAILED: `+n;throw _e(e),new Error(e)}function A(n,e){n||C()}function P1(n,e){n||C()}function S(n,e){return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class y extends je{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xe{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IE{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class x1{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ne.UNAUTHENTICATED))}shutdown(){}}class O1{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class M1{constructor(e){this.t=e,this.currentUser=Ne.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let i=this.i;const s=c=>this.i!==i?(i=this.i,t(c)):Promise.resolve();let r=new xe;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new xe,e.enqueueRetryable(()=>s(this.currentUser))};const o=()=>{const c=r;e.enqueueRetryable(async()=>{await c.promise,await s(this.currentUser)})},a=c=>{I("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=c,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(c=>a(c)),setTimeout(()=>{if(!this.auth){const c=this.t.getImmediate({optional:!0});c?a(c):(I("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new xe)}},0),o()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(I("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(A(typeof i.accessToken=="string"),new IE(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return A(e===null||typeof e=="string"),new Ne(e)}}class L1{constructor(e,t,i,s){this.h=e,this.l=t,this.m=i,this.g=s,this.type="FirstParty",this.user=Ne.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(A(!(typeof this.h!="object"||this.h===null||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class F1{constructor(e,t,i,s){this.h=e,this.l=t,this.m=i,this.g=s}getToken(){return Promise.resolve(new L1(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(Ne.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class U1{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class V1{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const i=r=>{r.error!=null&&I("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const o=r.token!==this.A;return this.A=r.token,I("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(r.token):Promise.resolve()};this.o=r=>{e.enqueueRetryable(()=>i(r))};const s=r=>{I("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.appCheck.addTokenListener(this.o)};this.T.onInit(r=>s(r)),setTimeout(()=>{if(!this.appCheck){const r=this.T.getImmediate({optional:!0});r?s(r):I("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(A(typeof t.token=="string"),this.A=t.token,new U1(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $1(n){const e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TE{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let i="";for(;i.length<20;){const s=$1(40);for(let r=0;r<s.length;++r)i.length<20&&s[r]<t&&(i+=e.charAt(s[r]%e.length))}return i}}function L(n,e){return n<e?-1:n>e?1:0}function or(n,e,t){return n.length===e.length&&n.every((i,s)=>t(i,e[s]))}function EE(n){return n+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ce{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new y(m.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new y(m.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ce.fromMillis(Date.now())}static fromDate(e){return ce.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new ce(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?L(this.nanoseconds,e.nanoseconds):L(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class R{constructor(e){this.timestamp=e}static fromTimestamp(e){return new R(e)}static min(){return new R(new ce(0,0))}static max(){return new R(new ce(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wo{constructor(e,t,i){t===void 0?t=0:t>e.length&&C(),i===void 0?i=e.length-t:i>e.length-t&&C(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return Wo.comparator(this,e)===0}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Wo?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let s=0;s<i;s++){const r=e.get(s),o=t.get(s);if(r<o)return-1;if(r>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class K extends Wo{construct(e,t,i){return new K(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new y(m.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(s=>s.length>0))}return new K(t)}static emptyPath(){return new K([])}}const B1=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ye extends Wo{construct(e,t,i){return new ye(e,t,i)}static isValidIdentifier(e){return B1.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ye.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new ye(["__name__"])}static fromServerFormat(e){const t=[];let i="",s=0;const r=()=>{if(i.length===0)throw new y(m.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let o=!1;for(;s<e.length;){const a=e[s];if(a==="\\"){if(s+1===e.length)throw new y(m.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const c=e[s+1];if(c!=="\\"&&c!=="."&&c!=="`")throw new y(m.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=c,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(i+=a,s++):(r(),s++)}if(r(),o)throw new y(m.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ye(t)}static emptyPath(){return new ye([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b{constructor(e){this.path=e}static fromPath(e){return new b(K.fromString(e))}static fromName(e){return new b(K.fromString(e).popFirst(5))}static empty(){return new b(K.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&K.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return K.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new b(new K(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bE{constructor(e,t,i,s){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=s}}function Td(n){return n.fields.find(e=>e.kind===2)}function Ri(n){return n.fields.filter(e=>e.kind!==2)}bE.UNKNOWN_ID=-1;class q1{constructor(e,t){this.fieldPath=e,this.kind=t}}class Yc{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Yc(0,Pt.min())}}function SE(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,s=R.fromTimestamp(i===1e9?new ce(t+1,0):new ce(t,i));return new Pt(s,b.empty(),e)}function CE(n){return new Pt(n.readTime,n.key,-1)}class Pt{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new Pt(R.min(),b.empty(),-1)}static max(){return new Pt(R.max(),b.empty(),-1)}}function Rp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=b.comparator(n.documentKey,e.documentKey),t!==0?t:L(n.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class AE{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ii(n){if(n.code!==m.FAILED_PRECONDITION||n.message!==kE)throw n;I("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&C(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new g((i,s)=>{this.nextCallback=r=>{this.wrapSuccess(e,r).next(i,s)},this.catchCallback=r=>{this.wrapFailure(t,r).next(i,s)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof g?t:g.resolve(t)}catch(t){return g.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):g.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):g.reject(t)}static resolve(e){return new g((t,i)=>{t(e)})}static reject(e){return new g((t,i)=>{i(e)})}static waitFor(e){return new g((t,i)=>{let s=0,r=0,o=!1;e.forEach(a=>{++s,a.next(()=>{++r,o&&r===s&&t()},c=>i(c))}),o=!0,r===s&&t()})}static or(e){let t=g.resolve(!1);for(const i of e)t=t.next(s=>s?g.resolve(s):i());return t}static forEach(e,t){const i=[];return e.forEach((s,r)=>{i.push(t.call(this,s,r))}),this.waitFor(i)}static mapArray(e,t){return new g((i,s)=>{const r=e.length,o=new Array(r);let a=0;for(let c=0;c<r;c++){const l=c;t(e[l]).next(u=>{o[l]=u,++a,a===r&&i(o)},u=>s(u))}})}static doWhile(e,t){return new g((i,s)=>{const r=()=>{e()===!0?t().next(()=>{r()},s):i()};r()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new xe,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new fo(e,t.error)):this.P.resolve()},this.transaction.onerror=i=>{const s=Np(i.target.error);this.P.reject(new fo(e,s))}}static open(e,t,i,s){try{return new gu(t,e.transaction(s,i))}catch(r){throw new fo(t,r)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(I("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const t=this.transaction.objectStore(e);return new K1(t)}}class Ht{constructor(e,t,i){this.name=e,this.version=t,this.S=i,Ht.D(we())===12.2&&_e("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return I("SimpleDb","Removing database:",e),Di(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!Rt())return!1;if(Ht.N())return!0;const e=we(),t=Ht.D(e),i=0<t&&t<10,s=Ht.k(e),r=0<s&&s<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||r)}static N(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.O)==="YES"}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}static k(e){const t=e.match(/Android ([\d.]+)/i),i=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(i)}async F(e){return this.db||(I("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,i)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=r=>{const o=r.target.result;t(o)},s.onblocked=()=>{i(new fo(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=r=>{const o=r.target.error;o.name==="VersionError"?i(new y(m.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?i(new y(m.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):i(new fo(e,o))},s.onupgradeneeded=r=>{I("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',r.oldVersion);const o=r.target.result;this.S.$(o,s.transaction,r.oldVersion,this.version).next(()=>{I("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.B&&(this.db.onversionchange=t=>this.B(t)),this.db}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}async runTransaction(e,t,i,s){const r=t==="readonly";let o=0;for(;;){++o;try{this.db=await this.F(e);const a=gu.open(this.db,e,r?"readonly":"readwrite",i),c=s(a).next(l=>(a.V(),l)).catch(l=>(a.abort(l),g.reject(l))).toPromise();return c.catch(()=>{}),await a.v,c}catch(a){const c=a,l=c.name!=="FirebaseError"&&o<3;if(I("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),this.close(),!l)return Promise.reject(c)}}}close(){this.db&&this.db.close(),this.db=void 0}}class W1{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return Di(this.q.delete())}}class fo extends y{constructor(e,t){super(m.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Ti(n){return n.name==="IndexedDbTransactionError"}class K1{constructor(e){this.store=e}put(e,t){let i;return t!==void 0?(I("SimpleDb","PUT",this.store.name,e,t),i=this.store.put(t,e)):(I("SimpleDb","PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),Di(i)}add(e){return I("SimpleDb","ADD",this.store.name,e,e),Di(this.store.add(e))}get(e){return Di(this.store.get(e)).next(t=>(t===void 0&&(t=null),I("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return I("SimpleDb","DELETE",this.store.name,e),Di(this.store.delete(e))}count(){return I("SimpleDb","COUNT",this.store.name),Di(this.store.count())}W(e,t){const i=this.options(e,t);if(i.index||typeof this.store.getAll!="function"){const s=this.cursor(i),r=[];return this.H(s,(o,a)=>{r.push(a)}).next(()=>r)}{const s=this.store.getAll(i.range);return new g((r,o)=>{s.onerror=a=>{o(a.target.error)},s.onsuccess=a=>{r(a.target.result)}})}}J(e,t){const i=this.store.getAll(e,t===null?void 0:t);return new g((s,r)=>{i.onerror=o=>{r(o.target.error)},i.onsuccess=o=>{s(o.target.result)}})}Y(e,t){I("SimpleDb","DELETE ALL",this.store.name);const i=this.options(e,t);i.X=!1;const s=this.cursor(i);return this.H(s,(r,o,a)=>a.delete())}Z(e,t){let i;t?i=e:(i={},t=e);const s=this.cursor(i);return this.H(s,t)}tt(e){const t=this.cursor({});return new g((i,s)=>{t.onerror=r=>{const o=Np(r.target.error);s(o)},t.onsuccess=r=>{const o=r.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():i()}):i()}})}H(e,t){const i=[];return new g((s,r)=>{e.onerror=o=>{r(o.target.error)},e.onsuccess=o=>{const a=o.target.result;if(!a)return void s();const c=new W1(a),l=t(a.primaryKey,a.value,c);if(l instanceof g){const u=l.catch(h=>(c.done(),g.reject(h)));i.push(u)}c.isDone?s():c.G===null?a.continue():a.continue(c.G)}}).next(()=>g.waitFor(i))}options(e,t){let i;return e!==void 0&&(typeof e=="string"?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const i=this.store.index(e.index);return e.X?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Di(n){return new g((e,t)=>{n.onsuccess=i=>{const s=i.target.result;e(s)},n.onerror=i=>{const s=Np(i.target.error);t(s)}})}let b_=!1;function Np(n){const e=Ht.D(we());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const i=new y("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return b_||(b_=!0,setTimeout(()=>{throw i},0)),i}}return n}class j1{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}nt(e){I("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{I("IndexBackiller",`Documents written: ${await this.et.st()}`)}catch(t){Ti(t)?I("IndexBackiller","Ignoring IndexedDB error during index backfill: ",t):await Ii(t)}await this.nt(6e4)})}}class G1{constructor(e,t){this.localStore=e,this.persistence=t}async st(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.it(t,e))}it(e,t){const i=new Set;let s=t,r=!0;return g.doWhile(()=>r===!0&&s>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!i.has(o))return I("IndexBackiller",`Processing collection: ${o}`),this.rt(e,o,s).next(a=>{s-=a,i.add(o)});r=!1})).next(()=>t-s)}rt(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(s=>this.localStore.localDocuments.getNextDocuments(e,t,s,i).next(r=>{const o=r.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ot(s,r)).next(a=>(I("IndexBackiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}ot(e,t){let i=e;return t.changes.forEach((s,r)=>{const o=CE(r);Rp(o,i)>0&&(i=o)}),new Pt(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=i=>this.ut(i),this.ct=i=>t.writeSequenceNumber(i))}ut(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ct&&this.ct(e),e}}yt.at=-1;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H1{constructor(e,t,i,s,r,o,a,c){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=s,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.useFetchStreams=c}}class ui{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ui("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof ui&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function S_(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Es(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function RE(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ra(n){return n==null}function Ko(n){return n===0&&1/n==-1/0}function NE(n){return typeof n=="number"&&Number.isInteger(n)&&!Ko(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function z1(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class be{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new be(t)}static fromUint8Array(e){const t=function(i){let s="";for(let r=0;r<i.length;++r)s+=String.fromCharCode(i[r]);return s}(e);return new be(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return L(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}be.EMPTY_BYTE_STRING=new be("");const Q1=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hi(n){if(A(!!n),typeof n=="string"){let e=0;const t=Q1.exec(n);if(A(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:de(n.seconds),nanos:de(n.nanos)}}function de(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ss(n){return typeof n=="string"?be.fromBase64String(n):be.fromUint8Array(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dp(n){var e,t;return((t=(((e=n==null?void 0:n.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function DE(n){const e=n.mapValue.fields.__previous_value__;return Dp(e)?DE(e):e}function jo(n){const e=hi(n.mapValue.fields.__local_write_time__.timestampValue);return new ce(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},hc={nullValue:"NULL_VALUE"};function rs(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Dp(n)?4:PE(n)?9007199254740991:10:C()}function mn(n,e){if(n===e)return!0;const t=rs(n);if(t!==rs(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return jo(n).isEqual(jo(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const r=hi(i.timestampValue),o=hi(s.timestampValue);return r.seconds===o.seconds&&r.nanos===o.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return ss(i.bytesValue).isEqual(ss(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return de(i.geoPointValue.latitude)===de(s.geoPointValue.latitude)&&de(i.geoPointValue.longitude)===de(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return de(i.integerValue)===de(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const r=de(i.doubleValue),o=de(s.doubleValue);return r===o?Ko(r)===Ko(o):isNaN(r)&&isNaN(o)}return!1}(n,e);case 9:return or(n.arrayValue.values||[],e.arrayValue.values||[],mn);case 10:return function(i,s){const r=i.mapValue.fields||{},o=s.mapValue.fields||{};if(S_(r)!==S_(o))return!1;for(const a in r)if(r.hasOwnProperty(a)&&(o[a]===void 0||!mn(r[a],o[a])))return!1;return!0}(n,e);default:return C()}}function Go(n,e){return(n.values||[]).find(t=>mn(t,e))!==void 0}function di(n,e){if(n===e)return 0;const t=rs(n),i=rs(e);if(t!==i)return L(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return L(n.booleanValue,e.booleanValue);case 2:return function(s,r){const o=de(s.integerValue||s.doubleValue),a=de(r.integerValue||r.doubleValue);return o<a?-1:o>a?1:o===a?0:isNaN(o)?isNaN(a)?0:-1:1}(n,e);case 3:return C_(n.timestampValue,e.timestampValue);case 4:return C_(jo(n),jo(e));case 5:return L(n.stringValue,e.stringValue);case 6:return function(s,r){const o=ss(s),a=ss(r);return o.compareTo(a)}(n.bytesValue,e.bytesValue);case 7:return function(s,r){const o=s.split("/"),a=r.split("/");for(let c=0;c<o.length&&c<a.length;c++){const l=L(o[c],a[c]);if(l!==0)return l}return L(o.length,a.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,r){const o=L(de(s.latitude),de(r.latitude));return o!==0?o:L(de(s.longitude),de(r.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,r){const o=s.values||[],a=r.values||[];for(let c=0;c<o.length&&c<a.length;++c){const l=di(o[c],a[c]);if(l)return l}return L(o.length,a.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,r){if(s===Xn.mapValue&&r===Xn.mapValue)return 0;if(s===Xn.mapValue)return 1;if(r===Xn.mapValue)return-1;const o=s.fields||{},a=Object.keys(o),c=r.fields||{},l=Object.keys(c);a.sort(),l.sort();for(let u=0;u<a.length&&u<l.length;++u){const h=L(a[u],l[u]);if(h!==0)return h;const d=di(o[a[u]],c[l[u]]);if(d!==0)return d}return L(a.length,l.length)}(n.mapValue,e.mapValue);default:throw C()}}function C_(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return L(n,e);const t=hi(n),i=hi(e),s=L(t.seconds,i.seconds);return s!==0?s:L(t.nanos,i.nanos)}function ar(n){return Ed(n)}function Ed(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const s=hi(i);return`time(${s.seconds},${s.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?ss(n.bytesValue).toBase64():"referenceValue"in n?(t=n.referenceValue,b.fromName(t).toString()):"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(i){let s="[",r=!0;for(const o of i.values||[])r?r=!1:s+=",",s+=Ed(o);return s+"]"}(n.arrayValue):"mapValue"in n?function(i){const s=Object.keys(i.fields||{}).sort();let r="{",o=!0;for(const a of s)o?o=!1:r+=",",r+=`${a}:${Ed(i.fields[a])}`;return r+"}"}(n.mapValue):C();var e,t}function os(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function bd(n){return!!n&&"integerValue"in n}function Ho(n){return!!n&&"arrayValue"in n}function k_(n){return!!n&&"nullValue"in n}function A_(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function dc(n){return!!n&&"mapValue"in n}function po(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Es(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=po(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=po(n.arrayValue.values[t]);return e}return Object.assign({},n)}function PE(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function Y1(n){return"nullValue"in n?hc:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?os(ui.empty(),b.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:C()}function X1(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?os(ui.empty(),b.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Xn:C()}function R_(n,e){const t=di(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function N_(n,e){const t=di(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fi{constructor(e,t){this.position=e,this.inclusive=t}}function D_(n,e,t){let i=0;for(let s=0;s<n.position.length;s++){const r=e[s],o=n.position[s];if(r.field.isKeyField()?i=b.comparator(b.fromName(o.referenceValue),t.key):i=di(o,t.data.field(r.field)),r.dir==="desc"&&(i*=-1),i!==0)break}return i}function P_(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!mn(n.position[t],e.position[t]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xE{}class q extends xE{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,i):new J1(e,t,i):t==="array-contains"?new tF(e,i):t==="in"?new VE(e,i):t==="not-in"?new nF(e,i):t==="array-contains-any"?new iF(e,i):new q(e,t,i)}static createKeyFieldInFilter(e,t,i){return t==="in"?new Z1(e,i):new eF(e,i)}matches(e){const t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(di(t,this.value)):t!==null&&rs(this.value)===rs(t)&&this.matchesComparison(di(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return C()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Y extends xE{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new Y(e,t)}matches(e){return cr(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ht!==null||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt(t=>t.isInequality());return e!==null?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function cr(n){return n.op==="and"}function Sd(n){return n.op==="or"}function Pp(n){return OE(n)&&cr(n)}function OE(n){for(const e of n.filters)if(e instanceof Y)return!1;return!0}function Cd(n){if(n instanceof q)return n.field.canonicalString()+n.op.toString()+ar(n.value);if(Pp(n))return n.filters.map(e=>Cd(e)).join(",");{const e=n.filters.map(t=>Cd(t)).join(",");return`${n.op}(${e})`}}function ME(n,e){return n instanceof q?function(t,i){return i instanceof q&&t.op===i.op&&t.field.isEqual(i.field)&&mn(t.value,i.value)}(n,e):n instanceof Y?function(t,i){return i instanceof Y&&t.op===i.op&&t.filters.length===i.filters.length?t.filters.reduce((s,r,o)=>s&&ME(r,i.filters[o]),!0):!1}(n,e):void C()}function LE(n,e){const t=n.filters.concat(e);return Y.create(t,n.op)}function FE(n){return n instanceof q?function(e){return`${e.field.canonicalString()} ${e.op} ${ar(e.value)}`}(n):n instanceof Y?function(e){return e.op.toString()+" {"+e.getFilters().map(FE).join(" ,")+"}"}(n):"Filter"}class J1 extends q{constructor(e,t,i){super(e,t,i),this.key=b.fromName(i.referenceValue)}matches(e){const t=b.comparator(e.key,this.key);return this.matchesComparison(t)}}class Z1 extends q{constructor(e,t){super(e,"in",t),this.keys=UE("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class eF extends q{constructor(e,t){super(e,"not-in",t),this.keys=UE("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function UE(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(i=>b.fromName(i.referenceValue))}class tF extends q{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ho(t)&&Go(t.arrayValue,this.value)}}class VE extends q{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return t!==null&&Go(this.value.arrayValue,t)}}class nF extends q{constructor(e,t){super(e,"not-in",t)}matches(e){if(Go(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return t!==null&&!Go(this.value.arrayValue,t)}}class iF extends q{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ho(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>Go(this.value.arrayValue,i))}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class js{constructor(e,t="asc"){this.field=e,this.dir=t}}function sF(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pe{constructor(e,t){this.comparator=e,this.root=t||We.EMPTY}insert(e,t){return new pe(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,We.BLACK,null,null))}remove(e){return new pe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,We.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(i===0)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const s=this.comparator(e,i.key);if(s===0)return t+i.left.size;s<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Ja(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Ja(this.root,e,this.comparator,!1)}getReverseIterator(){return new Ja(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Ja(this.root,e,this.comparator,!0)}}class Ja{constructor(e,t,i,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!e.isEmpty();)if(r=t?i(e.key,t):1,t&&s&&(r*=-1),r<0)e=this.isReverse?e.left:e.right;else{if(r===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class We{constructor(e,t,i,s,r){this.key=e,this.value=t,this.color=i??We.RED,this.left=s??We.EMPTY,this.right=r??We.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,s,r){return new We(e??this.key,t??this.value,i??this.color,s??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let s=this;const r=i(e,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(e,t,i),null):r===0?s.copy(null,t,null,null,null):s.copy(null,null,null,null,s.right.insert(e,t,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return We.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,s=this;if(t(e,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(e,t),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),t(e,s.key)===0){if(s.right.isEmpty())return We.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(e,t))}return s.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,We.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,We.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw C();const e=this.left.check();if(e!==this.right.check())throw C();return e+(this.isRed()?0:1)}}We.EMPTY=null,We.RED=!0,We.BLACK=!1;We.EMPTY=new class{constructor(){this.size=0}get key(){throw C()}get value(){throw C()}get color(){throw C()}get left(){throw C()}get right(){throw C()}copy(n,e,t,i,s){return this}insert(n,e,t){return new We(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J{constructor(e){this.comparator=e,this.data=new pe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const s=i.getNext();if(this.comparator(s.key,e[1])>=0)return;t(s.key)}}forEachWhile(e,t){let i;for(i=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new x_(this.data.getIterator())}getIteratorFrom(e){return new x_(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof J)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const s=t.getNext().key,r=i.getNext().key;if(this.comparator(s,r)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new J(this.comparator);return t.data=e,t}}class x_{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ns(n){return n.hasNext()?n.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vt{constructor(e){this.fields=e,e.sort(ye.comparator)}static empty(){return new vt([])}unionWith(e){let t=new J(ye.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new vt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return or(this.fields,e.fields,(t,i)=>t.isEqual(i))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ke{constructor(e){this.value=e}static empty(){return new Ke({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!dc(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=po(t)}setAll(e){let t=ye.emptyPath(),i={},s=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){const c=this.getFieldsMap(t);this.applyChanges(c,i,s),i={},s=[],t=a.popLast()}o?i[a.lastSegment()]=po(o):s.push(a.lastSegment())});const r=this.getFieldsMap(t);this.applyChanges(r,i,s)}delete(e){const t=this.field(e.popLast());dc(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return mn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let s=t.mapValue.fields[e.get(i)];dc(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=s),t=s}return t.mapValue.fields}applyChanges(e,t,i){Es(t,(s,r)=>e[s]=r);for(const s of i)delete e[s]}clone(){return new Ke(po(this.value))}}function $E(n){const e=[];return Es(n.fields,(t,i)=>{const s=new ye([t]);if(dc(i)){const r=$E(i.mapValue).fields;if(r.length===0)e.push(s);else for(const o of r)e.push(s.child(o))}else e.push(s)}),new vt(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ne{constructor(e,t,i,s,r,o,a){this.key=e,this.documentType=t,this.version=i,this.readTime=s,this.createTime=r,this.data=o,this.documentState=a}static newInvalidDocument(e){return new ne(e,0,R.min(),R.min(),R.min(),Ke.empty(),0)}static newFoundDocument(e,t,i,s){return new ne(e,1,t,R.min(),i,s,0)}static newNoDocument(e,t){return new ne(e,2,t,R.min(),R.min(),Ke.empty(),0)}static newUnknownDocument(e,t){return new ne(e,3,t,R.min(),R.min(),Ke.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(R.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ke.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ke.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=R.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof ne&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ne(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rF{constructor(e,t=null,i=[],s=[],r=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=s,this.limit=r,this.startAt=o,this.endAt=a,this.ft=null}}function kd(n,e=null,t=[],i=[],s=null,r=null,o=null){return new rF(n,e,t,i,s,r,o)}function as(n){const e=S(n);if(e.ft===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>Cd(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>function(s){return s.field.canonicalString()+s.dir}(i)).join(","),Ra(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>ar(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>ar(i)).join(",")),e.ft=t}return e.ft}function Na(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!sF(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!ME(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!P_(n.startAt,e.startAt)&&P_(n.endAt,e.endAt)}function Xc(n){return b.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Jc(n,e){return n.filters.filter(t=>t instanceof q&&t.field.isEqual(e))}function O_(n,e,t){let i=hc,s=!0;for(const r of Jc(n,e)){let o=hc,a=!0;switch(r.op){case"<":case"<=":o=Y1(r.value);break;case"==":case"in":case">=":o=r.value;break;case">":o=r.value,a=!1;break;case"!=":case"not-in":o=hc}R_({value:i,inclusive:s},{value:o,inclusive:a})<0&&(i=o,s=a)}if(t!==null){for(let r=0;r<n.orderBy.length;++r)if(n.orderBy[r].field.isEqual(e)){const o=t.position[r];R_({value:i,inclusive:s},{value:o,inclusive:t.inclusive})<0&&(i=o,s=t.inclusive);break}}return{value:i,inclusive:s}}function M_(n,e,t){let i=Xn,s=!0;for(const r of Jc(n,e)){let o=Xn,a=!0;switch(r.op){case">=":case">":o=X1(r.value),a=!1;break;case"==":case"in":case"<=":o=r.value;break;case"<":o=r.value,a=!1;break;case"!=":case"not-in":o=Xn}N_({value:i,inclusive:s},{value:o,inclusive:a})>0&&(i=o,s=a)}if(t!==null){for(let r=0;r<n.orderBy.length;++r)if(n.orderBy[r].field.isEqual(e)){const o=t.position[r];N_({value:i,inclusive:s},{value:o,inclusive:t.inclusive})>0&&(i=o,s=t.inclusive);break}}return{value:i,inclusive:s}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Un{constructor(e,t=null,i=[],s=[],r=null,o="F",a=null,c=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=s,this.limit=r,this.limitType=o,this.startAt=a,this.endAt=c,this.dt=null,this._t=null,this.startAt,this.endAt}}function BE(n,e,t,i,s,r,o,a){return new Un(n,e,t,i,s,r,o,a)}function Rr(n){return new Un(n)}function L_(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function xp(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function mu(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(t!==null)return t}return null}function Op(n){return n.collectionGroup!==null}function zi(n){const e=S(n);if(e.dt===null){e.dt=[];const t=mu(e),i=xp(e);if(t!==null&&i===null)t.isKeyField()||e.dt.push(new js(t)),e.dt.push(new js(ye.keyField(),"asc"));else{let s=!1;for(const r of e.explicitOrderBy)e.dt.push(r),r.field.isKeyField()&&(s=!0);if(!s){const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.dt.push(new js(ye.keyField(),r))}}}return e.dt}function It(n){const e=S(n);if(!e._t)if(e.limitType==="F")e._t=kd(e.path,e.collectionGroup,zi(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const r of zi(e)){const o=r.dir==="desc"?"asc":"desc";t.push(new js(r.field,o))}const i=e.endAt?new fi(e.endAt.position,e.endAt.inclusive):null,s=e.startAt?new fi(e.startAt.position,e.startAt.inclusive):null;e._t=kd(e.path,e.collectionGroup,t,e.filters,e.limit,i,s)}return e._t}function Ad(n,e){e.getFirstInequalityField(),mu(n);const t=n.filters.concat([e]);return new Un(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Zc(n,e,t){return new Un(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Da(n,e){return Na(It(n),It(e))&&n.limitType===e.limitType}function qE(n){return`${as(It(n))}|lt:${n.limitType}`}function Rd(n){return`Query(target=${function(e){let t=e.path.canonicalString();return e.collectionGroup!==null&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(i=>FE(i)).join(", ")}]`),Ra(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(i=>function(s){return`${s.field.canonicalString()} (${s.dir})`}(i)).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>ar(i)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>ar(i)).join(",")),`Target(${t})`}(It(n))}; limitType=${n.limitType})`}function Pa(n,e){return e.isFoundDocument()&&function(t,i){const s=i.key.path;return t.collectionGroup!==null?i.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(s):b.isDocumentKey(t.path)?t.path.isEqual(s):t.path.isImmediateParentOf(s)}(n,e)&&function(t,i){for(const s of zi(t))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(t,i){for(const s of t.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(t,i){return!(t.startAt&&!function(s,r,o){const a=D_(s,r,o);return s.inclusive?a<=0:a<0}(t.startAt,zi(t),i)||t.endAt&&!function(s,r,o){const a=D_(s,r,o);return s.inclusive?a>=0:a>0}(t.endAt,zi(t),i))}(n,e)}function WE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function KE(n){return(e,t)=>{let i=!1;for(const s of zi(n)){const r=oF(s,e,t);if(r!==0)return r;i=i||s.field.isKeyField()}return 0}}function oF(n,e,t){const i=n.field.isKeyField()?b.comparator(e.key,t.key):function(s,r,o){const a=r.data.field(s),c=o.data.field(s);return a!==null&&c!==null?di(a,c):C()}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return C()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jE(n,e){if(n.wt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ko(e)?"-0":e}}function GE(n){return{integerValue:""+n}}function HE(n,e){return NE(e)?GE(e):jE(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _u{constructor(){this._=void 0}}function aF(n,e,t){return n instanceof lr?function(i,s){const r={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&(r.fields.__previous_value__=s),{mapValue:r}}(t,e):n instanceof cs?QE(n,e):n instanceof ls?YE(n,e):function(i,s){const r=zE(i,s),o=F_(r)+F_(i.gt);return bd(r)&&bd(i.gt)?GE(o):jE(i.yt,o)}(n,e)}function cF(n,e,t){return n instanceof cs?QE(n,e):n instanceof ls?YE(n,e):t}function zE(n,e){return n instanceof ur?bd(t=e)||function(i){return!!i&&"doubleValue"in i}(t)?e:{integerValue:0}:null;var t}class lr extends _u{}class cs extends _u{constructor(e){super(),this.elements=e}}function QE(n,e){const t=XE(e);for(const i of n.elements)t.some(s=>mn(s,i))||t.push(i);return{arrayValue:{values:t}}}class ls extends _u{constructor(e){super(),this.elements=e}}function YE(n,e){let t=XE(e);for(const i of n.elements)t=t.filter(s=>!mn(s,i));return{arrayValue:{values:t}}}class ur extends _u{constructor(e,t){super(),this.yt=e,this.gt=t}}function F_(n){return de(n.integerValue||n.doubleValue)}function XE(n){return Ho(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xa{constructor(e,t){this.field=e,this.transform=t}}function lF(n,e){return n.field.isEqual(e.field)&&function(t,i){return t instanceof cs&&i instanceof cs||t instanceof ls&&i instanceof ls?or(t.elements,i.elements,mn):t instanceof ur&&i instanceof ur?mn(t.gt,i.gt):t instanceof lr&&i instanceof lr}(n.transform,e.transform)}class uF{constructor(e,t){this.version=e,this.transformResults=t}}class ae{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ae}static exists(e){return new ae(void 0,e)}static updateTime(e){return new ae(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function fc(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}class yu{}function JE(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Dr(n.key,ae.none()):new Nr(n.key,n.data,ae.none());{const t=n.data,i=Ke.empty();let s=new J(ye.comparator);for(let r of e.fields)if(!s.has(r)){let o=t.field(r);o===null&&r.length>1&&(r=r.popLast(),o=t.field(r)),o===null?i.delete(r):i.set(r,o),s=s.add(r)}return new Vn(n.key,i,new vt(s.toArray()),ae.none())}}function hF(n,e,t){n instanceof Nr?function(i,s,r){const o=i.value.clone(),a=V_(i.fieldTransforms,s,r.transformResults);o.setAll(a),s.convertToFoundDocument(r.version,o).setHasCommittedMutations()}(n,e,t):n instanceof Vn?function(i,s,r){if(!fc(i.precondition,s))return void s.convertToUnknownDocument(r.version);const o=V_(i.fieldTransforms,s,r.transformResults),a=s.data;a.setAll(ZE(i)),a.setAll(o),s.convertToFoundDocument(r.version,a).setHasCommittedMutations()}(n,e,t):function(i,s,r){s.convertToNoDocument(r.version).setHasCommittedMutations()}(0,e,t)}function go(n,e,t,i){return n instanceof Nr?function(s,r,o,a){if(!fc(s.precondition,r))return o;const c=s.value.clone(),l=$_(s.fieldTransforms,a,r);return c.setAll(l),r.convertToFoundDocument(r.version,c).setHasLocalMutations(),null}(n,e,t,i):n instanceof Vn?function(s,r,o,a){if(!fc(s.precondition,r))return o;const c=$_(s.fieldTransforms,a,r),l=r.data;return l.setAll(ZE(s)),l.setAll(c),r.convertToFoundDocument(r.version,l).setHasLocalMutations(),o===null?null:o.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(u=>u.field))}(n,e,t,i):function(s,r,o){return fc(s.precondition,r)?(r.convertToNoDocument(r.version).setHasLocalMutations(),null):o}(n,e,t)}function dF(n,e){let t=null;for(const i of n.fieldTransforms){const s=e.data.field(i.field),r=zE(i.transform,s||null);r!=null&&(t===null&&(t=Ke.empty()),t.set(i.field,r))}return t||null}function U_(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(t,i){return t===void 0&&i===void 0||!(!t||!i)&&or(t,i,(s,r)=>lF(s,r))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}class Nr extends yu{constructor(e,t,i,s=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Vn extends yu{constructor(e,t,i,s,r=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function ZE(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function V_(n,e,t){const i=new Map;A(n.length===t.length);for(let s=0;s<t.length;s++){const r=n[s],o=r.transform,a=e.data.field(r.field);i.set(r.field,cF(o,a,t[s]))}return i}function $_(n,e,t){const i=new Map;for(const s of n){const r=s.transform,o=t.data.field(s.field);i.set(s.field,aF(r,o,e))}return i}class Dr extends yu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Mp extends yu{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fF{constructor(e){this.count=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Ie,W;function eb(n){switch(n){default:return C();case m.CANCELLED:case m.UNKNOWN:case m.DEADLINE_EXCEEDED:case m.RESOURCE_EXHAUSTED:case m.INTERNAL:case m.UNAVAILABLE:case m.UNAUTHENTICATED:return!1;case m.INVALID_ARGUMENT:case m.NOT_FOUND:case m.ALREADY_EXISTS:case m.PERMISSION_DENIED:case m.FAILED_PRECONDITION:case m.ABORTED:case m.OUT_OF_RANGE:case m.UNIMPLEMENTED:case m.DATA_LOSS:return!0}}function tb(n){if(n===void 0)return _e("GRPC error has no .code"),m.UNKNOWN;switch(n){case Ie.OK:return m.OK;case Ie.CANCELLED:return m.CANCELLED;case Ie.UNKNOWN:return m.UNKNOWN;case Ie.DEADLINE_EXCEEDED:return m.DEADLINE_EXCEEDED;case Ie.RESOURCE_EXHAUSTED:return m.RESOURCE_EXHAUSTED;case Ie.INTERNAL:return m.INTERNAL;case Ie.UNAVAILABLE:return m.UNAVAILABLE;case Ie.UNAUTHENTICATED:return m.UNAUTHENTICATED;case Ie.INVALID_ARGUMENT:return m.INVALID_ARGUMENT;case Ie.NOT_FOUND:return m.NOT_FOUND;case Ie.ALREADY_EXISTS:return m.ALREADY_EXISTS;case Ie.PERMISSION_DENIED:return m.PERMISSION_DENIED;case Ie.FAILED_PRECONDITION:return m.FAILED_PRECONDITION;case Ie.ABORTED:return m.ABORTED;case Ie.OUT_OF_RANGE:return m.OUT_OF_RANGE;case Ie.UNIMPLEMENTED:return m.UNIMPLEMENTED;case Ie.DATA_LOSS:return m.DATA_LOSS;default:return C()}}(W=Ie||(Ie={}))[W.OK=0]="OK",W[W.CANCELLED=1]="CANCELLED",W[W.UNKNOWN=2]="UNKNOWN",W[W.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",W[W.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",W[W.NOT_FOUND=5]="NOT_FOUND",W[W.ALREADY_EXISTS=6]="ALREADY_EXISTS",W[W.PERMISSION_DENIED=7]="PERMISSION_DENIED",W[W.UNAUTHENTICATED=16]="UNAUTHENTICATED",W[W.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",W[W.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",W[W.ABORTED=10]="ABORTED",W[W.OUT_OF_RANGE=11]="OUT_OF_RANGE",W[W.UNIMPLEMENTED=12]="UNIMPLEMENTED",W[W.INTERNAL=13]="INTERNAL",W[W.UNAVAILABLE=14]="UNAVAILABLE",W[W.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ei{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i!==void 0){for(const[s,r]of i)if(this.equalsFn(s,e))return r}}has(e){return this.get(e)!==void 0}set(e,t){const i=this.mapKeyFn(e),s=this.inner[i];if(s===void 0)return this.inner[i]=[[e,t]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],e))return void(s[r]=[e,t]);s.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(i===void 0)return!1;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return i.length===1?delete this.inner[t]:i.splice(s,1),this.innerSize--,!0;return!1}forEach(e){Es(this.inner,(t,i)=>{for(const[s,r]of i)e(s,r)})}isEmpty(){return RE(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pF=new pe(b.comparator);function wt(){return pF}const nb=new pe(b.comparator);function no(...n){let e=nb;for(const t of n)e=e.insert(t.key,t);return e}function ib(n){let e=nb;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function rn(){return mo()}function sb(){return mo()}function mo(){return new Ei(n=>n.toString(),(n,e)=>n.isEqual(e))}const gF=new pe(b.comparator),mF=new J(b.comparator);function F(...n){let e=mF;for(const t of n)e=e.add(t);return e}const _F=new J(L);function vu(){return _F}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oa{constructor(e,t,i,s,r){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const s=new Map;return s.set(e,Ma.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new Oa(R.min(),s,vu(),wt(),F())}}class Ma{constructor(e,t,i,s,r){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new Ma(i,t,F(),F(),F())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pc{constructor(e,t,i,s){this.It=e,this.removedTargetIds=t,this.key=i,this.Tt=s}}class rb{constructor(e,t){this.targetId=e,this.Et=t}}class ob{constructor(e,t,i=be.EMPTY_BYTE_STRING,s=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=s}}class B_{constructor(){this.At=0,this.Rt=W_(),this.bt=be.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return this.At!==0}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=F(),t=F(),i=F();return this.Rt.forEach((s,r)=>{switch(r){case 0:e=e.add(s);break;case 2:t=t.add(s);break;case 1:i=i.add(s);break;default:C()}}),new Ma(this.bt,this.Pt,e,t,i)}xt(){this.vt=!1,this.Rt=W_()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class yF{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=wt(),this.qt=q_(),this.Ut=new J(L)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,t=>{const i=this.Wt(t);switch(e.state){case 0:this.zt(t)&&i.Dt(e.resumeToken);break;case 1:i.Mt(),i.Vt||i.xt(),i.Dt(e.resumeToken);break;case 2:i.Mt(),i.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(i.Ft(),i.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),i.Dt(e.resumeToken));break;default:C()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach((i,s)=>{this.zt(s)&&t(s)})}Jt(e){const t=e.targetId,i=e.Et.count,s=this.Yt(t);if(s){const r=s.target;if(Xc(r))if(i===0){const o=new b(r.path);this.Qt(t,o,ne.newNoDocument(o,R.min()))}else A(i===1);else this.Xt(t)!==i&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){const t=new Map;this.Bt.forEach((r,o)=>{const a=this.Yt(o);if(a){if(r.current&&Xc(a.target)){const c=new b(a.target.path);this.Lt.get(c)!==null||this.te(o,c)||this.Qt(o,c,ne.newNoDocument(c,e))}r.St&&(t.set(o,r.Ct()),r.xt())}});let i=F();this.qt.forEach((r,o)=>{let a=!0;o.forEachWhile(c=>{const l=this.Yt(c);return!l||l.purpose===2||(a=!1,!1)}),a&&(i=i.add(r))}),this.Lt.forEach((r,o)=>o.setReadTime(e));const s=new Oa(e,t,this.Ut,this.Lt,i);return this.Lt=wt(),this.qt=q_(),this.Ut=new J(L),s}Gt(e,t){if(!this.zt(e))return;const i=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,i),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,i){if(!this.zt(e))return;const s=this.Wt(e);this.te(e,t)?s.Nt(t,1):s.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),i&&(this.Lt=this.Lt.insert(t,i))}removeTarget(e){this.Bt.delete(e)}Xt(e){const t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new B_,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new J(L),this.qt=this.qt.insert(e,t)),t}zt(e){const t=this.Yt(e)!==null;return t||I("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new B_),this.$t.getRemoteKeysForTarget(e).forEach(t=>{this.Qt(e,t,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function q_(){return new pe(b.comparator)}function W_(){return new pe(b.comparator)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vF=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),wF=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),IF=(()=>({and:"AND",or:"OR"}))();class TF{constructor(e,t){this.databaseId=e,this.wt=t}}function hr(n,e){return n.wt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ab(n,e){return n.wt?e.toBase64():e.toUint8Array()}function EF(n,e){return hr(n,e.toTimestamp())}function ve(n){return A(!!n),R.fromTimestamp(function(e){const t=hi(e);return new ce(t.seconds,t.nanos)}(n))}function Lp(n,e){return function(t){return new K(["projects",t.projectId,"databases",t.database])}(n).child("documents").child(e).canonicalString()}function cb(n){const e=K.fromString(n);return A(_b(e)),e}function zo(n,e){return Lp(n.databaseId,e.path)}function ln(n,e){const t=cb(e);if(t.get(1)!==n.databaseId.projectId)throw new y(m.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new y(m.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new b(ub(t))}function Nd(n,e){return Lp(n.databaseId,e)}function lb(n){const e=cb(n);return e.length===4?K.emptyPath():ub(e)}function Qo(n){return new K(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function ub(n){return A(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function K_(n,e,t){return{name:zo(n,e),fields:t.value.mapValue.fields}}function hb(n,e,t){const i=ln(n,e.name),s=ve(e.updateTime),r=e.createTime?ve(e.createTime):R.min(),o=new Ke({mapValue:{fields:e.fields}}),a=ne.newFoundDocument(i,s,r,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function bF(n,e){return"found"in e?function(t,i){A(!!i.found),i.found.name,i.found.updateTime;const s=ln(t,i.found.name),r=ve(i.found.updateTime),o=i.found.createTime?ve(i.found.createTime):R.min(),a=new Ke({mapValue:{fields:i.found.fields}});return ne.newFoundDocument(s,r,o,a)}(n,e):"missing"in e?function(t,i){A(!!i.missing),A(!!i.readTime);const s=ln(t,i.missing),r=ve(i.readTime);return ne.newNoDocument(s,r)}(n,e):C()}function SF(n,e){let t;if("targetChange"in e){e.targetChange;const i=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:C()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],r=function(c,l){return c.wt?(A(l===void 0||typeof l=="string"),be.fromBase64String(l||"")):(A(l===void 0||l instanceof Uint8Array),be.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){const l=c.code===void 0?m.UNKNOWN:tb(c.code);return new y(l,c.message||"")}(o);t=new ob(i,s,r,a||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const s=ln(n,i.document.name),r=ve(i.document.updateTime),o=i.document.createTime?ve(i.document.createTime):R.min(),a=new Ke({mapValue:{fields:i.document.fields}}),c=ne.newFoundDocument(s,r,o,a),l=i.targetIds||[],u=i.removedTargetIds||[];t=new pc(l,u,c.key,c)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const s=ln(n,i.document),r=i.readTime?ve(i.readTime):R.min(),o=ne.newNoDocument(s,r),a=i.removedTargetIds||[];t=new pc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const s=ln(n,i.document),r=i.removedTargetIds||[];t=new pc([],r,s,null)}else{if(!("filter"in e))return C();{e.filter;const i=e.filter;i.targetId;const s=i.count||0,r=new fF(s),o=i.targetId;t=new rb(o,r)}}return t}function Yo(n,e){let t;if(e instanceof Nr)t={update:K_(n,e.key,e.value)};else if(e instanceof Dr)t={delete:zo(n,e.key)};else if(e instanceof Vn)t={update:K_(n,e.key,e.data),updateMask:DF(e.fieldMask)};else{if(!(e instanceof Mp))return C();t={verify:zo(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(s,r){const o=r.transform;if(o instanceof lr)return{fieldPath:r.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(o instanceof cs)return{fieldPath:r.field.canonicalString(),appendMissingElements:{values:o.elements}};if(o instanceof ls)return{fieldPath:r.field.canonicalString(),removeAllFromArray:{values:o.elements}};if(o instanceof ur)return{fieldPath:r.field.canonicalString(),increment:o.gt};throw C()}(0,i))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:EF(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:C()}(n,e.precondition)),t}function Dd(n,e){const t=e.currentDocument?function(s){return s.updateTime!==void 0?ae.updateTime(ve(s.updateTime)):s.exists!==void 0?ae.exists(s.exists):ae.none()}(e.currentDocument):ae.none(),i=e.updateTransforms?e.updateTransforms.map(s=>function(r,o){let a=null;if("setToServerValue"in o)A(o.setToServerValue==="REQUEST_TIME"),a=new lr;else if("appendMissingElements"in o){const l=o.appendMissingElements.values||[];a=new cs(l)}else if("removeAllFromArray"in o){const l=o.removeAllFromArray.values||[];a=new ls(l)}else"increment"in o?a=new ur(r,o.increment):C();const c=ye.fromServerFormat(o.fieldPath);return new xa(c,a)}(n,s)):[];if(e.update){e.update.name;const s=ln(n,e.update.name),r=new Ke({mapValue:{fields:e.update.fields}});if(e.updateMask){const o=function(a){const c=a.fieldPaths||[];return new vt(c.map(l=>ye.fromServerFormat(l)))}(e.updateMask);return new Vn(s,r,o,t,i)}return new Nr(s,r,t,i)}if(e.delete){const s=ln(n,e.delete);return new Dr(s,t)}if(e.verify){const s=ln(n,e.verify);return new Mp(s,t)}return C()}function CF(n,e){return n&&n.length>0?(A(e!==void 0),n.map(t=>function(i,s){let r=i.updateTime?ve(i.updateTime):ve(s);return r.isEqual(R.min())&&(r=ve(s)),new uF(r,i.transformResults||[])}(t,e))):[]}function db(n,e){return{documents:[Nd(n,e.path)]}}function fb(n,e){const t={structuredQuery:{}},i=e.path;e.collectionGroup!==null?(t.parent=Nd(n,i),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Nd(n,i.popLast()),t.structuredQuery.from=[{collectionId:i.lastSegment()}]);const s=function(c){if(c.length!==0)return mb(Y.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);const r=function(c){if(c.length!==0)return c.map(l=>function(u){return{field:xs(u.field),direction:AF(u.dir)}}(l))}(e.orderBy);r&&(t.structuredQuery.orderBy=r);const o=function(c,l){return c.wt||Ra(l)?l:{value:l}}(n,e.limit);var a;return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),t}function pb(n){let e=lb(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let s=null;if(i>0){A(i===1);const u=t.from[0];u.allDescendants?s=u.collectionId:e=e.child(u.collectionId)}let r=[];t.where&&(r=function(u){const h=gb(u);return h instanceof Y&&Pp(h)?h.getFilters():[h]}(t.where));let o=[];t.orderBy&&(o=t.orderBy.map(u=>function(h){return new js(Os(h.field),function(d){switch(d){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(h.direction))}(u)));let a=null;t.limit&&(a=function(u){let h;return h=typeof u=="object"?u.value:u,Ra(h)?null:h}(t.limit));let c=null;t.startAt&&(c=function(u){const h=!!u.before,d=u.values||[];return new fi(d,h)}(t.startAt));let l=null;return t.endAt&&(l=function(u){const h=!u.before,d=u.values||[];return new fi(d,h)}(t.endAt)),BE(e,s,o,r,a,"F",c,l)}function kF(n,e){const t=function(i,s){switch(s){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return C()}}(0,e.purpose);return t==null?null:{"goog-listen-tags":t}}function gb(n){return n.unaryFilter!==void 0?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Os(e.unaryFilter.field);return q.create(t,"==",{doubleValue:NaN});case"IS_NULL":const i=Os(e.unaryFilter.field);return q.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Os(e.unaryFilter.field);return q.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Os(e.unaryFilter.field);return q.create(r,"!=",{nullValue:"NULL_VALUE"});default:return C()}}(n):n.fieldFilter!==void 0?function(e){return q.create(Os(e.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return C()}}(e.fieldFilter.op),e.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(e){return Y.create(e.compositeFilter.filters.map(t=>gb(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return C()}}(e.compositeFilter.op))}(n):C()}function AF(n){return vF[n]}function RF(n){return wF[n]}function NF(n){return IF[n]}function xs(n){return{fieldPath:n.canonicalString()}}function Os(n){return ye.fromServerFormat(n.fieldPath)}function mb(n){return n instanceof q?function(e){if(e.op==="=="){if(A_(e.value))return{unaryFilter:{field:xs(e.field),op:"IS_NAN"}};if(k_(e.value))return{unaryFilter:{field:xs(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(A_(e.value))return{unaryFilter:{field:xs(e.field),op:"IS_NOT_NAN"}};if(k_(e.value))return{unaryFilter:{field:xs(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:xs(e.field),op:RF(e.op),value:e.value}}}(n):n instanceof Y?function(e){const t=e.getFilters().map(i=>mb(i));return t.length===1?t[0]:{compositeFilter:{op:NF(e.op),filters:t}}}(n):C()}function DF(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function _b(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=j_(e)),e=PF(n.get(t),e);return j_(e)}function PF(n,e){let t=e;const i=n.length;for(let s=0;s<i;s++){const r=n.charAt(s);switch(r){case"\0":t+="";break;case"":t+="";break;default:t+=r}}return t}function j_(n){return n+""}function on(n){const e=n.length;if(A(e>=2),e===2)return A(n.charAt(0)===""&&n.charAt(1)===""),K.emptyPath();const t=e-2,i=[];let s="";for(let r=0;r<e;){const o=n.indexOf("",r);switch((o<0||o>t)&&C(),n.charAt(o+1)){case"":const a=n.substring(r,o);let c;s.length===0?c=a:(s+=a,c=s,s=""),i.push(c);break;case"":s+=n.substring(r,o),s+="\0";break;case"":s+=n.substring(r,o+1);break;default:C()}r=o+2}return new K(i)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const G_=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gc(n,e){return[n,dt(e)]}function yb(n,e,t){return[n,dt(e),t]}const xF={},OF=["prefixPath","collectionGroup","readTime","documentId"],MF=["prefixPath","collectionGroup","documentId"],LF=["collectionGroup","readTime","prefixPath","documentId"],FF=["canonicalId","targetId"],UF=["targetId","path"],VF=["path","targetId"],$F=["collectionId","parent"],BF=["indexId","uid"],qF=["uid","sequenceNumber"],WF=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],KF=["indexId","uid","orderedDocumentKey"],jF=["userId","collectionPath","documentId"],GF=["userId","collectionPath","largestBatchId"],HF=["userId","collectionGroup","largestBatchId"],vb=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],zF=[...vb,"documentOverlays"],wb=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Ib=wb,QF=[...Ib,"indexConfiguration","indexState","indexEntries"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pd extends AE{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function Be(n,e){const t=S(n);return Ht.M(t.se,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fp{constructor(e,t,i,s){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=s}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let s=0;s<this.mutations.length;s++){const r=this.mutations[s];r.key.isEqual(e.key)&&hF(r,e,i[s])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=go(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=go(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=sb();return this.mutations.forEach(s=>{const r=e.get(s.key),o=r.overlayedDocument;let a=this.applyToLocalView(o,r.mutatedFields);a=t.has(s.key)?null:a;const c=JE(o,a);c!==null&&i.set(s.key,c),o.isValidDocument()||o.convertToNoDocument(R.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),F())}isEqual(e){return this.batchId===e.batchId&&or(this.mutations,e.mutations,(t,i)=>U_(t,i))&&or(this.baseMutations,e.baseMutations,(t,i)=>U_(t,i))}}class Up{constructor(e,t,i,s){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=s}static from(e,t,i){A(e.mutations.length===i.length);let s=gF;const r=e.mutations;for(let o=0;o<r.length;o++)s=s.insert(r[o].key,i[o].version);return new Up(e,t,i,s)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vp{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ti{constructor(e,t,i,s,r=R.min(),o=R.min(),a=be.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a}withSequenceNumber(e){return new ti(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new ti(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new ti(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tb{constructor(e){this.ie=e}}function YF(n,e){let t;if(e.document)t=hb(n.ie,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const i=b.fromSegments(e.noDocument.path),s=hs(e.noDocument.readTime);t=ne.newNoDocument(i,s),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return C();{const i=b.fromSegments(e.unknownDocument.path),s=hs(e.unknownDocument.version);t=ne.newUnknownDocument(i,s)}}return e.readTime&&t.setReadTime(function(i){const s=new ce(i[0],i[1]);return R.fromTimestamp(s)}(e.readTime)),t}function H_(n,e){const t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:el(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document=function(s,r){return{name:zo(s,r.key),fields:r.data.value.mapValue.fields,updateTime:hr(s,r.version.toTimestamp()),createTime:hr(s,r.createTime.toTimestamp())}}(n.ie,e);else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:us(e.version)};else{if(!e.isUnknownDocument())return C();i.unknownDocument={path:t.path.toArray(),version:us(e.version)}}return i}function el(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function us(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function hs(n){const e=new ce(n.seconds,n.nanoseconds);return R.fromTimestamp(e)}function Pi(n,e){const t=(e.baseMutations||[]).map(r=>Dd(n.ie,r));for(let r=0;r<e.mutations.length-1;++r){const o=e.mutations[r];if(r+1<e.mutations.length&&e.mutations[r+1].transform!==void 0){const a=e.mutations[r+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(r+1,1),++r}}const i=e.mutations.map(r=>Dd(n.ie,r)),s=ce.fromMillis(e.localWriteTimeMs);return new Fp(e.batchId,s,t,i)}function io(n){const e=hs(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?hs(n.lastLimboFreeSnapshotVersion):R.min();let i;var s;return n.query.documents!==void 0?(A((s=n.query).documents.length===1),i=It(Rr(lb(s.documents[0])))):i=function(r){return It(pb(r))}(n.query),new ti(i,n.targetId,0,n.lastListenSequenceNumber,e,t,be.fromBase64String(n.resumeToken))}function Eb(n,e){const t=us(e.snapshotVersion),i=us(e.lastLimboFreeSnapshotVersion);let s;s=Xc(e.target)?db(n.ie,e.target):fb(n.ie,e.target);const r=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:as(e.target),readTime:t,resumeToken:r,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:s}}function $p(n){const e=pb({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Zc(e,e.limit,"L"):e}function dh(n,e){return new Vp(e.largestBatchId,Dd(n.ie,e.overlayMutation))}function z_(n,e){const t=e.path.lastSegment();return[n,dt(e.path.popLast()),t]}function Q_(n,e,t,i){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:us(i.readTime),documentKey:dt(i.documentKey.path),largestBatchId:i.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class XF{getBundleMetadata(e,t){return Y_(e).get(t).next(i=>{if(i)return{id:(s=i).bundleId,createTime:hs(s.createTime),version:s.version};var s})}saveBundleMetadata(e,t){return Y_(e).put({bundleId:(i=t).id,createTime:us(ve(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return X_(e).get(t).next(i=>{if(i)return{name:(s=i).name,query:$p(s.bundledQuery),readTime:hs(s.readTime)};var s})}saveNamedQuery(e,t){return X_(e).put(function(i){return{name:i.name,readTime:us(ve(i.readTime)),bundledQuery:i.bundledQuery}}(t))}}function Y_(n){return Be(n,"bundles")}function X_(n){return Be(n,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wu{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){const i=t.uid||"";return new wu(e,i)}getOverlay(e,t){return jr(e).get(z_(this.userId,t)).next(i=>i?dh(this.yt,i):null)}getOverlays(e,t){const i=rn();return g.forEach(t,s=>this.getOverlay(e,s).next(r=>{r!==null&&i.set(s,r)})).next(()=>i)}saveOverlays(e,t,i){const s=[];return i.forEach((r,o)=>{const a=new Vp(t,o);s.push(this.oe(e,a))}),g.waitFor(s)}removeOverlaysForBatchId(e,t,i){const s=new Set;t.forEach(o=>s.add(dt(o.getCollectionPath())));const r=[];return s.forEach(o=>{const a=IDBKeyRange.bound([this.userId,o,i],[this.userId,o,i+1],!1,!0);r.push(jr(e).Y("collectionPathOverlayIndex",a))}),g.waitFor(r)}getOverlaysForCollection(e,t,i){const s=rn(),r=dt(t),o=IDBKeyRange.bound([this.userId,r,i],[this.userId,r,Number.POSITIVE_INFINITY],!0);return jr(e).W("collectionPathOverlayIndex",o).next(a=>{for(const c of a){const l=dh(this.yt,c);s.set(l.getKey(),l)}return s})}getOverlaysForCollectionGroup(e,t,i,s){const r=rn();let o;const a=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return jr(e).Z({index:"collectionGroupOverlayIndex",range:a},(c,l,u)=>{const h=dh(this.yt,l);r.size()<s||h.largestBatchId===o?(r.set(h.getKey(),h),o=h.largestBatchId):u.done()}).next(()=>r)}oe(e,t){return jr(e).put(function(i,s,r){const[o,a,c]=z_(s,r.mutation.key);return{userId:s,collectionPath:a,documentId:c,collectionGroup:r.mutation.key.getCollectionGroup(),largestBatchId:r.largestBatchId,overlayMutation:Yo(i.ie,r.mutation)}}(this.yt,this.userId,t))}}function jr(n){return Be(n,"documentOverlays")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(de(e.integerValue));else if("doubleValue"in e){const i=de(e.doubleValue);isNaN(i)?this.he(t,13):(this.he(t,15),Ko(i)?t.le(0):t.le(i))}else if("timestampValue"in e){const i=e.timestampValue;this.he(t,20),typeof i=="string"?t.fe(i):(t.fe(`${i.seconds||""}`),t.le(i.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(ss(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const i=e.geoPointValue;this.he(t,45),t.le(i.latitude||0),t.le(i.longitude||0)}else"mapValue"in e?PE(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):C()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const i=e.fields||{};this.he(t,55);for(const s of Object.keys(i))this.de(s,t),this.ce(i[s],t)}ye(e,t){const i=e.values||[];this.he(t,50);for(const s of i)this.ce(s,t)}me(e,t){this.he(t,37),b.fromName(e).path.forEach(i=>{this.he(t,60),this.pe(i,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}xi.Ie=new xi;function JF(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function J_(n){const e=64-function(t){let i=0;for(let s=0;s<8;++s){const r=JF(255&t[s]);if(i+=r,r!==8)break}return i}(n);return Math.ceil(e/8)}class ZF{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.Ee(i.value),i=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.be(i.value),i=t.next();this.Pe()}ve(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.Ee(i);else if(i<2048)this.Ee(960|i>>>6),this.Ee(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.Ee(480|i>>>12),this.Ee(128|63&i>>>6),this.Ee(128|63&i);else{const s=t.codePointAt(0);this.Ee(240|s>>>18),this.Ee(128|63&s>>>12),this.Ee(128|63&s>>>6),this.Ee(128|63&s)}}this.Ae()}Ve(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.be(i);else if(i<2048)this.be(960|i>>>6),this.be(128|63&i);else if(t<"\uD800"||"\uDBFF"<t)this.be(480|i>>>12),this.be(128|63&i>>>6),this.be(128|63&i);else{const s=t.codePointAt(0);this.be(240|s>>>18),this.be(128|63&s>>>12),this.be(128|63&s>>>6),this.be(128|63&s)}}this.Pe()}Se(e){const t=this.De(e),i=J_(t);this.Ce(1+i),this.buffer[this.position++]=255&i;for(let s=t.length-i;s<t.length;++s)this.buffer[this.position++]=255&t[s]}xe(e){const t=this.De(e),i=J_(t);this.Ce(1+i),this.buffer[this.position++]=~(255&i);for(let s=t.length-i;s<t.length;++s)this.buffer[this.position++]=~(255&t[s])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(s){const r=new DataView(new ArrayBuffer(8));return r.setFloat64(0,s,!1),new Uint8Array(r.buffer)}(e),i=(128&t[0])!=0;t[0]^=i?255:128;for(let s=1;s<t.length;++s)t[s]^=i?255:0;return t}Ee(e){const t=255&e;t===0?(this.ke(0),this.ke(255)):t===255?(this.ke(255),this.ke(0)):this.ke(t)}be(e){const t=255&e;t===0?(this.Me(0),this.Me(255)):t===255?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){const t=e+this.position;if(t<=this.buffer.length)return;let i=2*this.buffer.length;i<t&&(i=t);const s=new Uint8Array(i);s.set(this.buffer),this.buffer=s}}class eU{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class tU{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class Gr{constructor(){this.$e=new ZF,this.Be=new eU(this.$e),this.Le=new tU(this.$e)}seed(e){this.$e.seed(e)}qe(e){return e===0?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(e,t,i,s){this.indexId=e,this.documentKey=t,this.arrayValue=i,this.directionalValue=s}Ue(){const e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,i=new Uint8Array(t);return i.set(this.directionalValue,0),t!==e?i.set([0],this.directionalValue.length):++i[i.length-1],new Oi(this.indexId,this.documentKey,this.arrayValue,i)}}function Wn(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Z_(n.arrayValue,e.arrayValue),t!==0?t:(t=Z_(n.directionalValue,e.directionalValue),t!==0?t:b.comparator(n.documentKey,e.documentKey)))}function Z_(n,e){for(let t=0;t<n.length&&t<e.length;++t){const i=n[t]-e[t];if(i!==0)return i}return n.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nU{constructor(e){this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const i=t;i.isInequality()?this.Qe=i:this.Ge.push(i)}}je(e){A(e.collectionGroup===this.collectionId);const t=Td(e);if(t!==void 0&&!this.We(t))return!1;const i=Ri(e);let s=0,r=0;for(;s<i.length&&this.We(i[s]);++s);if(s===i.length)return!0;if(this.Qe!==void 0){const o=i[s];if(!this.ze(this.Qe,o)||!this.He(this.Ke[r++],o))return!1;++s}for(;s<i.length;++s){const o=i[s];if(r>=this.Ke.length||!this.He(this.Ke[r++],o))return!1}return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;const i=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===i}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bb(n){var e,t;if(A(n instanceof q||n instanceof Y),n instanceof q){if(n instanceof VE){const s=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(r=>q.create(n.field,"==",r)))||[];return Y.create(s,"or")}return n}const i=n.filters.map(s=>bb(s));return Y.create(i,n.op)}function iU(n){if(n.getFilters().length===0)return[];const e=Md(bb(n));return A(Sb(e)),xd(e)||Od(e)?[e]:e.getFilters()}function xd(n){return n instanceof q}function Od(n){return n instanceof Y&&Pp(n)}function Sb(n){return xd(n)||Od(n)||function(e){if(e instanceof Y&&Sd(e)){for(const t of e.getFilters())if(!xd(t)&&!Od(t))return!1;return!0}return!1}(n)}function Md(n){if(A(n instanceof q||n instanceof Y),n instanceof q)return n;if(n.filters.length===1)return Md(n.filters[0]);const e=n.filters.map(i=>Md(i));let t=Y.create(e,n.op);return t=tl(t),Sb(t)?t:(A(t instanceof Y),A(cr(t)),A(t.filters.length>1),t.filters.reduce((i,s)=>Bp(i,s)))}function Bp(n,e){let t;return A(n instanceof q||n instanceof Y),A(e instanceof q||e instanceof Y),t=n instanceof q?e instanceof q?function(i,s){return Y.create([i,s],"and")}(n,e):ey(n,e):e instanceof q?ey(e,n):function(i,s){if(A(i.filters.length>0&&s.filters.length>0),cr(i)&&cr(s))return LE(i,s.getFilters());const r=Sd(i)?i:s,o=Sd(i)?s:i,a=r.filters.map(c=>Bp(c,o));return Y.create(a,"or")}(n,e),tl(t)}function ey(n,e){if(cr(e))return LE(e,n.getFilters());{const t=e.filters.map(i=>Bp(n,i));return Y.create(t,"or")}}function tl(n){if(A(n instanceof q||n instanceof Y),n instanceof q)return n;const e=n.getFilters();if(e.length===1)return tl(e[0]);if(OE(n))return n;const t=e.map(s=>tl(s)),i=[];return t.forEach(s=>{s instanceof q?i.push(s):s instanceof Y&&(s.op===n.op?i.push(...s.filters):i.push(s))}),i.length===1?i[0]:Y.create(i,n.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sU{constructor(){this.Je=new qp}addToCollectionParentIndex(e,t){return this.Je.add(t),g.resolve()}getCollectionParents(e,t){return g.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return g.resolve()}deleteFieldIndex(e,t){return g.resolve()}getDocumentsMatchingTarget(e,t){return g.resolve(null)}getIndexType(e,t){return g.resolve(0)}getFieldIndexes(e,t){return g.resolve([])}getNextCollectionGroupToUpdate(e){return g.resolve(null)}getMinOffset(e,t){return g.resolve(Pt.min())}getMinOffsetFromCollectionGroup(e,t){return g.resolve(Pt.min())}updateCollectionGroup(e,t,i){return g.resolve()}updateIndexEntries(e,t){return g.resolve()}}class qp{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t]||new J(K.comparator),r=!s.has(i);return this.index[t]=s.add(i),r}has(e){const t=e.lastSegment(),i=e.popLast(),s=this.index[t];return s&&s.has(i)}getEntries(e){return(this.index[e]||new J(K.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Za=new Uint8Array(0);class rU{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new qp,this.Xe=new Ei(i=>as(i),(i,s)=>Na(i,s)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){const i=t.lastSegment(),s=t.popLast();e.addOnCommittedListener(()=>{this.Ye.add(t)});const r={collectionId:i,parent:dt(s)};return ty(e).put(r)}return g.resolve()}getCollectionParents(e,t){const i=[],s=IDBKeyRange.bound([t,""],[EE(t),""],!1,!0);return ty(e).W(s).next(r=>{for(const o of r){if(o.collectionId!==t)break;i.push(on(o.parent))}return i})}addFieldIndex(e,t){const i=ec(e),s=function(o){return{indexId:o.indexId,collectionGroup:o.collectionGroup,fields:o.fields.map(a=>[a.fieldPath.canonicalString(),a.kind])}}(t);delete s.indexId;const r=i.add(s);if(t.indexState){const o=zr(e);return r.next(a=>{o.put(Q_(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return r.next()}deleteFieldIndex(e,t){const i=ec(e),s=zr(e),r=Hr(e);return i.delete(t.indexId).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const i=Hr(e);let s=!0;const r=new Map;return g.forEach(this.Ze(t),o=>this.tn(e,o).next(a=>{s&&(s=!!a),r.set(o,a)})).next(()=>{if(s){let o=F();const a=[];return g.forEach(r,(c,l)=>{var u;I("IndexedDbIndexManager",`Using index ${u=c,`id=${u.indexId}|cg=${u.collectionGroup}|f=${u.fields.map(x=>`${x.fieldPath}:${x.kind}`).join(",")}`} to execute ${as(t)}`);const h=function(x,U){const Q=Td(U);if(Q===void 0)return null;for(const G of Jc(x,Q.fieldPath))switch(G.op){case"array-contains-any":return G.value.arrayValue.values||[];case"array-contains":return[G.value]}return null}(l,c),d=function(x,U){const Q=new Map;for(const G of Ri(U))for(const me of Jc(x,G.fieldPath))switch(me.op){case"==":case"in":Q.set(G.fieldPath.canonicalString(),me.value);break;case"not-in":case"!=":return Q.set(G.fieldPath.canonicalString(),me.value),Array.from(Q.values())}return null}(l,c),f=function(x,U){const Q=[];let G=!0;for(const me of Ri(U)){const Et=me.kind===0?O_(x,me.fieldPath,x.startAt):M_(x,me.fieldPath,x.startAt);Q.push(Et.value),G&&(G=Et.inclusive)}return new fi(Q,G)}(l,c),p=function(x,U){const Q=[];let G=!0;for(const me of Ri(U)){const Et=me.kind===0?M_(x,me.fieldPath,x.endAt):O_(x,me.fieldPath,x.endAt);Q.push(Et.value),G&&(G=Et.inclusive)}return new fi(Q,G)}(l,c),_=this.en(c,l,f),w=this.en(c,l,p),N=this.nn(c,l,d),M=this.sn(c.indexId,h,_,f.inclusive,w,p.inclusive,N);return g.forEach(M,x=>i.J(x,t.limit).next(U=>{U.forEach(Q=>{const G=b.fromSegments(Q.documentKey);o.has(G)||(o=o.add(G),a.push(G))})}))}).next(()=>a)}return g.resolve(null)})}Ze(e){let t=this.Xe.get(e);return t||(e.filters.length===0?t=[e]:t=iU(Y.create(e.filters,"and")).map(i=>kd(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.Xe.set(e,t),t)}sn(e,t,i,s,r,o,a){const c=(t!=null?t.length:1)*Math.max(i.length,r.length),l=c/(t!=null?t.length:1),u=[];for(let h=0;h<c;++h){const d=t?this.rn(t[h/l]):Za,f=this.on(e,d,i[h%l],s),p=this.un(e,d,r[h%l],o),_=a.map(w=>this.on(e,d,w,!0));u.push(...this.createRange(f,p,_))}return u}on(e,t,i,s){const r=new Oi(e,b.empty(),t,i);return s?r:r.Ue()}un(e,t,i,s){const r=new Oi(e,b.empty(),t,i);return s?r.Ue():r}tn(e,t){const i=new nU(t),s=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,s).next(r=>{let o=null;for(const a of r)i.je(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let i=2;const s=this.Ze(t);return g.forEach(s,r=>this.tn(e,r).next(o=>{o?i!==0&&o.fields.length<function(a){let c=new J(ye.comparator),l=!1;for(const u of a.filters)for(const h of u.getFlattenedFilters())h.field.isKeyField()||(h.op==="array-contains"||h.op==="array-contains-any"?l=!0:c=c.add(h.field));for(const u of a.orderBy)u.field.isKeyField()||(c=c.add(u.field));return c.size+(l?1:0)}(r)&&(i=1):i=0})).next(()=>function(r){return r.limit!==null}(t)&&s.length>1&&i===2?1:i)}cn(e,t){const i=new Gr;for(const s of Ri(e)){const r=t.data.field(s.fieldPath);if(r==null)return null;const o=i.qe(s.kind);xi.Ie.ue(r,o)}return i.Fe()}rn(e){const t=new Gr;return xi.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const i=new Gr;return xi.Ie.ue(os(this.databaseId,t),i.qe(function(s){const r=Ri(s);return r.length===0?0:r[r.length-1].kind}(e))),i.Fe()}nn(e,t,i){if(i===null)return[];let s=[];s.push(new Gr);let r=0;for(const o of Ri(e)){const a=i[r++];for(const c of s)if(this.hn(t,o.fieldPath)&&Ho(a))s=this.ln(s,o,a);else{const l=c.qe(o.kind);xi.Ie.ue(a,l)}}return this.fn(s)}en(e,t,i){return this.nn(e,t,i.position)}fn(e){const t=[];for(let i=0;i<e.length;++i)t[i]=e[i].Fe();return t}ln(e,t,i){const s=[...e],r=[];for(const o of i.arrayValue.values||[])for(const a of s){const c=new Gr;c.seed(a.Fe()),xi.Ie.ue(o,c.qe(t.kind)),r.push(c)}return r}hn(e,t){return!!e.filters.find(i=>i instanceof q&&i.field.isEqual(t)&&(i.op==="in"||i.op==="not-in"))}getFieldIndexes(e,t){const i=ec(e),s=zr(e);return(t?i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):i.W()).next(r=>{const o=[];return g.forEach(r,a=>s.get([a.indexId,this.uid]).next(c=>{o.push(function(l,u){const h=u?new Yc(u.sequenceNumber,new Pt(hs(u.readTime),new b(on(u.documentKey)),u.largestBatchId)):Yc.empty(),d=l.fields.map(([f,p])=>new q1(ye.fromServerFormat(f),p));return new bE(l.indexId,l.collectionGroup,d,h)}(a,c))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((i,s)=>{const r=i.indexState.sequenceNumber-s.indexState.sequenceNumber;return r!==0?r:L(i.collectionGroup,s.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){const s=ec(e),r=zr(e);return this.dn(e).next(o=>s.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>g.forEach(a,c=>r.put(Q_(c.indexId,this.user,o,i)))))}updateIndexEntries(e,t){const i=new Map;return g.forEach(t,(s,r)=>{const o=i.get(s.collectionGroup);return(o?g.resolve(o):this.getFieldIndexes(e,s.collectionGroup)).next(a=>(i.set(s.collectionGroup,a),g.forEach(a,c=>this._n(e,s,c).next(l=>{const u=this.wn(r,c);return l.isEqual(u)?g.resolve():this.mn(e,r,c,l,u)}))))})}gn(e,t,i,s){return Hr(e).put({indexId:s.indexId,uid:this.uid,arrayValue:s.arrayValue,directionalValue:s.directionalValue,orderedDocumentKey:this.an(i,t.key),documentKey:t.key.path.toArray()})}yn(e,t,i,s){return Hr(e).delete([s.indexId,this.uid,s.arrayValue,s.directionalValue,this.an(i,t.key),t.key.path.toArray()])}_n(e,t,i){const s=Hr(e);let r=new J(Wn);return s.Z({index:"documentKeyIndex",range:IDBKeyRange.only([i.indexId,this.uid,this.an(i,t)])},(o,a)=>{r=r.add(new Oi(i.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>r)}wn(e,t){let i=new J(Wn);const s=this.cn(t,e);if(s==null)return i;const r=Td(t);if(r!=null){const o=e.data.field(r.fieldPath);if(Ho(o))for(const a of o.arrayValue.values||[])i=i.add(new Oi(t.indexId,e.key,this.rn(a),s))}else i=i.add(new Oi(t.indexId,e.key,Za,s));return i}mn(e,t,i,s,r){I("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const o=[];return function(a,c,l,u,h){const d=a.getIterator(),f=c.getIterator();let p=Ns(d),_=Ns(f);for(;p||_;){let w=!1,N=!1;if(p&&_){const M=l(p,_);M<0?N=!0:M>0&&(w=!0)}else p!=null?N=!0:w=!0;w?(u(_),_=Ns(f)):N?(h(p),p=Ns(d)):(p=Ns(d),_=Ns(f))}}(s,r,Wn,a=>{o.push(this.gn(e,t,i,a))},a=>{o.push(this.yn(e,t,i,a))}),g.waitFor(o)}dn(e){let t=1;return zr(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,r)=>{r.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((o,a)=>Wn(o,a)).filter((o,a,c)=>!a||Wn(o,c[a-1])!==0);const s=[];s.push(e);for(const o of i){const a=Wn(o,e),c=Wn(o,t);if(a===0)s[0]=e.Ue();else if(a>0&&c<0)s.push(o),s.push(o.Ue());else if(c>0)break}s.push(t);const r=[];for(let o=0;o<s.length;o+=2){if(this.pn(s[o],s[o+1]))return[];const a=[s[o].indexId,this.uid,s[o].arrayValue,s[o].directionalValue,Za,[]],c=[s[o+1].indexId,this.uid,s[o+1].arrayValue,s[o+1].directionalValue,Za,[]];r.push(IDBKeyRange.bound(a,c))}return r}pn(e,t){return Wn(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(ny)}getMinOffset(e,t){return g.mapArray(this.Ze(t),i=>this.tn(e,i).next(s=>s||C())).next(ny)}}function ty(n){return Be(n,"collectionParents")}function Hr(n){return Be(n,"indexEntries")}function ec(n){return Be(n,"indexConfiguration")}function zr(n){return Be(n,"indexState")}function ny(n){A(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){const s=n[i].indexState.offset;Rp(s,e)<0&&(e=s),t<s.largestBatchId&&(t=s.largestBatchId)}return new Pt(e.readTime,e.documentKey,t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iy={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class gt{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new gt(e,gt.DEFAULT_COLLECTION_PERCENTILE,gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cb(n,e,t){const i=n.store("mutations"),s=n.store("documentMutations"),r=[],o=IDBKeyRange.only(t.batchId);let a=0;const c=i.Z({range:o},(u,h,d)=>(a++,d.delete()));r.push(c.next(()=>{A(a===1)}));const l=[];for(const u of t.mutations){const h=yb(e,u.key.path,t.batchId);r.push(s.delete(h)),l.push(u.key)}return g.waitFor(r).next(()=>l)}function nl(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw C();e=n.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */gt.DEFAULT_COLLECTION_PERCENTILE=10,gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,gt.DEFAULT=new gt(41943040,gt.DEFAULT_COLLECTION_PERCENTILE,gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),gt.DISABLED=new gt(-1,0,0);class Iu{constructor(e,t,i,s){this.userId=e,this.yt=t,this.indexManager=i,this.referenceDelegate=s,this.In={}}static re(e,t,i,s){A(e.uid!=="");const r=e.isAuthenticated()?e.uid:"";return new Iu(r,t,i,s)}checkEmpty(e){let t=!0;const i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Kn(e).Z({index:"userMutationsIndex",range:i},(s,r,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,i,s){const r=Ms(e),o=Kn(e);return o.add({}).next(a=>{A(typeof a=="number");const c=new Fp(a,t,i,s),l=function(d,f,p){const _=p.baseMutations.map(N=>Yo(d.ie,N)),w=p.mutations.map(N=>Yo(d.ie,N));return{userId:f,batchId:p.batchId,localWriteTimeMs:p.localWriteTime.toMillis(),baseMutations:_,mutations:w}}(this.yt,this.userId,c),u=[];let h=new J((d,f)=>L(d.canonicalString(),f.canonicalString()));for(const d of s){const f=yb(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),u.push(o.put(l)),u.push(r.put(f,xF))}return h.forEach(d=>{u.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.In[a]=c.keys()}),g.waitFor(u).next(()=>c)})}lookupMutationBatch(e,t){return Kn(e).get(t).next(i=>i?(A(i.userId===this.userId),Pi(this.yt,i)):null)}Tn(e,t){return this.In[t]?g.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){const s=i.keys();return this.In[t]=s,s}return null})}getNextMutationBatchAfterBatchId(e,t){const i=t+1,s=IDBKeyRange.lowerBound([this.userId,i]);let r=null;return Kn(e).Z({index:"userMutationsIndex",range:s},(o,a,c)=>{a.userId===this.userId&&(A(a.batchId>=i),r=Pi(this.yt,a)),c.done()}).next(()=>r)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let i=-1;return Kn(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(s,r,o)=>{i=r.batchId,o.done()}).next(()=>i)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Kn(e).W("userMutationsIndex",t).next(i=>i.map(s=>Pi(this.yt,s)))}getAllMutationBatchesAffectingDocumentKey(e,t){const i=gc(this.userId,t.path),s=IDBKeyRange.lowerBound(i),r=[];return Ms(e).Z({range:s},(o,a,c)=>{const[l,u,h]=o,d=on(u);if(l===this.userId&&t.path.isEqual(d))return Kn(e).get(h).next(f=>{if(!f)throw C();A(f.userId===this.userId),r.push(Pi(this.yt,f))});c.done()}).next(()=>r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new J(L);const s=[];return t.forEach(r=>{const o=gc(this.userId,r.path),a=IDBKeyRange.lowerBound(o),c=Ms(e).Z({range:a},(l,u,h)=>{const[d,f,p]=l,_=on(f);d===this.userId&&r.path.isEqual(_)?i=i.add(p):h.done()});s.push(c)}),g.waitFor(s).next(()=>this.En(e,i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,s=i.length+1,r=gc(this.userId,i),o=IDBKeyRange.lowerBound(r);let a=new J(L);return Ms(e).Z({range:o},(c,l,u)=>{const[h,d,f]=c,p=on(d);h===this.userId&&i.isPrefixOf(p)?p.length===s&&(a=a.add(f)):u.done()}).next(()=>this.En(e,a))}En(e,t){const i=[],s=[];return t.forEach(r=>{s.push(Kn(e).get(r).next(o=>{if(o===null)throw C();A(o.userId===this.userId),i.push(Pi(this.yt,o))}))}),g.waitFor(s).next(()=>i)}removeMutationBatch(e,t){return Cb(e.se,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),g.forEach(i,s=>this.referenceDelegate.markPotentiallyOrphaned(e,s))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return g.resolve();const i=IDBKeyRange.lowerBound([this.userId]),s=[];return Ms(e).Z({range:i},(r,o,a)=>{if(r[0]===this.userId){const c=on(r[1]);s.push(c)}else a.done()}).next(()=>{A(s.length===0)})})}containsKey(e,t){return kb(e,this.userId,t)}Rn(e){return Ab(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function kb(n,e,t){const i=gc(e,t.path),s=i[1],r=IDBKeyRange.lowerBound(i);let o=!1;return Ms(n).Z({range:r,X:!0},(a,c,l)=>{const[u,h,d]=a;u===e&&h===s&&(o=!0),l.done()}).next(()=>o)}function Kn(n){return Be(n,"mutations")}function Ms(n){return Be(n,"documentMutations")}function Ab(n){return Be(n,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ds{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new ds(0)}static vn(){return new ds(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oU{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next(t=>{const i=new ds(t.highestTargetId);return t.highestTargetId=i.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(t=>R.fromTimestamp(new ce(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.Vn(e).next(s=>(s.highestListenSequenceNumber=t,i&&(s.lastRemoteSnapshotVersion=i.toTimestamp()),t>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=t),this.Sn(e,s)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(i=>(i.targetCount+=1,this.Cn(t,i),this.Sn(e,i))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Ds(e).delete(t.targetId)).next(()=>this.Vn(e)).next(i=>(A(i.targetCount>0),i.targetCount-=1,this.Sn(e,i)))}removeTargets(e,t,i){let s=0;const r=[];return Ds(e).Z((o,a)=>{const c=io(a);c.sequenceNumber<=t&&i.get(c.targetId)===null&&(s++,r.push(this.removeTargetData(e,c)))}).next(()=>g.waitFor(r)).next(()=>s)}forEachTarget(e,t){return Ds(e).Z((i,s)=>{const r=io(s);t(r)})}Vn(e){return sy(e).get("targetGlobalKey").next(t=>(A(t!==null),t))}Sn(e,t){return sy(e).put("targetGlobalKey",t)}Dn(e,t){return Ds(e).put(Eb(this.yt,t))}Cn(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.Vn(e).next(t=>t.targetCount)}getTargetData(e,t){const i=as(t),s=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]);let r=null;return Ds(e).Z({range:s,index:"queryTargetsIndex"},(o,a,c)=>{const l=io(a);Na(t,l.target)&&(r=l,c.done())}).next(()=>r)}addMatchingKeys(e,t,i){const s=[],r=Gn(e);return t.forEach(o=>{const a=dt(o.path);s.push(r.put({targetId:i,path:a})),s.push(this.referenceDelegate.addReference(e,i,o))}),g.waitFor(s)}removeMatchingKeys(e,t,i){const s=Gn(e);return g.forEach(t,r=>{const o=dt(r.path);return g.waitFor([s.delete([i,o]),this.referenceDelegate.removeReference(e,i,r)])})}removeMatchingKeysForTargetId(e,t){const i=Gn(e),s=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(s)}getMatchingKeysForTargetId(e,t){const i=IDBKeyRange.bound([t],[t+1],!1,!0),s=Gn(e);let r=F();return s.Z({range:i,X:!0},(o,a,c)=>{const l=on(o[1]),u=new b(l);r=r.add(u)}).next(()=>r)}containsKey(e,t){const i=dt(t.path),s=IDBKeyRange.bound([i],[EE(i)],!1,!0);let r=0;return Gn(e).Z({index:"documentTargetsIndex",X:!0,range:s},([o,a],c,l)=>{o!==0&&(r++,l.done())}).next(()=>r>0)}ne(e,t){return Ds(e).get(t).next(i=>i?io(i):null)}}function Ds(n){return Be(n,"targets")}function sy(n){return Be(n,"targetGlobal")}function Gn(n){return Be(n,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ry([n,e],[t,i]){const s=L(n,t);return s===0?L(e,i):s}class aU{constructor(e){this.xn=e,this.buffer=new J(ry),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();ry(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class cU{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Mn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return this.Mn!==null}Fn(e){I("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Mn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ti(t)?I("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Ii(t)}await this.Fn(3e5)})}}class lU{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(t===0)return g.resolve(yt.at);const i=new aU(t);return this.$n.forEachTarget(e,s=>i.On(s.sequenceNumber)).next(()=>this.$n.Ln(e,s=>i.On(s))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.$n.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(I("LruGarbageCollector","Garbage collection skipped; disabled"),g.resolve(iy)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(I("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),iy):this.qn(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let i,s,r,o,a,c,l;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(I("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),s=this.params.maximumSequenceNumbersToCollect):s=h,o=Date.now(),this.nthSequenceNumber(e,s))).next(h=>(i=h,a=Date.now(),this.removeTargets(e,i,t))).next(h=>(r=h,c=Date.now(),this.removeOrphanedDocuments(e,i))).next(h=>(l=Date.now(),Id()<=kt.DEBUG&&I("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${r} targets in `+(c-a)+`ms
	Removed ${h} documents in `+(l-c)+`ms
Total Duration: ${l-u}ms`),g.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:r,documentsRemoved:h})))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uU{constructor(e,t){this.db=e,this.garbageCollector=function(i,s){return new lU(i,s)}(this,t)}Bn(e){const t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}Un(e){let t=0;return this.Ln(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(i,s)=>t(s))}addReference(e,t,i){return tc(e,i)}removeReference(e,t,i){return tc(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return tc(e,t)}Gn(e,t){return function(i,s){let r=!1;return Ab(i).tt(o=>kb(i,o,s).next(a=>(a&&(r=!0),g.resolve(!a)))).next(()=>r)}(e,t)}removeOrphanedDocuments(e,t){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let r=0;return this.Kn(e,(o,a)=>{if(a<=t){const c=this.Gn(e,o).next(l=>{if(!l)return r++,i.getEntry(e,o).next(()=>(i.removeEntry(o,R.min()),Gn(e).delete([0,dt(o.path)])))});s.push(c)}}).next(()=>g.waitFor(s)).next(()=>i.apply(e)).next(()=>r)}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return tc(e,t)}Kn(e,t){const i=Gn(e);let s,r=yt.at;return i.Z({index:"documentTargetsIndex"},([o,a],{path:c,sequenceNumber:l})=>{o===0?(r!==yt.at&&t(new b(on(s)),r),r=l,s=c):r=yt.at}).next(()=>{r!==yt.at&&t(new b(on(s)),r)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function tc(n,e){return Gn(n).put(function(t,i){return{targetId:0,path:dt(t.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rb{constructor(){this.changes=new Ei(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ne.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return i!==void 0?g.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hU{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return ki(e).put(i)}removeEntry(e,t,i){return ki(e).delete(function(s,r){const o=s.path.toArray();return[o.slice(0,o.length-2),o[o.length-2],el(r),o[o.length-1]]}(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.Qn(e,i)))}getEntry(e,t){let i=ne.newInvalidDocument(t);return ki(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Qr(t))},(s,r)=>{i=this.jn(t,r)}).next(()=>i)}Wn(e,t){let i={size:0,document:ne.newInvalidDocument(t)};return ki(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Qr(t))},(s,r)=>{i={document:this.jn(t,r),size:nl(r)}}).next(()=>i)}getEntries(e,t){let i=wt();return this.zn(e,t,(s,r)=>{const o=this.jn(s,r);i=i.insert(s,o)}).next(()=>i)}Hn(e,t){let i=wt(),s=new pe(b.comparator);return this.zn(e,t,(r,o)=>{const a=this.jn(r,o);i=i.insert(r,a),s=s.insert(r,nl(o))}).next(()=>({documents:i,Jn:s}))}zn(e,t,i){if(t.isEmpty())return g.resolve();let s=new J(cy);t.forEach(c=>s=s.add(c));const r=IDBKeyRange.bound(Qr(s.first()),Qr(s.last())),o=s.getIterator();let a=o.getNext();return ki(e).Z({index:"documentKeyIndex",range:r},(c,l,u)=>{const h=b.fromSegments([...l.prefixPath,l.collectionGroup,l.documentId]);for(;a&&cy(a,h)<0;)i(a,null),a=o.getNext();a&&a.isEqual(h)&&(i(a,l),a=o.hasNext()?o.getNext():null),a?u.j(Qr(a)):u.done()}).next(()=>{for(;a;)i(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,i,s){const r=t.path,o=[r.popLast().toArray(),r.lastSegment(),el(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],a=[r.popLast().toArray(),r.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ki(e).W(IDBKeyRange.bound(o,a,!0)).next(c=>{let l=wt();for(const u of c){const h=this.jn(b.fromSegments(u.prefixPath.concat(u.collectionGroup,u.documentId)),u);h.isFoundDocument()&&(Pa(t,h)||s.has(h.key))&&(l=l.insert(h.key,h))}return l})}getAllFromCollectionGroup(e,t,i,s){let r=wt();const o=ay(t,i),a=ay(t,Pt.max());return ki(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(c,l,u)=>{const h=this.jn(b.fromSegments(l.prefixPath.concat(l.collectionGroup,l.documentId)),l);r=r.insert(h.key,h),r.size===s&&u.done()}).next(()=>r)}newChangeBuffer(e){return new dU(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return oy(e).get("remoteDocumentGlobalKey").next(t=>(A(!!t),t))}Qn(e,t){return oy(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const i=YF(this.yt,t);if(!(i.isNoDocument()&&i.version.isEqual(R.min())))return i}return ne.newInvalidDocument(e)}}function Nb(n){return new hU(n)}class dU extends Rb{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new Ei(i=>i.toString(),(i,s)=>i.isEqual(s))}applyChanges(e){const t=[];let i=0,s=new J((r,o)=>L(r.canonicalString(),o.canonicalString()));return this.changes.forEach((r,o)=>{const a=this.Xn.get(r);if(t.push(this.Yn.removeEntry(e,r,a.readTime)),o.isValidDocument()){const c=H_(this.Yn.yt,o);s=s.add(r.path.popLast());const l=nl(c);i+=l-a.size,t.push(this.Yn.addEntry(e,r,c))}else if(i-=a.size,this.trackRemovals){const c=H_(this.Yn.yt,o.convertToNoDocument(R.min()));t.push(this.Yn.addEntry(e,r,c))}}),s.forEach(r=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,r))}),t.push(this.Yn.updateMetadata(e,i)),g.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(i=>(this.Xn.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:i,Jn:s})=>(s.forEach((r,o)=>{this.Xn.set(r,{size:o,readTime:i.get(r).readTime})}),i))}}function oy(n){return Be(n,"remoteDocumentGlobal")}function ki(n){return Be(n,"remoteDocumentsV14")}function Qr(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function ay(n,e){const t=e.documentKey.path.toArray();return[n,el(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function cy(n,e){const t=n.path.toArray(),i=e.path.toArray();let s=0;for(let r=0;r<t.length-2&&r<i.length-2;++r)if(s=L(t[r],i[r]),s)return s;return s=L(t.length,i.length),s||(s=L(t[t.length-2],i[i.length-2]),s||L(t[t.length-1],i[i.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fU{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Db{constructor(e,t,i,s){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=s}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(s=>(i=s,this.remoteDocumentCache.getEntry(e,t))).next(s=>(i!==null&&go(i.mutation,s,vt.empty(),ce.now()),s))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,F()).next(()=>i))}getLocalViewOfDocuments(e,t,i=F()){const s=rn();return this.populateOverlays(e,s,t).next(()=>this.computeViews(e,t,s,i).next(r=>{let o=no();return r.forEach((a,c)=>{o=o.insert(a,c.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){const i=rn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,F()))}populateOverlays(e,t,i){const s=[];return i.forEach(r=>{t.has(r)||s.push(r)}),this.documentOverlayCache.getOverlays(e,s).next(r=>{r.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,i,s){let r=wt();const o=mo(),a=mo();return t.forEach((c,l)=>{const u=i.get(l.key);s.has(l.key)&&(u===void 0||u.mutation instanceof Vn)?r=r.insert(l.key,l):u!==void 0?(o.set(l.key,u.mutation.getFieldMask()),go(u.mutation,l,u.mutation.getFieldMask(),ce.now())):o.set(l.key,vt.empty())}),this.recalculateAndSaveOverlays(e,r).next(c=>(c.forEach((l,u)=>o.set(l,u)),t.forEach((l,u)=>{var h;return a.set(l,new fU(u,(h=o.get(l))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){const i=mo();let s=new pe((o,a)=>o-a),r=F();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(const a of o)a.keys().forEach(c=>{const l=t.get(c);if(l===null)return;let u=i.get(c)||vt.empty();u=a.applyToLocalView(l,u),i.set(c,u);const h=(s.get(a.batchId)||F()).add(c);s=s.insert(a.batchId,h)})}).next(()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const c=a.getNext(),l=c.key,u=c.value,h=sb();u.forEach(d=>{if(!r.has(d)){const f=JE(t.get(d),i.get(d));f!==null&&h.set(d,f),r=r.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,l,h))}return g.waitFor(o)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i){return function(s){return b.isDocumentKey(s.path)&&s.collectionGroup===null&&s.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Op(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i):this.getDocumentsMatchingCollectionQuery(e,t,i)}getNextDocuments(e,t,i,s){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,s).next(r=>{const o=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,s-r.size):g.resolve(rn());let a=-1,c=r;return o.next(l=>g.forEach(l,(u,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),r.get(u)?g.resolve():this.remoteDocumentCache.getEntry(e,u).next(d=>{c=c.insert(u,d)}))).next(()=>this.populateOverlays(e,l,r)).next(()=>this.computeViews(e,c,l,F())).next(u=>({batchId:a,changes:ib(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new b(t)).next(i=>{let s=no();return i.isFoundDocument()&&(s=s.insert(i.key,i)),s})}getDocumentsMatchingCollectionGroupQuery(e,t,i){const s=t.collectionGroup;let r=no();return this.indexManager.getCollectionParents(e,s).next(o=>g.forEach(o,a=>{const c=function(l,u){return new Un(u,null,l.explicitOrderBy.slice(),l.filters.slice(),l.limit,l.limitType,l.startAt,l.endAt)}(t,a.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,i).next(l=>{l.forEach((u,h)=>{r=r.insert(u,h)})})}).next(()=>r))}getDocumentsMatchingCollectionQuery(e,t,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId).next(r=>(s=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,i,s))).next(r=>{s.forEach((a,c)=>{const l=c.getKey();r.get(l)===null&&(r=r.insert(l,ne.newInvalidDocument(l)))});let o=no();return r.forEach((a,c)=>{const l=s.get(a);l!==void 0&&go(l.mutation,c,vt.empty(),ce.now()),Pa(t,c)&&(o=o.insert(a,c))}),o})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pU{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return g.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var i;return this.Zn.set(t.id,{id:(i=t).id,version:i.version,createTime:ve(i.createTime)}),g.resolve()}getNamedQuery(e,t){return g.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,function(i){return{name:i.name,query:$p(i.bundledQuery),readTime:ve(i.readTime)}}(t)),g.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gU{constructor(){this.overlays=new pe(b.comparator),this.es=new Map}getOverlay(e,t){return g.resolve(this.overlays.get(t))}getOverlays(e,t){const i=rn();return g.forEach(t,s=>this.getOverlay(e,s).next(r=>{r!==null&&i.set(s,r)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((s,r)=>{this.oe(e,t,r)}),g.resolve()}removeOverlaysForBatchId(e,t,i){const s=this.es.get(i);return s!==void 0&&(s.forEach(r=>this.overlays=this.overlays.remove(r)),this.es.delete(i)),g.resolve()}getOverlaysForCollection(e,t,i){const s=rn(),r=t.length+1,o=new b(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const c=a.getNext().value,l=c.getKey();if(!t.isPrefixOf(l.path))break;l.path.length===r&&c.largestBatchId>i&&s.set(c.getKey(),c)}return g.resolve(s)}getOverlaysForCollectionGroup(e,t,i,s){let r=new pe((l,u)=>l-u);const o=this.overlays.getIterator();for(;o.hasNext();){const l=o.getNext().value;if(l.getKey().getCollectionGroup()===t&&l.largestBatchId>i){let u=r.get(l.largestBatchId);u===null&&(u=rn(),r=r.insert(l.largestBatchId,u)),u.set(l.getKey(),l)}}const a=rn(),c=r.getIterator();for(;c.hasNext()&&(c.getNext().value.forEach((l,u)=>a.set(l,u)),!(a.size()>=s)););return g.resolve(a)}oe(e,t,i){const s=this.overlays.get(i.key);if(s!==null){const o=this.es.get(s.largestBatchId).delete(i.key);this.es.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new Vp(t,i));let r=this.es.get(t);r===void 0&&(r=F(),this.es.set(t,r)),this.es.set(t,r.add(i.key))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wp{constructor(){this.ns=new J(ke.ss),this.rs=new J(ke.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const i=new ke(e,t);this.ns=this.ns.add(i),this.rs=this.rs.add(i)}us(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.cs(new ke(e,t))}hs(e,t){e.forEach(i=>this.removeReference(i,t))}ls(e){const t=new b(new K([])),i=new ke(t,e),s=new ke(t,e+1),r=[];return this.rs.forEachInRange([i,s],o=>{this.cs(o),r.push(o.key)}),r}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new b(new K([])),i=new ke(t,e),s=new ke(t,e+1);let r=F();return this.rs.forEachInRange([i,s],o=>{r=r.add(o.key)}),r}containsKey(e){const t=new ke(e,0),i=this.ns.firstAfterOrEqual(t);return i!==null&&e.isEqual(i.key)}}class ke{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return b.comparator(e.key,t.key)||L(e._s,t._s)}static os(e,t){return L(e._s,t._s)||b.comparator(e.key,t.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mU{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new J(ke.ss)}checkEmpty(e){return g.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,i,s){const r=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Fp(r,t,i,s);this.mutationQueue.push(o);for(const a of s)this.gs=this.gs.add(new ke(a.key,r)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return g.resolve(o)}lookupMutationBatch(e,t){return g.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const i=t+1,s=this.ps(i),r=s<0?0:s;return g.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return g.resolve(this.mutationQueue.length===0?-1:this.ws-1)}getAllMutationBatches(e){return g.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new ke(t,0),s=new ke(t,Number.POSITIVE_INFINITY),r=[];return this.gs.forEachInRange([i,s],o=>{const a=this.ys(o._s);r.push(a)}),g.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new J(L);return t.forEach(s=>{const r=new ke(s,0),o=new ke(s,Number.POSITIVE_INFINITY);this.gs.forEachInRange([r,o],a=>{i=i.add(a._s)})}),g.resolve(this.Is(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,s=i.length+1;let r=i;b.isDocumentKey(r)||(r=r.child(""));const o=new ke(new b(r),0);let a=new J(L);return this.gs.forEachWhile(c=>{const l=c.key.path;return!!i.isPrefixOf(l)&&(l.length===s&&(a=a.add(c._s)),!0)},o),g.resolve(this.Is(a))}Is(e){const t=[];return e.forEach(i=>{const s=this.ys(i);s!==null&&t.push(s)}),t}removeMutationBatch(e,t){A(this.Ts(t.batchId,"removed")===0),this.mutationQueue.shift();let i=this.gs;return g.forEach(t.mutations,s=>{const r=new ke(s.key,t.batchId);return i=i.delete(r),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.gs=i})}An(e){}containsKey(e,t){const i=new ke(t,0),s=this.gs.firstAfterOrEqual(i);return g.resolve(t.isEqual(s&&s.key))}performConsistencyCheck(e){return this.mutationQueue.length,g.resolve()}Ts(e,t){return this.ps(e)}ps(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _U{constructor(e){this.Es=e,this.docs=new pe(b.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,s=this.docs.get(i),r=s?s.size:0,o=this.Es(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return g.resolve(i?i.document.mutableCopy():ne.newInvalidDocument(t))}getEntries(e,t){let i=wt();return t.forEach(s=>{const r=this.docs.get(s);i=i.insert(s,r?r.document.mutableCopy():ne.newInvalidDocument(s))}),g.resolve(i)}getDocumentsMatchingQuery(e,t,i,s){let r=wt();const o=t.path,a=new b(o.child("")),c=this.docs.getIteratorFrom(a);for(;c.hasNext();){const{key:l,value:{document:u}}=c.getNext();if(!o.isPrefixOf(l.path))break;l.path.length>o.length+1||Rp(CE(u),i)<=0||(s.has(u.key)||Pa(t,u))&&(r=r.insert(u.key,u.mutableCopy()))}return g.resolve(r)}getAllFromCollectionGroup(e,t,i,s){C()}As(e,t){return g.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new yU(this)}getSize(e){return g.resolve(this.size)}}class yU extends Rb{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach((i,s)=>{s.isValidDocument()?t.push(this.Yn.addEntry(e,s)):this.Yn.removeEntry(i)}),g.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vU{constructor(e){this.persistence=e,this.Rs=new Ei(t=>as(t),Na),this.lastRemoteSnapshotVersion=R.min(),this.highestTargetId=0,this.bs=0,this.Ps=new Wp,this.targetCount=0,this.vs=ds.Pn()}forEachTarget(e,t){return this.Rs.forEach((i,s)=>t(s)),g.resolve()}getLastRemoteSnapshotVersion(e){return g.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return g.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),g.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.bs&&(this.bs=t),g.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new ds(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,g.resolve()}updateTargetData(e,t){return this.Dn(t),g.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,g.resolve()}removeTargets(e,t,i){let s=0;const r=[];return this.Rs.forEach((o,a)=>{a.sequenceNumber<=t&&i.get(a.targetId)===null&&(this.Rs.delete(o),r.push(this.removeMatchingKeysForTargetId(e,a.targetId)),s++)}),g.waitFor(r).next(()=>s)}getTargetCount(e){return g.resolve(this.targetCount)}getTargetData(e,t){const i=this.Rs.get(t)||null;return g.resolve(i)}addMatchingKeys(e,t,i){return this.Ps.us(t,i),g.resolve()}removeMatchingKeys(e,t,i){this.Ps.hs(t,i);const s=this.persistence.referenceDelegate,r=[];return s&&t.forEach(o=>{r.push(s.markPotentiallyOrphaned(e,o))}),g.waitFor(r)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),g.resolve()}getMatchingKeysForTargetId(e,t){const i=this.Ps.ds(t);return g.resolve(i)}containsKey(e,t){return g.resolve(this.Ps.containsKey(t))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pb{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new yt(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new vU(this),this.indexManager=new sU,this.remoteDocumentCache=function(i){return new _U(i)}(i=>this.referenceDelegate.xs(i)),this.yt=new Tb(t),this.Ns=new pU(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new gU,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.Vs[e.toKey()];return i||(i=new mU(t,this.referenceDelegate),this.Vs[e.toKey()]=i),i}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,i){I("MemoryPersistence","Starting transaction:",e);const s=new wU(this.Ss.next());return this.referenceDelegate.ks(),i(s).next(r=>this.referenceDelegate.Os(s).next(()=>r)).toPromise().then(r=>(s.raiseOnCommittedEvent(),r))}Ms(e,t){return g.or(Object.values(this.Vs).map(i=>()=>i.containsKey(e,t)))}}class wU extends AE{constructor(e){super(),this.currentSequenceNumber=e}}class Tu{constructor(e){this.persistence=e,this.Fs=new Wp,this.$s=null}static Bs(e){return new Tu(e)}get Ls(){if(this.$s)return this.$s;throw C()}addReference(e,t,i){return this.Fs.addReference(i,t),this.Ls.delete(i.toString()),g.resolve()}removeReference(e,t,i){return this.Fs.removeReference(i,t),this.Ls.add(i.toString()),g.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),g.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(s=>this.Ls.add(s.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(r=>this.Ls.add(r.toString()))}).next(()=>i.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return g.forEach(this.Ls,i=>{const s=b.fromPath(i);return this.qs(e,s).next(r=>{r||t.removeEntry(s,R.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.qs(e,t).next(i=>{i?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return g.or([()=>g.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class IU{constructor(e){this.yt=e}$(e,t,i,s){const r=new gu("createOrUpgrade",t);i<1&&s>=1&&(function(a){a.createObjectStore("owner")}(e),function(a){a.createObjectStore("mutationQueues",{keyPath:"userId"}),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",G_,{unique:!0}),a.createObjectStore("documentMutations")}(e),ly(e),function(a){a.createObjectStore("remoteDocuments")}(e));let o=g.resolve();return i<3&&s>=3&&(i!==0&&(function(a){a.deleteObjectStore("targetDocuments"),a.deleteObjectStore("targets"),a.deleteObjectStore("targetGlobal")}(e),ly(e)),o=o.next(()=>function(a){const c=a.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:R.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(r))),i<4&&s>=4&&(i!==0&&(o=o.next(()=>function(a,c){return c.store("mutations").W().next(l=>{a.deleteObjectStore("mutations"),a.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",G_,{unique:!0});const u=c.store("mutations"),h=l.map(d=>u.put(d));return g.waitFor(h)})}(e,r))),o=o.next(()=>{(function(a){a.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),i<5&&s>=5&&(o=o.next(()=>this.Us(r))),i<6&&s>=6&&(o=o.next(()=>(function(a){a.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(r)))),i<7&&s>=7&&(o=o.next(()=>this.Gs(r))),i<8&&s>=8&&(o=o.next(()=>this.Qs(e,r))),i<9&&s>=9&&(o=o.next(()=>{(function(a){a.objectStoreNames.contains("remoteDocumentChanges")&&a.deleteObjectStore("remoteDocumentChanges")})(e)})),i<10&&s>=10&&(o=o.next(()=>this.js(r))),i<11&&s>=11&&(o=o.next(()=>{(function(a){a.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(a){a.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),i<12&&s>=12&&(o=o.next(()=>{(function(a){const c=a.createObjectStore("documentOverlays",{keyPath:jF});c.createIndex("collectionPathOverlayIndex",GF,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",HF,{unique:!1})})(e)})),i<13&&s>=13&&(o=o.next(()=>function(a){const c=a.createObjectStore("remoteDocumentsV14",{keyPath:OF});c.createIndex("documentKeyIndex",MF),c.createIndex("collectionGroupIndex",LF)}(e)).next(()=>this.Ws(e,r)).next(()=>e.deleteObjectStore("remoteDocuments"))),i<14&&s>=14&&(o=o.next(()=>this.zs(e,r))),i<15&&s>=15&&(o=o.next(()=>function(a){a.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),a.createObjectStore("indexState",{keyPath:BF}).createIndex("sequenceNumberIndex",qF,{unique:!1}),a.createObjectStore("indexEntries",{keyPath:WF}).createIndex("documentKeyIndex",KF,{unique:!1})}(e))),o}Ks(e){let t=0;return e.store("remoteDocuments").Z((i,s)=>{t+=nl(s)}).next(()=>{const i={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",i)})}Us(e){const t=e.store("mutationQueues"),i=e.store("mutations");return t.W().next(s=>g.forEach(s,r=>{const o=IDBKeyRange.bound([r.userId,-1],[r.userId,r.lastAcknowledgedBatchId]);return i.W("userMutationsIndex",o).next(a=>g.forEach(a,c=>{A(c.userId===r.userId);const l=Pi(this.yt,c);return Cb(e,r.userId,l).next(()=>{})}))}))}Gs(e){const t=e.store("targetDocuments"),i=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(s=>{const r=[];return i.Z((o,a)=>{const c=new K(o),l=function(u){return[0,dt(u)]}(c);r.push(t.get(l).next(u=>u?g.resolve():(h=>t.put({targetId:0,path:dt(h),sequenceNumber:s.highestListenSequenceNumber}))(c)))}).next(()=>g.waitFor(r))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:$F});const i=t.store("collectionParents"),s=new qp,r=o=>{if(s.add(o)){const a=o.lastSegment(),c=o.popLast();return i.put({collectionId:a,parent:dt(c)})}};return t.store("remoteDocuments").Z({X:!0},(o,a)=>{const c=new K(o);return r(c.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([o,a,c],l)=>{const u=on(a);return r(u.popLast())}))}js(e){const t=e.store("targets");return t.Z((i,s)=>{const r=io(s),o=Eb(this.yt,r);return t.put(o)})}Ws(e,t){const i=t.store("remoteDocuments"),s=[];return i.Z((r,o)=>{const a=t.store("remoteDocumentsV14"),c=(l=o,l.document?new b(K.fromString(l.document.name).popFirst(5)):l.noDocument?b.fromSegments(l.noDocument.path):l.unknownDocument?b.fromSegments(l.unknownDocument.path):C()).path.toArray();var l;/**
* @license
* Copyright 2017 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/const u={prefixPath:c.slice(0,c.length-2),collectionGroup:c[c.length-2],documentId:c[c.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};s.push(a.put(u))}).next(()=>g.waitFor(s))}zs(e,t){const i=t.store("mutations"),s=Nb(this.yt),r=new Pb(Tu.Bs,this.yt.ie);return i.W().next(o=>{const a=new Map;return o.forEach(c=>{var l;let u=(l=a.get(c.userId))!==null&&l!==void 0?l:F();Pi(this.yt,c).keys().forEach(h=>u=u.add(h)),a.set(c.userId,u)}),g.forEach(a,(c,l)=>{const u=new Ne(l),h=wu.re(this.yt,u),d=r.getIndexManager(u),f=Iu.re(u,this.yt,d,r.referenceDelegate);return new Db(s,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new Pd(t,yt.at),c).next()})})}}function ly(n){n.createObjectStore("targetDocuments",{keyPath:UF}).createIndex("documentTargetsIndex",VF,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",FF,{unique:!0}),n.createObjectStore("targetGlobal")}const fh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class Kp{constructor(e,t,i,s,r,o,a,c,l,u,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.Hs=r,this.window=o,this.document=a,this.Js=l,this.Ys=u,this.Xs=h,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=d=>Promise.resolve(),!Kp.C())throw new y(m.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new uU(this,s),this.ii=t+"main",this.yt=new Tb(c),this.ri=new Ht(this.ii,this.Xs,new IU(this.yt)),this.Cs=new oU(this.referenceDelegate,this.yt),this.remoteDocumentCache=Nb(this.yt),this.Ns=new XF,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,u===!1&&_e("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new y(m.FAILED_PRECONDITION,fh);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new yt(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){return this.si=async t=>{if(this.started)return e(t)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(async t=>{t.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget(async()=>{this.started&&await this.ui()}))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>nc(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(Ti(e))return I("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return I("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return Yr(e).get("owner").next(t=>g.resolve(this.mi(t)))}gi(e){return nc(e).delete(this.clientId)}async yi(){if(this.isPrimary&&!this.pi(this.ni,18e5)){this.ni=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const i=Be(t,"clientMetadata");return i.W().next(s=>{const r=this.Ii(s,18e5),o=s.filter(a=>r.indexOf(a)===-1);return g.forEach(o,a=>i.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.oi)for(const t of e)this.oi.removeItem(this.Ti(t.clientId))}}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?g.resolve(!0):Yr(e).get("owner").next(t=>{if(t!==null&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new y(m.FAILED_PRECONDITION,fh);return!1}}return!(!this.networkEnabled||!this.inForeground)||nc(e).W().next(i=>this.Ii(i,5e3).find(s=>{if(this.clientId!==s.clientId){const r=!this.networkEnabled&&s.networkEnabled,o=!this.inForeground&&s.inForeground,a=this.networkEnabled===s.networkEnabled;if(r||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&I("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async shutdown(){this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),await this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const t=new Pd(e,yt.at);return this._i(t).next(()=>this.gi(t))}),this.ri.close(),this.Pi()}Ii(e,t){return e.filter(i=>this.pi(i.updateTimeMs,t)&&!this.Ei(i.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>nc(e).W().next(t=>this.Ii(t,18e5).map(i=>i.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return Iu.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new rU(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return wu.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,i){I("IndexedDbPersistence","Starting transaction:",e);const s=t==="readonly"?"readonly":"readwrite",r=(o=this.Xs)===15?QF:o===14?Ib:o===13?wb:o===12?zF:o===11?vb:void C();var o;let a;return this.ri.runTransaction(e,s,r,c=>(a=new Pd(c,this.Ss?this.Ss.next():yt.at),t==="readwrite-primary"?this.fi(a).next(l=>!!l||this.di(a)).next(l=>{if(!l)throw _e(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new y(m.FAILED_PRECONDITION,kE);return i(a)}).next(l=>this.wi(a).next(()=>l)):this.Vi(a).next(()=>i(a)))).then(c=>(a.raiseOnCommittedEvent(),c))}Vi(e){return Yr(e).get("owner").next(t=>{if(t!==null&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)&&!this.mi(t)&&!(this.Ys||this.allowTabSynchronization&&t.allowTabSynchronization))throw new y(m.FAILED_PRECONDITION,fh)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Yr(e).put("owner",t)}static C(){return Ht.C()}_i(e){const t=Yr(e);return t.get("owner").next(i=>this.mi(i)?(I("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):g.resolve())}pi(e,t){const i=Date.now();return!(e<i-t)&&(!(e>i)||(_e(`Detected an update time that is in the future: ${e} > ${i}`),!1))}ci(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground=this.document.visibilityState==="visible")}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Zs=()=>{this.Ai(),hk()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const i=((t=this.oi)===null||t===void 0?void 0:t.getItem(this.Ti(e)))!==null;return I("IndexedDbPersistence",`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return _e("IndexedDbPersistence","Failed to get zombied client id.",i),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){_e("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch{}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Yr(n){return Be(n,"owner")}function nc(n){return Be(n,"clientMetadata")}function jp(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gp{constructor(e,t,i,s){this.targetId=e,this.fromCache=t,this.Si=i,this.Di=s}static Ci(e,t){let i=F(),s=F();for(const r of t.docChanges)switch(r.type){case 0:i=i.add(r.doc.key);break;case 1:s=s.add(r.doc.key)}return new Gp(e,t.fromCache,i,s)}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xb{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,i,s){return this.ki(e,t).next(r=>r||this.Oi(e,t,s,i)).next(r=>r||this.Mi(e,t))}ki(e,t){if(L_(t))return g.resolve(null);let i=It(t);return this.indexManager.getIndexType(e,i).next(s=>s===0?null:(t.limit!==null&&s===1&&(t=Zc(t,null,"F"),i=It(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(r=>{const o=F(...r);return this.Ni.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,i).next(c=>{const l=this.Fi(t,a);return this.$i(t,l,o,c.readTime)?this.ki(e,Zc(t,null,"F")):this.Bi(e,l,t,c)}))})))}Oi(e,t,i,s){return L_(t)||s.isEqual(R.min())?this.Mi(e,t):this.Ni.getDocuments(e,i).next(r=>{const o=this.Fi(t,r);return this.$i(t,o,i,s)?this.Mi(e,t):(Id()<=kt.DEBUG&&I("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Rd(t)),this.Bi(e,o,t,SE(s,-1)))})}Fi(e,t){let i=new J(KE(e));return t.forEach((s,r)=>{Pa(e,r)&&(i=i.add(r))}),i}$i(e,t,i,s){if(e.limit===null)return!1;if(i.size!==t.size)return!0;const r=e.limitType==="F"?t.last():t.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Mi(e,t){return Id()<=kt.DEBUG&&I("QueryEngine","Using full collection scan to execute query:",Rd(t)),this.Ni.getDocumentsMatchingQuery(e,t,Pt.min())}Bi(e,t,i,s){return this.Ni.getDocumentsMatchingQuery(e,i,s).next(r=>(t.forEach(o=>{r=r.insert(o.key,o)}),r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TU{constructor(e,t,i,s){this.persistence=e,this.Li=t,this.yt=s,this.qi=new pe(L),this.Ui=new Ei(r=>as(r),Na),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(i)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Db(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qi))}}function Ob(n,e,t,i){return new TU(n,e,t,i)}async function Mb(n,e){const t=S(n);return await t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(r=>(s=r,t.Qi(e),t.mutationQueue.getAllMutationBatches(i))).next(r=>{const o=[],a=[];let c=F();for(const l of s){o.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}for(const l of r){a.push(l.batchId);for(const u of l.mutations)c=c.add(u.key)}return t.localDocuments.getDocuments(i,c).next(l=>({ji:l,removedBatchIds:o,addedBatchIds:a}))})})}function EU(n,e){const t=S(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const s=e.batch.keys(),r=t.Gi.newChangeBuffer({trackRemovals:!0});return function(o,a,c,l){const u=c.batch,h=u.keys();let d=g.resolve();return h.forEach(f=>{d=d.next(()=>l.getEntry(a,f)).next(p=>{const _=c.docVersions.get(f);A(_!==null),p.version.compareTo(_)<0&&(u.applyToRemoteDocument(p,c),p.isValidDocument()&&(p.setReadTime(c.commitVersion),l.addEntry(p)))})}),d.next(()=>o.mutationQueue.removeMutationBatch(a,u))}(t,i,e,r).next(()=>r.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,s,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(o){let a=F();for(let c=0;c<o.mutationResults.length;++c)o.mutationResults[c].transformResults.length>0&&(a=a.add(o.batch.mutations[c].key));return a}(e))).next(()=>t.localDocuments.getDocuments(i,s))})}function Lb(n){const e=S(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function bU(n,e){const t=S(n),i=e.snapshotVersion;let s=t.qi;return t.persistence.runTransaction("Apply remote event","readwrite-primary",r=>{const o=t.Gi.newChangeBuffer({trackRemovals:!0});s=t.qi;const a=[];e.targetChanges.forEach((u,h)=>{const d=s.get(h);if(!d)return;a.push(t.Cs.removeMatchingKeys(r,u.removedDocuments,h).next(()=>t.Cs.addMatchingKeys(r,u.addedDocuments,h)));let f=d.withSequenceNumber(r.currentSequenceNumber);e.targetMismatches.has(h)?f=f.withResumeToken(be.EMPTY_BYTE_STRING,R.min()).withLastLimboFreeSnapshotVersion(R.min()):u.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(u.resumeToken,i)),s=s.insert(h,f),function(p,_,w){return p.resumeToken.approximateByteSize()===0||_.snapshotVersion.toMicroseconds()-p.snapshotVersion.toMicroseconds()>=3e8?!0:w.addedDocuments.size+w.modifiedDocuments.size+w.removedDocuments.size>0}(d,f,u)&&a.push(t.Cs.updateTargetData(r,f))});let c=wt(),l=F();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(r,u))}),a.push(Fb(r,o,e.documentUpdates).next(u=>{c=u.Wi,l=u.zi})),!i.isEqual(R.min())){const u=t.Cs.getLastRemoteSnapshotVersion(r).next(h=>t.Cs.setTargetsMetadata(r,r.currentSequenceNumber,i));a.push(u)}return g.waitFor(a).next(()=>o.apply(r)).next(()=>t.localDocuments.getLocalViewOfDocuments(r,c,l)).next(()=>c)}).then(r=>(t.qi=s,r))}function Fb(n,e,t){let i=F(),s=F();return t.forEach(r=>i=i.add(r)),e.getEntries(n,i).next(r=>{let o=wt();return t.forEach((a,c)=>{const l=r.get(a);c.isFoundDocument()!==l.isFoundDocument()&&(s=s.add(a)),c.isNoDocument()&&c.version.isEqual(R.min())?(e.removeEntry(a,c.readTime),o=o.insert(a,c)):!l.isValidDocument()||c.version.compareTo(l.version)>0||c.version.compareTo(l.version)===0&&l.hasPendingWrites?(e.addEntry(c),o=o.insert(a,c)):I("LocalStore","Ignoring outdated watch update for ",a,". Current version:",l.version," Watch version:",c.version)}),{Wi:o,zi:s}})}function SU(n,e){const t=S(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function dr(n,e){const t=S(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let s;return t.Cs.getTargetData(i,e).next(r=>r?(s=r,g.resolve(s)):t.Cs.allocateTargetId(i).next(o=>(s=new ti(e,o,0,i.currentSequenceNumber),t.Cs.addTargetData(i,s).next(()=>s))))}).then(i=>{const s=t.qi.get(i.targetId);return(s===null||i.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(t.qi=t.qi.insert(i.targetId,i),t.Ui.set(e,i.targetId)),i})}async function fr(n,e,t){const i=S(n),s=i.qi.get(e),r=t?"readwrite":"readwrite-primary";try{t||await i.persistence.runTransaction("Release target",r,o=>i.persistence.referenceDelegate.removeTarget(o,s))}catch(o){if(!Ti(o))throw o;I("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}i.qi=i.qi.remove(e),i.Ui.delete(s.target)}function il(n,e,t){const i=S(n);let s=R.min(),r=F();return i.persistence.runTransaction("Execute query","readonly",o=>function(a,c,l){const u=S(a),h=u.Ui.get(l);return h!==void 0?g.resolve(u.qi.get(h)):u.Cs.getTargetData(c,l)}(i,o,It(e)).next(a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,i.Cs.getMatchingKeysForTargetId(o,a.targetId).next(c=>{r=c})}).next(()=>i.Li.getDocumentsMatchingQuery(o,e,t?s:R.min(),t?r:F())).next(a=>($b(i,WE(e),a),{documents:a,Hi:r})))}function Ub(n,e){const t=S(n),i=S(t.Cs),s=t.qi.get(e);return s?Promise.resolve(s.target):t.persistence.runTransaction("Get target data","readonly",r=>i.ne(r,e).next(o=>o?o.target:null))}function Vb(n,e){const t=S(n),i=t.Ki.get(e)||R.min();return t.persistence.runTransaction("Get new document changes","readonly",s=>t.Gi.getAllFromCollectionGroup(s,e,SE(i,-1),Number.MAX_SAFE_INTEGER)).then(s=>($b(t,e,s),s))}function $b(n,e,t){let i=n.Ki.get(e)||R.min();t.forEach((s,r)=>{r.readTime.compareTo(i)>0&&(i=r.readTime)}),n.Ki.set(e,i)}async function CU(n,e,t,i){const s=S(n);let r=F(),o=wt();for(const l of t){const u=e.Ji(l.metadata.name);l.document&&(r=r.add(u));const h=e.Yi(l);h.setReadTime(e.Xi(l.metadata.readTime)),o=o.insert(u,h)}const a=s.Gi.newChangeBuffer({trackRemovals:!0}),c=await dr(s,function(l){return It(Rr(K.fromString(`__bundle__/docs/${l}`)))}(i));return s.persistence.runTransaction("Apply bundle documents","readwrite",l=>Fb(l,a,o).next(u=>(a.apply(l),u)).next(u=>s.Cs.removeMatchingKeysForTargetId(l,c.targetId).next(()=>s.Cs.addMatchingKeys(l,r,c.targetId)).next(()=>s.localDocuments.getLocalViewOfDocuments(l,u.Wi,u.zi)).next(()=>u.Wi)))}async function kU(n,e,t=F()){const i=await dr(n,It($p(e.bundledQuery))),s=S(n);return s.persistence.runTransaction("Save named query","readwrite",r=>{const o=ve(e.readTime);if(i.snapshotVersion.compareTo(o)>=0)return s.Ns.saveNamedQuery(r,e);const a=i.withResumeToken(be.EMPTY_BYTE_STRING,o);return s.qi=s.qi.insert(a.targetId,a),s.Cs.updateTargetData(r,a).next(()=>s.Cs.removeMatchingKeysForTargetId(r,i.targetId)).next(()=>s.Cs.addMatchingKeys(r,t,i.targetId)).next(()=>s.Ns.saveNamedQuery(r,e))})}function uy(n,e){return`firestore_clients_${n}_${e}`}function hy(n,e,t){let i=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(i+=`_${e.uid}`),i}function ph(n,e){return`firestore_targets_${n}_${e}`}class sl{constructor(e,t,i,s){this.user=e,this.batchId=t,this.state=i,this.error=s}static Zi(e,t,i){const s=JSON.parse(i);let r,o=typeof s=="object"&&["pending","acknowledged","rejected"].indexOf(s.state)!==-1&&(s.error===void 0||typeof s.error=="object");return o&&s.error&&(o=typeof s.error.message=="string"&&typeof s.error.code=="string",o&&(r=new y(s.error.code,s.error.message))),o?new sl(e,t,s.state,r):(_e("SharedClientState",`Failed to parse mutation state for ID '${t}': ${i}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class _o{constructor(e,t,i){this.targetId=e,this.state=t,this.error=i}static Zi(e,t){const i=JSON.parse(t);let s,r=typeof i=="object"&&["not-current","current","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return r&&i.error&&(r=typeof i.error.message=="string"&&typeof i.error.code=="string",r&&(s=new y(i.error.code,i.error.message))),r?new _o(e,i.state,s):(_e("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class rl{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const i=JSON.parse(t);let s=typeof i=="object"&&i.activeTargetIds instanceof Array,r=vu();for(let o=0;s&&o<i.activeTargetIds.length;++o)s=NE(i.activeTargetIds[o]),r=r.add(i.activeTargetIds[o]);return s?new rl(e,r):(_e("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Hp{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new Hp(t.clientId,t.onlineState):(_e("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Ld{constructor(){this.activeTargetIds=vu()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class gh{constructor(e,t,i,s,r){this.window=e,this.Hs=t,this.persistenceKey=i,this.sr=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new pe(L),this.started=!1,this.cr=[];const o=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=r,this.ar=uy(this.persistenceKey,this.sr),this.hr=function(a){return`firestore_sequence_number_${a}`}(this.persistenceKey),this.ur=this.ur.insert(this.sr,new Ld),this.lr=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.wr=function(a){return`firestore_online_state_${a}`}(this.persistenceKey),this.mr=function(a){return`firestore_bundle_loaded_v2_${a}`}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.vi();for(const i of e){if(i===this.sr)continue;const s=this.getItem(uy(this.persistenceKey,i));if(s){const r=rl.Zi(i,s);r&&(this.ur=this.ur.insert(r.clientId,r))}}this.gr();const t=this.storage.getItem(this.wr);if(t){const i=this.yr(t);i&&this.pr(i)}for(const i of this.cr)this.rr(i);this.cr=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach((i,s)=>{s.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,i){this.Tr(e,t,i),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const i=this.storage.getItem(ph(this.persistenceKey,e));if(i){const s=_o.Zi(e,i);s&&(t=s.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(ph(this.persistenceKey,e))}updateQueryState(e,t,i){this.Rr(e,t,i)}handleUserChange(e,t,i){t.forEach(s=>{this.Er(s)}),this.currentUser=e,i.forEach(s=>{this.addPendingMutation(s)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return I("SharedClientState","READ",e,t),t}setItem(e,t){I("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){I("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){const t=e;if(t.storageArea===this.storage){if(I("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ar)return void _e("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable(async()=>{if(this.started){if(t.key!==null){if(this.lr.test(t.key)){if(t.newValue==null){const i=this.vr(t.key);return this.Vr(i,null)}{const i=this.Sr(t.key,t.newValue);if(i)return this.Vr(i.clientId,i)}}else if(this.dr.test(t.key)){if(t.newValue!==null){const i=this.Dr(t.key,t.newValue);if(i)return this.Cr(i)}}else if(this._r.test(t.key)){if(t.newValue!==null){const i=this.Nr(t.key,t.newValue);if(i)return this.kr(i)}}else if(t.key===this.wr){if(t.newValue!==null){const i=this.yr(t.newValue);if(i)return this.pr(i)}}else if(t.key===this.hr){const i=function(s){let r=yt.at;if(s!=null)try{const o=JSON.parse(s);A(typeof o=="number"),r=o}catch(o){_e("SharedClientState","Failed to read sequence number from WebStorage",o)}return r}(t.newValue);i!==yt.at&&this.sequenceNumberHandler(i)}else if(t.key===this.mr){const i=this.Or(t.newValue);await Promise.all(i.map(s=>this.syncEngine.Mr(s)))}}}else this.cr.push(t)})}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,i){const s=new sl(this.currentUser,e,t,i),r=hy(this.persistenceKey,this.currentUser,e);this.setItem(r,s.tr())}Er(e){const t=hy(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){const t={clientId:this.sr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(t))}Rr(e,t,i){const s=ph(this.persistenceKey,e),r=new _o(e,t,i);this.setItem(s,r.tr())}Pr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){const t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){const i=this.vr(e);return rl.Zi(i,t)}Dr(e,t){const i=this.dr.exec(e),s=Number(i[1]),r=i[2]!==void 0?i[2]:null;return sl.Zi(new Ne(r),s,t)}Nr(e,t){const i=this._r.exec(e),s=Number(i[1]);return _o.Zi(s,t)}yr(e){return Hp.Zi(e)}Or(e){return JSON.parse(e)}async Cr(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Fr(e.batchId,e.state,e.error);I("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const i=t?this.ur.insert(e,t):this.ur.remove(e),s=this.Ir(this.ur),r=this.Ir(i),o=[],a=[];return r.forEach(c=>{s.has(c)||o.push(c)}),s.forEach(c=>{r.has(c)||a.push(c)}),this.syncEngine.Br(o,a).then(()=>{this.ur=i})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=vu();return e.forEach((i,s)=>{t=t.unionWith(s.activeTargetIds)}),t}}class Bb{constructor(){this.Lr=new Ld,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,i){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new Ld,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class AU{Ur(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dy{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){I("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){I("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RU={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class NU{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class DU extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http";this.oo=t+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,i,s,r){const o=this.ho(e,t);I("RestConnection","Sending: ",o,i);const a={};return this.lo(a,s,r),this.fo(e,o,a,i).then(c=>(I("RestConnection","Received: ",c),c),c=>{throw rr("RestConnection",`${e} failed with error: `,c,"url: ",o,"request:",i),c})}_o(e,t,i,s,r,o){return this.ao(e,t,i,s,r)}lo(e,t,i){e["X-Goog-Api-Client"]="gl-js/ fire/"+Ar,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((s,r)=>e[r]=s),i&&i.headers.forEach((s,r)=>e[r]=s)}ho(e,t){const i=RU[e];return`${this.oo}/v1/${t}:${i}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,i,s){return new Promise((r,o)=>{const a=new N1;a.setWithCredentials(!0),a.listenOnce(k1.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case hh.NO_ERROR:const l=a.getResponseJson();I("Connection","XHR received:",JSON.stringify(l)),r(l);break;case hh.TIMEOUT:I("Connection",'RPC "'+e+'" timed out'),o(new y(m.DEADLINE_EXCEEDED,"Request time out"));break;case hh.HTTP_ERROR:const u=a.getStatus();if(I("Connection",'RPC "'+e+'" failed with status:',u,"response text:",a.getResponseText()),u>0){let h=a.getResponseJson();Array.isArray(h)&&(h=h[0]);const d=h==null?void 0:h.error;if(d&&d.status&&d.message){const f=function(p){const _=p.toLowerCase().replace(/_/g,"-");return Object.values(m).indexOf(_)>=0?_:m.UNKNOWN}(d.status);o(new y(f,d.message))}else o(new y(m.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new y(m.UNAVAILABLE,"Connection failed."));break;default:C()}}finally{I("Connection",'RPC "'+e+'" completed.')}});const c=JSON.stringify(s);a.send(t,"POST",c,i,15)})}wo(e,t,i){const s=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=S1(),o=C1(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(a.xmlHttpFactory=new R1({})),this.lo(a.initMessageHeaders,t,i),a.encodeInitMessageHeaders=!0;const c=s.join("");I("Connection","Creating WebChannel: "+c,a);const l=r.createWebChannel(c,a);let u=!1,h=!1;const d=new NU({Hr:p=>{h?I("Connection","Not sending because WebChannel is closed:",p):(u||(I("Connection","Opening WebChannel transport."),l.open(),u=!0),I("Connection","WebChannel sending:",p),l.send(p))},Jr:()=>l.close()}),f=(p,_,w)=>{p.listen(_,N=>{try{w(N)}catch(M){setTimeout(()=>{throw M},0)}})};return f(l,Xa.EventType.OPEN,()=>{h||I("Connection","WebChannel transport opened.")}),f(l,Xa.EventType.CLOSE,()=>{h||(h=!0,I("Connection","WebChannel transport closed"),d.io())}),f(l,Xa.EventType.ERROR,p=>{h||(h=!0,rr("Connection","WebChannel transport errored:",p),d.io(new y(m.UNAVAILABLE,"The operation could not be completed")))}),f(l,Xa.EventType.MESSAGE,p=>{var _;if(!h){const w=p.data[0];A(!!w);const N=w,M=N.error||((_=N[0])===null||_===void 0?void 0:_.error);if(M){I("Connection","WebChannel received error:",M);const x=M.status;let U=function(G){const me=Ie[G];if(me!==void 0)return tb(me)}(x),Q=M.message;U===void 0&&(U=m.INTERNAL,Q="Unknown error status: "+x+" with message "+M.message),h=!0,d.io(new y(U,Q)),l.close()}else I("Connection","WebChannel received:",w),d.ro(w)}}),f(o,A1.STAT_EVENT,p=>{p.stat===T_.PROXY?I("Connection","Detected buffering proxy"):p.stat===T_.NOPROXY&&I("Connection","Detected no buffering proxy")}),setTimeout(()=>{d.so()},0),d}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qb(){return typeof window<"u"?window:null}function mc(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function La(n){return new TF(n,!0)}class zp{constructor(e,t,i=1e3,s=1.5,r=6e4){this.Hs=e,this.timerId=t,this.mo=i,this.yo=s,this.po=r,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),i=Math.max(0,Date.now()-this.Eo),s=Math.max(0,t-i);s>0&&I("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,s,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){this.To!==null&&(this.To.skipDelay(),this.To=null)}cancel(){this.To!==null&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wb{constructor(e,t,i,s,r,o,a,c){this.Hs=e,this.vo=i,this.Vo=s,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=c,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new zp(e,t)}No(){return this.state===1||this.state===5||this.ko()}ko(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Oo()}async stop(){this.No()&&await this.close(0)}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&this.Do===null&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}async $o(){if(this.ko())return this.close(0)}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}async close(e,t){this.Lo(),this.qo(),this.xo.cancel(),this.So++,e!==4?this.xo.reset():t&&t.code===m.RESOURCE_EXHAUSTED?(_e(t.toString()),_e("Using maximum backoff delay to prevent overloading the backend."),this.xo.Ao()):t&&t.code===m.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.Uo(),this.stream.close(),this.stream=null),this.state=e,await this.listener.Zr(t)}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,s])=>{this.So===t&&this.Go(i,s)},i=>{e(()=>{const s=new y(m.UNKNOWN,"Fetching auth token failed: "+i.message);return this.Qo(s)})})}Go(e,t){const i=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{i(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(s=>{i(()=>this.Qo(s))}),this.stream.onMessage(s=>{i(()=>this.onMessage(s))})}Oo(){this.state=5,this.xo.Ro(async()=>{this.state=0,this.start()})}Qo(e){return I("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget(()=>this.So===e?t():(I("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class PU extends Wb{constructor(e,t,i,s,r,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,s,o),this.yt=r}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=SF(this.yt,e),i=function(s){if(!("targetChange"in s))return R.min();const r=s.targetChange;return r.targetIds&&r.targetIds.length?R.min():r.readTime?ve(r.readTime):R.min()}(e);return this.listener.Wo(t,i)}zo(e){const t={};t.database=Qo(this.yt),t.addTarget=function(s,r){let o;const a=r.target;return o=Xc(a)?{documents:db(s,a)}:{query:fb(s,a)},o.targetId=r.targetId,r.resumeToken.approximateByteSize()>0?o.resumeToken=ab(s,r.resumeToken):r.snapshotVersion.compareTo(R.min())>0&&(o.readTime=hr(s,r.snapshotVersion.toTimestamp())),o}(this.yt,e);const i=kF(this.yt,e);i&&(t.labels=i),this.Bo(t)}Ho(e){const t={};t.database=Qo(this.yt),t.removeTarget=e,this.Bo(t)}}class xU extends Wb{constructor(e,t,i,s,r,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,s,o),this.yt=r,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(A(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=CF(e.writeResults,e.commitTime),i=ve(e.commitTime);return this.listener.Zo(i,t)}return A(!e.writeResults||e.writeResults.length===0),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=Qo(this.yt),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>Yo(this.yt,i))};this.Bo(t)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class OU extends class{}{constructor(e,t,i,s){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.yt=s,this.nu=!1}su(){if(this.nu)throw new y(m.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,r])=>this.connection.ao(e,t,i,s,r)).catch(s=>{throw s.name==="FirebaseError"?(s.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new y(m.UNKNOWN,s.toString())})}_o(e,t,i,s){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,o])=>this.connection._o(e,t,i,r,o,s)).catch(r=>{throw r.name==="FirebaseError"?(r.code===m.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new y(m.UNKNOWN,r.toString())})}terminate(){this.nu=!0}}class MU{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){this.iu===0&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){this.state==="Online"?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,e==="Online"&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(_e(t),this.ou=!1):I("OnlineStateTracker",t)}lu(){this.ru!==null&&(this.ru.cancel(),this.ru=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class LU{constructor(e,t,i,s,r){this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=r,this.mu.Ur(o=>{i.enqueueAndForget(async()=>{bi(this)&&(I("RemoteStore","Restarting streams for network reachability change."),await async function(a){const c=S(a);c._u.add(4),await Pr(c),c.gu.set("Unknown"),c._u.delete(4),await Fa(c)}(this))})}),this.gu=new MU(i,s)}}async function Fa(n){if(bi(n))for(const e of n.wu)await e(!0)}async function Pr(n){for(const e of n.wu)await e(!1)}function Eu(n,e){const t=S(n);t.du.has(e.targetId)||(t.du.set(e.targetId,e),Xp(t)?Yp(t):Or(t).ko()&&Qp(t,e))}function Xo(n,e){const t=S(n),i=Or(t);t.du.delete(e),i.ko()&&Kb(t,e),t.du.size===0&&(i.ko()?i.Fo():bi(t)&&t.gu.set("Unknown"))}function Qp(n,e){n.yu.Ot(e.targetId),Or(n).zo(e)}function Kb(n,e){n.yu.Ot(e),Or(n).Ho(e)}function Yp(n){n.yu=new yF({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>n.du.get(e)||null}),Or(n).start(),n.gu.uu()}function Xp(n){return bi(n)&&!Or(n).No()&&n.du.size>0}function bi(n){return S(n)._u.size===0}function jb(n){n.yu=void 0}async function FU(n){n.du.forEach((e,t)=>{Qp(n,e)})}async function UU(n,e){jb(n),Xp(n)?(n.gu.hu(e),Yp(n)):n.gu.set("Unknown")}async function VU(n,e,t){if(n.gu.set("Online"),e instanceof ob&&e.state===2&&e.cause)try{await async function(i,s){const r=s.cause;for(const o of s.targetIds)i.du.has(o)&&(await i.remoteSyncer.rejectListen(o,r),i.du.delete(o),i.yu.removeTarget(o))}(n,e)}catch(i){I("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),await ol(n,i)}else if(e instanceof pc?n.yu.Kt(e):e instanceof rb?n.yu.Jt(e):n.yu.jt(e),!t.isEqual(R.min()))try{const i=await Lb(n.localStore);t.compareTo(i)>=0&&await function(s,r){const o=s.yu.Zt(r);return o.targetChanges.forEach((a,c)=>{if(a.resumeToken.approximateByteSize()>0){const l=s.du.get(c);l&&s.du.set(c,l.withResumeToken(a.resumeToken,r))}}),o.targetMismatches.forEach(a=>{const c=s.du.get(a);if(!c)return;s.du.set(a,c.withResumeToken(be.EMPTY_BYTE_STRING,c.snapshotVersion)),Kb(s,a);const l=new ti(c.target,a,1,c.sequenceNumber);Qp(s,l)}),s.remoteSyncer.applyRemoteEvent(o)}(n,t)}catch(i){I("RemoteStore","Failed to raise snapshot:",i),await ol(n,i)}}async function ol(n,e,t){if(!Ti(e))throw e;n._u.add(1),await Pr(n),n.gu.set("Offline"),t||(t=()=>Lb(n.localStore)),n.asyncQueue.enqueueRetryable(async()=>{I("RemoteStore","Retrying IndexedDB access"),await t(),n._u.delete(1),await Fa(n)})}function Gb(n,e){return e().catch(t=>ol(n,t,e))}async function xr(n){const e=S(n),t=pi(e);let i=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;$U(e);)try{const s=await SU(e.localStore,i);if(s===null){e.fu.length===0&&t.Fo();break}i=s.batchId,BU(e,s)}catch(s){await ol(e,s)}Hb(e)&&zb(e)}function $U(n){return bi(n)&&n.fu.length<10}function BU(n,e){n.fu.push(e);const t=pi(n);t.ko()&&t.Yo&&t.Xo(e.mutations)}function Hb(n){return bi(n)&&!pi(n).No()&&n.fu.length>0}function zb(n){pi(n).start()}async function qU(n){pi(n).eu()}async function WU(n){const e=pi(n);for(const t of n.fu)e.Xo(t.mutations)}async function KU(n,e,t){const i=n.fu.shift(),s=Up.from(i,e,t);await Gb(n,()=>n.remoteSyncer.applySuccessfulWrite(s)),await xr(n)}async function jU(n,e){e&&pi(n).Yo&&await async function(t,i){if(s=i.code,eb(s)&&s!==m.ABORTED){const r=t.fu.shift();pi(t).Mo(),await Gb(t,()=>t.remoteSyncer.rejectFailedWrite(r.batchId,i)),await xr(t)}var s}(n,e),Hb(n)&&zb(n)}async function fy(n,e){const t=S(n);t.asyncQueue.verifyOperationInProgress(),I("RemoteStore","RemoteStore received new credentials");const i=bi(t);t._u.add(3),await Pr(t),i&&t.gu.set("Unknown"),await t.remoteSyncer.handleCredentialChange(e),t._u.delete(3),await Fa(t)}async function Fd(n,e){const t=S(n);e?(t._u.delete(2),await Fa(t)):e||(t._u.add(2),await Pr(t),t.gu.set("Unknown"))}function Or(n){return n.pu||(n.pu=function(e,t,i){const s=S(e);return s.su(),new PU(t,s.connection,s.authCredentials,s.appCheckCredentials,s.yt,i)}(n.datastore,n.asyncQueue,{Yr:FU.bind(null,n),Zr:UU.bind(null,n),Wo:VU.bind(null,n)}),n.wu.push(async e=>{e?(n.pu.Mo(),Xp(n)?Yp(n):n.gu.set("Unknown")):(await n.pu.stop(),jb(n))})),n.pu}function pi(n){return n.Iu||(n.Iu=function(e,t,i){const s=S(e);return s.su(),new xU(t,s.connection,s.authCredentials,s.appCheckCredentials,s.yt,i)}(n.datastore,n.asyncQueue,{Yr:qU.bind(null,n),Zr:jU.bind(null,n),tu:WU.bind(null,n),Zo:KU.bind(null,n)}),n.wu.push(async e=>{e?(n.Iu.Mo(),await xr(n)):(await n.Iu.stop(),n.fu.length>0&&(I("RemoteStore",`Stopping write stream with ${n.fu.length} pending writes`),n.fu=[]))})),n.Iu}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jp{constructor(e,t,i,s,r){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=s,this.removalCallback=r,this.deferred=new xe,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}static createAndSchedule(e,t,i,s,r){const o=Date.now()+i,a=new Jp(e,t,o,s,r);return a.start(i),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new y(m.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Mr(n,e){if(_e("AsyncQueue",`${e}: ${n}`),Ti(n))return new y(m.UNAVAILABLE,`${e}: ${n}`);throw n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gs{constructor(e){this.comparator=e?(t,i)=>e(t,i)||b.comparator(t.key,i.key):(t,i)=>b.comparator(t.key,i.key),this.keyedMap=no(),this.sortedSet=new pe(this.comparator)}static emptySet(e){return new Gs(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Gs)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const s=t.getNext().key,r=i.getNext().key;if(!s.isEqual(r))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){const i=new Gs;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class py{constructor(){this.Tu=new pe(b.comparator)}track(e){const t=e.doc.key,i=this.Tu.get(t);i?e.type!==0&&i.type===3?this.Tu=this.Tu.insert(t,e):e.type===3&&i.type!==1?this.Tu=this.Tu.insert(t,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.Tu=this.Tu.remove(t):e.type===1&&i.type===2?this.Tu=this.Tu.insert(t,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):C():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal((t,i)=>{e.push(i)}),e}}class pr{constructor(e,t,i,s,r,o,a,c,l){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=s,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=c,this.hasCachedResults=l}static fromInitialDocuments(e,t,i,s,r){const o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new pr(e,t,Gs.emptySet(t),o,i,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Da(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let s=0;s<t.length;s++)if(t[s].type!==i[s].type||!t[s].doc.isEqual(i[s].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GU{constructor(){this.Au=void 0,this.listeners=[]}}class HU{constructor(){this.queries=new Ei(e=>qE(e),Da),this.onlineState="Unknown",this.Ru=new Set}}async function Zp(n,e){const t=S(n),i=e.query;let s=!1,r=t.queries.get(i);if(r||(s=!0,r=new GU),s)try{r.Au=await t.onListen(i)}catch(o){const a=Mr(o,`Initialization of query '${Rd(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,r),r.listeners.push(e),e.bu(t.onlineState),r.Au&&e.Pu(r.Au)&&tg(t)}async function eg(n,e){const t=S(n),i=e.query;let s=!1;const r=t.queries.get(i);if(r){const o=r.listeners.indexOf(e);o>=0&&(r.listeners.splice(o,1),s=r.listeners.length===0)}if(s)return t.queries.delete(i),t.onUnlisten(i)}function zU(n,e){const t=S(n);let i=!1;for(const s of e){const r=s.query,o=t.queries.get(r);if(o){for(const a of o.listeners)a.Pu(s)&&(i=!0);o.Au=s}}i&&tg(t)}function QU(n,e,t){const i=S(n),s=i.queries.get(e);if(s)for(const r of s.listeners)r.onError(t);i.queries.delete(e)}function tg(n){n.Ru.forEach(e=>{e.next()})}class ng{constructor(e,t,i){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=i||{}}Pu(e){if(!this.options.includeMetadataChanges){const i=[];for(const s of e.docChanges)s.type!==3&&i.push(s);e=new pr(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){if(!e.fromCache)return!0;const i=t!=="Offline";return(!this.options.Nu||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Du(e){if(e.docChanges.length>0)return!0;const t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}xu(e){e=pr.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YU{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gy{constructor(e){this.yt=e}Ji(e){return ln(this.yt,e)}Yi(e){return e.metadata.exists?hb(this.yt,e.document,!1):ne.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return ve(e)}}class XU{constructor(e,t,i){this.Mu=e,this.localStore=t,this.yt=i,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Qb(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const i=K.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(i.get(i.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,i=new gy(this.yt);for(const s of e)if(s.metadata.queries){const r=i.Ji(s.metadata.name);for(const o of s.metadata.queries){const a=(t.get(o)||F()).add(r);t.set(o,a)}}return t}async complete(){const e=await CU(this.localStore,new gy(this.yt),this.documents,this.Mu.id),t=this.$u(this.documents);for(const i of this.queries)await kU(this.localStore,i,t.get(i.name));return this.progress.taskState="Success",{progress:this.progress,Bu:this.collectionGroups,Lu:e}}}function Qb(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yb{constructor(e){this.key=e}}class Xb{constructor(e){this.key=e}}class Jb{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=F(),this.mutatedKeys=F(),this.Gu=KE(e),this.Qu=new Gs(this.Gu)}get ju(){return this.qu}Wu(e,t){const i=t?t.zu:new py,s=t?t.Qu:this.Qu;let r=t?t.mutatedKeys:this.mutatedKeys,o=s,a=!1;const c=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,l=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(e.inorderTraversal((u,h)=>{const d=s.get(u),f=Pa(this.query,h)?h:null,p=!!d&&this.mutatedKeys.has(d.key),_=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations);let w=!1;d&&f?d.data.isEqual(f.data)?p!==_&&(i.track({type:3,doc:f}),w=!0):this.Hu(d,f)||(i.track({type:2,doc:f}),w=!0,(c&&this.Gu(f,c)>0||l&&this.Gu(f,l)<0)&&(a=!0)):!d&&f?(i.track({type:0,doc:f}),w=!0):d&&!f&&(i.track({type:1,doc:d}),w=!0,(c||l)&&(a=!0)),w&&(f?(o=o.add(f),r=_?r.add(u):r.delete(u)):(o=o.delete(u),r=r.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){const u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),r=r.delete(u.key),i.track({type:1,doc:u})}return{Qu:o,zu:i,$i:a,mutatedKeys:r}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i){const s=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const r=e.zu.Eu();r.sort((l,u)=>function(h,d){const f=p=>{switch(p){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return C()}};return f(h)-f(d)}(l.type,u.type)||this.Gu(l.doc,u.doc)),this.Ju(i);const o=t?this.Yu():[],a=this.Ku.size===0&&this.current?1:0,c=a!==this.Uu;return this.Uu=a,r.length!==0||c?{snapshot:new pr(this.query,e.Qu,s,r,e.mutatedKeys,a===0,c,!1,!!i&&i.resumeToken.approximateByteSize()>0),Xu:o}:{Xu:o}}bu(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new py,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(t=>this.qu=this.qu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qu=this.qu.delete(t)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=F(),this.Qu.forEach(i=>{this.Zu(i.key)&&(this.Ku=this.Ku.add(i.key))});const t=[];return e.forEach(i=>{this.Ku.has(i)||t.push(new Xb(i))}),this.Ku.forEach(i=>{e.has(i)||t.push(new Yb(i))}),t}tc(e){this.qu=e.Hi,this.Ku=F();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return pr.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,this.Uu===0,this.hasCachedResults)}}class JU{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class ZU{constructor(e){this.key=e,this.nc=!1}}class eV{constructor(e,t,i,s,r,o){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.sc={},this.ic=new Ei(a=>qE(a),Da),this.rc=new Map,this.oc=new Set,this.uc=new pe(b.comparator),this.cc=new Map,this.ac=new Wp,this.hc={},this.lc=new Map,this.fc=ds.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return this.dc===!0}}async function tV(n,e){const t=ag(n);let i,s;const r=t.ic.get(e);if(r)i=r.targetId,t.sharedClientState.addLocalQueryTarget(i),s=r.view.ec();else{const o=await dr(t.localStore,It(e));t.isPrimaryClient&&Eu(t.remoteStore,o);const a=t.sharedClientState.addLocalQueryTarget(o.targetId);i=o.targetId,s=await ig(t,e,i,a==="current",o.resumeToken)}return s}async function ig(n,e,t,i,s){n._c=(h,d,f)=>async function(p,_,w,N){let M=_.view.Wu(w);M.$i&&(M=await il(p.localStore,_.query,!1).then(({documents:Q})=>_.view.Wu(Q,M)));const x=N&&N.targetChanges.get(_.targetId),U=_.view.applyChanges(M,p.isPrimaryClient,x);return Ud(p,_.targetId,U.Xu),U.snapshot}(n,h,d,f);const r=await il(n.localStore,e,!0),o=new Jb(e,r.Hi),a=o.Wu(r.documents),c=Ma.createSynthesizedTargetChangeForCurrentChange(t,i&&n.onlineState!=="Offline",s),l=o.applyChanges(a,n.isPrimaryClient,c);Ud(n,t,l.Xu);const u=new JU(e,t,o);return n.ic.set(e,u),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),l.snapshot}async function nV(n,e){const t=S(n),i=t.ic.get(e),s=t.rc.get(i.targetId);if(s.length>1)return t.rc.set(i.targetId,s.filter(r=>!Da(r,e))),void t.ic.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(i.targetId),t.sharedClientState.isActiveQueryTarget(i.targetId)||await fr(t.localStore,i.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(i.targetId),Xo(t.remoteStore,i.targetId),gr(t,i.targetId)}).catch(Ii)):(gr(t,i.targetId),await fr(t.localStore,i.targetId,!0))}async function iV(n,e,t){const i=cg(n);try{const s=await function(r,o){const a=S(r),c=ce.now(),l=o.reduce((d,f)=>d.add(f.key),F());let u,h;return a.persistence.runTransaction("Locally write mutations","readwrite",d=>{let f=wt(),p=F();return a.Gi.getEntries(d,l).next(_=>{f=_,f.forEach((w,N)=>{N.isValidDocument()||(p=p.add(w))})}).next(()=>a.localDocuments.getOverlayedDocuments(d,f)).next(_=>{u=_;const w=[];for(const N of o){const M=dF(N,u.get(N.key).overlayedDocument);M!=null&&w.push(new Vn(N.key,M,$E(M.value.mapValue),ae.exists(!0)))}return a.mutationQueue.addMutationBatch(d,c,w,o)}).next(_=>{h=_;const w=_.applyToLocalDocumentSet(u,p);return a.documentOverlayCache.saveOverlays(d,_.batchId,w)})}).then(()=>({batchId:h.batchId,changes:ib(u)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(s.batchId),function(r,o,a){let c=r.hc[r.currentUser.toKey()];c||(c=new pe(L)),c=c.insert(o,a),r.hc[r.currentUser.toKey()]=c}(i,s.batchId,t),await $n(i,s.changes),await xr(i.remoteStore)}catch(s){const r=Mr(s,"Failed to persist write");t.reject(r)}}async function Zb(n,e){const t=S(n);try{const i=await bU(t.localStore,e);e.targetChanges.forEach((s,r)=>{const o=t.cc.get(r);o&&(A(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1),s.addedDocuments.size>0?o.nc=!0:s.modifiedDocuments.size>0?A(o.nc):s.removedDocuments.size>0&&(A(o.nc),o.nc=!1))}),await $n(t,i,e)}catch(i){await Ii(i)}}function my(n,e,t){const i=S(n);if(i.isPrimaryClient&&t===0||!i.isPrimaryClient&&t===1){const s=[];i.ic.forEach((r,o)=>{const a=o.view.bu(e);a.snapshot&&s.push(a.snapshot)}),function(r,o){const a=S(r);a.onlineState=o;let c=!1;a.queries.forEach((l,u)=>{for(const h of u.listeners)h.bu(o)&&(c=!0)}),c&&tg(a)}(i.eventManager,e),s.length&&i.sc.Wo(s),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function sV(n,e,t){const i=S(n);i.sharedClientState.updateQueryState(e,"rejected",t);const s=i.cc.get(e),r=s&&s.key;if(r){let o=new pe(b.comparator);o=o.insert(r,ne.newNoDocument(r,R.min()));const a=F().add(r),c=new Oa(R.min(),new Map,new J(L),o,a);await Zb(i,c),i.uc=i.uc.remove(r),i.cc.delete(e),og(i)}else await fr(i.localStore,e,!1).then(()=>gr(i,e,t)).catch(Ii)}async function rV(n,e){const t=S(n),i=e.batch.batchId;try{const s=await EU(t.localStore,e);rg(t,i,null),sg(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),await $n(t,s)}catch(s){await Ii(s)}}async function oV(n,e,t){const i=S(n);try{const s=await function(r,o){const a=S(r);return a.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return a.mutationQueue.lookupMutationBatch(c,o).next(u=>(A(u!==null),l=u.keys(),a.mutationQueue.removeMutationBatch(c,u))).next(()=>a.mutationQueue.performConsistencyCheck(c)).next(()=>a.documentOverlayCache.removeOverlaysForBatchId(c,l,o)).next(()=>a.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>a.localDocuments.getDocuments(c,l))})}(i.localStore,e);rg(i,e,t),sg(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),await $n(i,s)}catch(s){await Ii(s)}}async function aV(n,e){const t=S(n);bi(t.remoteStore)||I("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const i=await function(r){const o=S(r);return o.persistence.runTransaction("Get highest unacknowledged batch id","readonly",a=>o.mutationQueue.getHighestUnacknowledgedBatchId(a))}(t.localStore);if(i===-1)return void e.resolve();const s=t.lc.get(i)||[];s.push(e),t.lc.set(i,s)}catch(i){const s=Mr(i,"Initialization of waitForPendingWrites() operation failed");e.reject(s)}}function sg(n,e){(n.lc.get(e)||[]).forEach(t=>{t.resolve()}),n.lc.delete(e)}function rg(n,e,t){const i=S(n);let s=i.hc[i.currentUser.toKey()];if(s){const r=s.get(e);r&&(t?r.reject(t):r.resolve(),s=s.remove(e)),i.hc[i.currentUser.toKey()]=s}}function gr(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.rc.get(e))n.ic.delete(i),t&&n.sc.wc(i,t);n.rc.delete(e),n.isPrimaryClient&&n.ac.ls(e).forEach(i=>{n.ac.containsKey(i)||eS(n,i)})}function eS(n,e){n.oc.delete(e.path.canonicalString());const t=n.uc.get(e);t!==null&&(Xo(n.remoteStore,t),n.uc=n.uc.remove(e),n.cc.delete(t),og(n))}function Ud(n,e,t){for(const i of t)i instanceof Yb?(n.ac.addReference(i.key,e),cV(n,i)):i instanceof Xb?(I("SyncEngine","Document no longer in limbo: "+i.key),n.ac.removeReference(i.key,e),n.ac.containsKey(i.key)||eS(n,i.key)):C()}function cV(n,e){const t=e.key,i=t.path.canonicalString();n.uc.get(t)||n.oc.has(i)||(I("SyncEngine","New document in limbo: "+t),n.oc.add(i),og(n))}function og(n){for(;n.oc.size>0&&n.uc.size<n.maxConcurrentLimboResolutions;){const e=n.oc.values().next().value;n.oc.delete(e);const t=new b(K.fromString(e)),i=n.fc.next();n.cc.set(i,new ZU(t)),n.uc=n.uc.insert(t,i),Eu(n.remoteStore,new ti(It(Rr(t.path)),i,2,yt.at))}}async function $n(n,e,t){const i=S(n),s=[],r=[],o=[];i.ic.isEmpty()||(i.ic.forEach((a,c)=>{o.push(i._c(c,e,t).then(l=>{if((l||t)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(c.targetId,l!=null&&l.fromCache?"not-current":"current"),l){s.push(l);const u=Gp.Ci(c.targetId,l);r.push(u)}}))}),await Promise.all(o),i.sc.Wo(s),await async function(a,c){const l=S(a);try{await l.persistence.runTransaction("notifyLocalViewChanges","readwrite",u=>g.forEach(c,h=>g.forEach(h.Si,d=>l.persistence.referenceDelegate.addReference(u,h.targetId,d)).next(()=>g.forEach(h.Di,d=>l.persistence.referenceDelegate.removeReference(u,h.targetId,d)))))}catch(u){if(!Ti(u))throw u;I("LocalStore","Failed to update sequence numbers: "+u)}for(const u of c){const h=u.targetId;if(!u.fromCache){const d=l.qi.get(h),f=d.snapshotVersion,p=d.withLastLimboFreeSnapshotVersion(f);l.qi=l.qi.insert(h,p)}}}(i.localStore,r))}async function lV(n,e){const t=S(n);if(!t.currentUser.isEqual(e)){I("SyncEngine","User change. New user:",e.toKey());const i=await Mb(t.localStore,e);t.currentUser=e,function(s,r){s.lc.forEach(o=>{o.forEach(a=>{a.reject(new y(m.CANCELLED,r))})}),s.lc.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await $n(t,i.ji)}}function uV(n,e){const t=S(n),i=t.cc.get(e);if(i&&i.nc)return F().add(i.key);{let s=F();const r=t.rc.get(e);if(!r)return s;for(const o of r){const a=t.ic.get(o);s=s.unionWith(a.view.ju)}return s}}async function hV(n,e){const t=S(n),i=await il(t.localStore,e.query,!0),s=e.view.tc(i);return t.isPrimaryClient&&Ud(t,e.targetId,s.Xu),s}async function dV(n,e){const t=S(n);return Vb(t.localStore,e).then(i=>$n(t,i))}async function fV(n,e,t,i){const s=S(n),r=await function(o,a){const c=S(o),l=S(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",u=>l.Tn(u,a).next(h=>h?c.localDocuments.getDocuments(u,h):g.resolve(null)))}(s.localStore,e);r!==null?(t==="pending"?await xr(s.remoteStore):t==="acknowledged"||t==="rejected"?(rg(s,e,i||null),sg(s,e),function(o,a){S(S(o).mutationQueue).An(a)}(s.localStore,e)):C(),await $n(s,r)):I("SyncEngine","Cannot apply mutation batch with id: "+e)}async function pV(n,e){const t=S(n);if(ag(t),cg(t),e===!0&&t.dc!==!0){const i=t.sharedClientState.getAllActiveQueryTargets(),s=await _y(t,i.toArray());t.dc=!0,await Fd(t.remoteStore,!0);for(const r of s)Eu(t.remoteStore,r)}else if(e===!1&&t.dc!==!1){const i=[];let s=Promise.resolve();t.rc.forEach((r,o)=>{t.sharedClientState.isLocalQueryTarget(o)?i.push(o):s=s.then(()=>(gr(t,o),fr(t.localStore,o,!0))),Xo(t.remoteStore,o)}),await s,await _y(t,i),function(r){const o=S(r);o.cc.forEach((a,c)=>{Xo(o.remoteStore,c)}),o.ac.fs(),o.cc=new Map,o.uc=new pe(b.comparator)}(t),t.dc=!1,await Fd(t.remoteStore,!1)}}async function _y(n,e,t){const i=S(n),s=[],r=[];for(const o of e){let a;const c=i.rc.get(o);if(c&&c.length!==0){a=await dr(i.localStore,It(c[0]));for(const l of c){const u=i.ic.get(l),h=await hV(i,u);h.snapshot&&r.push(h.snapshot)}}else{const l=await Ub(i.localStore,o);a=await dr(i.localStore,l),await ig(i,tS(l),o,!1,a.resumeToken)}s.push(a)}return i.sc.Wo(r),s}function tS(n){return BE(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function gV(n){const e=S(n);return S(S(e.localStore).persistence).vi()}async function mV(n,e,t,i){const s=S(n);if(s.dc)return void I("SyncEngine","Ignoring unexpected query state notification.");const r=s.rc.get(e);if(r&&r.length>0)switch(t){case"current":case"not-current":{const o=await Vb(s.localStore,WE(r[0])),a=Oa.createSynthesizedRemoteEventForCurrentChange(e,t==="current",be.EMPTY_BYTE_STRING);await $n(s,o,a);break}case"rejected":await fr(s.localStore,e,!0),gr(s,e,i);break;default:C()}}async function _V(n,e,t){const i=ag(n);if(i.dc){for(const s of e){if(i.rc.has(s)){I("SyncEngine","Adding an already active target "+s);continue}const r=await Ub(i.localStore,s),o=await dr(i.localStore,r);await ig(i,tS(r),o.targetId,!1,o.resumeToken),Eu(i.remoteStore,o)}for(const s of t)i.rc.has(s)&&await fr(i.localStore,s,!1).then(()=>{Xo(i.remoteStore,s),gr(i,s)}).catch(Ii)}}function ag(n){const e=S(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Zb.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=uV.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=sV.bind(null,e),e.sc.Wo=zU.bind(null,e.eventManager),e.sc.wc=QU.bind(null,e.eventManager),e}function cg(n){const e=S(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=rV.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=oV.bind(null,e),e}function yV(n,e,t){const i=S(n);(async function(s,r,o){try{const a=await r.getMetadata();if(await function(h,d){const f=S(h),p=ve(d.createTime);return f.persistence.runTransaction("hasNewerBundle","readonly",_=>f.Ns.getBundleMetadata(_,d.id)).then(_=>!!_&&_.createTime.compareTo(p)>=0)}(s.localStore,a))return await r.close(),o._completeWith(function(h){return{taskState:"Success",documentsLoaded:h.totalDocuments,bytesLoaded:h.totalBytes,totalDocuments:h.totalDocuments,totalBytes:h.totalBytes}}(a)),Promise.resolve(new Set);o._updateProgress(Qb(a));const c=new XU(a,s.localStore,r.yt);let l=await r.mc();for(;l;){const h=await c.Fu(l);h&&o._updateProgress(h),l=await r.mc()}const u=await c.complete();return await $n(s,u.Lu,void 0),await function(h,d){const f=S(h);return f.persistence.runTransaction("Save bundle","readwrite",p=>f.Ns.saveBundleMetadata(p,d))}(s.localStore,a),o._completeWith(u.progress),Promise.resolve(u.Bu)}catch(a){return rr("SyncEngine",`Loading bundle failed with ${a}`),o._failWith(a),Promise.resolve(new Set)}})(i,e,t).then(s=>{i.sharedClientState.notifyBundleLoaded(s)})}class nS{constructor(){this.synchronizeTabs=!1}async initialize(e){this.yt=La(e.databaseInfo.databaseId),this.sharedClientState=this.gc(e),this.persistence=this.yc(e),await this.persistence.start(),this.localStore=this.Ic(e),this.gcScheduler=this.Tc(e,this.localStore),this.indexBackfillerScheduler=this.Ec(e,this.localStore)}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return Ob(this.persistence,new xb,e.initialUser,this.yt)}yc(e){return new Pb(Tu.Bs,this.yt)}gc(e){return new Bb}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class iS extends nS{constructor(e,t,i){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ac.initialize(this,e),await cg(this.Ac.syncEngine),await xr(this.Ac.remoteStore),await this.persistence.li(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}Ic(e){return Ob(this.persistence,new xb,e.initialUser,this.yt)}Tc(e,t){const i=this.persistence.referenceDelegate.garbageCollector;return new cU(i,e.asyncQueue,t)}Ec(e,t){const i=new G1(t,this.persistence);return new j1(e.asyncQueue,i)}yc(e){const t=jp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=this.cacheSizeBytes!==void 0?gt.withCacheSize(this.cacheSizeBytes):gt.DEFAULT;return new Kp(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,qb(),mc(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new Bb}}class vV extends iS{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const t=this.Ac.syncEngine;this.sharedClientState instanceof gh&&(this.sharedClientState.syncEngine={Fr:fV.bind(null,t),$r:mV.bind(null,t),Br:_V.bind(null,t),vi:gV.bind(null,t),Mr:dV.bind(null,t)},await this.sharedClientState.start()),await this.persistence.li(async i=>{await pV(this.Ac.syncEngine,i),this.gcScheduler&&(i&&!this.gcScheduler.started?this.gcScheduler.start():i||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(i&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():i||this.indexBackfillerScheduler.stop())})}gc(e){const t=qb();if(!gh.C(t))throw new y(m.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const i=jp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new gh(t,e.asyncQueue,i,e.clientId,e.initialUser)}}class lg{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>my(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=lV.bind(null,this.syncEngine),await Fd(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new HU}createDatastore(e){const t=La(e.databaseInfo.databaseId),i=(s=e.databaseInfo,new DU(s));var s;return function(r,o,a,c){return new OU(r,o,a,c)}(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return t=this.localStore,i=this.datastore,s=e.asyncQueue,r=a=>my(this.syncEngine,a,0),o=dy.C()?new dy:new AU,new LU(t,i,s,r,o);var t,i,s,r,o}createSyncEngine(e,t){return function(i,s,r,o,a,c,l){const u=new eV(i,s,r,o,a,c);return l&&(u.dc=!0),u}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return async function(e){const t=S(e);I("RemoteStore","RemoteStore shutting down."),t._u.add(5),await Pr(t),t.mu.shutdown(),t.gu.set("Unknown")}(this.remoteStore)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ug(n,e,t){if(!t)throw new y(m.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function sS(n,e,t,i){if(e===!0&&i===!0)throw new y(m.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function yy(n){if(!b.isDocumentKey(n))throw new y(m.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function vy(n){if(b.isDocumentKey(n))throw new y(m.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function bu(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":C()}function j(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new y(m.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=bu(n);throw new y(m.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function rS(n,e){if(e<=0)throw new y(m.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wy=new Map;class Iy{constructor(e){var t;if(e.host===void 0){if(e.ssl!==void 0)throw new y(m.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new y(m.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,sS("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ua{constructor(e,t,i,s){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Iy({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new y(m.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Iy(e),e.credentials!==void 0&&(this._authCredentials=function(t){if(!t)return new x1;switch(t.type){case"gapi":const i=t.client;return new F1(i,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new y(m.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=wy.get(e);t&&(I("ComponentProvider","Removing Datastore"),wy.delete(e),t.terminate())}(this),Promise.resolve()}}function wV(n,e,t,i={}){var s;const r=(n=j(n,Ua))._getSettings();if(r.host!=="firestore.googleapis.com"&&r.host!==e&&rr("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},r),{host:`${e}:${t}`,ssl:!1})),i.mockUserToken){let o,a;if(typeof i.mockUserToken=="string")o=i.mockUserToken,a=Ne.MOCK_USER;else{o=Xd(i.mockUserToken,(s=n._app)===null||s===void 0?void 0:s.options.projectId);const c=i.mockUserToken.sub||i.mockUserToken.user_id;if(!c)throw new y(m.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new Ne(c)}n._authCredentials=new O1(new IE(o,a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ie{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new un(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ie(this.firestore,e,this._key)}}class Xe{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new Xe(this.firestore,e,this._query)}}class un extends Xe{constructor(e,t,i){super(e,t,Rr(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ie(this.firestore,null,new b(e))}withConverter(e){return new un(this.firestore,e,this._path)}}function oS(n,e,...t){if(n=v(n),ug("collection","path",e),n instanceof Ua){const i=K.fromString(e,...t);return vy(i),new un(n,null,i)}{if(!(n instanceof ie||n instanceof un))throw new y(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(K.fromString(e,...t));return vy(i),new un(n.firestore,null,i)}}function IV(n,e){if(n=j(n,Ua),ug("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new y(m.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Xe(n,null,function(t){return new Un(K.emptyPath(),t)}(e))}function al(n,e,...t){if(n=v(n),arguments.length===1&&(e=TE.R()),ug("doc","path",e),n instanceof Ua){const i=K.fromString(e,...t);return yy(i),new ie(n,null,new b(i))}{if(!(n instanceof ie||n instanceof un))throw new y(m.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(K.fromString(e,...t));return yy(i),new ie(n.firestore,n instanceof un?n.converter:null,new b(i))}}function aS(n,e){return n=v(n),e=v(e),(n instanceof ie||n instanceof un)&&(e instanceof ie||e instanceof un)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function cS(n,e){return n=v(n),e=v(e),n instanceof Xe&&e instanceof Xe&&n.firestore===e.firestore&&Da(n._query,e._query)&&n.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ty(n,e=10240){let t=0;return{async read(){if(t<n.byteLength){const i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Su{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):_e("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TV{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new xe,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(i=>{i&&i.Ou()?this.metadata.resolve(i.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(i==null?void 0:i.ku)}`))},i=>this.metadata.reject(i))}close(){return this.Pc.cancel()}async getMetadata(){return this.metadata.promise}async mc(){return await this.getMetadata(),this.Vc()}async Vc(){const e=await this.Sc();if(e===null)return null;const t=this.vc.decode(e),i=Number(t);isNaN(i)&&this.Dc(`length string (${t}) is not valid number`);const s=await this.Cc(i);return new YU(JSON.parse(s),e.length+i)}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async Sc(){for(;this.xc()<0&&!await this.Nc(););if(this.buffer.length===0)return null;const e=this.xc();e<0&&this.Dc("Reached the end of bundle when a length string is expected.");const t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t}async Cc(e){for(;this.buffer.length<e;)await this.Nc()&&this.Dc("Reached the end of bundle when more is expected.");const t=this.vc.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t}Dc(e){throw this.Pc.cancel(),new Error(`Invalid bundle format: ${e}`)}async Nc(){const e=await this.Pc.read();if(!e.done){const t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EV{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new y(m.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const t=await async function(i,s){const r=S(i),o=Qo(r.yt)+"/documents",a={documents:s.map(h=>zo(r.yt,h))},c=await r._o("BatchGetDocuments",o,a,s.length),l=new Map;c.forEach(h=>{const d=bF(r.yt,h);l.set(d.key.toString(),d)});const u=[];return s.forEach(h=>{const d=l.get(h.toString());A(!!d),u.push(d)}),u}(this.datastore,e);return t.forEach(i=>this.recordVersion(i)),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastWriteError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new Dr(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,i)=>{const s=b.fromPath(i);this.mutations.push(new Mp(s,this.precondition(s)))}),await async function(t,i){const s=S(t),r=Qo(s.yt)+"/documents",o={writes:i.map(a=>Yo(s.yt,a))};await s.ao("Commit",r,o)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw C();t=R.min()}const i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new y(m.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(R.min())?ae.exists(!1):ae.updateTime(t):ae.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(R.min()))throw new y(m.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ae.updateTime(t)}return ae.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bV{constructor(e,t,i,s,r){this.asyncQueue=e,this.datastore=t,this.options=i,this.updateFunction=s,this.deferred=r,this.kc=i.maxAttempts,this.xo=new zp(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){this.xo.Ro(async()=>{const e=new EV(this.datastore),t=this.Mc(e);t&&t.then(i=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(i)}).catch(s=>{this.Fc(s)}))}).catch(i=>{this.Fc(i)})})}Mc(e){try{const t=this.updateFunction(e);return!Ra(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if(e.name==="FirebaseError"){const t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!eb(t)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SV{constructor(e,t,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=s,this.user=Ne.UNAUTHENTICATED,this.clientId=TE.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,async r=>{I("FirestoreClient","Received user=",r.uid),await this.authCredentialListener(r),this.user=r}),this.appCheckCredentials.start(i,r=>(I("FirestoreClient","Received new app check token=",r),this.appCheckCredentialListener(r,this.user)))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new y(m.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const e=new xe;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const i=Mr(t,"Failed to shutdown persistence");e.reject(i)}}),e.promise}}async function lS(n,e){n.asyncQueue.verifyOperationInProgress(),I("FirestoreClient","Initializing OfflineComponentProvider");const t=await n.getConfiguration();await e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(async s=>{i.isEqual(s)||(await Mb(e.localStore,s),i=s)}),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}async function uS(n,e){n.asyncQueue.verifyOperationInProgress();const t=await hg(n);I("FirestoreClient","Initializing OnlineComponentProvider");const i=await n.getConfiguration();await e.initialize(t,i),n.setCredentialChangeListener(s=>fy(e.remoteStore,s)),n.setAppCheckTokenChangeListener((s,r)=>fy(e.remoteStore,r)),n.onlineComponents=e}async function hg(n){return n.offlineComponents||(I("FirestoreClient","Using default OfflineComponentProvider"),await lS(n,new nS)),n.offlineComponents}async function Cu(n){return n.onlineComponents||(I("FirestoreClient","Using default OnlineComponentProvider"),await uS(n,new lg)),n.onlineComponents}function hS(n){return hg(n).then(e=>e.persistence)}function dg(n){return hg(n).then(e=>e.localStore)}function dS(n){return Cu(n).then(e=>e.remoteStore)}function fg(n){return Cu(n).then(e=>e.syncEngine)}function CV(n){return Cu(n).then(e=>e.datastore)}async function mr(n){const e=await Cu(n),t=e.eventManager;return t.onListen=tV.bind(null,e.syncEngine),t.onUnlisten=nV.bind(null,e.syncEngine),t}function kV(n){return n.asyncQueue.enqueue(async()=>{const e=await hS(n),t=await dS(n);return e.setNetworkEnabled(!0),function(i){const s=S(i);return s._u.delete(0),Fa(s)}(t)})}function AV(n){return n.asyncQueue.enqueue(async()=>{const e=await hS(n),t=await dS(n);return e.setNetworkEnabled(!1),async function(i){const s=S(i);s._u.add(0),await Pr(s),s.gu.set("Offline")}(t)})}function RV(n,e){const t=new xe;return n.asyncQueue.enqueueAndForget(async()=>async function(i,s,r){try{const o=await function(a,c){const l=S(a);return l.persistence.runTransaction("read document","readonly",u=>l.localDocuments.getDocument(u,c))}(i,s);o.isFoundDocument()?r.resolve(o):o.isNoDocument()?r.resolve(null):r.reject(new y(m.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(o){const a=Mr(o,`Failed to get document '${s} from cache`);r.reject(a)}}(await dg(n),e,t)),t.promise}function fS(n,e,t={}){const i=new xe;return n.asyncQueue.enqueueAndForget(async()=>function(s,r,o,a,c){const l=new Su({next:h=>{r.enqueueAndForget(()=>eg(s,u));const d=h.docs.has(o);!d&&h.fromCache?c.reject(new y(m.UNAVAILABLE,"Failed to get document because the client is offline.")):d&&h.fromCache&&a&&a.source==="server"?c.reject(new y(m.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(h)},error:h=>c.reject(h)}),u=new ng(Rr(o.path),l,{includeMetadataChanges:!0,Nu:!0});return Zp(s,u)}(await mr(n),n.asyncQueue,e,t,i)),i.promise}function NV(n,e){const t=new xe;return n.asyncQueue.enqueueAndForget(async()=>async function(i,s,r){try{const o=await il(i,s,!0),a=new Jb(s,o.Hi),c=a.Wu(o.documents),l=a.applyChanges(c,!1);r.resolve(l.snapshot)}catch(o){const a=Mr(o,`Failed to execute query '${s} against cache`);r.reject(a)}}(await dg(n),e,t)),t.promise}function pS(n,e,t={}){const i=new xe;return n.asyncQueue.enqueueAndForget(async()=>function(s,r,o,a,c){const l=new Su({next:h=>{r.enqueueAndForget(()=>eg(s,u)),h.fromCache&&a.source==="server"?c.reject(new y(m.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(h)},error:h=>c.reject(h)}),u=new ng(o,l,{includeMetadataChanges:!0,Nu:!0});return Zp(s,u)}(await mr(n),n.asyncQueue,e,t,i)),i.promise}function DV(n,e){const t=new Su(e);return n.asyncQueue.enqueueAndForget(async()=>function(i,s){S(i).Ru.add(s),s.next()}(await mr(n),t)),()=>{t.bc(),n.asyncQueue.enqueueAndForget(async()=>function(i,s){S(i).Ru.delete(s)}(await mr(n),t))}}function PV(n,e,t,i){const s=function(r,o){let a;return a=typeof r=="string"?new TextEncoder().encode(r):r,function(c,l){return new TV(c,l)}(function(c,l){if(c instanceof Uint8Array)return Ty(c,l);if(c instanceof ArrayBuffer)return Ty(new Uint8Array(c),l);if(c instanceof ReadableStream)return c.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(a),o)}(t,La(e));n.asyncQueue.enqueueAndForget(async()=>{yV(await fg(n),s,i)})}function xV(n,e){return n.asyncQueue.enqueue(async()=>function(t,i){const s=S(t);return s.persistence.runTransaction("Get named query","readonly",r=>s.Ns.getNamedQuery(r,i))}(await dg(n),e))}class OV{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new zp(this,"async_queue_retry"),this.Wc=()=>{const t=mc();t&&I("AsyncQueue","Visibility state changed to "+t.visibilityState),this.xo.Po()};const e=mc();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=mc();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const t=new xe;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}async Jc(){if(this.Lc.length!==0){try{await this.Lc[0](),this.Lc.shift(),this.xo.reset()}catch(e){if(!Ti(e))throw e;I("AsyncQueue","Operation failed with retryable error: "+e)}this.Lc.length>0&&this.xo.Ro(()=>this.Jc())}}Hc(e){const t=this.Bc.then(()=>(this.Gc=!0,e().catch(i=>{this.Kc=i,this.Gc=!1;const s=function(r){let o=r.message||"";return r.stack&&(o=r.stack.includes(r.message)?r.stack:r.message+`
`+r.stack),o}(i);throw _e("INTERNAL UNHANDLED ERROR: ",s),i}).then(i=>(this.Gc=!1,i))));return this.Bc=t,t}enqueueAfterDelay(e,t,i){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const s=Jp.createAndSchedule(this,e,t,i,r=>this.Yc(r));return this.Uc.push(s),s}zc(){this.Kc&&C()}verifyOperationInProgress(){}async Xc(){let e;do e=this.Bc,await e;while(e!==this.Bc)}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.Uc.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.Uc)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function Vd(n){return function(e,t){if(typeof e!="object"||e===null)return!1;const i=e;for(const s of t)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}class MV{constructor(){this._progressObserver={},this._taskCompletionResolver=new xe,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,i){this._progressObserver={next:e,error:t,complete:i}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LV=-1;class ge extends Ua{constructor(e,t,i,s){super(e,t,i,s),this.type="firestore",this._queue=new OV,this._persistenceKey=(s==null?void 0:s.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||gS(this),this._firestoreClient.terminate()}}function qe(n){return n._firestoreClient||gS(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function gS(n){var e;const t=n._freezeSettings(),i=function(s,r,o,a){return new H1(s,r,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,a.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,t);n._firestoreClient=new SV(n._authCredentials,n._appCheckCredentials,n._queue,i)}function FV(n,e){_S(n=j(n,ge));const t=qe(n),i=n._freezeSettings(),s=new lg;return mS(t,s,new iS(s,i.cacheSizeBytes,e==null?void 0:e.forceOwnership))}function UV(n){_S(n=j(n,ge));const e=qe(n),t=n._freezeSettings(),i=new lg;return mS(e,i,new vV(i,t.cacheSizeBytes))}function mS(n,e,t){const i=new xe;return n.asyncQueue.enqueue(async()=>{try{await lS(n,t),await uS(n,e),i.resolve()}catch(s){const r=s;if(!function(o){return o.name==="FirebaseError"?o.code===m.FAILED_PRECONDITION||o.code===m.UNIMPLEMENTED:typeof DOMException<"u"&&o instanceof DOMException?o.code===22||o.code===20||o.code===11:!0}(r))throw r;rr("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r)}}).then(()=>i.promise)}function VV(n){if(n._initialized&&!n._terminated)throw new y(m.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new xe;return n._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(t){if(!Ht.C())return Promise.resolve();const i=t+"main";await Ht.delete(i)}(jp(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}}),e.promise}function $V(n){return function(e){const t=new xe;return e.asyncQueue.enqueueAndForget(async()=>aV(await fg(e),t)),t.promise}(qe(n=j(n,ge)))}function BV(n){return kV(qe(n=j(n,ge)))}function qV(n){return AV(qe(n=j(n,ge)))}function WV(n,e){const t=qe(n=j(n,ge)),i=new MV;return PV(t,n._databaseId,e,i),i}function KV(n,e){return xV(qe(n=j(n,ge)),e).then(t=>t?new Xe(n,null,t.query):null)}function _S(n){if(n._initialized||n._terminated)throw new y(m.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new _n(be.fromBase64String(e))}catch(t){throw new y(m.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new _n(be.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gi{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new y(m.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ye(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bs{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ku{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new y(m.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new y(m.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return L(this._lat,e._lat)||L(this._long,e._long)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jV=/^__.*__$/;class GV{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return this.fieldMask!==null?new Vn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Nr(e,this.data,t,this.fieldTransforms)}}class yS{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new Vn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function vS(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw C()}}class Au{constructor(e,t,i,s,r,o){this.settings=e,this.databaseId=t,this.yt=i,this.ignoreUndefinedProperties=s,r===void 0&&this.na(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new Au(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.ia({path:i,oa:!1});return s.ua(e),s}ca(e){var t;const i=(t=this.path)===null||t===void 0?void 0:t.child(e),s=this.ia({path:i,oa:!1});return s.na(),s}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return cl(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(e.length===0)throw this.ha("Document fields must not be empty");if(vS(this.sa)&&jV.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class HV{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=i||La(e)}da(e,t,i,s=!1){return new Au({sa:e,methodName:t,fa:i,path:ye.emptyPath(),oa:!1,la:s},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function Ss(n){const e=n._freezeSettings(),t=La(n._databaseId);return new HV(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Ru(n,e,t,i,s,r={}){const o=n.da(r.merge||r.mergeFields?2:0,e,t,s);_g("Data must be an object, but it was:",o,i);const a=TS(i,o);let c,l;if(r.merge)c=new vt(o.fieldMask),l=o.fieldTransforms;else if(r.mergeFields){const u=[];for(const h of r.mergeFields){const d=$d(e,h,t);if(!o.contains(d))throw new y(m.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);bS(u,d)||u.push(d)}c=new vt(u),l=o.fieldTransforms.filter(h=>c.covers(h.field))}else c=null,l=o.fieldTransforms;return new GV(new Ke(a),c,l)}class Va extends bs{_toFieldTransform(e){if(e.sa!==2)throw e.sa===1?e.ha(`${this._methodName}() can only appear at the top level of your update data`):e.ha(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Va}}function wS(n,e,t){return new Au({sa:3,fa:e.settings.fa,methodName:n._methodName,oa:t},e.databaseId,e.yt,e.ignoreUndefinedProperties)}class pg extends bs{_toFieldTransform(e){return new xa(e.path,new lr)}isEqual(e){return e instanceof pg}}class zV extends bs{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=wS(this,e,!0),i=this._a.map(r=>Cs(r,t)),s=new cs(i);return new xa(e.path,s)}isEqual(e){return this===e}}class QV extends bs{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=wS(this,e,!0),i=this._a.map(r=>Cs(r,t)),s=new ls(i);return new xa(e.path,s)}isEqual(e){return this===e}}class YV extends bs{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){const t=new ur(e.yt,HE(e.yt,this.wa));return new xa(e.path,t)}isEqual(e){return this===e}}function gg(n,e,t,i){const s=n.da(1,e,t);_g("Data must be an object, but it was:",s,i);const r=[],o=Ke.empty();Es(i,(c,l)=>{const u=yg(e,c,t);l=v(l);const h=s.ca(u);if(l instanceof Va)r.push(u);else{const d=Cs(l,h);d!=null&&(r.push(u),o.set(u,d))}});const a=new vt(r);return new yS(o,a,s.fieldTransforms)}function mg(n,e,t,i,s,r){const o=n.da(1,e,t),a=[$d(e,i,t)],c=[s];if(r.length%2!=0)throw new y(m.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<r.length;d+=2)a.push($d(e,r[d])),c.push(r[d+1]);const l=[],u=Ke.empty();for(let d=a.length-1;d>=0;--d)if(!bS(l,a[d])){const f=a[d];let p=c[d];p=v(p);const _=o.ca(f);if(p instanceof Va)l.push(f);else{const w=Cs(p,_);w!=null&&(l.push(f),u.set(f,w))}}const h=new vt(l);return new yS(u,h,o.fieldTransforms)}function IS(n,e,t,i=!1){return Cs(t,n.da(i?4:3,e))}function Cs(n,e){if(ES(n=v(n)))return _g("Unsupported field value:",e,n),TS(n,e);if(n instanceof bs)return function(t,i){if(!vS(i.sa))throw i.ha(`${t._methodName}() can only be used with update() and set()`);if(!i.path)throw i.ha(`${t._methodName}() is not currently supported inside arrays`);const s=t._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.oa&&e.sa!==4)throw e.ha("Nested arrays are not supported");return function(t,i){const s=[];let r=0;for(const o of t){let a=Cs(o,i.aa(r));a==null&&(a={nullValue:"NULL_VALUE"}),s.push(a),r++}return{arrayValue:{values:s}}}(n,e)}return function(t,i){if((t=v(t))===null)return{nullValue:"NULL_VALUE"};if(typeof t=="number")return HE(i.yt,t);if(typeof t=="boolean")return{booleanValue:t};if(typeof t=="string")return{stringValue:t};if(t instanceof Date){const s=ce.fromDate(t);return{timestampValue:hr(i.yt,s)}}if(t instanceof ce){const s=new ce(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:hr(i.yt,s)}}if(t instanceof ku)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof _n)return{bytesValue:ab(i.yt,t._byteString)};if(t instanceof ie){const s=i.databaseId,r=t.firestore._databaseId;if(!r.isEqual(s))throw i.ha(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:Lp(t.firestore._databaseId||i.databaseId,t._key.path)}}throw i.ha(`Unsupported field value: ${bu(t)}`)}(n,e)}function TS(n,e){const t={};return RE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Es(n,(i,s)=>{const r=Cs(s,e.ra(i));r!=null&&(t[i]=r)}),{mapValue:{fields:t}}}function ES(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ce||n instanceof ku||n instanceof _n||n instanceof ie||n instanceof bs)}function _g(n,e,t){if(!ES(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){const i=bu(t);throw i==="an object"?e.ha(n+" a custom object"):e.ha(n+" "+i)}}function $d(n,e,t){if((e=v(e))instanceof gi)return e._internalPath;if(typeof e=="string")return yg(n,e);throw cl("Field path arguments must be of type string or ",n,!1,void 0,t)}const XV=new RegExp("[~\\*/\\[\\]]");function yg(n,e,t){if(e.search(XV)>=0)throw cl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new gi(...e.split("."))._internalPath}catch{throw cl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function cl(n,e,t,i,s){const r=i&&!i.isEmpty(),o=s!==void 0;let a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(r||o)&&(c+=" (found",r&&(c+=` in field ${i}`),o&&(c+=` in document ${s}`),c+=")"),new y(m.INVALID_ARGUMENT,a+n+c)}function bS(n,e){return n.some(t=>t.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jo{constructor(e,t,i,s,r){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new ie(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new JV(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Nu("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}}class JV extends Jo{data(){return super.data()}}function Nu(n,e){return typeof e=="string"?yg(n,e):e instanceof gi?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SS(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new y(m.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class vg{}class $a extends vg{}function jn(n,e,...t){let i=[];e instanceof vg&&i.push(e),i=i.concat(t),function(s){const r=s.filter(a=>a instanceof wg).length,o=s.filter(a=>a instanceof Du).length;if(r>1||r>0&&o>0)throw new y(m.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const s of i)n=s._apply(n);return n}class Du extends $a{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new Du(e,t,i)}_apply(e){const t=this._parse(e);return kS(e._query,t),new Xe(e.firestore,e.converter,Ad(e._query,t))}_parse(e){const t=Ss(e.firestore);return function(s,r,o,a,c,l,u){let h;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new y(m.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){by(u,l);const d=[];for(const f of u)d.push(Ey(a,s,f));h={arrayValue:{values:d}}}else h=Ey(a,s,u)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||by(u,l),h=IS(o,r,u,l==="in"||l==="not-in");return q.create(c,l,h)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}}function ZV(n,e,t){const i=e,s=Nu("where",n);return Du._create(s,i,t)}class wg extends vg{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new wg(e,t)}_parse(e){const t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return t.length===1?t[0]:Y.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let r=i;const o=s.getFlattenedFilters();for(const a of o)kS(r,a),r=Ad(r,a)}(e._query,t),new Xe(e.firestore,e.converter,Ad(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}class Ig extends $a{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Ig(e,t)}_apply(e){const t=function(i,s,r){if(i.startAt!==null)throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new y(m.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const o=new js(s,r);return function(a,c){if(xp(a)===null){const l=mu(a);l!==null&&AS(a,l,c.field)}}(i,o),o}(e._query,this._field,this._direction);return new Xe(e.firestore,e.converter,function(i,s){const r=i.explicitOrderBy.concat([s]);return new Un(i.path,i.collectionGroup,r,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}function e$(n,e="asc"){const t=e,i=Nu("orderBy",n);return Ig._create(i,t)}class Pu extends $a{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new Pu(e,t,i)}_apply(e){return new Xe(e.firestore,e.converter,Zc(e._query,this._limit,this._limitType))}}function t$(n){return rS("limit",n),Pu._create("limit",n,"F")}function n$(n){return rS("limitToLast",n),Pu._create("limitToLast",n,"L")}class xu extends $a{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new xu(e,t,i)}_apply(e){const t=CS(e,this.type,this._docOrFields,this._inclusive);return new Xe(e.firestore,e.converter,function(i,s){return new Un(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}}function i$(...n){return xu._create("startAt",n,!0)}function s$(...n){return xu._create("startAfter",n,!1)}class Ou extends $a{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new Ou(e,t,i)}_apply(e){const t=CS(e,this.type,this._docOrFields,this._inclusive);return new Xe(e.firestore,e.converter,function(i,s){return new Un(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}}function r$(...n){return Ou._create("endBefore",n,!1)}function o$(...n){return Ou._create("endAt",n,!0)}function CS(n,e,t,i){if(t[0]=v(t[0]),t[0]instanceof Jo)return function(s,r,o,a,c){if(!a)throw new y(m.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${o}().`);const l=[];for(const u of zi(s))if(u.field.isKeyField())l.push(os(r,a.key));else{const h=a.data.field(u.field);if(Dp(h))throw new y(m.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(h===null){const d=u.field.canonicalString();throw new y(m.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${d}' (used as the orderBy) does not exist.`)}l.push(h)}return new fi(l,c)}(n._query,n.firestore._databaseId,e,t[0]._document,i);{const s=Ss(n.firestore);return function(r,o,a,c,l,u){const h=r.explicitOrderBy;if(l.length>h.length)throw new y(m.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const d=[];for(let f=0;f<l.length;f++){const p=l[f];if(h[f].field.isKeyField()){if(typeof p!="string")throw new y(m.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof p}`);if(!Op(r)&&p.indexOf("/")!==-1)throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${p}' contains a slash.`);const _=r.path.child(K.fromString(p));if(!b.isDocumentKey(_))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${_}' is not because it contains an odd number of segments.`);const w=new b(_);d.push(os(o,w))}else{const _=IS(a,c,p);d.push(_)}}return new fi(d,u)}(n._query,n.firestore._databaseId,s,e,t,i)}}function Ey(n,e,t){if(typeof(t=v(t))=="string"){if(t==="")throw new y(m.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Op(e)&&t.indexOf("/")!==-1)throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(K.fromString(t));if(!b.isDocumentKey(i))throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return os(n,new b(i))}if(t instanceof ie)return os(n,t._key);throw new y(m.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${bu(t)}.`)}function by(n,e){if(!Array.isArray(n)||n.length===0)throw new y(m.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new y(m.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function kS(n,e){if(e.isInequality()){const i=mu(n),s=e.field;if(i!==null&&!i.isEqual(s))throw new y(m.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${i.toString()}' and '${s.toString()}'`);const r=xp(n);r!==null&&AS(n,s,r)}const t=function(i,s){for(const r of i)for(const o of r.getFlattenedFilters())if(s.indexOf(o.op)>=0)return o.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new y(m.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new y(m.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function AS(n,e,t){if(!t.isEqual(e))throw new y(m.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class Tg{convertValue(e,t="none"){switch(rs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return de(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ss(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw C()}}convertObject(e,t){const i={};return Es(e.fields,(s,r)=>{i[s]=this.convertValue(r,t)}),i}convertGeoPoint(e){return new ku(de(e.latitude),de(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":const i=DE(e);return i==null?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(jo(e));default:return null}}convertTimestamp(e){const t=hi(e);return new ce(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=K.fromString(e);A(_b(i));const s=new ui(i.get(1),i.get(3)),r=new b(i.popFirst(5));return s.isEqual(t)||_e(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),r}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mu(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class a$ extends Tg{constructor(e){super(),this.firestore=e}convertBytes(e){return new _n(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ie(this.firestore,null,t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Bi{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class xn extends Jo{constructor(e,t,i,s,r,o){super(e,t,i,s,o),this._firestore=e,this._firestoreImpl=e,this.metadata=r}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new yo(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(Nu("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class yo extends xn{data(e={}){return super.data(e)}}class mi{constructor(e,t,i,s){this._firestore=e,this._userDataWriter=t,this._snapshot=s,this.metadata=new Bi(s.hasPendingWrites,s.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new yo(this._firestore,this._userDataWriter,i.key,i,new Bi(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new y(m.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let r=0;return i._snapshot.docChanges.map(o=>{const a=new yo(i._firestore,i._userDataWriter,o.doc.key,o.doc,new Bi(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);return o.doc,{type:"added",doc:a,oldIndex:-1,newIndex:r++}})}{let r=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(o=>s||o.type!==3).map(o=>{const a=new yo(i._firestore,i._userDataWriter,o.doc.key,o.doc,new Bi(i._snapshot.mutatedKeys.has(o.doc.key),i._snapshot.fromCache),i.query.converter);let c=-1,l=-1;return o.type!==0&&(c=r.indexOf(o.doc.key),r=r.delete(o.doc.key)),o.type!==1&&(r=r.add(o.doc),l=r.indexOf(o.doc.key)),{type:c$(o.type),doc:a,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function c$(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return C()}}function RS(n,e){return n instanceof xn&&e instanceof xn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof mi&&e instanceof mi&&n._firestore===e._firestore&&cS(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function l$(n){n=j(n,ie);const e=j(n.firestore,ge);return fS(qe(e),n._key).then(t=>Eg(e,n,t))}class ks extends Tg{constructor(e){super(),this.firestore=e}convertBytes(e){return new _n(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ie(this.firestore,null,t)}}function u$(n){n=j(n,ie);const e=j(n.firestore,ge),t=qe(e),i=new ks(e);return RV(t,n._key).then(s=>new xn(e,i,n._key,s,new Bi(s!==null&&s.hasLocalMutations,!0),n.converter))}function h$(n){n=j(n,ie);const e=j(n.firestore,ge);return fS(qe(e),n._key,{source:"server"}).then(t=>Eg(e,n,t))}function d$(n){n=j(n,Xe);const e=j(n.firestore,ge),t=qe(e),i=new ks(e);return SS(n._query),pS(t,n._query).then(s=>new mi(e,i,n,s))}function f$(n){n=j(n,Xe);const e=j(n.firestore,ge),t=qe(e),i=new ks(e);return NV(t,n._query).then(s=>new mi(e,i,n,s))}function p$(n){n=j(n,Xe);const e=j(n.firestore,ge),t=qe(e),i=new ks(e);return pS(t,n._query,{source:"server"}).then(s=>new mi(e,i,n,s))}function Sy(n,e,t){n=j(n,ie);const i=j(n.firestore,ge),s=Mu(n.converter,e,t);return Ba(i,[Ru(Ss(i),"setDoc",n._key,s,n.converter!==null,t).toMutation(n._key,ae.none())])}function Cy(n,e,t,...i){n=j(n,ie);const s=j(n.firestore,ge),r=Ss(s);let o;return o=typeof(e=v(e))=="string"||e instanceof gi?mg(r,"updateDoc",n._key,e,t,i):gg(r,"updateDoc",n._key,e),Ba(s,[o.toMutation(n._key,ae.exists(!0))])}function g$(n){return Ba(j(n.firestore,ge),[new Dr(n._key,ae.none())])}function m$(n,e){const t=j(n.firestore,ge),i=al(n),s=Mu(n.converter,e);return Ba(t,[Ru(Ss(n.firestore),"addDoc",i._key,s,n.converter!==null,{}).toMutation(i._key,ae.exists(!1))]).then(()=>i)}function NS(n,...e){var t,i,s;n=v(n);let r={includeMetadataChanges:!1},o=0;typeof e[o]!="object"||Vd(e[o])||(r=e[o],o++);const a={includeMetadataChanges:r.includeMetadataChanges};if(Vd(e[o])){const h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(i=h.error)===null||i===void 0?void 0:i.bind(h),e[o+2]=(s=h.complete)===null||s===void 0?void 0:s.bind(h)}let c,l,u;if(n instanceof ie)l=j(n.firestore,ge),u=Rr(n._key.path),c={next:h=>{e[o]&&e[o](Eg(l,n,h))},error:e[o+1],complete:e[o+2]};else{const h=j(n,Xe);l=j(h.firestore,ge),u=h._query;const d=new ks(l);c={next:f=>{e[o]&&e[o](new mi(l,d,h,f))},error:e[o+1],complete:e[o+2]},SS(n._query)}return function(h,d,f,p){const _=new Su(p),w=new ng(d,_,f);return h.asyncQueue.enqueueAndForget(async()=>Zp(await mr(h),w)),()=>{_.bc(),h.asyncQueue.enqueueAndForget(async()=>eg(await mr(h),w))}}(qe(l),u,a,c)}function _$(n,e){return DV(qe(n=j(n,ge)),Vd(e)?e:{next:e})}function Ba(n,e){return function(t,i){const s=new xe;return t.asyncQueue.enqueueAndForget(async()=>iV(await fg(t),i,s)),s.promise}(qe(n),e)}function Eg(n,e,t){const i=t.docs.get(e._key),s=new ks(n);return new xn(n,s,e._key,i,new Bi(t.hasPendingWrites,t.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y$={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class v${constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ss(e)}set(e,t,i){this._verifyNotCommitted();const s=Hn(e,this._firestore),r=Mu(s.converter,t,i),o=Ru(this._dataReader,"WriteBatch.set",s._key,r,s.converter!==null,i);return this._mutations.push(o.toMutation(s._key,ae.none())),this}update(e,t,i,...s){this._verifyNotCommitted();const r=Hn(e,this._firestore);let o;return o=typeof(t=v(t))=="string"||t instanceof gi?mg(this._dataReader,"WriteBatch.update",r._key,t,i,s):gg(this._dataReader,"WriteBatch.update",r._key,t),this._mutations.push(o.toMutation(r._key,ae.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Hn(e,this._firestore);return this._mutations=this._mutations.concat(new Dr(t._key,ae.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new y(m.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Hn(n,e){if((n=v(n)).firestore!==e)throw new y(m.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class w$ extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ss(e)}get(e){const t=Hn(e,this._firestore),i=new a$(this._firestore);return this._transaction.lookup([t._key]).then(s=>{if(!s||s.length!==1)return C();const r=s[0];if(r.isFoundDocument())return new Jo(this._firestore,i,r.key,r,t.converter);if(r.isNoDocument())return new Jo(this._firestore,i,t._key,null,t.converter);throw C()})}set(e,t,i){const s=Hn(e,this._firestore),r=Mu(s.converter,t,i),o=Ru(this._dataReader,"Transaction.set",s._key,r,s.converter!==null,i);return this._transaction.set(s._key,o),this}update(e,t,i,...s){const r=Hn(e,this._firestore);let o;return o=typeof(t=v(t))=="string"||t instanceof gi?mg(this._dataReader,"Transaction.update",r._key,t,i,s):gg(this._dataReader,"Transaction.update",r._key,t),this._transaction.update(r._key,o),this}delete(e){const t=Hn(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Hn(e,this._firestore),i=new ks(this._firestore);return super.get(e).then(s=>new xn(this._firestore,i,t._key,s._document,new Bi(!1,!1),t.converter))}}function I$(n,e,t){n=j(n,ge);const i=Object.assign(Object.assign({},y$),t);return function(s){if(s.maxAttempts<1)throw new y(m.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),function(s,r,o){const a=new xe;return s.asyncQueue.enqueueAndForget(async()=>{const c=await CV(s);new bV(s.asyncQueue,c,o,r,a).run()}),a.promise}(qe(n),s=>e(new w$(n,s)),i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T$(){return new Va("deleteField")}function E$(){return new pg("serverTimestamp")}function b$(...n){return new zV("arrayUnion",n)}function S$(...n){return new QV("arrayRemove",n)}function C$(n){return new YV("increment",n)}(function(n,e=!0){(function(t){Ar=t})(Mn),Me(new X("firestore",(t,{instanceIdentifier:i,options:s})=>{const r=t.getProvider("app").getImmediate(),o=new ge(new M1(t.getProvider("auth-internal")),new V1(t.getProvider("app-check-internal")),function(a,c){if(!Object.prototype.hasOwnProperty.apply(a.options,["projectId"]))throw new y(m.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ui(a.options.projectId,c)}(r,i),r);return s=Object.assign({useFetchStreams:e},s),o._setSettings(s),o},"PUBLIC").setMultipleInstances(!0)),ue(E_,"3.8.3",n),ue(E_,"3.8.3","esm2017")})();const k$="@firebase/firestore-compat",A$="0.3.3";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bg(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new y("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ky(){if(typeof Uint8Array>"u")throw new y("unimplemented","Uint8Arrays are not available in this environment.")}function Ay(){if(!z1())throw new y("unimplemented","Blobs are unavailable in Firestore in this environment.")}let ll=class{constructor(e){this._delegate=e}static fromBase64String(e){return Ay(),new ll(_n.fromBase64String(e))}static fromUint8Array(e){return ky(),new ll(_n.fromUint8Array(e))}toBase64(){return Ay(),this._delegate.toBase64()}toUint8Array(){return ky(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bd(n){return R$(n,["next","error","complete"])}function R$(n,e){if(typeof n!="object"||n===null)return!1;const t=n;for(const i of e)if(i in t&&typeof t[i]=="function")return!0;return!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class N${enableIndexedDbPersistence(e,t){return FV(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return UV(e._delegate)}clearIndexedDbPersistence(e){return VV(e._delegate)}}class DS{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof ui||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&rr("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,i={}){wV(this._delegate,e,t,i)}enableNetwork(){return BV(this._delegate)}disableNetwork(){return qV(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,sS("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return $V(this._delegate)}onSnapshotsInSync(e){return _$(this._delegate,e)}get app(){if(!this._appCompat)throw new y("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new _r(this,oS(this._delegate,e))}catch(t){throw at(t,"collection()","Firestore.collection()")}}doc(e){try{return new Ut(this,al(this._delegate,e))}catch(t){throw at(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ot(this,IV(this._delegate,e))}catch(t){throw at(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return I$(this._delegate,t=>e(new PS(this,t)))}batch(){return qe(this._delegate),new xS(new v$(this._delegate,e=>Ba(this._delegate,e)))}loadBundle(e){return WV(this._delegate,e)}namedQuery(e){return KV(this._delegate,e).then(t=>t?new ot(this,t):null)}}class Lu extends Tg{constructor(e){super(),this.firestore=e}convertBytes(e){return new ll(new _n(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Ut.forKey(t,this.firestore,null)}}function D$(n){D1(n)}class PS{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Lu(e)}get(e){const t=qi(e);return this._delegate.get(t).then(i=>new Zo(this._firestore,new xn(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){const s=qi(e);return i?(bg("Transaction.set",i),this._delegate.set(s,t,i)):this._delegate.set(s,t),this}update(e,t,i,...s){const r=qi(e);return arguments.length===2?this._delegate.update(r,t):this._delegate.update(r,t,i,...s),this}delete(e){const t=qi(e);return this._delegate.delete(t),this}}class xS{constructor(e){this._delegate=e}set(e,t,i){const s=qi(e);return i?(bg("WriteBatch.set",i),this._delegate.set(s,t,i)):this._delegate.set(s,t),this}update(e,t,i,...s){const r=qi(e);return arguments.length===2?this._delegate.update(r,t):this._delegate.update(r,t,i,...s),this}delete(e){const t=qi(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class fs{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){const i=new yo(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ea(this._firestore,i),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const i=fs.INSTANCES;let s=i.get(e);s||(s=new WeakMap,i.set(e,s));let r=s.get(t);return r||(r=new fs(e,new Lu(e),t),s.set(t,r)),r}}fs.INSTANCES=new WeakMap;class Ut{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Lu(e)}static forPath(e,t,i){if(e.length%2!==0)throw new y("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Ut(t,new ie(t._delegate,i,new b(e)))}static forKey(e,t,i){return new Ut(t,new ie(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new _r(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new _r(this.firestore,oS(this._delegate,e))}catch(t){throw at(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=v(e),e instanceof ie?aS(this._delegate,e):!1}set(e,t){t=bg("DocumentReference.set",t);try{return t?Sy(this._delegate,e,t):Sy(this._delegate,e)}catch(i){throw at(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return arguments.length===1?Cy(this._delegate,e):Cy(this._delegate,e,t,...i)}catch(s){throw at(s,"updateDoc()","DocumentReference.update()")}}delete(){return g$(this._delegate)}onSnapshot(...e){const t=OS(e),i=MS(e,s=>new Zo(this.firestore,new xn(this.firestore._delegate,this._userDataWriter,s._key,s._document,s.metadata,this._delegate.converter)));return NS(this._delegate,t,i)}get(e){let t;return(e==null?void 0:e.source)==="cache"?t=u$(this._delegate):(e==null?void 0:e.source)==="server"?t=h$(this._delegate):t=l$(this._delegate),t.then(i=>new Zo(this.firestore,new xn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new Ut(this.firestore,e?this._delegate.withConverter(fs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function at(n,e,t){return n.message=n.message.replace(e,t),n}function OS(n){for(const e of n)if(typeof e=="object"&&!Bd(e))return e;return{}}function MS(n,e){var t,i;let s;return Bd(n[0])?s=n[0]:Bd(n[1])?s=n[1]:typeof n[0]=="function"?s={next:n[0],error:n[1],complete:n[2]}:s={next:n[1],error:n[2],complete:n[3]},{next:r=>{s.next&&s.next(e(r))},error:(t=s.error)===null||t===void 0?void 0:t.bind(s),complete:(i=s.complete)===null||i===void 0?void 0:i.bind(s)}}class Zo{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Ut(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return RS(this._delegate,e._delegate)}}class ea extends Zo{data(e){const t=this._delegate.data(e);return P1(t!==void 0),t}}class ot{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Lu(e)}where(e,t,i){try{return new ot(this.firestore,jn(this._delegate,ZV(e,t,i)))}catch(s){throw at(s,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new ot(this.firestore,jn(this._delegate,e$(e,t)))}catch(i){throw at(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new ot(this.firestore,jn(this._delegate,t$(e)))}catch(t){throw at(t,"limit()","Query.limit()")}}limitToLast(e){try{return new ot(this.firestore,jn(this._delegate,n$(e)))}catch(t){throw at(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new ot(this.firestore,jn(this._delegate,i$(...e)))}catch(t){throw at(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new ot(this.firestore,jn(this._delegate,s$(...e)))}catch(t){throw at(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new ot(this.firestore,jn(this._delegate,r$(...e)))}catch(t){throw at(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new ot(this.firestore,jn(this._delegate,o$(...e)))}catch(t){throw at(t,"endAt()","Query.endAt()")}}isEqual(e){return cS(this._delegate,e._delegate)}get(e){let t;return(e==null?void 0:e.source)==="cache"?t=f$(this._delegate):(e==null?void 0:e.source)==="server"?t=p$(this._delegate):t=d$(this._delegate),t.then(i=>new qd(this.firestore,new mi(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){const t=OS(e),i=MS(e,s=>new qd(this.firestore,new mi(this.firestore._delegate,this._userDataWriter,this._delegate,s._snapshot)));return NS(this._delegate,t,i)}withConverter(e){return new ot(this.firestore,e?this._delegate.withConverter(fs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}class P${constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ea(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class qd{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ot(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new ea(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new P$(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new ea(this._firestore,i))})}isEqual(e){return RS(this._delegate,e._delegate)}}class _r extends ot{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Ut(this.firestore,e):null}doc(e){try{return e===void 0?new Ut(this.firestore,al(this._delegate)):new Ut(this.firestore,al(this._delegate,e))}catch(t){throw at(t,"doc()","CollectionReference.doc()")}}add(e){return m$(this._delegate,e).then(t=>new Ut(this.firestore,t))}isEqual(e){return aS(this._delegate,e._delegate)}withConverter(e){return new _r(this.firestore,e?this._delegate.withConverter(fs.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}function qi(n){return j(n,ie)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sg{constructor(...e){this._delegate=new gi(...e)}static documentId(){return new Sg(ye.keyField().canonicalString())}isEqual(e){return e=v(e),e instanceof gi?this._delegate._internalPath.isEqual(e._internalPath):!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mi{constructor(e){this._delegate=e}static serverTimestamp(){const e=E$();return e._methodName="FieldValue.serverTimestamp",new Mi(e)}static delete(){const e=T$();return e._methodName="FieldValue.delete",new Mi(e)}static arrayUnion(...e){const t=b$(...e);return t._methodName="FieldValue.arrayUnion",new Mi(t)}static arrayRemove(...e){const t=S$(...e);return t._methodName="FieldValue.arrayRemove",new Mi(t)}static increment(e){const t=C$(e);return t._methodName="FieldValue.increment",new Mi(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const x$={Firestore:DS,GeoPoint:ku,Timestamp:ce,Blob:ll,Transaction:PS,WriteBatch:xS,DocumentReference:Ut,DocumentSnapshot:Zo,Query:ot,QueryDocumentSnapshot:ea,QuerySnapshot:qd,CollectionReference:_r,FieldPath:Sg,FieldValue:Mi,setLogLevel:D$,CACHE_SIZE_UNLIMITED:LV};function O$(n,e){n.INTERNAL.registerComponent(new X("firestore-compat",t=>{const i=t.getProvider("app-compat").getImmediate(),s=t.getProvider("firestore").getImmediate();return e(i,s)},"PUBLIC").setServiceProps(Object.assign({},x$)))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function M$(n){O$(n,(e,t)=>new DS(e,t,new N$)),n.registerVersion(k$,A$)}M$(Ve);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const L$="type.googleapis.com/google.protobuf.Int64Value",F$="type.googleapis.com/google.protobuf.UInt64Value";function LS(n,e){const t={};for(const i in n)n.hasOwnProperty(i)&&(t[i]=e(n[i]));return t}function Wd(n){if(n==null)return null;if(n instanceof Number&&(n=n.valueOf()),typeof n=="number"&&isFinite(n)||n===!0||n===!1||Object.prototype.toString.call(n)==="[object String]")return n;if(n instanceof Date)return n.toISOString();if(Array.isArray(n))return n.map(e=>Wd(e));if(typeof n=="function"||typeof n=="object")return LS(n,e=>Wd(e));throw new Error("Data cannot be encoded in JSON: "+n)}function ul(n){if(n==null)return n;if(n["@type"])switch(n["@type"]){case L$:case F$:{const e=Number(n.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+n);return e}default:throw new Error("Data cannot be decoded from JSON: "+n)}return Array.isArray(n)?n.map(e=>ul(e)):typeof n=="function"||typeof n=="object"?LS(n,e=>ul(e)):n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FS="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ry={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Hs extends je{constructor(e,t,i){super(`${FS}/${e}`,t||""),this.details=i}}function U$(n){if(n>=200&&n<300)return"ok";switch(n){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function V$(n,e){let t=U$(n),i=t,s;try{const r=e&&e.error;if(r){const o=r.status;if(typeof o=="string"){if(!Ry[o])return new Hs("internal","internal");t=Ry[o],i=o}const a=r.message;typeof a=="string"&&(i=a),s=r.details,s!==void 0&&(s=ul(s))}}catch{}return t==="ok"?null:new Hs(t,i,s)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $${constructor(e,t,i){this.auth=null,this.messaging=null,this.appCheck=null,this.auth=e.getImmediate({optional:!0}),this.messaging=t.getImmediate({optional:!0}),this.auth||e.get().then(s=>this.auth=s,()=>{}),this.messaging||t.get().then(s=>this.messaging=s,()=>{}),this.appCheck||i.get().then(s=>this.appCheck=s,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return e==null?void 0:e.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(){if(this.appCheck){const e=await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(){const e=await this.getAuthToken(),t=await this.getMessagingToken(),i=await this.getAppCheckToken();return{authToken:e,messagingToken:t,appCheckToken:i}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ny="us-central1";function B$(n){let e=null;return{promise:new Promise((t,i)=>{e=setTimeout(()=>{i(new Hs("deadline-exceeded","deadline-exceeded"))},n)}),cancel:()=>{e&&clearTimeout(e)}}}let q$=class{constructor(e,t,i,s,r=Ny,o){this.app=e,this.fetchImpl=o,this.emulatorOrigin=null,this.contextProvider=new $$(t,i,s),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(r);this.customDomain=a.origin,this.region=Ny}catch{this.customDomain=null,this.region=r}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}};function W$(n,e,t){n.emulatorOrigin=`http://${e}:${t}`}function K$(n,e,t){return i=>H$(n,e,i,t||{})}function j$(n,e,t){return i=>US(n,e,i,t||{})}async function G$(n,e,t,i){t["Content-Type"]="application/json";let s;try{s=await i(n,{method:"POST",body:JSON.stringify(e),headers:t})}catch{return{status:0,json:null}}let r=null;try{r=await s.json()}catch{}return{status:s.status,json:r}}function H$(n,e,t,i){const s=n._url(e);return US(n,s,t,i)}async function US(n,e,t,i){t=Wd(t);const s={data:t},r={},o=await n.contextProvider.getContext();o.authToken&&(r.Authorization="Bearer "+o.authToken),o.messagingToken&&(r["Firebase-Instance-ID-Token"]=o.messagingToken),o.appCheckToken!==null&&(r["X-Firebase-AppCheck"]=o.appCheckToken);const a=i.timeout||7e4,c=B$(a),l=await Promise.race([G$(e,s,r,n.fetchImpl),c.promise,n.cancelAllRequests]);if(c.cancel(),!l)throw new Hs("cancelled","Firebase Functions instance was deleted.");const u=V$(l.status,l.json);if(u)throw u;if(!l.json)throw new Hs("internal","Response is not valid JSON object.");let h=l.json.data;if(typeof h>"u"&&(h=l.json.result),typeof h>"u")throw new Hs("internal","Response is missing data field.");return{data:ul(h)}}const Dy="@firebase/functions",Py="0.9.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const z$="auth-internal",Q$="app-check-internal",Y$="messaging-internal";function X$(n,e){const t=(i,{instanceIdentifier:s})=>{const r=i.getProvider("app").getImmediate(),o=i.getProvider(z$),a=i.getProvider(Y$),c=i.getProvider(Q$);return new q$(r,o,a,c,s,n)};Me(new X(FS,t,"PUBLIC").setMultipleInstances(!0)),ue(Dy,Py,e),ue(Dy,Py,"esm2017")}function xy(n,e,t){W$(v(n),e,t)}function J$(n,e,t){return K$(v(n),e,t)}function Z$(n,e,t){return j$(v(n),e,t)}X$(fetch.bind(self));const eB="@firebase/functions-compat",tB="0.3.3";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class VS{constructor(e,t){this.app=e,this._delegate=t,this._region=this._delegate.region,this._customDomain=this._delegate.customDomain}httpsCallable(e,t){return J$(this._delegate,e,t)}httpsCallableFromURL(e,t){return Z$(this._delegate,e,t)}useFunctionsEmulator(e){const t=e.match("[a-zA-Z]+://([a-zA-Z0-9.-]+)(?::([0-9]+))?");if(t==null)throw new je("functions","No origin provided to useFunctionsEmulator()");if(t[2]==null)throw new je("functions","Port missing in origin provided to useFunctionsEmulator()");return xy(this._delegate,t[1],Number(t[2]))}useEmulator(e,t){return xy(this._delegate,e,t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nB="us-central1",iB=(n,{instanceIdentifier:e})=>{const t=n.getProvider("app-compat").getImmediate(),i=n.getProvider("functions").getImmediate({identifier:e??nB});return new VS(t,i)};function sB(){const n={Functions:VS};Ve.INTERNAL.registerComponent(new X("functions-compat",iB,"PUBLIC").setServiceProps(n).setMultipleInstances(!0))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */sB();Ve.registerVersion(eB,tB);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rB="/firebase-messaging-sw.js",oB="/firebase-cloud-messaging-push-scope",$S="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",aB="https://fcmregistrations.googleapis.com/v1",BS="google.c.a.c_id",cB="google.c.a.c_l",lB="google.c.a.ts",uB="google.c.a.e";var Oy;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(Oy||(Oy={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var ta;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(ta||(ta={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vn(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function hB(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(t),s=new Uint8Array(i.length);for(let r=0;r<i.length;++r)s[r]=i.charCodeAt(r);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mh="fcm_token_details_db",dB=5,My="fcm_token_object_Store";async function fB(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(r=>r.name).includes(mh))return null;let e=null;return(await ia(mh,dB,{upgrade:async(i,s,r,o)=>{var a;if(s<2||!i.objectStoreNames.contains(My))return;const c=o.objectStore(My),l=await c.index("fcmSenderId").get(n);if(await c.clear(),!!l){if(s===2){const u=l;if(!u.auth||!u.p256dh||!u.endpoint)return;e={token:u.fcmToken,createTime:(a=u.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:u.auth,p256dh:u.p256dh,endpoint:u.endpoint,swScope:u.swScope,vapidKey:typeof u.vapidKey=="string"?u.vapidKey:vn(u.vapidKey)}}}else if(s===3){const u=l;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:vn(u.auth),p256dh:vn(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:vn(u.vapidKey)}}}else if(s===4){const u=l;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:vn(u.auth),p256dh:vn(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:vn(u.vapidKey)}}}}}})).close(),await Vs(mh),await Vs("fcm_vapid_details_db"),await Vs("undefined"),pB(e)?e:null}function pB(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gB="firebase-messaging-database",mB=1,ps="firebase-messaging-store";let _h=null;function Cg(){return _h||(_h=ia(gB,mB,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(ps)}}})),_h}async function qS(n){const e=Ag(n),i=await(await Cg()).transaction(ps).objectStore(ps).get(e);if(i)return i;{const s=await fB(n.appConfig.senderId);if(s)return await kg(n,s),s}}async function kg(n,e){const t=Ag(n),s=(await Cg()).transaction(ps,"readwrite");return await s.objectStore(ps).put(e,t),await s.done,e}async function _B(n){const e=Ag(n),i=(await Cg()).transaction(ps,"readwrite");await i.objectStore(ps).delete(e),await i.done}function Ag({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yB={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["only-available-in-window"]:"This method is available in a Window context.",["only-available-in-sw"]:"This method is available in a service worker context.",["permission-default"]:"The notification permission was not granted and dismissed instead.",["permission-blocked"]:"The notification permission was not granted and blocked instead.",["unsupported-browser"]:"This browser doesn't support the API's required to use the Firebase SDK.",["indexed-db-unsupported"]:"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)",["failed-service-worker-registration"]:"We are unable to register the default service worker. {$browserErrorMessage}",["token-subscribe-failed"]:"A problem occurred while subscribing the user to FCM: {$errorInfo}",["token-subscribe-no-token"]:"FCM returned no token when subscribing the user to push.",["token-unsubscribe-failed"]:"A problem occurred while unsubscribing the user from FCM: {$errorInfo}",["token-update-failed"]:"A problem occurred while updating the user from FCM: {$errorInfo}",["token-update-no-token"]:"FCM returned no token when updating the user to push.",["use-sw-after-get-token"]:"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",["invalid-sw-registration"]:"The input to useServiceWorker() must be a ServiceWorkerRegistration.",["invalid-bg-handler"]:"The input to setBackgroundMessageHandler() must be a function.",["invalid-vapid-key"]:"The public VAPID key must be a string.",["use-vapid-key-after-get-token"]:"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},ft=new xt("messaging","Messaging",yB);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vB(n,e){const t=await Ng(n),i=KS(e),s={method:"POST",headers:t,body:JSON.stringify(i)};let r;try{r=await(await fetch(Rg(n.appConfig),s)).json()}catch(o){throw ft.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(r.error){const o=r.error.message;throw ft.create("token-subscribe-failed",{errorInfo:o})}if(!r.token)throw ft.create("token-subscribe-no-token");return r.token}async function wB(n,e){const t=await Ng(n),i=KS(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(i)};let r;try{r=await(await fetch(`${Rg(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw ft.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(r.error){const o=r.error.message;throw ft.create("token-update-failed",{errorInfo:o})}if(!r.token)throw ft.create("token-update-no-token");return r.token}async function WS(n,e){const i={method:"DELETE",headers:await Ng(n)};try{const r=await(await fetch(`${Rg(n.appConfig)}/${e}`,i)).json();if(r.error){const o=r.error.message;throw ft.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw ft.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function Rg({projectId:n}){return`${aB}/projects/${n}/registrations`}async function Ng({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function KS({p256dh:n,auth:e,endpoint:t,vapidKey:i}){const s={web:{endpoint:t,auth:e,p256dh:n}};return i!==$S&&(s.web.applicationPubKey=i),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const IB=7*24*60*60*1e3;async function TB(n){const e=await bB(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:vn(e.getKey("auth")),p256dh:vn(e.getKey("p256dh"))},i=await qS(n.firebaseDependencies);if(i){if(SB(i.subscriptionOptions,t))return Date.now()>=i.createTime+IB?EB(n,{token:i.token,createTime:Date.now(),subscriptionOptions:t}):i.token;try{await WS(n.firebaseDependencies,i.token)}catch(s){console.warn(s)}return Ly(n.firebaseDependencies,t)}else return Ly(n.firebaseDependencies,t)}async function jS(n){const e=await qS(n.firebaseDependencies);e&&(await WS(n.firebaseDependencies,e.token),await _B(n.firebaseDependencies));const t=await n.swRegistration.pushManager.getSubscription();return t?t.unsubscribe():!0}async function EB(n,e){try{const t=await wB(n.firebaseDependencies,e),i=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await kg(n.firebaseDependencies,i),t}catch(t){throw await jS(n),t}}async function Ly(n,e){const i={token:await vB(n,e),createTime:Date.now(),subscriptionOptions:e};return await kg(n,i),i.token}async function bB(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:hB(e)})}function SB(n,e){const t=e.vapidKey===n.vapidKey,i=e.endpoint===n.endpoint,s=e.auth===n.auth,r=e.p256dh===n.p256dh;return t&&i&&s&&r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fy(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return CB(e,n),kB(e,n),AB(e,n),e}function CB(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const i=e.notification.body;i&&(n.notification.body=i);const s=e.notification.image;s&&(n.notification.image=s);const r=e.notification.icon;r&&(n.notification.icon=r)}function kB(n,e){e.data&&(n.data=e.data)}function AB(n,e){var t,i,s,r,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(i=e.fcmOptions)===null||i===void 0?void 0:i.link)!==null&&s!==void 0?s:(r=e.notification)===null||r===void 0?void 0:r.click_action;a&&(n.fcmOptions.link=a);const c=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;c&&(n.fcmOptions.analyticsLabel=c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RB(n){return typeof n=="object"&&!!n&&BS in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */GS("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o");GS("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");function GS(n,e){const t=[];for(let i=0;i<n.length;i++)t.push(n.charAt(i)),i<e.length&&t.push(e.charAt(i));return t.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function NB(n){if(!n||!n.options)throw yh("App Configuration Object");if(!n.name)throw yh("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const i of e)if(!t[i])throw yh(i);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function yh(n){return ft.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let DB=class{constructor(e,t,i){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=NB(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:i}}_delete(){return Promise.resolve()}};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function HS(n){try{n.swRegistration=await navigator.serviceWorker.register(rB,{scope:oB}),n.swRegistration.update().catch(()=>{})}catch(e){throw ft.create("failed-service-worker-registration",{browserErrorMessage:e==null?void 0:e.message})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function PB(n,e){if(!e&&!n.swRegistration&&await HS(n),!(!e&&n.swRegistration)){if(!(e instanceof ServiceWorkerRegistration))throw ft.create("invalid-sw-registration");n.swRegistration=e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xB(n,e){e?n.vapidKey=e:n.vapidKey||(n.vapidKey=$S)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zS(n,e){if(!navigator)throw ft.create("only-available-in-window");if(Notification.permission==="default"&&await Notification.requestPermission(),Notification.permission!=="granted")throw ft.create("permission-blocked");return await xB(n,e==null?void 0:e.vapidKey),await PB(n,e==null?void 0:e.serviceWorkerRegistration),TB(n)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function OB(n,e,t){const i=MB(e);(await n.firebaseDependencies.analyticsProvider.get()).logEvent(i,{message_id:t[BS],message_name:t[cB],message_time:t[lB],message_device_time:Math.floor(Date.now()/1e3)})}function MB(n){switch(n){case ta.NOTIFICATION_CLICKED:return"notification_open";case ta.PUSH_RECEIVED:return"notification_foreground";default:throw new Error}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function LB(n,e){const t=e.data;if(!t.isFirebaseMessaging)return;n.onMessageHandler&&t.messageType===ta.PUSH_RECEIVED&&(typeof n.onMessageHandler=="function"?n.onMessageHandler(Fy(t)):n.onMessageHandler.next(Fy(t)));const i=t.data;RB(i)&&i[uB]==="1"&&await OB(n,t.messageType,i)}const Uy="@firebase/messaging",Vy="0.12.3";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FB=n=>{const e=new DB(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return navigator.serviceWorker.addEventListener("message",t=>LB(e,t)),e},UB=n=>{const e=n.getProvider("messaging").getImmediate();return{getToken:i=>zS(e,i)}};function VB(){Me(new X("messaging",FB,"PUBLIC")),Me(new X("messaging-internal",UB,"PRIVATE")),ue(Uy,Vy),ue(Uy,Vy,"esm2017")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $B(n){if(!navigator)throw ft.create("only-available-in-window");return n.swRegistration||await HS(n),jS(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function BB(n,e){if(!navigator)throw ft.create("only-available-in-window");return n.onMessageHandler=e,()=>{n.onMessageHandler=null}}async function qB(n,e){return n=v(n),zS(n,e)}function WB(n){return n=v(n),$B(n)}function KB(n,e){return n=v(n),BB(n,e)}VB();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const QS="BDOU99-h67HcA6JeFXHbSNMu7e2yNNu3RzoMj8TM4W88jITfq7ZmPvIM1Iv-4_l2LxQcYwhqby2xGpWwzjfAnG4",jB="https://fcmregistrations.googleapis.com/v1",YS="FCM_MSG",GB="google.c.a.c_id",HB=3,zB=1;var hl;(function(n){n[n.DATA_MESSAGE=1]="DATA_MESSAGE",n[n.DISPLAY_NOTIFICATION=3]="DISPLAY_NOTIFICATION"})(hl||(hl={}));/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except
 * in compliance with the License. You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under the License
 * is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express
 * or implied. See the License for the specific language governing permissions and limitations under
 * the License.
 */var dl;(function(n){n.PUSH_RECEIVED="push-received",n.NOTIFICATION_CLICKED="notification-clicked"})(dl||(dl={}));/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wn(n){const e=new Uint8Array(n);return btoa(String.fromCharCode(...e)).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function QB(n){const e="=".repeat((4-n.length%4)%4),t=(n+e).replace(/\-/g,"+").replace(/_/g,"/"),i=atob(t),s=new Uint8Array(i.length);for(let r=0;r<i.length;++r)s[r]=i.charCodeAt(r);return s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vh="fcm_token_details_db",YB=5,$y="fcm_token_object_Store";async function XB(n){if("databases"in indexedDB&&!(await indexedDB.databases()).map(r=>r.name).includes(vh))return null;let e=null;return(await ia(vh,YB,{upgrade:async(i,s,r,o)=>{var a;if(s<2||!i.objectStoreNames.contains($y))return;const c=o.objectStore($y),l=await c.index("fcmSenderId").get(n);if(await c.clear(),!!l){if(s===2){const u=l;if(!u.auth||!u.p256dh||!u.endpoint)return;e={token:u.fcmToken,createTime:(a=u.createTime)!==null&&a!==void 0?a:Date.now(),subscriptionOptions:{auth:u.auth,p256dh:u.p256dh,endpoint:u.endpoint,swScope:u.swScope,vapidKey:typeof u.vapidKey=="string"?u.vapidKey:wn(u.vapidKey)}}}else if(s===3){const u=l;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:wn(u.auth),p256dh:wn(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:wn(u.vapidKey)}}}else if(s===4){const u=l;e={token:u.fcmToken,createTime:u.createTime,subscriptionOptions:{auth:wn(u.auth),p256dh:wn(u.p256dh),endpoint:u.endpoint,swScope:u.swScope,vapidKey:wn(u.vapidKey)}}}}}})).close(),await Vs(vh),await Vs("fcm_vapid_details_db"),await Vs("undefined"),JB(e)?e:null}function JB(n){if(!n||!n.subscriptionOptions)return!1;const{subscriptionOptions:e}=n;return typeof n.createTime=="number"&&n.createTime>0&&typeof n.token=="string"&&n.token.length>0&&typeof e.auth=="string"&&e.auth.length>0&&typeof e.p256dh=="string"&&e.p256dh.length>0&&typeof e.endpoint=="string"&&e.endpoint.length>0&&typeof e.swScope=="string"&&e.swScope.length>0&&typeof e.vapidKey=="string"&&e.vapidKey.length>0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZB="firebase-messaging-database",eq=1,gs="firebase-messaging-store";let wh=null;function Dg(){return wh||(wh=ia(ZB,eq,{upgrade:(n,e)=>{switch(e){case 0:n.createObjectStore(gs)}}})),wh}async function Pg(n){const e=Og(n),i=await(await Dg()).transaction(gs).objectStore(gs).get(e);if(i)return i;{const s=await XB(n.appConfig.senderId);if(s)return await xg(n,s),s}}async function xg(n,e){const t=Og(n),s=(await Dg()).transaction(gs,"readwrite");return await s.objectStore(gs).put(e,t),await s.done,e}async function tq(n){const e=Og(n),i=(await Dg()).transaction(gs,"readwrite");await i.objectStore(gs).delete(e),await i.done}function Og({appConfig:n}){return n.appId}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nq={["missing-app-config-values"]:'Missing App configuration value: "{$valueName}"',["only-available-in-window"]:"This method is available in a Window context.",["only-available-in-sw"]:"This method is available in a service worker context.",["permission-default"]:"The notification permission was not granted and dismissed instead.",["permission-blocked"]:"The notification permission was not granted and blocked instead.",["unsupported-browser"]:"This browser doesn't support the API's required to use the Firebase SDK.",["indexed-db-unsupported"]:"This browser doesn't support indexedDb.open() (ex. Safari iFrame, Firefox Private Browsing, etc)",["failed-service-worker-registration"]:"We are unable to register the default service worker. {$browserErrorMessage}",["token-subscribe-failed"]:"A problem occurred while subscribing the user to FCM: {$errorInfo}",["token-subscribe-no-token"]:"FCM returned no token when subscribing the user to push.",["token-unsubscribe-failed"]:"A problem occurred while unsubscribing the user from FCM: {$errorInfo}",["token-update-failed"]:"A problem occurred while updating the user from FCM: {$errorInfo}",["token-update-no-token"]:"FCM returned no token when updating the user to push.",["use-sw-after-get-token"]:"The useServiceWorker() method may only be called once and must be called before calling getToken() to ensure your service worker is used.",["invalid-sw-registration"]:"The input to useServiceWorker() must be a ServiceWorkerRegistration.",["invalid-bg-handler"]:"The input to setBackgroundMessageHandler() must be a function.",["invalid-vapid-key"]:"The public VAPID key must be a string.",["use-vapid-key-after-get-token"]:"The usePublicVapidKey() method may only be called once and must be called before calling getToken() to ensure your VAPID key is used."},hn=new xt("messaging","Messaging",nq);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function iq(n,e){const t=await Lg(n),i=JS(e),s={method:"POST",headers:t,body:JSON.stringify(i)};let r;try{r=await(await fetch(Mg(n.appConfig),s)).json()}catch(o){throw hn.create("token-subscribe-failed",{errorInfo:o==null?void 0:o.toString()})}if(r.error){const o=r.error.message;throw hn.create("token-subscribe-failed",{errorInfo:o})}if(!r.token)throw hn.create("token-subscribe-no-token");return r.token}async function sq(n,e){const t=await Lg(n),i=JS(e.subscriptionOptions),s={method:"PATCH",headers:t,body:JSON.stringify(i)};let r;try{r=await(await fetch(`${Mg(n.appConfig)}/${e.token}`,s)).json()}catch(o){throw hn.create("token-update-failed",{errorInfo:o==null?void 0:o.toString()})}if(r.error){const o=r.error.message;throw hn.create("token-update-failed",{errorInfo:o})}if(!r.token)throw hn.create("token-update-no-token");return r.token}async function XS(n,e){const i={method:"DELETE",headers:await Lg(n)};try{const r=await(await fetch(`${Mg(n.appConfig)}/${e}`,i)).json();if(r.error){const o=r.error.message;throw hn.create("token-unsubscribe-failed",{errorInfo:o})}}catch(s){throw hn.create("token-unsubscribe-failed",{errorInfo:s==null?void 0:s.toString()})}}function Mg({projectId:n}){return`${jB}/projects/${n}/registrations`}async function Lg({appConfig:n,installations:e}){const t=await e.getToken();return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n.apiKey,"x-goog-firebase-installations-auth":`FIS ${t}`})}function JS({p256dh:n,auth:e,endpoint:t,vapidKey:i}){const s={web:{endpoint:t,auth:e,p256dh:n}};return i!==QS&&(s.web.applicationPubKey=i),s}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rq=7*24*60*60*1e3;async function oq(n){const e=await cq(n.swRegistration,n.vapidKey),t={vapidKey:n.vapidKey,swScope:n.swRegistration.scope,endpoint:e.endpoint,auth:wn(e.getKey("auth")),p256dh:wn(e.getKey("p256dh"))},i=await Pg(n.firebaseDependencies);if(i){if(lq(i.subscriptionOptions,t))return Date.now()>=i.createTime+rq?aq(n,{token:i.token,createTime:Date.now(),subscriptionOptions:t}):i.token;try{await XS(n.firebaseDependencies,i.token)}catch(s){console.warn(s)}return By(n.firebaseDependencies,t)}else return By(n.firebaseDependencies,t)}async function Kd(n){const e=await Pg(n.firebaseDependencies);e&&(await XS(n.firebaseDependencies,e.token),await tq(n.firebaseDependencies));const t=await n.swRegistration.pushManager.getSubscription();return t?t.unsubscribe():!0}async function aq(n,e){try{const t=await sq(n.firebaseDependencies,e),i=Object.assign(Object.assign({},e),{token:t,createTime:Date.now()});return await xg(n.firebaseDependencies,i),t}catch(t){throw await Kd(n),t}}async function By(n,e){const i={token:await iq(n,e),createTime:Date.now(),subscriptionOptions:e};return await xg(n,i),i.token}async function cq(n,e){const t=await n.pushManager.getSubscription();return t||n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:QB(e)})}function lq(n,e){const t=e.vapidKey===n.vapidKey,i=e.endpoint===n.endpoint,s=e.auth===n.auth,r=e.p256dh===n.p256dh;return t&&i&&s&&r}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uq(n){const e={from:n.from,collapseKey:n.collapse_key,messageId:n.fcmMessageId};return hq(e,n),dq(e,n),fq(e,n),e}function hq(n,e){if(!e.notification)return;n.notification={};const t=e.notification.title;t&&(n.notification.title=t);const i=e.notification.body;i&&(n.notification.body=i);const s=e.notification.image;s&&(n.notification.image=s);const r=e.notification.icon;r&&(n.notification.icon=r)}function dq(n,e){e.data&&(n.data=e.data)}function fq(n,e){var t,i,s,r,o;if(!e.fcmOptions&&!(!((t=e.notification)===null||t===void 0)&&t.click_action))return;n.fcmOptions={};const a=(s=(i=e.fcmOptions)===null||i===void 0?void 0:i.link)!==null&&s!==void 0?s:(r=e.notification)===null||r===void 0?void 0:r.click_action;a&&(n.fcmOptions.link=a);const c=(o=e.fcmOptions)===null||o===void 0?void 0:o.analytics_label;c&&(n.fcmOptions.analyticsLabel=c)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pq(n){return typeof n=="object"&&!!n&&GB in n}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gq(n){return new Promise(e=>{setTimeout(e,n)})}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */ZS("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o");ZS("AzSCbw63g1R0nCw85jG8","Iaya3yLKwmgvh7cF0q4");async function mq(n,e){const t=_q(e,await n.firebaseDependencies.installations.getId());yq(n,t)}function _q(n,e){var t,i;const s={};return n.from&&(s.project_number=n.from),n.fcmMessageId&&(s.message_id=n.fcmMessageId),s.instance_id=e,n.notification?s.message_type=hl.DISPLAY_NOTIFICATION.toString():s.message_type=hl.DATA_MESSAGE.toString(),s.sdk_platform=HB.toString(),s.package_name=self.origin.replace(/(^\w+:|^)\/\//,""),n.collapse_key&&(s.collapse_key=n.collapse_key),s.event=zB.toString(),!((t=n.fcmOptions)===null||t===void 0)&&t.analytics_label&&(s.analytics_label=(i=n.fcmOptions)===null||i===void 0?void 0:i.analytics_label),s}function yq(n,e){const t={};t.event_time_ms=Math.floor(Date.now()).toString(),t.source_extension_json_proto3=JSON.stringify(e),n.logEvents.push(t)}function ZS(n,e){const t=[];for(let i=0;i<n.length;i++)t.push(n.charAt(i)),i<e.length&&t.push(e.charAt(i));return t.join("")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function vq(n,e){var t,i;const{newSubscription:s}=n;if(!s){await Kd(e);return}const r=await Pg(e.firebaseDependencies);await Kd(e),e.vapidKey=(i=(t=r==null?void 0:r.subscriptionOptions)===null||t===void 0?void 0:t.vapidKey)!==null&&i!==void 0?i:QS,await oq(e)}async function wq(n,e){const t=Eq(n);if(!t)return;e.deliveryMetricsExportedToBigQueryEnabled&&await mq(e,t);const i=await eC();if(Sq(i))return Cq(i,t);if(t.notification&&await kq(Tq(t)),!!e&&e.onBackgroundMessageHandler){const s=uq(t);typeof e.onBackgroundMessageHandler=="function"?await e.onBackgroundMessageHandler(s):e.onBackgroundMessageHandler.next(s)}}async function Iq(n){var e,t;const i=(t=(e=n.notification)===null||e===void 0?void 0:e.data)===null||t===void 0?void 0:t[YS];if(i){if(n.action)return}else return;n.stopImmediatePropagation(),n.notification.close();const s=Aq(i);if(!s)return;const r=new URL(s,self.location.href),o=new URL(self.location.origin);if(r.host!==o.host)return;let a=await bq(r);if(a?a=await a.focus():(a=await self.clients.openWindow(s),await gq(3e3)),!!a)return i.messageType=dl.NOTIFICATION_CLICKED,i.isFirebaseMessaging=!0,a.postMessage(i)}function Tq(n){const e=Object.assign({},n.notification);return e.data={[YS]:n},e}function Eq({data:n}){if(!n)return null;try{return n.json()}catch{return null}}async function bq(n){const e=await eC();for(const t of e){const i=new URL(t.url,self.location.href);if(n.host===i.host)return t}return null}function Sq(n){return n.some(e=>e.visibilityState==="visible"&&!e.url.startsWith("chrome-extension://"))}function Cq(n,e){e.isFirebaseMessaging=!0,e.messageType=dl.PUSH_RECEIVED;for(const t of n)t.postMessage(e)}function eC(){return self.clients.matchAll({type:"window",includeUncontrolled:!0})}function kq(n){var e;const{actions:t}=n,{maxActions:i}=Notification;return t&&i&&t.length>i&&console.warn(`This browser only supports ${i} actions. The remaining actions will not be displayed.`),self.registration.showNotification((e=n.title)!==null&&e!==void 0?e:"",n)}function Aq(n){var e,t,i;const s=(t=(e=n.fcmOptions)===null||e===void 0?void 0:e.link)!==null&&t!==void 0?t:(i=n.notification)===null||i===void 0?void 0:i.click_action;return s||(pq(n.data)?self.location.origin:null)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rq(n){if(!n||!n.options)throw Ih("App Configuration Object");if(!n.name)throw Ih("App Name");const e=["projectId","apiKey","appId","messagingSenderId"],{options:t}=n;for(const i of e)if(!t[i])throw Ih(i);return{appName:n.name,projectId:t.projectId,apiKey:t.apiKey,appId:t.appId,senderId:t.messagingSenderId}}function Ih(n){return hn.create("missing-app-config-values",{valueName:n})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nq{constructor(e,t,i){this.deliveryMetricsExportedToBigQueryEnabled=!1,this.onBackgroundMessageHandler=null,this.onMessageHandler=null,this.logEvents=[],this.isLogServiceStarted=!1;const s=Rq(e);this.firebaseDependencies={app:e,appConfig:s,installations:t,analyticsProvider:i}}_delete(){return Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dq=n=>{const e=new Nq(n.getProvider("app").getImmediate(),n.getProvider("installations-internal").getImmediate(),n.getProvider("analytics-internal"));return self.addEventListener("push",t=>{t.waitUntil(wq(t,e))}),self.addEventListener("pushsubscriptionchange",t=>{t.waitUntil(vq(t,e))}),self.addEventListener("notificationclick",t=>{t.waitUntil(Iq(t))}),e};function Pq(){Me(new X("messaging-sw",Dq,"PUBLIC"))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xq(n,e){if(self.document!==void 0)throw hn.create("only-available-in-sw");return n.onBackgroundMessageHandler=e,()=>{n.onBackgroundMessageHandler=null}}function Oq(n,e){return n=v(n),xq(n,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Pq();const Mq="@firebase/messaging-compat",Lq="0.2.3";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fq(){return self&&"ServiceWorkerGlobalScope"in self?Vq():Uq()}function Uq(){return typeof window<"u"&&Rt()&&ml()&&"serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window&&"fetch"in window&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}function Vq(){return Rt()&&"PushManager"in self&&"Notification"in self&&ServiceWorkerRegistration.prototype.hasOwnProperty("showNotification")&&PushSubscription.prototype.hasOwnProperty("getKey")}class qy{constructor(e,t){this.app=e,this._delegate=t,this.app=e,this._delegate=t}async getToken(e){return qB(this._delegate,e)}async deleteToken(){return WB(this._delegate)}onMessage(e){return KB(this._delegate,e)}onBackgroundMessage(e){return Oq(this._delegate,e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $q=n=>self&&"ServiceWorkerGlobalScope"in self?new qy(n.getProvider("app-compat").getImmediate(),n.getProvider("messaging-sw").getImmediate()):new qy(n.getProvider("app-compat").getImmediate(),n.getProvider("messaging").getImmediate()),Bq={isSupported:Fq};function qq(){Ve.INTERNAL.registerComponent(new X("messaging-compat",$q,"PUBLIC").setServiceProps(Bq))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */qq();Ve.registerVersion(Mq,Lq);/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tC="firebasestorage.googleapis.com",nC="storageBucket",Wq=2*60*1e3,Kq=10*60*1e3,jq=1e3;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class he extends je{constructor(e,t,i=0){super(Th(e),`Firebase Storage: ${t} (${Th(e)})`),this.status_=i,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,he.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return Th(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}var se;(function(n){n.UNKNOWN="unknown",n.OBJECT_NOT_FOUND="object-not-found",n.BUCKET_NOT_FOUND="bucket-not-found",n.PROJECT_NOT_FOUND="project-not-found",n.QUOTA_EXCEEDED="quota-exceeded",n.UNAUTHENTICATED="unauthenticated",n.UNAUTHORIZED="unauthorized",n.UNAUTHORIZED_APP="unauthorized-app",n.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",n.INVALID_CHECKSUM="invalid-checksum",n.CANCELED="canceled",n.INVALID_EVENT_NAME="invalid-event-name",n.INVALID_URL="invalid-url",n.INVALID_DEFAULT_BUCKET="invalid-default-bucket",n.NO_DEFAULT_BUCKET="no-default-bucket",n.CANNOT_SLICE_BLOB="cannot-slice-blob",n.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",n.NO_DOWNLOAD_URL="no-download-url",n.INVALID_ARGUMENT="invalid-argument",n.INVALID_ARGUMENT_COUNT="invalid-argument-count",n.APP_DELETED="app-deleted",n.INVALID_ROOT_OPERATION="invalid-root-operation",n.INVALID_FORMAT="invalid-format",n.INTERNAL_ERROR="internal-error",n.UNSUPPORTED_ENVIRONMENT="unsupported-environment"})(se||(se={}));function Th(n){return"storage/"+n}function Fg(){const n="An unknown error occurred, please check the error payload for server response.";return new he(se.UNKNOWN,n)}function Gq(n){return new he(se.OBJECT_NOT_FOUND,"Object '"+n+"' does not exist.")}function Hq(n){return new he(se.QUOTA_EXCEEDED,"Quota for bucket '"+n+"' exceeded, please view quota on https://firebase.google.com/pricing/.")}function zq(){const n="User is not authenticated, please authenticate using Firebase Authentication and try again.";return new he(se.UNAUTHENTICATED,n)}function Qq(){return new he(se.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project.")}function Yq(n){return new he(se.UNAUTHORIZED,"User does not have permission to access '"+n+"'.")}function iC(){return new he(se.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function sC(){return new he(se.CANCELED,"User canceled the upload/download.")}function Xq(n){return new he(se.INVALID_URL,"Invalid URL '"+n+"'.")}function Jq(n){return new he(se.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.")}function Zq(){return new he(se.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+nC+"' property when initializing the app?")}function rC(){return new he(se.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function eW(){return new he(se.SERVER_FILE_WRONG_SIZE,"Server recorded incorrect upload file size, please retry the upload.")}function tW(){return new he(se.NO_DOWNLOAD_URL,"The given file does not have any download URLs.")}function nW(n){return new he(se.UNSUPPORTED_ENVIRONMENT,`${n} is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information.`)}function zs(n){return new he(se.INVALID_ARGUMENT,n)}function oC(){return new he(se.APP_DELETED,"The Firebase app was deleted.")}function aC(n){return new he(se.INVALID_ROOT_OPERATION,"The operation '"+n+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function vo(n,e){return new he(se.INVALID_FORMAT,"String does not match format '"+n+"': "+e)}function Xr(n){throw new he(se.INTERNAL_ERROR,"Internal error: "+n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tt{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return this.path.length===0}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let i;try{i=tt.makeFromUrl(e,t)}catch{return new tt(e,"")}if(i.path==="")return i;throw Jq(e)}static makeFromUrl(e,t){let i=null;const s="([A-Za-z0-9.\\-_]+)";function r(U){U.path.charAt(U.path.length-1)==="/"&&(U.path_=U.path_.slice(0,-1))}const o="(/(.*))?$",a=new RegExp("^gs://"+s+o,"i"),c={bucket:1,path:3};function l(U){U.path_=decodeURIComponent(U.path)}const u="v[A-Za-z0-9_]+",h=t.replace(/[.]/g,"\\."),d="(/([^?#]*).*)?$",f=new RegExp(`^https?://${h}/${u}/b/${s}/o${d}`,"i"),p={bucket:1,path:3},_=t===tC?"(?:storage.googleapis.com|storage.cloud.google.com)":t,w="([^?#]*)",N=new RegExp(`^https?://${_}/${s}/${w}`,"i"),x=[{regex:a,indices:c,postModify:r},{regex:f,indices:p,postModify:l},{regex:N,indices:{bucket:1,path:2},postModify:l}];for(let U=0;U<x.length;U++){const Q=x[U],G=Q.regex.exec(e);if(G){const me=G[Q.indices.bucket];let Et=G[Q.indices.path];Et||(Et=""),i=new tt(me,Et),Q.postModify(i);break}}if(i==null)throw Xq(e);return i}}class iW{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sW(n,e,t){let i=1,s=null,r=null,o=!1,a=0;function c(){return a===2}let l=!1;function u(...w){l||(l=!0,e.apply(null,w))}function h(w){s=setTimeout(()=>{s=null,n(f,c())},w)}function d(){r&&clearTimeout(r)}function f(w,...N){if(l){d();return}if(w){d(),u.call(null,w,...N);return}if(c()||o){d(),u.call(null,w,...N);return}i<64&&(i*=2);let x;a===1?(a=2,x=0):x=(i+Math.random())*1e3,h(x)}let p=!1;function _(w){p||(p=!0,d(),!l&&(s!==null?(w||(a=2),clearTimeout(s),h(0)):w||(a=1)))}return h(0),r=setTimeout(()=>{o=!0,_(!0)},t),_}function rW(n){n(!1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function oW(n){return n!==void 0}function aW(n){return typeof n=="function"}function cW(n){return typeof n=="object"&&!Array.isArray(n)}function Fu(n){return typeof n=="string"||n instanceof String}function Wy(n){return Ug()&&n instanceof Blob}function Ug(){return typeof Blob<"u"&&!Qd()}function jd(n,e,t,i){if(i<e)throw zs(`Invalid value for '${n}'. Expected ${e} or greater.`);if(i>t)throw zs(`Invalid value for '${n}'. Expected ${t} or less.`)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Si(n,e,t){let i=e;return t==null&&(i=`https://${e}`),`${t}://${i}/v0${n}`}function cC(n){const e=encodeURIComponent;let t="?";for(const i in n)if(n.hasOwnProperty(i)){const s=e(i)+"="+e(n[i]);t=t+s+"&"}return t=t.slice(0,-1),t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qi;(function(n){n[n.NO_ERROR=0]="NO_ERROR",n[n.NETWORK_ERROR=1]="NETWORK_ERROR",n[n.ABORT=2]="ABORT"})(Qi||(Qi={}));/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lC(n,e){const t=n>=500&&n<600,s=[408,429].indexOf(n)!==-1,r=e.indexOf(n)!==-1;return t||s||r}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lW{constructor(e,t,i,s,r,o,a,c,l,u,h,d=!0){this.url_=e,this.method_=t,this.headers_=i,this.body_=s,this.successCodes_=r,this.additionalRetryCodes_=o,this.callback_=a,this.errorCallback_=c,this.timeout_=l,this.progressCallback_=u,this.connectionFactory_=h,this.retry=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((f,p)=>{this.resolve_=f,this.reject_=p,this.start_()})}start_(){const e=(i,s)=>{if(s){i(!1,new ic(!1,null,!0));return}const r=this.connectionFactory_();this.pendingConnection_=r;const o=a=>{const c=a.loaded,l=a.lengthComputable?a.total:-1;this.progressCallback_!==null&&this.progressCallback_(c,l)};this.progressCallback_!==null&&r.addUploadProgressListener(o),r.send(this.url_,this.method_,this.body_,this.headers_).then(()=>{this.progressCallback_!==null&&r.removeUploadProgressListener(o),this.pendingConnection_=null;const a=r.getErrorCode()===Qi.NO_ERROR,c=r.getStatus();if(!a||lC(c,this.additionalRetryCodes_)&&this.retry){const u=r.getErrorCode()===Qi.ABORT;i(!1,new ic(!1,null,u));return}const l=this.successCodes_.indexOf(c)!==-1;i(!0,new ic(l,r))})},t=(i,s)=>{const r=this.resolve_,o=this.reject_,a=s.connection;if(s.wasSuccessCode)try{const c=this.callback_(a,a.getResponse());oW(c)?r(c):r()}catch(c){o(c)}else if(a!==null){const c=Fg();c.serverResponse=a.getErrorText(),this.errorCallback_?o(this.errorCallback_(a,c)):o(c)}else if(s.canceled){const c=this.appDelete_?oC():sC();o(c)}else{const c=iC();o(c)}};this.canceled_?t(!1,new ic(!1,null,!0)):this.backoffId_=sW(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,this.backoffId_!==null&&rW(this.backoffId_),this.pendingConnection_!==null&&this.pendingConnection_.abort()}}class ic{constructor(e,t,i){this.wasSuccessCode=e,this.connection=t,this.canceled=!!i}}function uW(n,e){e!==null&&e.length>0&&(n.Authorization="Firebase "+e)}function hW(n,e){n["X-Firebase-Storage-Version"]="webjs/"+(e??"AppManager")}function dW(n,e){e&&(n["X-Firebase-GMPID"]=e)}function fW(n,e){e!==null&&(n["X-Firebase-AppCheck"]=e)}function pW(n,e,t,i,s,r,o=!0){const a=cC(n.urlParams),c=n.url+a,l=Object.assign({},n.headers);return dW(l,e),uW(l,t),hW(l,r),fW(l,i),new lW(c,n.method,l,n.body,n.successCodes,n.additionalRetryCodes,n.handler,n.errorHandler,n.timeout,n.progressCallback,s,o)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gW(){return typeof BlobBuilder<"u"?BlobBuilder:typeof WebKitBlobBuilder<"u"?WebKitBlobBuilder:void 0}function mW(...n){const e=gW();if(e!==void 0){const t=new e;for(let i=0;i<n.length;i++)t.append(n[i]);return t.getBlob()}else{if(Ug())return new Blob(n);throw new he(se.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}}function _W(n,e,t){return n.webkitSlice?n.webkitSlice(e,t):n.mozSlice?n.mozSlice(e,t):n.slice?n.slice(e,t):null}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yW(n){if(typeof atob>"u")throw nW("base-64");return atob(n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vt={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"};class Eh{constructor(e,t){this.data=e,this.contentType=t||null}}function uC(n,e){switch(n){case Vt.RAW:return new Eh(hC(e));case Vt.BASE64:case Vt.BASE64URL:return new Eh(dC(n,e));case Vt.DATA_URL:return new Eh(wW(e),IW(e))}throw Fg()}function hC(n){const e=[];for(let t=0;t<n.length;t++){let i=n.charCodeAt(t);if(i<=127)e.push(i);else if(i<=2047)e.push(192|i>>6,128|i&63);else if((i&64512)===55296)if(!(t<n.length-1&&(n.charCodeAt(t+1)&64512)===56320))e.push(239,191,189);else{const r=i,o=n.charCodeAt(++t);i=65536|(r&1023)<<10|o&1023,e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|i&63)}else(i&64512)===56320?e.push(239,191,189):e.push(224|i>>12,128|i>>6&63,128|i&63)}return new Uint8Array(e)}function vW(n){let e;try{e=decodeURIComponent(n)}catch{throw vo(Vt.DATA_URL,"Malformed data URL.")}return hC(e)}function dC(n,e){switch(n){case Vt.BASE64:{const s=e.indexOf("-")!==-1,r=e.indexOf("_")!==-1;if(s||r)throw vo(n,"Invalid character '"+(s?"-":"_")+"' found: is it base64url encoded?");break}case Vt.BASE64URL:{const s=e.indexOf("+")!==-1,r=e.indexOf("/")!==-1;if(s||r)throw vo(n,"Invalid character '"+(s?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/");break}}let t;try{t=yW(e)}catch(s){throw s.message.includes("polyfill")?s:vo(n,"Invalid character found")}const i=new Uint8Array(t.length);for(let s=0;s<t.length;s++)i[s]=t.charCodeAt(s);return i}class fC{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(t===null)throw vo(Vt.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");const i=t[1]||null;i!=null&&(this.base64=TW(i,";base64"),this.contentType=this.base64?i.substring(0,i.length-7):i),this.rest=e.substring(e.indexOf(",")+1)}}function wW(n){const e=new fC(n);return e.base64?dC(Vt.BASE64,e.rest):vW(e.rest)}function IW(n){return new fC(n).contentType}function TW(n,e){return n.length>=e.length?n.substring(n.length-e.length)===e:!1}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class In{constructor(e,t){let i=0,s="";Wy(e)?(this.data_=e,i=e.size,s=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),i=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),i=e.length),this.size_=i,this.type_=s}size(){return this.size_}type(){return this.type_}slice(e,t){if(Wy(this.data_)){const i=this.data_,s=_W(i,e,t);return s===null?null:new In(s)}else{const i=new Uint8Array(this.data_.buffer,e,t-e);return new In(i,!0)}}static getBlob(...e){if(Ug()){const t=e.map(i=>i instanceof In?i.data_:i);return new In(mW.apply(null,t))}else{const t=e.map(o=>Fu(o)?uC(Vt.RAW,o).data:o.data_);let i=0;t.forEach(o=>{i+=o.byteLength});const s=new Uint8Array(i);let r=0;return t.forEach(o=>{for(let a=0;a<o.length;a++)s[r++]=o[a]}),new In(s,!0)}}uploadData(){return this.data_}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vg(n){let e;try{e=JSON.parse(n)}catch{return null}return cW(e)?e:null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function EW(n){if(n.length===0)return null;const e=n.lastIndexOf("/");return e===-1?"":n.slice(0,e)}function bW(n,e){const t=e.split("/").filter(i=>i.length>0).join("/");return n.length===0?t:n+"/"+t}function pC(n){const e=n.lastIndexOf("/",n.length-2);return e===-1?n:n.slice(e+1)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function SW(n,e){return e}class rt{constructor(e,t,i,s){this.server=e,this.local=t||e,this.writable=!!i,this.xform=s||SW}}let sc=null;function CW(n){return!Fu(n)||n.length<2?n:pC(n)}function Uu(){if(sc)return sc;const n=[];n.push(new rt("bucket")),n.push(new rt("generation")),n.push(new rt("metageneration")),n.push(new rt("name","fullPath",!0));function e(r,o){return CW(o)}const t=new rt("name");t.xform=e,n.push(t);function i(r,o){return o!==void 0?Number(o):o}const s=new rt("size");return s.xform=i,n.push(s),n.push(new rt("timeCreated")),n.push(new rt("updated")),n.push(new rt("md5Hash",null,!0)),n.push(new rt("cacheControl",null,!0)),n.push(new rt("contentDisposition",null,!0)),n.push(new rt("contentEncoding",null,!0)),n.push(new rt("contentLanguage",null,!0)),n.push(new rt("contentType",null,!0)),n.push(new rt("metadata","customMetadata",!0)),sc=n,sc}function kW(n,e){function t(){const i=n.bucket,s=n.fullPath,r=new tt(i,s);return e._makeStorageReference(r)}Object.defineProperty(n,"ref",{get:t})}function AW(n,e,t){const i={};i.type="file";const s=t.length;for(let r=0;r<s;r++){const o=t[r];i[o.local]=o.xform(i,e[o.server])}return kW(i,n),i}function gC(n,e,t){const i=Vg(e);return i===null?null:AW(n,i,t)}function RW(n,e,t,i){const s=Vg(e);if(s===null||!Fu(s.downloadTokens))return null;const r=s.downloadTokens;if(r.length===0)return null;const o=encodeURIComponent;return r.split(",").map(l=>{const u=n.bucket,h=n.fullPath,d="/b/"+o(u)+"/o/"+o(h),f=Si(d,t,i),p=cC({alt:"media",token:l});return f+p})[0]}function $g(n,e){const t={},i=e.length;for(let s=0;s<i;s++){const r=e[s];r.writable&&(t[r.server]=n[r.local])}return JSON.stringify(t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ky="prefixes",jy="items";function NW(n,e,t){const i={prefixes:[],items:[],nextPageToken:t.nextPageToken};if(t[Ky])for(const s of t[Ky]){const r=s.replace(/\/$/,""),o=n._makeStorageReference(new tt(e,r));i.prefixes.push(o)}if(t[jy])for(const s of t[jy]){const r=n._makeStorageReference(new tt(e,s.name));i.items.push(r)}return i}function DW(n,e,t){const i=Vg(t);return i===null?null:NW(n,e,i)}class Bn{constructor(e,t,i,s){this.url=e,this.method=t,this.handler=i,this.timeout=s,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dn(n){if(!n)throw Fg()}function Vu(n,e){function t(i,s){const r=gC(n,s,e);return dn(r!==null),r}return t}function PW(n,e){function t(i,s){const r=DW(n,e,s);return dn(r!==null),r}return t}function xW(n,e){function t(i,s){const r=gC(n,s,e);return dn(r!==null),RW(r,s,n.host,n._protocol)}return t}function Lr(n){function e(t,i){let s;return t.getStatus()===401?t.getErrorText().includes("Firebase App Check token is invalid")?s=Qq():s=zq():t.getStatus()===402?s=Hq(n.bucket):t.getStatus()===403?s=Yq(n.path):s=i,s.status=t.getStatus(),s.serverResponse=i.serverResponse,s}return e}function $u(n){const e=Lr(n);function t(i,s){let r=e(i,s);return i.getStatus()===404&&(r=Gq(n.path)),r.serverResponse=s.serverResponse,r}return t}function mC(n,e,t){const i=e.fullServerUrl(),s=Si(i,n.host,n._protocol),r="GET",o=n.maxOperationRetryTime,a=new Bn(s,r,Vu(n,t),o);return a.errorHandler=$u(e),a}function OW(n,e,t,i,s){const r={};e.isRoot?r.prefix="":r.prefix=e.path+"/",t&&t.length>0&&(r.delimiter=t),i&&(r.pageToken=i),s&&(r.maxResults=s);const o=e.bucketOnlyServerUrl(),a=Si(o,n.host,n._protocol),c="GET",l=n.maxOperationRetryTime,u=new Bn(a,c,PW(n,e.bucket),l);return u.urlParams=r,u.errorHandler=Lr(e),u}function MW(n,e,t){const i=e.fullServerUrl(),s=Si(i,n.host,n._protocol),r="GET",o=n.maxOperationRetryTime,a=new Bn(s,r,xW(n,t),o);return a.errorHandler=$u(e),a}function LW(n,e,t,i){const s=e.fullServerUrl(),r=Si(s,n.host,n._protocol),o="PATCH",a=$g(t,i),c={"Content-Type":"application/json; charset=utf-8"},l=n.maxOperationRetryTime,u=new Bn(r,o,Vu(n,i),l);return u.headers=c,u.body=a,u.errorHandler=$u(e),u}function FW(n,e){const t=e.fullServerUrl(),i=Si(t,n.host,n._protocol),s="DELETE",r=n.maxOperationRetryTime;function o(c,l){}const a=new Bn(i,s,o,r);return a.successCodes=[200,204],a.errorHandler=$u(e),a}function UW(n,e){return n&&n.contentType||e&&e.type()||"application/octet-stream"}function _C(n,e,t){const i=Object.assign({},t);return i.fullPath=n.path,i.size=e.size(),i.contentType||(i.contentType=UW(null,e)),i}function VW(n,e,t,i,s){const r=e.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};function a(){let x="";for(let U=0;U<2;U++)x=x+Math.random().toString().slice(2);return x}const c=a();o["Content-Type"]="multipart/related; boundary="+c;const l=_C(e,i,s),u=$g(l,t),h="--"+c+`\r
Content-Type: application/json; charset=utf-8\r
\r
`+u+`\r
--`+c+`\r
Content-Type: `+l.contentType+`\r
\r
`,d=`\r
--`+c+"--",f=In.getBlob(h,i,d);if(f===null)throw rC();const p={name:l.fullPath},_=Si(r,n.host,n._protocol),w="POST",N=n.maxUploadRetryTime,M=new Bn(_,w,Vu(n,t),N);return M.urlParams=p,M.headers=o,M.body=f.uploadData(),M.errorHandler=Lr(e),M}class fl{constructor(e,t,i,s){this.current=e,this.total=t,this.finalized=!!i,this.metadata=s||null}}function Bg(n,e){let t=null;try{t=n.getResponseHeader("X-Goog-Upload-Status")}catch{dn(!1)}return dn(!!t&&(e||["active"]).indexOf(t)!==-1),t}function $W(n,e,t,i,s){const r=e.bucketOnlyServerUrl(),o=_C(e,i,s),a={name:o.fullPath},c=Si(r,n.host,n._protocol),l="POST",u={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${i.size()}`,"X-Goog-Upload-Header-Content-Type":o.contentType,"Content-Type":"application/json; charset=utf-8"},h=$g(o,t),d=n.maxUploadRetryTime;function f(_){Bg(_);let w;try{w=_.getResponseHeader("X-Goog-Upload-URL")}catch{dn(!1)}return dn(Fu(w)),w}const p=new Bn(c,l,f,d);return p.urlParams=a,p.headers=u,p.body=h,p.errorHandler=Lr(e),p}function BW(n,e,t,i){const s={"X-Goog-Upload-Command":"query"};function r(l){const u=Bg(l,["active","final"]);let h=null;try{h=l.getResponseHeader("X-Goog-Upload-Size-Received")}catch{dn(!1)}h||dn(!1);const d=Number(h);return dn(!isNaN(d)),new fl(d,i.size(),u==="final")}const o="POST",a=n.maxUploadRetryTime,c=new Bn(t,o,r,a);return c.headers=s,c.errorHandler=Lr(e),c}const Gy=256*1024;function qW(n,e,t,i,s,r,o,a){const c=new fl(0,0);if(o?(c.current=o.current,c.total=o.total):(c.current=0,c.total=i.size()),i.size()!==c.total)throw eW();const l=c.total-c.current;let u=l;s>0&&(u=Math.min(u,s));const h=c.current,d=h+u;let f="";u===0?f="finalize":l===u?f="upload, finalize":f="upload";const p={"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":`${c.current}`},_=i.slice(h,d);if(_===null)throw rC();function w(U,Q){const G=Bg(U,["active","final"]),me=c.current+u,Et=i.size();let Ci;return G==="final"?Ci=Vu(e,r)(U,Q):Ci=null,new fl(me,Et,G==="final",Ci)}const N="POST",M=e.maxUploadRetryTime,x=new Bn(t,N,w,M);return x.headers=p,x.body=_.uploadData(),x.progressCallback=a||null,x.errorHandler=Lr(n),x}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WW={STATE_CHANGED:"state_changed"},ct={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function bh(n){switch(n){case"running":case"pausing":case"canceling":return ct.RUNNING;case"paused":return ct.PAUSED;case"success":return ct.SUCCESS;case"canceled":return ct.CANCELED;case"error":return ct.ERROR;default:return ct.ERROR}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class KW{constructor(e,t,i){if(aW(e)||t!=null||i!=null)this.next=e,this.error=t??void 0,this.complete=i??void 0;else{const r=e;this.next=r.next,this.error=r.error,this.complete=r.complete}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ps(n){return(...e)=>{Promise.resolve().then(()=>n(...e))}}class jW{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=Qi.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=Qi.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=Qi.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,i,s){if(this.sent_)throw Xr("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(t,e,!0),s!==void 0)for(const r in s)s.hasOwnProperty(r)&&this.xhr_.setRequestHeader(r,s[r].toString());return i!==void 0?this.xhr_.send(i):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw Xr("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw Xr("cannot .getStatus() before sending");try{return this.xhr_.status}catch{return-1}}getResponse(){if(!this.sent_)throw Xr("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw Xr("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){this.xhr_.upload!=null&&this.xhr_.upload.removeEventListener("progress",e)}}class GW extends jW{initXhr(){this.xhr_.responseType="text"}}function nn(){return new GW}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yC{constructor(e,t,i=null){this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=e,this._blob=t,this._metadata=i,this._mappings=Uu(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=s=>{if(this._request=void 0,this._chunkMultiplier=1,s._codeEquals(se.CANCELED))this._needToFetchStatus=!0,this.completeTransitions_();else{const r=this.isExponentialBackoffExpired();if(lC(s.status,[]))if(r)s=iC();else{this.sleepTime=Math.max(this.sleepTime*2,jq),this._needToFetchStatus=!0,this.completeTransitions_();return}this._error=s,this._transition("error")}},this._metadataErrorHandler=s=>{this._request=void 0,s._codeEquals(se.CANCELED)?this.completeTransitions_():(this._error=s,this._transition("error"))},this.sleepTime=0,this.maxSleepTime=this._ref.storage.maxUploadRetryTime,this._promise=new Promise((s,r)=>{this._resolve=s,this._reject=r,this._start()}),this._promise.then(null,()=>{})}isExponentialBackoffExpired(){return this.sleepTime>this.maxSleepTime}_makeProgressCallback(){const e=this._transferred;return t=>this._updateProgress(e+t)}_shouldDoResumable(e){return e.size()>256*1024}_start(){this._state==="running"&&this._request===void 0&&(this._resumable?this._uploadUrl===void 0?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this.pendingTimeout=setTimeout(()=>{this.pendingTimeout=void 0,this._continueUpload()},this.sleepTime):this._oneShotUpload())}_resolveToken(e){Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(([t,i])=>{switch(this._state){case"running":e(t,i);break;case"canceling":this._transition("canceled");break;case"pausing":this._transition("paused");break}})}_createResumable(){this._resolveToken((e,t)=>{const i=$W(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(i,nn,e,t);this._request=s,s.getPromise().then(r=>{this._request=void 0,this._uploadUrl=r,this._needToFetchStatus=!1,this.completeTransitions_()},this._errorHandler)})}_fetchStatus(){const e=this._uploadUrl;this._resolveToken((t,i)=>{const s=BW(this._ref.storage,this._ref._location,e,this._blob),r=this._ref.storage._makeRequest(s,nn,t,i);this._request=r,r.getPromise().then(o=>{o=o,this._request=void 0,this._updateProgress(o.current),this._needToFetchStatus=!1,o.finalized&&(this._needToFetchMetadata=!0),this.completeTransitions_()},this._errorHandler)})}_continueUpload(){const e=Gy*this._chunkMultiplier,t=new fl(this._transferred,this._blob.size()),i=this._uploadUrl;this._resolveToken((s,r)=>{let o;try{o=qW(this._ref._location,this._ref.storage,i,this._blob,e,this._mappings,t,this._makeProgressCallback())}catch(c){this._error=c,this._transition("error");return}const a=this._ref.storage._makeRequest(o,nn,s,r,!1);this._request=a,a.getPromise().then(c=>{this._increaseMultiplier(),this._request=void 0,this._updateProgress(c.current),c.finalized?(this._metadata=c.metadata,this._transition("success")):this.completeTransitions_()},this._errorHandler)})}_increaseMultiplier(){Gy*this._chunkMultiplier*2<32*1024*1024&&(this._chunkMultiplier*=2)}_fetchMetadata(){this._resolveToken((e,t)=>{const i=mC(this._ref.storage,this._ref._location,this._mappings),s=this._ref.storage._makeRequest(i,nn,e,t);this._request=s,s.getPromise().then(r=>{this._request=void 0,this._metadata=r,this._transition("success")},this._metadataErrorHandler)})}_oneShotUpload(){this._resolveToken((e,t)=>{const i=VW(this._ref.storage,this._ref._location,this._mappings,this._blob,this._metadata),s=this._ref.storage._makeRequest(i,nn,e,t);this._request=s,s.getPromise().then(r=>{this._request=void 0,this._metadata=r,this._updateProgress(this._blob.size()),this._transition("success")},this._errorHandler)})}_updateProgress(e){const t=this._transferred;this._transferred=e,this._transferred!==t&&this._notifyObservers()}_transition(e){if(this._state!==e)switch(e){case"canceling":case"pausing":this._state=e,this._request!==void 0?this._request.cancel():this.pendingTimeout&&(clearTimeout(this.pendingTimeout),this.pendingTimeout=void 0,this.completeTransitions_());break;case"running":const t=this._state==="paused";this._state=e,t&&(this._notifyObservers(),this._start());break;case"paused":this._state=e,this._notifyObservers();break;case"canceled":this._error=sC(),this._state=e,this._notifyObservers();break;case"error":this._state=e,this._notifyObservers();break;case"success":this._state=e,this._notifyObservers();break}}completeTransitions_(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start();break}}get snapshot(){const e=bh(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:e,metadata:this._metadata,task:this,ref:this._ref}}on(e,t,i,s){const r=new KW(t||void 0,i||void 0,s||void 0);return this._addObserver(r),()=>{this._removeObserver(r)}}then(e,t){return this._promise.then(e,t)}catch(e){return this.then(null,e)}_addObserver(e){this._observers.push(e),this._notifyObserver(e)}_removeObserver(e){const t=this._observers.indexOf(e);t!==-1&&this._observers.splice(t,1)}_notifyObservers(){this._finishPromise(),this._observers.slice().forEach(t=>{this._notifyObserver(t)})}_finishPromise(){if(this._resolve!==void 0){let e=!0;switch(bh(this._state)){case ct.SUCCESS:Ps(this._resolve.bind(null,this.snapshot))();break;case ct.CANCELED:case ct.ERROR:const t=this._reject;Ps(t.bind(null,this._error))();break;default:e=!1;break}e&&(this._resolve=void 0,this._reject=void 0)}}_notifyObserver(e){switch(bh(this._state)){case ct.RUNNING:case ct.PAUSED:e.next&&Ps(e.next.bind(e,this.snapshot))();break;case ct.SUCCESS:e.complete&&Ps(e.complete.bind(e))();break;case ct.CANCELED:case ct.ERROR:e.error&&Ps(e.error.bind(e,this._error))();break;default:e.error&&Ps(e.error.bind(e,this._error))()}}resume(){const e=this._state==="paused"||this._state==="pausing";return e&&this._transition("running"),e}pause(){const e=this._state==="running";return e&&this._transition("pausing"),e}cancel(){const e=this._state==="running"||this._state==="pausing";return e&&this._transition("canceling"),e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ms{constructor(e,t){this._service=e,t instanceof tt?this._location=t:this._location=tt.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new ms(e,t)}get root(){const e=new tt(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return pC(this._location.path)}get storage(){return this._service}get parent(){const e=EW(this._location.path);if(e===null)return null;const t=new tt(this._location.bucket,e);return new ms(this._service,t)}_throwIfRoot(e){if(this._location.path==="")throw aC(e)}}function HW(n,e,t){return n._throwIfRoot("uploadBytesResumable"),new yC(n,new In(e),t)}function zW(n){const e={prefixes:[],items:[]};return vC(n,e).then(()=>e)}async function vC(n,e,t){const s=await wC(n,{pageToken:t});e.prefixes.push(...s.prefixes),e.items.push(...s.items),s.nextPageToken!=null&&await vC(n,e,s.nextPageToken)}function wC(n,e){e!=null&&typeof e.maxResults=="number"&&jd("options.maxResults",1,1e3,e.maxResults);const t=e||{},i=OW(n.storage,n._location,"/",t.pageToken,t.maxResults);return n.storage.makeRequestWithTokens(i,nn)}function QW(n){n._throwIfRoot("getMetadata");const e=mC(n.storage,n._location,Uu());return n.storage.makeRequestWithTokens(e,nn)}function YW(n,e){n._throwIfRoot("updateMetadata");const t=LW(n.storage,n._location,e,Uu());return n.storage.makeRequestWithTokens(t,nn)}function XW(n){n._throwIfRoot("getDownloadURL");const e=MW(n.storage,n._location,Uu());return n.storage.makeRequestWithTokens(e,nn).then(t=>{if(t===null)throw tW();return t})}function JW(n){n._throwIfRoot("deleteObject");const e=FW(n.storage,n._location);return n.storage.makeRequestWithTokens(e,nn)}function IC(n,e){const t=bW(n._location.path,e),i=new tt(n._location.bucket,t);return new ms(n.storage,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ZW(n){return/^[A-Za-z]+:\/\//.test(n)}function eK(n,e){return new ms(n,e)}function TC(n,e){if(n instanceof qg){const t=n;if(t._bucket==null)throw Zq();const i=new ms(t,t._bucket);return e!=null?TC(i,e):i}else return e!==void 0?IC(n,e):n}function tK(n,e){if(e&&ZW(e)){if(n instanceof qg)return eK(n,e);throw zs("To use ref(service, url), the first argument must be a Storage instance.")}else return TC(n,e)}function Hy(n,e){const t=e==null?void 0:e[nC];return t==null?null:tt.makeFromBucketSpec(t,n)}function nK(n,e,t,i={}){n.host=`${e}:${t}`,n._protocol="http";const{mockUserToken:s}=i;s&&(n._overrideAuthToken=typeof s=="string"?s:Xd(s,n.app.options.projectId))}class qg{constructor(e,t,i,s,r){this.app=e,this._authProvider=t,this._appCheckProvider=i,this._url=s,this._firebaseVersion=r,this._bucket=null,this._host=tC,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=Wq,this._maxUploadRetryTime=Kq,this._requests=new Set,s!=null?this._bucket=tt.makeFromBucketSpec(s,this._host):this._bucket=Hy(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,this._url!=null?this._bucket=tt.makeFromBucketSpec(this._url,e):this._bucket=Hy(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){jd("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){jd("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(t!==null)return t.accessToken}return null}async _getAppCheckToken(){const e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ms(this,e)}_makeRequest(e,t,i,s,r=!0){if(this._deleted)return new iW(oC());{const o=pW(e,this._appId,i,s,t,this._firebaseVersion,r);return this._requests.add(o),o.getPromise().then(()=>this._requests.delete(o),()=>this._requests.delete(o)),o}}async makeRequestWithTokens(e,t){const[i,s]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,i,s).getPromise()}}const zy="@firebase/storage",Qy="0.11.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iK="storage";function sK(n,e,t){return n=v(n),HW(n,e,t)}function rK(n){return n=v(n),QW(n)}function oK(n,e){return n=v(n),YW(n,e)}function aK(n,e){return n=v(n),wC(n,e)}function cK(n){return n=v(n),zW(n)}function lK(n){return n=v(n),XW(n)}function uK(n){return n=v(n),JW(n)}function Yy(n,e){return n=v(n),tK(n,e)}function hK(n,e){return IC(n,e)}function dK(n,e,t,i={}){nK(n,e,t,i)}function fK(n,{instanceIdentifier:e}){const t=n.getProvider("app").getImmediate(),i=n.getProvider("auth-internal"),s=n.getProvider("app-check-internal");return new qg(t,i,s,e,Mn)}function pK(){Me(new X(iK,fK,"PUBLIC").setMultipleInstances(!0)),ue(zy,Qy,""),ue(zy,Qy,"esm2017")}pK();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rc{constructor(e,t,i){this._delegate=e,this.task=t,this.ref=i}get bytesTransferred(){return this._delegate.bytesTransferred}get metadata(){return this._delegate.metadata}get state(){return this._delegate.state}get totalBytes(){return this._delegate.totalBytes}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xy{constructor(e,t){this._delegate=e,this._ref=t,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}get snapshot(){return new rc(this._delegate.snapshot,this,this._ref)}then(e,t){return this._delegate.then(i=>{if(e)return e(new rc(i,this,this._ref))},t)}on(e,t,i,s){let r;return t&&(typeof t=="function"?r=o=>t(new rc(o,this,this._ref)):r={next:t.next?o=>t.next(new rc(o,this,this._ref)):void 0,complete:t.complete||void 0,error:t.error||void 0}),this._delegate.on(e,r,i||void 0,s||void 0)}}class Jy{constructor(e,t){this._delegate=e,this._service=t}get prefixes(){return this._delegate.prefixes.map(e=>new Rn(e,this._service))}get items(){return this._delegate.items.map(e=>new Rn(e,this._service))}get nextPageToken(){return this._delegate.nextPageToken||null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rn{constructor(e,t){this._delegate=e,this.storage=t}get name(){return this._delegate.name}get bucket(){return this._delegate.bucket}get fullPath(){return this._delegate.fullPath}toString(){return this._delegate.toString()}child(e){const t=hK(this._delegate,e);return new Rn(t,this.storage)}get root(){return new Rn(this._delegate.root,this.storage)}get parent(){const e=this._delegate.parent;return e==null?null:new Rn(e,this.storage)}put(e,t){return this._throwIfRoot("put"),new Xy(sK(this._delegate,e,t),this)}putString(e,t=Vt.RAW,i){this._throwIfRoot("putString");const s=uC(t,e),r=Object.assign({},i);return r.contentType==null&&s.contentType!=null&&(r.contentType=s.contentType),new Xy(new yC(this._delegate,new In(s.data,!0),r),this)}listAll(){return cK(this._delegate).then(e=>new Jy(e,this.storage))}list(e){return aK(this._delegate,e||void 0).then(t=>new Jy(t,this.storage))}getMetadata(){return rK(this._delegate)}updateMetadata(e){return oK(this._delegate,e)}getDownloadURL(){return lK(this._delegate)}delete(){return this._throwIfRoot("delete"),uK(this._delegate)}_throwIfRoot(e){if(this._delegate._location.path==="")throw aC(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class EC{constructor(e,t){this.app=e,this._delegate=t}get maxOperationRetryTime(){return this._delegate.maxOperationRetryTime}get maxUploadRetryTime(){return this._delegate.maxUploadRetryTime}ref(e){if(Zy(e))throw zs("ref() expected a child path but got a URL, use refFromURL instead.");return new Rn(Yy(this._delegate,e),this)}refFromURL(e){if(!Zy(e))throw zs("refFromURL() expected a full URL but got a child path, use ref() instead.");try{tt.makeFromUrl(e,this._delegate.host)}catch{throw zs("refFromUrl() expected a valid full URL but got an invalid one.")}return new Rn(Yy(this._delegate,e),this)}setMaxUploadRetryTime(e){this._delegate.maxUploadRetryTime=e}setMaxOperationRetryTime(e){this._delegate.maxOperationRetryTime=e}useEmulator(e,t,i={}){dK(this._delegate,e,t,i)}}function Zy(n){return/^[A-Za-z]+:\/\//.test(n)}const gK="@firebase/storage-compat",mK="0.3.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _K="storage-compat";function yK(n,{instanceIdentifier:e}){const t=n.getProvider("app-compat").getImmediate(),i=n.getProvider("storage").getImmediate({identifier:e});return new EC(t,i)}function vK(n){const e={TaskState:ct,TaskEvent:WW,StringFormat:Vt,Storage:EC,Reference:Rn};n.INTERNAL.registerComponent(new X(_K,yK,"PUBLIC").setServiceProps(e).setMultipleInstances(!0)),n.registerVersion(gK,mK)}vK(Ve);const ev="@firebase/performance",Gd="0.6.3";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bC=Gd,wK="FB-PERF-TRACE-START",IK="FB-PERF-TRACE-STOP",Hd="FB-PERF-TRACE-MEASURE",SC="_wt_",CC="_fp",kC="_fcp",AC="_fid",RC="@firebase/performance/config",NC="@firebase/performance/configexpire",TK="performance",DC="Performance";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const EK={["trace started"]:"Trace {$traceName} was started before.",["trace stopped"]:"Trace {$traceName} is not running.",["nonpositive trace startTime"]:"Trace {$traceName} startTime should be positive.",["nonpositive trace duration"]:"Trace {$traceName} duration should be positive.",["no window"]:"Window is not available.",["no app id"]:"App id is not available.",["no project id"]:"Project id is not available.",["no api key"]:"Api key is not available.",["invalid cc log"]:"Attempted to queue invalid cc event",["FB not default"]:"Performance can only start when Firebase app instance is the default one.",["RC response not ok"]:"RC response is not ok",["invalid attribute name"]:"Attribute name {$attributeName} is invalid.",["invalid attribute value"]:"Attribute value {$attributeValue} is invalid.",["invalid custom metric name"]:"Custom metric name {$customMetricName} is invalid",["invalid String merger input"]:"Input for String merger is invalid, contact support team to resolve.",["already initialized"]:"initializePerformance() has already been called with different options. To avoid this error, call initializePerformance() with the same options as when it was originally called, or call getPerformance() to return the already initialized instance."},et=new xt(TK,DC,EK);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yn=new On(DC);yn.logLevel=kt.INFO;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Sh,PC;class Oe{constructor(e){if(this.window=e,!e)throw et.create("no window");this.performance=e.performance,this.PerformanceObserver=e.PerformanceObserver,this.windowLocation=e.location,this.navigator=e.navigator,this.document=e.document,this.navigator&&this.navigator.cookieEnabled&&(this.localStorage=e.localStorage),e.perfMetrics&&e.perfMetrics.onFirstInputDelay&&(this.onFirstInputDelay=e.perfMetrics.onFirstInputDelay)}getUrl(){return this.windowLocation.href.split("?")[0]}mark(e){!this.performance||!this.performance.mark||this.performance.mark(e)}measure(e,t,i){!this.performance||!this.performance.measure||this.performance.measure(e,t,i)}getEntriesByType(e){return!this.performance||!this.performance.getEntriesByType?[]:this.performance.getEntriesByType(e)}getEntriesByName(e){return!this.performance||!this.performance.getEntriesByName?[]:this.performance.getEntriesByName(e)}getTimeOrigin(){return this.performance&&(this.performance.timeOrigin||this.performance.timing.navigationStart)}requiredApisAvailable(){return!fetch||!Promise||!ml()?(yn.info("Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled."),!1):Rt()?!0:(yn.info("IndexedDB is not supported by current browswer"),!1)}setupObserver(e,t){if(!this.PerformanceObserver)return;new this.PerformanceObserver(s=>{for(const r of s.getEntries())t(r)}).observe({entryTypes:[e]})}static getInstance(){return Sh===void 0&&(Sh=new Oe(PC)),Sh}}function bK(n){PC=n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let xC;function SK(n){const e=n.getId();return e.then(t=>{xC=t}),e}function Wg(){return xC}function CK(n){const e=n.getToken();return e.then(t=>{}),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tv(n,e){const t=n.length-e.length;if(t<0||t>1)throw et.create("invalid String merger input");const i=[];for(let s=0;s<n.length;s++)i.push(n.charAt(s)),e.length>s&&i.push(e.charAt(s));return i.join("")}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ch;class Ct{constructor(){this.instrumentationEnabled=!0,this.dataCollectionEnabled=!0,this.loggingEnabled=!1,this.tracesSamplingRate=1,this.networkRequestsSamplingRate=1,this.logEndPointUrl="https://firebaselogging.googleapis.com/v0cc/log?format=json_proto",this.flTransportEndpointUrl=tv("hts/frbslgigp.ogepscmv/ieo/eaylg","tp:/ieaeogn-agolai.o/1frlglgc/o"),this.transportKey=tv("AzSC8r6ReiGqFMyfvgow","Iayx0u-XT3vksVM-pIV"),this.logSource=462,this.logTraceAfterSampling=!1,this.logNetworkAfterSampling=!1,this.configTimeToLive=12}getFlTransportFullUrl(){return this.flTransportEndpointUrl.concat("?key=",this.transportKey)}static getInstance(){return Ch===void 0&&(Ch=new Ct),Ch}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Qs;(function(n){n[n.UNKNOWN=0]="UNKNOWN",n[n.VISIBLE=1]="VISIBLE",n[n.HIDDEN=2]="HIDDEN"})(Qs||(Qs={}));const kK=["firebase_","google_","ga_"],AK=new RegExp("^[a-zA-Z]\\w*$"),RK=40,NK=100;function DK(){const n=Oe.getInstance().navigator;return n!=null&&n.serviceWorker?n.serviceWorker.controller?2:3:1}function OC(){switch(Oe.getInstance().document.visibilityState){case"visible":return Qs.VISIBLE;case"hidden":return Qs.HIDDEN;default:return Qs.UNKNOWN}}function PK(){const e=Oe.getInstance().navigator.connection;switch(e&&e.effectiveType){case"slow-2g":return 1;case"2g":return 2;case"3g":return 3;case"4g":return 4;default:return 0}}function xK(n){return n.length===0||n.length>RK?!1:!kK.some(t=>n.startsWith(t))&&!!n.match(AK)}function OK(n){return n.length!==0&&n.length<=NK}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function MC(n){var e;const t=(e=n.options)===null||e===void 0?void 0:e.appId;if(!t)throw et.create("no app id");return t}function MK(n){var e;const t=(e=n.options)===null||e===void 0?void 0:e.projectId;if(!t)throw et.create("no project id");return t}function LK(n){var e;const t=(e=n.options)===null||e===void 0?void 0:e.apiKey;if(!t)throw et.create("no api key");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const FK="0.0.1",jt={loggingEnabled:!0},UK="FIREBASE_INSTALLATIONS_AUTH";function VK(n,e){const t=$K();return t?(nv(t),Promise.resolve()):WK(n,e).then(nv).then(i=>BK(i),()=>{})}function $K(){const n=Oe.getInstance().localStorage;if(!n)return;const e=n.getItem(NC);if(!e||!KK(e))return;const t=n.getItem(RC);if(t)try{return JSON.parse(t)}catch{return}}function BK(n){const e=Oe.getInstance().localStorage;!n||!e||(e.setItem(RC,JSON.stringify(n)),e.setItem(NC,String(Date.now()+Ct.getInstance().configTimeToLive*60*60*1e3)))}const qK="Could not fetch config, will use default configs";function WK(n,e){return CK(n.installations).then(t=>{const i=MK(n.app),s=LK(n.app),r=`https://firebaseremoteconfig.googleapis.com/v1/projects/${i}/namespaces/fireperf:fetch?key=${s}`,o=new Request(r,{method:"POST",headers:{Authorization:`${UK} ${t}`},body:JSON.stringify({app_instance_id:e,app_instance_id_token:t,app_id:MC(n.app),app_version:bC,sdk_version:FK})});return fetch(o).then(a=>{if(a.ok)return a.json();throw et.create("RC response not ok")})}).catch(()=>{yn.info(qK)})}function nv(n){if(!n)return n;const e=Ct.getInstance(),t=n.entries||{};return t.fpr_enabled!==void 0?e.loggingEnabled=String(t.fpr_enabled)==="true":e.loggingEnabled=jt.loggingEnabled,t.fpr_log_source?e.logSource=Number(t.fpr_log_source):jt.logSource&&(e.logSource=jt.logSource),t.fpr_log_endpoint_url?e.logEndPointUrl=t.fpr_log_endpoint_url:jt.logEndPointUrl&&(e.logEndPointUrl=jt.logEndPointUrl),t.fpr_log_transport_key?e.transportKey=t.fpr_log_transport_key:jt.transportKey&&(e.transportKey=jt.transportKey),t.fpr_vc_network_request_sampling_rate!==void 0?e.networkRequestsSamplingRate=Number(t.fpr_vc_network_request_sampling_rate):jt.networkRequestsSamplingRate!==void 0&&(e.networkRequestsSamplingRate=jt.networkRequestsSamplingRate),t.fpr_vc_trace_sampling_rate!==void 0?e.tracesSamplingRate=Number(t.fpr_vc_trace_sampling_rate):jt.tracesSamplingRate!==void 0&&(e.tracesSamplingRate=jt.tracesSamplingRate),e.logTraceAfterSampling=iv(e.tracesSamplingRate),e.logNetworkAfterSampling=iv(e.networkRequestsSamplingRate),n}function KK(n){return Number(n)>Date.now()}function iv(n){return Math.random()<=n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Kg=1,kh;function LC(n){return Kg=2,kh=kh||GK(n),kh}function jK(){return Kg===3}function GK(n){return HK().then(()=>SK(n.installations)).then(e=>VK(n,e)).then(()=>sv(),()=>sv())}function HK(){const n=Oe.getInstance().document;return new Promise(e=>{if(n&&n.readyState!=="complete"){const t=()=>{n.readyState==="complete"&&(n.removeEventListener("readystatechange",t),e())};n.addEventListener("readystatechange",t)}else e()})}function sv(){Kg=3}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jg=10*1e3,zK=5.5*1e3,FC=3,QK=1e3;let pl=FC,ni=[],rv=!1;function YK(){rv||(Bu(zK),rv=!0)}function Bu(n){setTimeout(()=>{if(pl!==0){if(!ni.length)return Bu(jg);XK()}},n)}function XK(){const n=ni.splice(0,QK),e=n.map(i=>({source_extension_json_proto3:i.message,event_time_ms:String(i.eventTime)})),t={request_time_ms:String(Date.now()),client_info:{client_type:1,js_client_info:{}},log_source:Ct.getInstance().logSource,log_event:e};JK(t,n).catch(()=>{ni=[...n,...ni],pl--,yn.info(`Tries left: ${pl}.`),Bu(jg)})}function JK(n,e){return ZK(n).then(t=>(t.ok||yn.info("Call to Firebase backend failed."),t.json())).then(t=>{const i=Number(t.nextRequestWaitMillis);let s=jg;isNaN(i)||(s=Math.max(i,s));const r=t.logResponseDetails;Array.isArray(r)&&r.length>0&&r[0].responseAction==="RETRY_REQUEST_LATER"&&(ni=[...e,...ni],yn.info("Retry transport request later.")),pl=FC,Bu(s)})}function ZK(n){const e=Ct.getInstance().getFlTransportFullUrl();return fetch(e,{method:"POST",body:JSON.stringify(n)})}function ej(n){if(!n.eventTime||!n.message)throw et.create("invalid cc log");ni=[...ni,n]}function tj(n){return(...e)=>{const t=n(...e);ej({message:t,eventTime:Date.now()})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Ah;function UC(n,e){Ah||(Ah=tj(ij)),Ah(n,e)}function oc(n){const e=Ct.getInstance();!e.instrumentationEnabled&&n.isAuto||!e.dataCollectionEnabled&&!n.isAuto||Oe.getInstance().requiredApisAvailable()&&(n.isAuto&&OC()!==Qs.VISIBLE||(jK()?Rh(n):LC(n.performanceController).then(()=>Rh(n),()=>Rh(n))))}function Rh(n){if(!Wg())return;const e=Ct.getInstance();!e.loggingEnabled||!e.logTraceAfterSampling||setTimeout(()=>UC(n,1),0)}function nj(n){const e=Ct.getInstance();if(!e.instrumentationEnabled)return;const t=n.url,i=e.logEndPointUrl.split("?")[0],s=e.flTransportEndpointUrl.split("?")[0];t===i||t===s||!e.loggingEnabled||!e.logNetworkAfterSampling||setTimeout(()=>UC(n,0),0)}function ij(n,e){return e===0?sj(n):rj(n)}function sj(n){const e={url:n.url,http_method:n.httpMethod||0,http_response_code:200,response_payload_bytes:n.responsePayloadBytes,client_start_time_us:n.startTimeUs,time_to_response_initiated_us:n.timeToResponseInitiatedUs,time_to_response_completed_us:n.timeToResponseCompletedUs},t={application_info:VC(n.performanceController.app),network_request_metric:e};return JSON.stringify(t)}function rj(n){const e={name:n.name,is_auto:n.isAuto,client_start_time_us:n.startTimeUs,duration_us:n.durationUs};Object.keys(n.counters).length!==0&&(e.counters=n.counters);const t=n.getAttributes();Object.keys(t).length!==0&&(e.custom_attributes=t);const i={application_info:VC(n.performanceController.app),trace_metric:e};return JSON.stringify(i)}function VC(n){return{google_app_id:MC(n),app_instance_id:Wg(),web_app_info:{sdk_version:bC,page_url:Oe.getInstance().getUrl(),service_worker_status:DK(),visibility_state:OC(),effective_connection_type:PK()},application_process_state:0}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const oj=100,aj="_",cj=[CC,kC,AC];function lj(n,e){return n.length===0||n.length>oj?!1:e&&e.startsWith(SC)&&cj.indexOf(n)>-1||!n.startsWith(aj)}function uj(n){const e=Math.floor(n);return e<n&&yn.info(`Metric value should be an Integer, setting the value as : ${e}.`),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ii{constructor(e,t,i=!1,s){this.performanceController=e,this.name=t,this.isAuto=i,this.state=1,this.customAttributes={},this.counters={},this.api=Oe.getInstance(),this.randomId=Math.floor(Math.random()*1e6),this.isAuto||(this.traceStartMark=`${wK}-${this.randomId}-${this.name}`,this.traceStopMark=`${IK}-${this.randomId}-${this.name}`,this.traceMeasure=s||`${Hd}-${this.randomId}-${this.name}`,s&&this.calculateTraceMetrics())}start(){if(this.state!==1)throw et.create("trace started",{traceName:this.name});this.api.mark(this.traceStartMark),this.state=2}stop(){if(this.state!==2)throw et.create("trace stopped",{traceName:this.name});this.state=3,this.api.mark(this.traceStopMark),this.api.measure(this.traceMeasure,this.traceStartMark,this.traceStopMark),this.calculateTraceMetrics(),oc(this)}record(e,t,i){if(e<=0)throw et.create("nonpositive trace startTime",{traceName:this.name});if(t<=0)throw et.create("nonpositive trace duration",{traceName:this.name});if(this.durationUs=Math.floor(t*1e3),this.startTimeUs=Math.floor(e*1e3),i&&i.attributes&&(this.customAttributes=Object.assign({},i.attributes)),i&&i.metrics)for(const s of Object.keys(i.metrics))isNaN(Number(i.metrics[s]))||(this.counters[s]=Math.floor(Number(i.metrics[s])));oc(this)}incrementMetric(e,t=1){this.counters[e]===void 0?this.putMetric(e,t):this.putMetric(e,this.counters[e]+t)}putMetric(e,t){if(lj(e,this.name))this.counters[e]=uj(t??0);else throw et.create("invalid custom metric name",{customMetricName:e})}getMetric(e){return this.counters[e]||0}putAttribute(e,t){const i=xK(e),s=OK(t);if(i&&s){this.customAttributes[e]=t;return}if(!i)throw et.create("invalid attribute name",{attributeName:e});if(!s)throw et.create("invalid attribute value",{attributeValue:t})}getAttribute(e){return this.customAttributes[e]}removeAttribute(e){this.customAttributes[e]!==void 0&&delete this.customAttributes[e]}getAttributes(){return Object.assign({},this.customAttributes)}setStartTime(e){this.startTimeUs=e}setDuration(e){this.durationUs=e}calculateTraceMetrics(){const e=this.api.getEntriesByName(this.traceMeasure),t=e&&e[0];t&&(this.durationUs=Math.floor(t.duration*1e3),this.startTimeUs=Math.floor((t.startTime+this.api.getTimeOrigin())*1e3))}static createOobTrace(e,t,i,s){const r=Oe.getInstance().getUrl();if(!r)return;const o=new ii(e,SC+r,!0),a=Math.floor(Oe.getInstance().getTimeOrigin()*1e3);o.setStartTime(a),t&&t[0]&&(o.setDuration(Math.floor(t[0].duration*1e3)),o.putMetric("domInteractive",Math.floor(t[0].domInteractive*1e3)),o.putMetric("domContentLoadedEventEnd",Math.floor(t[0].domContentLoadedEventEnd*1e3)),o.putMetric("loadEventEnd",Math.floor(t[0].loadEventEnd*1e3)));const c="first-paint",l="first-contentful-paint";if(i){const u=i.find(d=>d.name===c);u&&u.startTime&&o.putMetric(CC,Math.floor(u.startTime*1e3));const h=i.find(d=>d.name===l);h&&h.startTime&&o.putMetric(kC,Math.floor(h.startTime*1e3)),s&&o.putMetric(AC,Math.floor(s*1e3))}oc(o)}static createUserTimingTrace(e,t){const i=new ii(e,t,!1,t);oc(i)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ov(n,e){const t=e;if(!t||t.responseStart===void 0)return;const i=Oe.getInstance().getTimeOrigin(),s=Math.floor((t.startTime+i)*1e3),r=t.responseStart?Math.floor((t.responseStart-t.startTime)*1e3):void 0,o=Math.floor((t.responseEnd-t.startTime)*1e3),a=t.name&&t.name.split("?")[0],c={performanceController:n,url:a,responsePayloadBytes:t.transferSize,startTimeUs:s,timeToResponseInitiatedUs:r,timeToResponseCompletedUs:o};nj(c)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hj=5e3;function av(n){Wg()&&(setTimeout(()=>fj(n),0),setTimeout(()=>dj(n),0),setTimeout(()=>pj(n),0))}function dj(n){const e=Oe.getInstance(),t=e.getEntriesByType("resource");for(const i of t)ov(n,i);e.setupObserver("resource",i=>ov(n,i))}function fj(n){const e=Oe.getInstance(),t=e.getEntriesByType("navigation"),i=e.getEntriesByType("paint");if(e.onFirstInputDelay){let s=setTimeout(()=>{ii.createOobTrace(n,t,i),s=void 0},hj);e.onFirstInputDelay(r=>{s&&(clearTimeout(s),ii.createOobTrace(n,t,i,r))})}else ii.createOobTrace(n,t,i)}function pj(n){const e=Oe.getInstance(),t=e.getEntriesByType("measure");for(const i of t)cv(n,i);e.setupObserver("measure",i=>cv(n,i))}function cv(n,e){const t=e.name;t.substring(0,Hd.length)!==Hd&&ii.createUserTimingTrace(n,t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gj{constructor(e,t){this.app=e,this.installations=t,this.initialized=!1}_init(e){this.initialized||((e==null?void 0:e.dataCollectionEnabled)!==void 0&&(this.dataCollectionEnabled=e.dataCollectionEnabled),(e==null?void 0:e.instrumentationEnabled)!==void 0&&(this.instrumentationEnabled=e.instrumentationEnabled),Oe.getInstance().requiredApisAvailable()?_l().then(t=>{t&&(YK(),LC(this).then(()=>av(this),()=>av(this)),this.initialized=!0)}).catch(t=>{yn.info(`Environment doesn't support IndexedDB: ${t}`)}):yn.info('Firebase Performance cannot start if the browser does not support "Fetch" and "Promise", or cookies are disabled.'))}set instrumentationEnabled(e){Ct.getInstance().instrumentationEnabled=e}get instrumentationEnabled(){return Ct.getInstance().instrumentationEnabled}set dataCollectionEnabled(e){Ct.getInstance().dataCollectionEnabled=e}get dataCollectionEnabled(){return Ct.getInstance().dataCollectionEnabled}}const mj="[DEFAULT]";function _j(n,e){return n=v(n),new ii(n,e)}const yj=(n,{options:e})=>{const t=n.getProvider("app").getImmediate(),i=n.getProvider("installations-internal").getImmediate();if(t.name!==mj)throw et.create("FB not default");if(typeof window>"u")throw et.create("no window");bK(window);const s=new gj(t,i);return s._init(e),s};function vj(){Me(new X("performance",yj,"PUBLIC")),ue(ev,Gd),ue(ev,Gd,"esm2017")}vj();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wj{constructor(e,t){this.app=e,this._delegate=t}get instrumentationEnabled(){return this._delegate.instrumentationEnabled}set instrumentationEnabled(e){this._delegate.instrumentationEnabled=e}get dataCollectionEnabled(){return this._delegate.dataCollectionEnabled}set dataCollectionEnabled(e){this._delegate.dataCollectionEnabled=e}trace(e){return _j(this._delegate,e)}}const Ij="@firebase/performance-compat",Tj="0.2.3";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ej(n){n.INTERNAL.registerComponent(new X("performance-compat",bj,"PUBLIC")),n.registerVersion(Ij,Tj)}function bj(n){const e=n.getProvider("app-compat").getImmediate(),t=n.getProvider("performance").getImmediate();return new wj(e,t)}Ej(Ve);const Nh="@firebase/remote-config",lv="0.4.3";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sj{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cj="remote-config";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kj={["registration-window"]:"Undefined window object. This SDK only supports usage in a browser environment.",["registration-project-id"]:"Undefined project identifier. Check Firebase app initialization.",["registration-api-key"]:"Undefined API key. Check Firebase app initialization.",["registration-app-id"]:"Undefined app identifier. Check Firebase app initialization.",["storage-open"]:"Error thrown when opening storage. Original error: {$originalErrorMessage}.",["storage-get"]:"Error thrown when reading from storage. Original error: {$originalErrorMessage}.",["storage-set"]:"Error thrown when writing to storage. Original error: {$originalErrorMessage}.",["storage-delete"]:"Error thrown when deleting from storage. Original error: {$originalErrorMessage}.",["fetch-client-network"]:"Fetch client failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.",["fetch-timeout"]:'The config fetch request timed out.  Configure timeout using "fetchTimeoutMillis" SDK setting.',["fetch-throttle"]:'The config fetch request timed out while in an exponential backoff state. Configure timeout using "fetchTimeoutMillis" SDK setting. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.',["fetch-client-parse"]:"Fetch client could not parse response. Original error: {$originalErrorMessage}.",["fetch-status"]:"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.",["indexed-db-unavailable"]:"Indexed DB is not supported by current browser"},mt=new xt("remoteconfig","Remote Config",kj);function Aj(n,e){return n instanceof je&&n.code.indexOf(e)!==-1}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rj=!1,Nj="",uv=0,Dj=["1","true","t","yes","y","on"];class Dh{constructor(e,t=Nj){this._source=e,this._value=t}asString(){return this._value}asBoolean(){return this._source==="static"?Rj:Dj.indexOf(this._value.toLowerCase())>=0}asNumber(){if(this._source==="static")return uv;let e=Number(this._value);return isNaN(e)&&(e=uv),e}getSource(){return this._source}}async function $C(n){const e=v(n),[t,i]=await Promise.all([e._storage.getLastSuccessfulFetchResponse(),e._storage.getActiveConfigEtag()]);return!t||!t.config||!t.eTag||t.eTag===i?!1:(await Promise.all([e._storageCache.setActiveConfig(t.config),e._storage.setActiveConfigEtag(t.eTag)]),!0)}function BC(n){const e=v(n);return e._initializePromise||(e._initializePromise=e._storageCache.loadFromStorage().then(()=>{e._isInitializationComplete=!0})),e._initializePromise}async function qC(n){const e=v(n),t=new Sj;setTimeout(async()=>{t.abort()},e.settings.fetchTimeoutMillis);try{await e._client.fetch({cacheMaxAgeMillis:e.settings.minimumFetchIntervalMillis,signal:t}),await e._storageCache.setLastFetchStatus("success")}catch(i){const s=Aj(i,"fetch-throttle")?"throttle":"failure";throw await e._storageCache.setLastFetchStatus(s),i}}function Pj(n){const e=v(n);return Fj(e._storageCache.getActiveConfig(),e.defaultConfig).reduce((t,i)=>(t[i]=qa(n,i),t),{})}function xj(n,e){return qa(v(n),e).asBoolean()}function Oj(n,e){return qa(v(n),e).asNumber()}function Mj(n,e){return qa(v(n),e).asString()}function qa(n,e){const t=v(n);t._isInitializationComplete||t._logger.debug(`A value was requested for key "${e}" before SDK initialization completed. Await on ensureInitialized if the intent was to get a previously activated value.`);const i=t._storageCache.getActiveConfig();return i&&i[e]!==void 0?new Dh("remote",i[e]):t.defaultConfig&&t.defaultConfig[e]!==void 0?new Dh("default",String(t.defaultConfig[e])):(t._logger.debug(`Returning static value for key "${e}". Define a default or remote value if this is unintentional.`),new Dh("static"))}function Lj(n,e){const t=v(n);switch(e){case"debug":t._logger.logLevel=kt.DEBUG;break;case"silent":t._logger.logLevel=kt.SILENT;break;default:t._logger.logLevel=kt.ERROR}}function Fj(n={},e={}){return Object.keys(Object.assign(Object.assign({},n),e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uj{constructor(e,t,i,s){this.client=e,this.storage=t,this.storageCache=i,this.logger=s}isCachedDataFresh(e,t){if(!t)return this.logger.debug("Config fetch cache check. Cache unpopulated."),!1;const i=Date.now()-t,s=i<=e;return this.logger.debug(`Config fetch cache check. Cache age millis: ${i}. Cache max age millis (minimumFetchIntervalMillis setting): ${e}. Is cache hit: ${s}.`),s}async fetch(e){const[t,i]=await Promise.all([this.storage.getLastSuccessfulFetchTimestampMillis(),this.storage.getLastSuccessfulFetchResponse()]);if(i&&this.isCachedDataFresh(e.cacheMaxAgeMillis,t))return i;e.eTag=i&&i.eTag;const s=await this.client.fetch(e),r=[this.storageCache.setLastSuccessfulFetchTimestampMillis(Date.now())];return s.status===200&&r.push(this.storage.setLastSuccessfulFetchResponse(s)),await Promise.all(r),s}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vj(n=navigator){return n.languages&&n.languages[0]||n.language}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $j{constructor(e,t,i,s,r,o){this.firebaseInstallations=e,this.sdkVersion=t,this.namespace=i,this.projectId=s,this.apiKey=r,this.appId=o}async fetch(e){const[t,i]=await Promise.all([this.firebaseInstallations.getId(),this.firebaseInstallations.getToken()]),r=`${window.FIREBASE_REMOTE_CONFIG_URL_BASE||"https://firebaseremoteconfig.googleapis.com"}/v1/projects/${this.projectId}/namespaces/${this.namespace}:fetch?key=${this.apiKey}`,o={"Content-Type":"application/json","Content-Encoding":"gzip","If-None-Match":e.eTag||"*"},a={sdk_version:this.sdkVersion,app_instance_id:t,app_instance_id_token:i,app_id:this.appId,language_code:Vj()},c={method:"POST",headers:o,body:JSON.stringify(a)},l=fetch(r,c),u=new Promise((w,N)=>{e.signal.addEventListener(()=>{const M=new Error("The operation was aborted.");M.name="AbortError",N(M)})});let h;try{await Promise.race([l,u]),h=await l}catch(w){let N="fetch-client-network";throw(w==null?void 0:w.name)==="AbortError"&&(N="fetch-timeout"),mt.create(N,{originalErrorMessage:w==null?void 0:w.message})}let d=h.status;const f=h.headers.get("ETag")||void 0;let p,_;if(h.status===200){let w;try{w=await h.json()}catch(N){throw mt.create("fetch-client-parse",{originalErrorMessage:N==null?void 0:N.message})}p=w.entries,_=w.state}if(_==="INSTANCE_STATE_UNSPECIFIED"?d=500:_==="NO_CHANGE"?d=304:(_==="NO_TEMPLATE"||_==="EMPTY_CONFIG")&&(p={}),d!==304&&d!==200)throw mt.create("fetch-status",{httpStatus:d});return{status:d,eTag:f,config:p}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bj(n,e){return new Promise((t,i)=>{const s=Math.max(e-Date.now(),0),r=setTimeout(t,s);n.addEventListener(()=>{clearTimeout(r),i(mt.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function qj(n){if(!(n instanceof je)||!n.customData)return!1;const e=Number(n.customData.httpStatus);return e===429||e===500||e===503||e===504}class Wj{constructor(e,t){this.client=e,this.storage=t}async fetch(e){const t=await this.storage.getThrottleMetadata()||{backoffCount:0,throttleEndTimeMillis:Date.now()};return this.attemptFetch(e,t)}async attemptFetch(e,{throttleEndTimeMillis:t,backoffCount:i}){await Bj(e.signal,t);try{const s=await this.client.fetch(e);return await this.storage.deleteThrottleMetadata(),s}catch(s){if(!qj(s))throw s;const r={throttleEndTimeMillis:Date.now()+yc(i),backoffCount:i+1};return await this.storage.setThrottleMetadata(r),this.attemptFetch(e,r)}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kj=60*1e3,jj=12*60*60*1e3;class Gj{constructor(e,t,i,s,r){this.app=e,this._client=t,this._storageCache=i,this._storage=s,this._logger=r,this._isInitializationComplete=!1,this.settings={fetchTimeoutMillis:Kj,minimumFetchIntervalMillis:jj},this.defaultConfig={}}get fetchTimeMillis(){return this._storageCache.getLastSuccessfulFetchTimestampMillis()||-1}get lastFetchStatus(){return this._storageCache.getLastFetchStatus()||"no-fetch-yet"}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _c(n,e){const t=n.target.error||void 0;return mt.create(e,{originalErrorMessage:t&&(t==null?void 0:t.message)})}const Ni="app_namespace_store",Hj="firebase_remote_config",zj=1;function Qj(){return new Promise((n,e)=>{try{const t=indexedDB.open(Hj,zj);t.onerror=i=>{e(_c(i,"storage-open"))},t.onsuccess=i=>{n(i.target.result)},t.onupgradeneeded=i=>{const s=i.target.result;switch(i.oldVersion){case 0:s.createObjectStore(Ni,{keyPath:"compositeKey"})}}}catch(t){e(mt.create("storage-open",{originalErrorMessage:t==null?void 0:t.message}))}})}class Yj{constructor(e,t,i,s=Qj()){this.appId=e,this.appName=t,this.namespace=i,this.openDbPromise=s}getLastFetchStatus(){return this.get("last_fetch_status")}setLastFetchStatus(e){return this.set("last_fetch_status",e)}getLastSuccessfulFetchTimestampMillis(){return this.get("last_successful_fetch_timestamp_millis")}setLastSuccessfulFetchTimestampMillis(e){return this.set("last_successful_fetch_timestamp_millis",e)}getLastSuccessfulFetchResponse(){return this.get("last_successful_fetch_response")}setLastSuccessfulFetchResponse(e){return this.set("last_successful_fetch_response",e)}getActiveConfig(){return this.get("active_config")}setActiveConfig(e){return this.set("active_config",e)}getActiveConfigEtag(){return this.get("active_config_etag")}setActiveConfigEtag(e){return this.set("active_config_etag",e)}getThrottleMetadata(){return this.get("throttle_metadata")}setThrottleMetadata(e){return this.set("throttle_metadata",e)}deleteThrottleMetadata(){return this.delete("throttle_metadata")}async get(e){const t=await this.openDbPromise;return new Promise((i,s)=>{const o=t.transaction([Ni],"readonly").objectStore(Ni),a=this.createCompositeKey(e);try{const c=o.get(a);c.onerror=l=>{s(_c(l,"storage-get"))},c.onsuccess=l=>{const u=l.target.result;i(u?u.value:void 0)}}catch(c){s(mt.create("storage-get",{originalErrorMessage:c==null?void 0:c.message}))}})}async set(e,t){const i=await this.openDbPromise;return new Promise((s,r)=>{const a=i.transaction([Ni],"readwrite").objectStore(Ni),c=this.createCompositeKey(e);try{const l=a.put({compositeKey:c,value:t});l.onerror=u=>{r(_c(u,"storage-set"))},l.onsuccess=()=>{s()}}catch(l){r(mt.create("storage-set",{originalErrorMessage:l==null?void 0:l.message}))}})}async delete(e){const t=await this.openDbPromise;return new Promise((i,s)=>{const o=t.transaction([Ni],"readwrite").objectStore(Ni),a=this.createCompositeKey(e);try{const c=o.delete(a);c.onerror=l=>{s(_c(l,"storage-delete"))},c.onsuccess=()=>{i()}}catch(c){s(mt.create("storage-delete",{originalErrorMessage:c==null?void 0:c.message}))}})}createCompositeKey(e){return[this.appId,this.appName,this.namespace,e].join()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xj{constructor(e){this.storage=e}getLastFetchStatus(){return this.lastFetchStatus}getLastSuccessfulFetchTimestampMillis(){return this.lastSuccessfulFetchTimestampMillis}getActiveConfig(){return this.activeConfig}async loadFromStorage(){const e=this.storage.getLastFetchStatus(),t=this.storage.getLastSuccessfulFetchTimestampMillis(),i=this.storage.getActiveConfig(),s=await e;s&&(this.lastFetchStatus=s);const r=await t;r&&(this.lastSuccessfulFetchTimestampMillis=r);const o=await i;o&&(this.activeConfig=o)}setLastFetchStatus(e){return this.lastFetchStatus=e,this.storage.setLastFetchStatus(e)}setLastSuccessfulFetchTimestampMillis(e){return this.lastSuccessfulFetchTimestampMillis=e,this.storage.setLastSuccessfulFetchTimestampMillis(e)}setActiveConfig(e){return this.activeConfig=e,this.storage.setActiveConfig(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jj(){Me(new X(Cj,n,"PUBLIC").setMultipleInstances(!0)),ue(Nh,lv),ue(Nh,lv,"esm2017");function n(e,{instanceIdentifier:t}){const i=e.getProvider("app").getImmediate(),s=e.getProvider("installations-internal").getImmediate();if(typeof window>"u")throw mt.create("registration-window");if(!Rt())throw mt.create("indexed-db-unavailable");const{projectId:r,apiKey:o,appId:a}=i.options;if(!r)throw mt.create("registration-project-id");if(!o)throw mt.create("registration-api-key");if(!a)throw mt.create("registration-app-id");t=t||"firebase";const c=new Yj(a,i.name,t),l=new Xj(c),u=new On(Nh);u.logLevel=kt.ERROR;const h=new $j(s,Mn,t,r,o,a),d=new Wj(h,c),f=new Uj(d,c,l,u),p=new Gj(i,f,l,c,u);return BC(p),p}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Zj(n){return n=v(n),await qC(n),$C(n)}async function eG(){if(!Rt())return!1;try{return await _l()}catch{return!1}}Jj();/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class tG{constructor(e,t){this.app=e,this._delegate=t}get defaultConfig(){return this._delegate.defaultConfig}set defaultConfig(e){this._delegate.defaultConfig=e}get fetchTimeMillis(){return this._delegate.fetchTimeMillis}get lastFetchStatus(){return this._delegate.lastFetchStatus}get settings(){return this._delegate.settings}set settings(e){this._delegate.settings=e}activate(){return $C(this._delegate)}ensureInitialized(){return BC(this._delegate)}fetch(){return qC(this._delegate)}fetchAndActivate(){return Zj(this._delegate)}getAll(){return Pj(this._delegate)}getBoolean(e){return xj(this._delegate,e)}getNumber(e){return Oj(this._delegate,e)}getString(e){return Mj(this._delegate,e)}getValue(e){return qa(this._delegate,e)}setLogLevel(e){Lj(this._delegate,e)}}const nG="@firebase/remote-config-compat",iG="0.2.3";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sG(n){n.INTERNAL.registerComponent(new X("remoteConfig-compat",rG,"PUBLIC").setMultipleInstances(!0).setServiceProps({isSupported:eG})),n.registerVersion(nG,iG)}function rG(n,{instanceIdentifier:e}){const t=n.getProvider("app-compat").getImmediate(),i=n.getProvider("remote-config").getImmediate({identifier:e});return new tG(t,i)}sG(Ve);var oG="firebase",aG="9.17.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Ve.registerVersion(oG,aG,"app-compat");var cG="firebase",lG="9.17.1";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */console.warn(`
It looks like you're using the development build of the Firebase JS SDK.
When deploying Firebase apps to production, it is advisable to only import
the individual SDK components you intend to use.

For the module builds, these are available in the following manner
(replace <PACKAGE> with the name of a component - i.e. auth, database, etc):

CommonJS Modules:
const firebase = require('firebase/app');
require('firebase/<PACKAGE>');

ES Modules:
import firebase from 'firebase/app';
import 'firebase/<PACKAGE>';

Typescript:
import firebase from 'firebase/app';
import 'firebase/<PACKAGE>';
`);Ve.registerVersion(cG,lG,"compat");export{Ve as f};
